function _toConsumableArray(i){return _arrayWithoutHoles(i)||_iterableToArray(i)||_unsupportedIterableToArray(i)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(i){if(typeof Symbol!=="undefined"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function _arrayWithoutHoles(i){if(Array.isArray(i))return _arrayLikeToArray(i)}function _createForOfIteratorHelper(i,u){var d=typeof Symbol!=="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(!d){if(Array.isArray(i)||(d=_unsupportedIterableToArray(i))||u&&i&&typeof i.length==="number"){d&&(i=d);var h=0;var m=function F(){};return{s:m,n:function n(){return h>=i.length?{done:true}:{done:false,value:i[h++]}},e:function e(i){throw i},f:m}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var v,g=true,y=false;return{s:function s(){d=d.call(i)},n:function n(){var i=d.next();g=i.done;return i},e:function e(i){y=true;v=i},f:function f(){try{g||d.return==null||d.return()}finally{if(y)throw v}}}}function _unsupportedIterableToArray(i,u){if(i){if(typeof i==="string")return _arrayLikeToArray(i,u);var d=Object.prototype.toString.call(i).slice(8,-1);d==="Object"&&i.constructor&&(d=i.constructor.name);return d==="Map"||d==="Set"?Array.from(i):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?_arrayLikeToArray(i,u):void 0}}function _arrayLikeToArray(i,u){(u==null||u>i.length)&&(u=i.length);for(var d=0,h=new Array(u);d<u;d++)h[d]=i[d];return h}function _wrapNativeSuper(i){var u=typeof Map==="function"?new Map:void 0;_wrapNativeSuper=function _wrapNativeSuper(i){if(i===null||!_isNativeFunction(i))return i;if(typeof i!=="function")throw new TypeError("Super expression must either be null or a function");if(typeof u!=="undefined"){if(u.has(i))return u.get(i);u.set(i,Wrapper)}function Wrapper(){return _construct(i,arguments,_getPrototypeOf(this).constructor)}Wrapper.prototype=Object.create(i.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,i)};return _wrapNativeSuper(i)}function _construct(i,u,d){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var h=[null];h.push.apply(h,u);var m=new(i.bind.apply(i,h));return d&&_setPrototypeOf(m,d.prototype),m}function _isNativeFunction(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch(u){return typeof i==="function"}}function _callSuper(i,u,d){return u=_getPrototypeOf(u),_possibleConstructorReturn(i,_isNativeReflectConstruct()?Reflect.construct(u,d||[],_getPrototypeOf(i).constructor):u.apply(i,d))}function _possibleConstructorReturn(i,u){if(u&&(_typeof(u)==="object"||typeof u==="function"))return u;if(u!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(i)}function _assertThisInitialized(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function _isNativeReflectConstruct(){try{var i=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(i){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!i})()}function _getPrototypeOf(i){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(i){return i.__proto__||Object.getPrototypeOf(i)};return _getPrototypeOf(i)}function _inherits(i,u){if(typeof u!=="function"&&u!==null)throw new TypeError("Super expression must either be null or a function");i.prototype=Object.create(u&&u.prototype,{constructor:{value:i,writable:true,configurable:true}});Object.defineProperty(i,"prototype",{writable:false});u&&_setPrototypeOf(i,u)}function _setPrototypeOf(i,u){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(i,u){i.__proto__=u;return i};return _setPrototypeOf(i,u)}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return u};var i,u={},d=Object.prototype,h=d.hasOwnProperty,m=Object.defineProperty||function(i,u,d){i[u]=d.value},v="function"==typeof Symbol?Symbol:{},g=v.iterator||"@@iterator",y=v.asyncIterator||"@@asyncIterator",b=v.toStringTag||"@@toStringTag";function define(i,u,d){return Object.defineProperty(i,u,{value:d,enumerable:!0,configurable:!0,writable:!0}),i[u]}try{define({},"")}catch(i){define=function define(i,u,d){return i[u]=d}}function wrap(i,u,d,h){var v=u&&u.prototype instanceof Generator?u:Generator,g=Object.create(v.prototype),y=new Context(h||[]);return m(g,"_invoke",{value:makeInvokeMethod(i,d,y)}),g}function tryCatch(i,u,d){try{return{type:"normal",arg:i.call(u,d)}}catch(i){return{type:"throw",arg:i}}}u.wrap=wrap;var x="suspendedStart",A="suspendedYield",P="executing",D="completed",q={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var V={};define(V,g,(function(){return this}));var J=Object.getPrototypeOf,X=J&&J(J(values([])));X&&X!==d&&h.call(X,g)&&(V=X);var oe=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(V);function defineIteratorMethods(i){["next","throw","return"].forEach((function(u){define(i,u,(function(i){return this._invoke(u,i)}))}))}function AsyncIterator(i,u){function invoke(d,m,v,g){var y=tryCatch(i[d],i,m);if("throw"!==y.type){var b=y.arg,x=b.value;return x&&"object"==_typeof(x)&&h.call(x,"__await")?u.resolve(x.__await).then((function(i){invoke("next",i,v,g)}),(function(i){invoke("throw",i,v,g)})):u.resolve(x).then((function(i){b.value=i,v(b)}),(function(i){return invoke("throw",i,v,g)}))}g(y.arg)}var d;m(this,"_invoke",{value:function value(i,h){function callInvokeWithMethodAndArg(){return new u((function(u,d){invoke(i,h,u,d)}))}return d=d?d.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(u,d,h){var m=x;return function(v,g){if(m===P)throw Error("Generator is already running");if(m===D){if("throw"===v)throw g;return{value:i,done:!0}}for(h.method=v,h.arg=g;;){var y=h.delegate;if(y){var b=maybeInvokeDelegate(y,h);if(b){if(b===q)continue;return b}}if("next"===h.method)h.sent=h._sent=h.arg;else if("throw"===h.method){if(m===x)throw m=D,h.arg;h.dispatchException(h.arg)}else"return"===h.method&&h.abrupt("return",h.arg);m=P;var V=tryCatch(u,d,h);if("normal"===V.type){if(m=h.done?D:A,V.arg===q)continue;return{value:V.arg,done:h.done}}"throw"===V.type&&(m=D,h.method="throw",h.arg=V.arg)}}}function maybeInvokeDelegate(u,d){var h=d.method,m=u.iterator[h];if(m===i)return d.delegate=null,"throw"===h&&u.iterator.return&&(d.method="return",d.arg=i,maybeInvokeDelegate(u,d),"throw"===d.method)||"return"!==h&&(d.method="throw",d.arg=new TypeError("The iterator does not provide a '"+h+"' method")),q;var v=tryCatch(m,u.iterator,d.arg);if("throw"===v.type)return d.method="throw",d.arg=v.arg,d.delegate=null,q;var g=v.arg;return g?g.done?(d[u.resultName]=g.value,d.next=u.nextLoc,"return"!==d.method&&(d.method="next",d.arg=i),d.delegate=null,q):g:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,q)}function pushTryEntry(i){var u={tryLoc:i[0]};1 in i&&(u.catchLoc=i[1]),2 in i&&(u.finallyLoc=i[2],u.afterLoc=i[3]),this.tryEntries.push(u)}function resetTryEntry(i){var u=i.completion||{};u.type="normal",delete u.arg,i.completion=u}function Context(i){this.tryEntries=[{tryLoc:"root"}],i.forEach(pushTryEntry,this),this.reset(!0)}function values(u){if(u||""===u){var d=u[g];if(d)return d.call(u);if("function"==typeof u.next)return u;if(!isNaN(u.length)){var m=-1,v=function next(){for(;++m<u.length;)if(h.call(u,m))return next.value=u[m],next.done=!1,next;return next.value=i,next.done=!0,next};return v.next=v}}throw new TypeError(_typeof(u)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,m(oe,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),m(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,b,"GeneratorFunction"),u.isGeneratorFunction=function(i){var u="function"==typeof i&&i.constructor;return!!u&&(u===GeneratorFunction||"GeneratorFunction"===(u.displayName||u.name))},u.mark=function(i){return Object.setPrototypeOf?Object.setPrototypeOf(i,GeneratorFunctionPrototype):(i.__proto__=GeneratorFunctionPrototype,define(i,b,"GeneratorFunction")),i.prototype=Object.create(oe),i},u.awrap=function(i){return{__await:i}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,y,(function(){return this})),u.AsyncIterator=AsyncIterator,u.async=function(i,d,h,m,v){void 0===v&&(v=Promise);var g=new AsyncIterator(wrap(i,d,h,m),v);return u.isGeneratorFunction(d)?g:g.next().then((function(i){return i.done?i.value:g.next()}))},defineIteratorMethods(oe),define(oe,b,"Generator"),define(oe,g,(function(){return this})),define(oe,"toString",(function(){return"[object Generator]"})),u.keys=function(i){var u=Object(i),d=[];for(var h in u)d.push(h);return d.reverse(),function next(){for(;d.length;){var i=d.pop();if(i in u)return next.value=i,next.done=!1,next}return next.done=!0,next}},u.values=values,Context.prototype={constructor:Context,reset:function reset(u){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(resetTryEntry),!u)for(var d in this)"t"===d.charAt(0)&&h.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=i)},stop:function stop(){this.done=!0;var i=this.tryEntries[0].completion;if("throw"===i.type)throw i.arg;return this.rval},dispatchException:function dispatchException(u){if(this.done)throw u;var d=this;function handle(h,m){return g.type="throw",g.arg=u,d.next=h,m&&(d.method="next",d.arg=i),!!m}for(var m=this.tryEntries.length-1;m>=0;--m){var v=this.tryEntries[m],g=v.completion;if("root"===v.tryLoc)return handle("end");if(v.tryLoc<=this.prev){var y=h.call(v,"catchLoc"),b=h.call(v,"finallyLoc");if(y&&b){if(this.prev<v.catchLoc)return handle(v.catchLoc,!0);if(this.prev<v.finallyLoc)return handle(v.finallyLoc)}else if(y){if(this.prev<v.catchLoc)return handle(v.catchLoc,!0)}else{if(!b)throw Error("try statement without catch or finally");if(this.prev<v.finallyLoc)return handle(v.finallyLoc)}}}},abrupt:function abrupt(i,u){for(var d=this.tryEntries.length-1;d>=0;--d){var m=this.tryEntries[d];if(m.tryLoc<=this.prev&&h.call(m,"finallyLoc")&&this.prev<m.finallyLoc){var v=m;break}}v&&("break"===i||"continue"===i)&&v.tryLoc<=u&&u<=v.finallyLoc&&(v=null);var g=v?v.completion:{};return g.type=i,g.arg=u,v?(this.method="next",this.next=v.finallyLoc,q):this.complete(g)},complete:function complete(i,u){if("throw"===i.type)throw i.arg;return"break"===i.type||"continue"===i.type?this.next=i.arg:"return"===i.type?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):"normal"===i.type&&u&&(this.next=u),q},finish:function finish(i){for(var u=this.tryEntries.length-1;u>=0;--u){var d=this.tryEntries[u];if(d.finallyLoc===i)return this.complete(d.completion,d.afterLoc),resetTryEntry(d),q}},catch:function _catch(i){for(var u=this.tryEntries.length-1;u>=0;--u){var d=this.tryEntries[u];if(d.tryLoc===i){var h=d.completion;if("throw"===h.type){var m=h.arg;resetTryEntry(d)}return m}}throw Error("illegal catch attempt")},delegateYield:function delegateYield(u,d,h){return this.delegate={iterator:values(u),resultName:d,nextLoc:h},"next"===this.method&&(this.arg=i),q}},u}function asyncGeneratorStep(i,u,d,h,m,v,g){try{var y=i[v](g);var b=y.value}catch(i){d(i);return}y.done?u(b):Promise.resolve(b).then(h,m)}function _asyncToGenerator(i){return function(){var u=this,d=arguments;return new Promise((function(h,m){var v=i.apply(u,d);function _next(i){asyncGeneratorStep(v,h,m,_next,_throw,"next",i)}function _throw(i){asyncGeneratorStep(v,h,m,_next,_throw,"throw",i)}_next(void 0)}))}}function ownKeys(i,u){var d=Object.keys(i);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(i);u&&(h=h.filter((function(u){return Object.getOwnPropertyDescriptor(i,u).enumerable}))),d.push.apply(d,h)}return d}function _objectSpread(i){for(var u=1;u<arguments.length;u++){var d=null!=arguments[u]?arguments[u]:{};u%2?ownKeys(Object(d),!0).forEach((function(u){_defineProperty(i,u,d[u])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(d)):ownKeys(Object(d)).forEach((function(u){Object.defineProperty(i,u,Object.getOwnPropertyDescriptor(d,u))}))}return i}function _defineProperty(i,u,d){u=_toPropertyKey(u);u in i?Object.defineProperty(i,u,{value:d,enumerable:true,configurable:true,writable:true}):i[u]=d;return i}function _typeof(i){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof(i)}function _classCallCheck(i,u){if(!(i instanceof u))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,u){for(var d=0;d<u.length;d++){var h=u[d];h.enumerable=h.enumerable||false;h.configurable=true;"value"in h&&(h.writable=true);Object.defineProperty(i,_toPropertyKey(h.key),h)}}function _createClass(i,u,d){u&&_defineProperties(i.prototype,u);d&&_defineProperties(i,d);Object.defineProperty(i,"prototype",{writable:false});return i}function _toPropertyKey(i){var u=_toPrimitive(i,"string");return"symbol"==_typeof(u)?u:u+""}function _toPrimitive(i,u){if("object"!=_typeof(i)||!i)return i;var d=i[Symbol.toPrimitive];if(void 0!==d){var h=d.call(i,u||"default");if("object"!=_typeof(h))return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===u?String:Number)(i)}var i=function(){function us(){_classCallCheck(this,us)}return _createClass(us,null,[{key:"render",value:function render(i,u){var d=document.createElement("div");d.id="error-view",d.innerText=u,i.replaceChildren(d)}}])}();var u=function(){function Xt(){_classCallCheck(this,Xt)}return _createClass(Xt,null,[{key:"onLoad",value:function onLoad(i){i.innerHTML='<div id="large-loading-ring"></div>'}},{key:"createElements",value:function createElements(){var i=document.createElement("div");return i.id="validate-property-key-view",i}},{key:"render",value:function render(u,d,h){var m=Xt.createElements(),v={onSuccess:d,onFail:i.render.bind(this,u,"Your 'key' has failed authentication"),onLoad:Xt.onLoad.bind(this,m)};h.key&&h.verifyKey(h.key,v),u.replaceChildren(m)}}])}();var d=function(){function M(){_classCallCheck(this,M)}return _createClass(M,null,[{key:"unsetStyle",value:function unsetStyle(i,u){var d=Object.keys(u).reduce((function(i,u){return i[u]="",i}),{});Object.assign(i.style,d)}},{key:"unsetActivityCSSMouseStates",value:function unsetActivityCSSMouseStates(i,u){u.click&&M.unsetStyle(i,u.click),u.hover&&M.unsetStyle(i,u.hover)}},{key:"unsetAllCSSMouseStates",value:function unsetAllCSSMouseStates(i,u){M.unsetActivityCSSMouseStates(i,u),u.default&&M.unsetStyle(i,u.default)}},{key:"processStateful",value:function processStateful(i,u,d){var h=i.default||{},m=Object.assign(JSON.parse(JSON.stringify(_objectSpread(_objectSpread({},h),u))),i==null?void 0:i.hover),v=Object.assign(JSON.parse(JSON.stringify(_objectSpread(_objectSpread({},m),d))),i==null?void 0:i.click);return{default:h,hover:m,click:v}}},{key:"mergeStatefulStyles",value:function mergeStatefulStyles(i){var u={default:{},hover:{},click:{}};return i.forEach((function(i){u.default=Object.assign(u.default,i.default),u.hover=Object.assign(u.hover,i.hover),u.click=Object.assign(u.click,i.click)})),u}},{key:"overwriteDefaultWithAlreadyApplied",value:function overwriteDefaultWithAlreadyApplied(i,u){Object.keys(i.default||[]).forEach((function(d){var h;var m=d;u.style[m]&&(h=i.default)!=null&&h[m]&&(i.default[d]=u.style[m])}))}},{key:"applyToStyleIfNotDefined",value:function applyToStyleIfNotDefined(i,u){for(var d in u){var h=u[d];i[d]===""&&h&&(i[d]=h)}}}])}();var h=function(){function je(){_classCallCheck(this,je)}return _createClass(je,null,[{key:"attemptAppendStyleSheetToHead",value:function attemptAppendStyleSheetToHead(i){if(!i.fontFamily||i.fontFamily===je.DEFAULT_FONT_FAMILY){var u=document.getElementsByTagName("head")[0];if(!Array.from(u.getElementsByTagName("link")).some((function(i){return i.getAttribute("href")===je.FONT_URL}))){var d=document.createElement("link");d.rel="stylesheet",d.href=je.FONT_URL,u.appendChild(d)}}}}])}();h.FONT_URL="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap",h.DEFAULT_FONT_FAMILY="'Inter', sans-serif, Avenir, Helvetica, Arial";var m=h;var v=function(){function nt(){_classCallCheck(this,nt)}return _createClass(nt,null,[{key:"apply",value:function apply(i,u){if(u)try{nt.applyStyleSheet(i,u)}catch(d){nt.addStyleElement(i,u)}}},{key:"applyStyleSheet",value:function applyStyleSheet(i,u){var d=new CSSStyleSheet;d.replaceSync(i),u.adoptedStyleSheets.push(d)}},{key:"addStyleElement",value:function addStyleElement(i,u){var d=document.createElement("style");d.innerHTML=i,u.appendChild(d)}},{key:"applyDefaultStyleToComponent",value:function applyDefaultStyleToComponent(i,u){u&&d.applyToStyleIfNotDefined(i,u),d.applyToStyleIfNotDefined(i,nt.DEFAULT_COMPONENT_STYLE)}}])}();v.DEFAULT_COMPONENT_STYLE={height:"350px",width:"320px",border:"1px solid #cacaca",fontFamily:m.DEFAULT_FONT_FAMILY,fontSize:"0.9rem",backgroundColor:"white",position:"relative",overflow:"hidden"};var g=v;var y,b=function(i){return i.ESCAPE="Escape",i.ENTER="Enter",i.TAB="Tab",i.ARROW_UP="ArrowUp",i.ARROW_DOWN="ArrowDown",i.ARROW_RIGHT="ArrowRight",i.ARROW_LEFT="ArrowLeft",i.BACKSPACE="Backspace",i.DELETE="Delete",i.META="Meta",i.CONTROL="Control",i}(b||{});var x=(y=_createClass((function ft(){_classCallCheck(this,ft)})),y.IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),y.IS_CHROMIUM=window.chrome,y);var A=function(){function Ue(){_classCallCheck(this,Ue)}return _createClass(Ue,null,[{key:"add",value:function add(i,u,d,h){d!==void 0&&i.addEventListener("keydown",Ue.onKeyDown.bind(this,d)),i.oninput=Ue.onInput.bind(this,d,h),i.addEventListener("paste",(function(i){var d;i.preventDefault(),(d=i.clipboardData)!=null&&d.files.length&&u.addFilesToAnyType(Array.from(i.clipboardData.files))}))}},{key:"onKeyDown",value:function onKeyDown(i,u){var d=u.target.textContent;d&&d.length>=i&&!Ue.PERMITTED_KEYS.has(u.key)&&!Ue.isKeyCombinationPermitted(u)&&u.preventDefault()}},{key:"isKeyCombinationPermitted",value:function isKeyCombinationPermitted(i){return i.key==="a"&&(i.ctrlKey||i.metaKey)}},{key:"onInput",value:function onInput(i,u,d){var h=d.target,m=h.textContent||"";i!==void 0&&m.length>i&&(h.textContent=m.substring(0,i),J.focusEndOfInput(h)),u==null||u()}}])}();A.PERMITTED_KEYS=new Set([b.BACKSPACE,b.DELETE,b.ARROW_RIGHT,b.ARROW_LEFT,b.ARROW_DOWN,b.ARROW_UP,b.META,b.CONTROL,b.ENTER]);var P=A;var D=function(){function fs(){_classCallCheck(this,fs)}return _createClass(fs,null,[{key:"sanitizePastedTextContent",value:function sanitizePastedTextContent(i){var u,d;i.preventDefault();var h=(u=i.clipboardData)==null?void 0:u.getData("text/plain");h&&((d=document.execCommand)==null||d.call(document,"insertText",!1,h))}}])}();var q=function(){function Me(i,u,d){var h=this;_classCallCheck(this,Me);var m;var v=Me.processConfig(u,i.textInput);this.elementRef=Me.createContainerElement((m=v==null?void 0:v.styles)==null?void 0:m.container),this.inputElementRef=this.createInputElement(v),this._config=v,this.elementRef.appendChild(this.inputElementRef),setTimeout((function(){var u;P.add(h.inputElementRef,d,(u=i.textInput)==null?void 0:u.characterLimit,i._validationHandler)}))}return _createClass(Me,[{key:"createInputElement",value:function createInputElement(i){var u,d,h;var m=document.createElement("div");return m.id=Me.TEXT_INPUT_ID,m.classList.add("text-input-styling","text-input-placeholder"),m.innerText=((u=i==null?void 0:i.placeholder)==null?void 0:u.text)||"Ask me anything!",x.IS_CHROMIUM&&Me.preventAutomaticScrollUpOnNewLine(m),typeof(i==null?void 0:i.disabled)=="boolean"&&i.disabled===!0?(m.contentEditable="false",m.classList.add("text-input-disabled")):(m.contentEditable="true",this.addEventListeners(m,i)),Object.assign(m.style,(d=i==null?void 0:i.styles)==null?void 0:d.text),Object.assign(m.style,(h=i==null?void 0:i.placeholder)==null?void 0:h.style),m}},{key:"removeTextIfPlaceholder",value:function removeTextIfPlaceholder(){var i,u,h,m;this.inputElementRef.classList.contains("text-input-placeholder")&&!this.inputElementRef.classList.contains("text-input-disabled")&&((i=this._config.placeholder)!=null&&i.style&&(d.unsetStyle(this.inputElementRef,(u=this._config.placeholder)==null?void 0:u.style),Object.assign(this.inputElementRef.style,(m=(h=this._config)==null?void 0:h.styles)==null?void 0:m.text)),Me.clear(this.inputElementRef),this.inputElementRef.classList.remove("text-input-placeholder"))}},{key:"addEventListeners",value:function addEventListeners(i,u){var d,h,m;i.onfocus=this.onFocus.bind(this,(d=u==null?void 0:u.styles)==null?void 0:d.focus),(h=u==null?void 0:u.styles)!=null&&h.focus&&(i.onblur=this.onBlur.bind(this,u.styles.focus,(m=u==null?void 0:u.styles)==null?void 0:m.container)),i.addEventListener("keydown",this.onKeydown.bind(this)),i.addEventListener("paste",D.sanitizePastedTextContent)}},{key:"onFocus",value:function onFocus(i){var u=this;x.IS_SAFARI?setTimeout((function(){u.removeTextIfPlaceholder()})):this.removeTextIfPlaceholder(),Object.assign(this.elementRef.style,i)}},{key:"onBlur",value:function onBlur(i,u){d.unsetStyle(this.elementRef,i),u&&Object.assign(this.elementRef.style,u)}},{key:"onKeydown",value:function onKeydown(i){var u;i.key===b.ENTER&&!i.ctrlKey&&!i.shiftKey&&(i.preventDefault(),(u=this.submit)==null||u.call(this))}}],[{key:"processConfig",value:function processConfig(i,u){var d,h,m,v;var g;return(d=u)!==null&&d!==void 0?d:u={},(h=u.disabled)!==null&&h!==void 0?h:u.disabled=i.isTextInputDisabled,(m=u.placeholder)!==null&&m!==void 0?m:u.placeholder={},(v=(g=u.placeholder).text)!==null&&v!==void 0?v:g.text=i.textInputPlaceholderText,u}},{key:"preventAutomaticScrollUpOnNewLine",value:function preventAutomaticScrollUpOnNewLine(i){var u;i.addEventListener("keydown",(function(){u=window.scrollY})),i.addEventListener("input",(function(){u!==window.scrollY&&window.scrollTo({top:u})}))}},{key:"clear",value:function clear(i){var u=window.scrollY;i.classList.contains("text-input-disabled")||(i.textContent=""),x.IS_CHROMIUM&&window.scrollTo({top:u})}},{key:"toggleEditability",value:function toggleEditability(i,u){i.contentEditable=u?"true":"false"}},{key:"createContainerElement",value:function createContainerElement(i){var u=document.createElement("div");return u.id="text-input-container",Object.assign(u.style,i),u}}])}();q.TEXT_INPUT_ID="text-input";var V=q;var J=function(){function xi(){_classCallCheck(this,xi)}return _createClass(xi,null,[{key:"focusEndOfInput",value:function focusEndOfInput(i){var u=document.createRange();u.selectNodeContents(i),u.collapse(!1);var d=window.getSelection();d==null||d.removeAllRanges(),d==null||d.addRange(u)}},{key:"focusFromParentElement",value:function focusFromParentElement(i){var u=i.querySelector("#".concat(V.TEXT_INPUT_ID));u&&xi.focusEndOfInput(u)}}])}();function En(i){return i.charAt(0).toUpperCase()+i.slice(1)}function ps(i){return i&&JSON.stringify(i)}function cn(i,u,d,h){var m="\n".concat(En(u)," message: ").concat(JSON.stringify(i)," \n"),v=d?"".concat(En(u)," message after interceptor: ").concat(ps(h)," \n"):"";return m+v}function ms(i,u,d,h){return"".concat(cn(i,u,d,h),"Make sure the ").concat(u," message is using the Response format: https://deepchat.dev/docs/connect/#Response \nYou can also augment it using the responseInterceptor property: https://deepchat.dev/docs/interceptors#responseInterceptor")}function gs(i,u,d){var h="response";return"".concat(cn(i,h,u,d),"Make sure the ").concat(h,' message is using the {text: string} format, e.g: {text: "Model Response"}')}function bs(i,u){var d="request";return"".concat(cn(i,d,u),"Make sure the ").concat(d,' message is using the {body: {text: string}} format, e.g: {body: {text: "Model Response"}}')}var X="Make sure the events are using {text: string} or {html: string} format.\nYou can also augment them using the responseInterceptor property: https://deepchat.dev/docs/interceptors#responseInterceptor",oe={INVALID_KEY:"Invalid API Key",CONNECTION_FAILED:"Failed to connect",INVALID_RESPONSE:ms,INVALID_MODEL_REQUEST:bs,INVALID_MODEL_RESPONSE:gs,INVALID_STREAM_EVENT:X,INVALID_STREAM_EVENT_MIX:"Cannot mix {text: string} and {html: string} responses.",NO_VALID_STREAM_EVENTS_SENT:"No valid stream events were sent.\n".concat(X)},pe=function(){function bi(){_classCallCheck(this,bi)}return _createClass(bi,null,[{key:"addElements",value:function addElements(i){for(var u=arguments.length,d=new Array(u>1?u-1:0),h=1;h<u;h++)d[h-1]=arguments[h];d.forEach((function(u){return i.appendChild(u)}))}},{key:"isScrollbarAtBottomOfElement",value:function isScrollbarAtBottomOfElement(i){var u=i.scrollHeight,d=i.clientHeight,h=i.scrollTop,m=u-d;return h>=m-bi.CODE_SNIPPET_GENERATION_JUMP}},{key:"cloneElement",value:function cloneElement(i){var u=i.cloneNode(!0);return i.parentNode.replaceChild(u,i),u}},{key:"scrollToBottom",value:function scrollToBottom(i){i.scrollTop=i.scrollHeight}},{key:"scrollToTop",value:function scrollToTop(i){i.scrollTop=0}}])}();pe.CODE_SNIPPET_GENERATION_JUMP=.5;var fe=pe;var me=function(){function vi(){_classCallCheck(this,vi)}return _createClass(vi,null,[{key:"speak",value:function speak(i,u){if(window.SpeechSynthesisUtterance){var d=new SpeechSynthesisUtterance(i);Object.assign(d,u),speechSynthesis.speak(d)}}},{key:"processConfig",value:function processConfig(i,u){var d={};setTimeout((function(){if(_typeof(i)=="object"&&(i.lang&&(d.lang=i.lang),i.pitch&&(d.pitch=i.pitch),i.rate&&(d.rate=i.rate),i.volume&&(d.volume=i.volume),i.voiceName)){var h=window.speechSynthesis.getVoices().find((function(u){var d;return u.name.toLocaleLowerCase()===((d=i.voiceName)==null?void 0:d.toLocaleLowerCase())}));h&&(d.voice=h)}u(d)}),vi.LOAD_VOICES_MS)}}])}();me.LOAD_VOICES_MS=200;var Ce=me;var Te=function(){function ue(){_classCallCheck(this,ue)}return _createClass(ue,null,[{key:"checkForContainerStyles",value:function checkForContainerStyles(i,u){var d=i.containerStyle;d&&(Object.assign(u.style,d),console.error("The containerStyle property is deprecated since version 1.3.14."),console.error("Please change to using the style property instead: https://deepchat.dev/docs/styles#style"))}},{key:"handleResponseProperty",value:function handleResponseProperty(i){return console.error("The {result: ....} response object type is deprecated since version 1.3.0."),console.error("Please change to using the new response object: https://deepchat.dev/docs/connect#Response"),i.result}},{key:"processHistory",value:function processHistory(i){var u=i.initialMessages;if(u)return console.error("The initialMessages property is deprecated since version 1.5.0."),console.error("Please change to using the history property instead: https://deepchat.dev/docs/messages/#history"),u}},{key:"processHistoryFile",value:function processHistoryFile(i){var u=i.file;u&&(console.error("The file property in MessageContent is deprecated since version 1.3.17."),console.error("Please change to using the files array property: https://deepchat.dev/docs/messages/#MessageContent"),i.files=[u])}},{key:"processValidateInput",value:function processValidateInput(i){var u=i.validateMessageBeforeSending;if(u)return console.error("The validateMessageBeforeSending property is deprecated since version 1.3.24."),console.error("Please change to using validateInput: https://deepchat.dev/docs/interceptors#validateInput"),u}},{key:"processSubmitUserMessage",value:function processSubmitUserMessage(i){return console.error("The submitUserMessage(text: string) argument string type is deprecated since version 1.4.4."),console.error("Please change to using the new argument type: https://deepchat.dev/docs/methods#submitUserMessage"),{text:i}}},{key:"flagHTMLUpdateClass",value:function flagHTMLUpdateClass(i){var u;(u=i.children[0])!=null&&u.classList.contains("deep-chat-update-message")&&(console.error('The "deep-chat-update-message" html class is deprecated since version 1.4.4.'),console.error("Please change to using {..., overwrite: true} object: https://deepchat.dev/docs/connect#Response"))}},{key:"processConnect",value:function processConnect(i){var u=i;u.request&&(u.connect?Object.assign(u.connect,u.request):u.connect=u.request,console.error("The request property is deprecated since version 1.5.0."),console.error("Please see the connect object: https://deepchat.dev/docs/connect#connect-1"))}},{key:"checkForStream",value:function checkForStream(i){var u=i.stream;if(u)return console.error("The stream property has been moved to the connect object in version 1.5.0."),console.error("Please see the connect object: https://deepchat.dev/docs/connect#connect-1"),u}},{key:"fireOnNewMessage",value:function fireOnNewMessage(i,u){var d;var h=i;h.onNewMessage&&(console.error("The onNewMessage event has deprecated since version 1.5.0."),console.error("Please see the onMessage event: https://deepchat.dev/docs/events#onMessage"),(d=h.onNewMessage)==null||d.call(h,u)),i.dispatchEvent(new CustomEvent("new-message",{detail:u}))}}])}();var Oe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='iso-8859-1'?%3e%3csvg%20fill='%23000000'%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20viewBox='0%200%2032%2032'%20xml:space='preserve'%3e%3cpath%20d='M23,30.36H9c-2.404,0-4.36-1.956-4.36-4.36V15c0-2.404,1.956-4.36,4.36-4.36h3.659%20c0.167-1.566,1.415-2.813,2.981-2.981V5.333c-1.131-0.174-2-1.154-2-2.333c0-1.301,1.059-2.36,2.36-2.36%20c1.302,0,2.36,1.059,2.36,2.36c0,1.179-0.869,2.159-2,2.333V7.66c1.566,0.167,2.814,1.415,2.981,2.981H23%20c2.404,0,4.36,1.956,4.36,4.36v11C27.36,28.404,25.404,30.36,23,30.36z%20M9,11.36c-2.007,0-3.64,1.633-3.64,3.64v11%20c0,2.007,1.633,3.64,3.64,3.64h14c2.007,0,3.64-1.633,3.64-3.64V15c0-2.007-1.633-3.64-3.64-3.64H9z%20M13.384,10.64h5.231%20C18.439,9.354,17.334,8.36,16,8.36C14.667,8.36,13.561,9.354,13.384,10.64z%20M16,1.36c-0.904,0-1.64,0.736-1.64,1.64%20S15.096,4.64,16,4.64c0.904,0,1.64-0.736,1.64-1.64S16.904,1.36,16,1.36z%20M20,27.36h-8c-1.301,0-2.36-1.059-2.36-2.36%20s1.059-2.36,2.36-2.36h8c1.302,0,2.36,1.059,2.36,2.36S21.302,27.36,20,27.36z%20M12,23.36c-0.904,0-1.64,0.735-1.64,1.64%20s0.736,1.64,1.64,1.64h8c0.904,0,1.64-0.735,1.64-1.64s-0.735-1.64-1.64-1.64H12z%20M31,23.86h-2c-0.199,0-0.36-0.161-0.36-0.36V15%20c0-0.199,0.161-0.36,0.36-0.36h2c0.199,0,0.36,0.161,0.36,0.36v8.5C31.36,23.699,31.199,23.86,31,23.86z%20M29.36,23.14h1.279v-7.78%20H29.36V23.14z%20M3,23.86H1c-0.199,0-0.36-0.161-0.36-0.36V15c0-0.199,0.161-0.36,0.36-0.36h2c0.199,0,0.36,0.161,0.36,0.36v8.5%20C3.36,23.699,3.199,23.86,3,23.86z%20M1.36,23.14h1.28v-7.78H1.36V23.14z%20M20,20.36c-1.302,0-2.36-1.059-2.36-2.36%20s1.059-2.36,2.36-2.36s2.36,1.059,2.36,2.36C22.36,19.302,21.302,20.36,20,20.36z%20M20,16.36c-0.904,0-1.64,0.736-1.64,1.64%20s0.735,1.64,1.64,1.64s1.64-0.735,1.64-1.64S20.904,16.36,20,16.36z%20M12,20.36c-1.301,0-2.36-1.059-2.36-2.36s1.059-2.36,2.36-2.36%20s2.36,1.059,2.36,2.36C14.36,19.302,13.301,20.36,12,20.36z%20M12,16.36c-0.904,0-1.64,0.736-1.64,1.64s0.736,1.64,1.64,1.64%20s1.64-0.735,1.64-1.64S12.904,16.36,12,16.36z'/%3e%3crect%20style='fill:none;'%20width='32'%20height='32'/%3e%3c/svg%3e",Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAD6CAMAAAC/MqoPAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAADNQTFRF////9vX18vLy/Pz86enp4+Li2tnZ1tbWzczM+fn57Ozs4N/f09LS0M/P5uXl7+/v3dzcwtncCAAAAAFiS0dEAIgFHUgAAAAJcEhZcwAAAEgAAABIAEbJaz4AAAZNSURBVHja7d3bdtsqEABQYABZSLH9/3+ZpnUsIcF5iOM6PfElNoMHMfPQdq3GmL0GkLhEUqLaUExnOtOZznSmM53pTGc605nOdKYznelMZzrTmV4LXSqllKyJDkob26xWq8Zae/iH0QoWTm9d1xur4WuypQJtTd+5dqn0VjcxzNO5/57mEBvdLo8Oron6aseWOjYOFkVvjQs3DmgyONMuht52EfztP+4hdu0i6LCO808/M8c1lE/fuPGej41uUzgdtoO/75N+2ELJ9I3b3//hPXbiMenm3pR/Jt4USgcLBIp4Bh10gqKVhvLo0klCxeSky96nKcj3siw6pJIL4XsoiQ7apyvMY/V3HHrSRioLopvEhSpTCn2TPEuwKYMOIX0tAxRBf/Hpa+lfSqBv9gi1FPsNfTrMAiVmIE/vJhz61FGnQxRIEYE4vfNYdN8Rp6MlHaHotHTn8ejekaZPAjEmyvQWdZFTtYTpXqCGJ0zvcek9Yfoel76nS0ffv1NMp1ca+pkgyfRCGind4L7OWWc605l+cxjsyhqy9AGbPpClc1/nvl5VX0c/3Alk6RU3+Am7shNZ+h6bvidLr7jBB+zKBrL0irOOudmIUDzTmf5gIP+iEuXtRuTVaEmY/oZLfyNMrzjryPc0gerMTdpVg0tvjJUU6bLPcGOoUv46SLL6Wi8yhLf06C7TUyekI0efRaaYqdFltkeNpPumRPSMDxgBYvSM035FrKAmH72hRW99PrpvSdEHkTEGUvSsK3yKVDkuJ92RohcZaehzzirPpOg+J92Tolfc4Cumx5xVXpGiZ34+ICX6W84qv5GiR5NPbiIpOv6BCoSvSkTX+eiaGP092zINvBOj4x8mSf9FqejvNo/cvpOji19ZbmviL0GPLsYMFzgzCor0+Bv/ePDvSJKOb9dJ5UlnbnEHiHgzv6cdTpJOWuc/u3FEucLDOL75xGtBiefrcwgoC9NDSH/jkH6pAuXmBqPQ9HSUPVdZBH1GGOrMXAQdYxcKZfxAoK+KKBKFLosoEoX+u4giUehz8jlcnAuhp78I46yDYNAd+QLR6K+pr+yvxdBTHyVDubQh0UfSxaHSd0lbvNkVRE87JGOtc+PQd2QLQ6fHhJkKsSh6yg13tO08JPprsgrrXWH0dJd2vH1MLPprot4eXoujpzrdhngiD40ek2y92lggPcnWa8qN1Yz0BFuvZhRl0uOfR0v4Ewuli/Bg4Qr3lArqGdndQ3UPO1EunXYwnelMZzrTmc50pjOd6UxnOtOZznSmM53pTGf6kuj6oedFKV0s3fX6sX1S3bsi6a4PD7+/YAqYeBw6pIB/4qEgOqxdSPbGiim4NRRCbzs3Jj0L4UfXtQXQVRfn5IdA/Bw7RZzurEV6EtdsLeGXkIPuA+K1UoVeA0l62zmN/LqfSSft9KkepmoRuvi3nd5uKNFB9zbbXEANqdr941XO0NJx2v2jdJenpf+/3bvn0ts16ph+sd6hX7dPo2+2cZzE02Ia43bzDHqr+2Evnhz74ZHU30ffbKOeng1/NPV30Ns1gYQnSP2P6e65Pfxc6h02XZqXQCjhJ6kPL6bFo4NrGvAU4UII4SE2P1vQuZkuOxckVfehisF1MjUddN/MZBN+kvq5uf0O/xa66gyNS9ktMWlz44rO1Z8C19i5FPdHzPamXn+F3hryPfxMr78+4F+kq22kO6Rf6fUQt+puuustyWv4rbG3l/duztFB96GYoe1cTBdXMr+nw9qVM6ZfxOvzezff0nXi/ZOndvrR6Zvpm0c3h6nhdb+5iS7tsIim/qXZD9+97/Jf+rpZ5BET1ayv0GUzLhEuhBBjIy/RdVPgndutIRt9nt7p5cKFEEJ3Z+jQFDZL+XnMDXxHB73gxn5s9Kc3d3/pFciFkN/QTSXHJpX5l66gDrkQoP6hL3xsPw39la4qOiV8tH78XeSbue6N9mvWa6J/ybpc1CT1Wnh5Qq9meP8IOKH3ddH7E/ri1iYux/SXDrXR4UiPdck/wUpU+FtPf6/orja6O9KL3l56LOvVxe5Ib2qjN0d6Vbex4ghWlU3bPqI90If66MNng680FNpbJijH6kCvaF3uMzQ3+IrpFerV4Y9dffQdN3im10ivbuImhD3Qq5u4HdZkua8znelMZ/pS4z9CPVKkxowNxgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMy0yN1QxNTo0NToxNSswMDowMN1xSg4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDMtMjdUMTU6NDU6MTUrMDA6MDCsLPKyAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAABJRU5ErkJggg==",De=function(){function ie(){_classCallCheck(this,ie)}return _createClass(ie,null,[{key:"hide",value:function hide(i){var u;(u=i.getElementsByClassName(ie.CONTAINER_CLASS)[0].style).visibility||(u.visibility="hidden")}},{key:"applyCustomStylesToElements",value:function applyCustomStylesToElements(i,u,d){Object.assign(i.style,d.container),Object.assign(u.style,d.avatar)}},{key:"applyCustomStyles",value:function applyCustomStyles(i,u,d,h){var m,v,g,y;if((m=d.default)!=null&&m.styles&&ie.applyCustomStylesToElements(i,u,d.default.styles),h===Qe.USER_ROLE)(v=d.user)!=null&&v.styles&&ie.applyCustomStylesToElements(i,u,d.user.styles);else{(g=d.ai)!=null&&g.styles&&ie.applyCustomStylesToElements(i,u,d.ai.styles);var b=(y=d[h])==null?void 0:y.styles;b&&ie.applyCustomStylesToElements(i,u,b)}}},{key:"createAvatar",value:function createAvatar(i,u){var d,h,m,v,g;var y=document.createElement("img");i===Qe.USER_ROLE?y.src=((d=u==null?void 0:u.user)==null?void 0:d.src)||((h=u==null?void 0:u.default)==null?void 0:h.src)||Ne:y.src=((m=u==null?void 0:u[i])==null?void 0:m.src)||((v=u==null?void 0:u.ai)==null?void 0:v.src)||((g=u==null?void 0:u.default)==null?void 0:g.src)||Oe,y.classList.add("avatar");var b=document.createElement("div");return b.classList.add(ie.CONTAINER_CLASS),b.appendChild(y),u&&ie.applyCustomStyles(b,y,u,i),b}},{key:"getPosition",value:function getPosition(i,u){var d,h,m;var v,g,y,b,x,A;var P=(g=(v=u==null?void 0:u[i])==null?void 0:v.styles)==null?void 0:g.position;return i!==Qe.USER_ROLE&&((d=P)!==null&&d!==void 0?d:P=(b=(y=u==null?void 0:u.ai)==null?void 0:y.styles)==null?void 0:b.position),(h=P)!==null&&h!==void 0?h:P=(A=(x=u==null?void 0:u.default)==null?void 0:x.styles)==null?void 0:A.position,(m=P)!==null&&m!==void 0?m:P=i===Qe.USER_ROLE?"right":"left",P}},{key:"add",value:function add(i,u,d){var h=typeof d=="boolean"?void 0:d,m=ie.createAvatar(u,h),v=ie.getPosition(u,h);m.classList.add(v==="left"?"left-item-position":"right-item-position"),i.insertAdjacentElement(v==="left"?"beforebegin":"afterend",m)}}])}();De.CONTAINER_CLASS="avatar-container";var Ve=De;var Ke=function(){function be(){_classCallCheck(this,be)}return _createClass(be,null,[{key:"hide",value:function hide(i){var u;(u=i.getElementsByClassName(be.NAME_CLASS)[0].style).visibility||(u.visibility="hidden")}},{key:"getPosition",value:function getPosition(i,u){var d,h,m;var v,g,y;var b=(v=u==null?void 0:u[i])==null?void 0:v.position;return i!==Qe.USER_ROLE&&((d=b)!==null&&d!==void 0?d:b=(g=u==null?void 0:u.ai)==null?void 0:g.position),(h=b)!==null&&h!==void 0?h:b=(y=u==null?void 0:u.default)==null?void 0:y.position,(m=b)!==null&&m!==void 0?m:b=i===Qe.USER_ROLE?"right":"left",b}},{key:"applyStyle",value:function applyStyle(i,u,d){var h,m,v,g;Object.assign(i.style,(h=d.default)==null?void 0:h.style),u===Qe.USER_ROLE?Object.assign(i.style,(m=d.user)==null?void 0:m.style):(Object.assign(i.style,(v=d.ai)==null?void 0:v.style),Object.assign(i.style,(g=d[u])==null?void 0:g.style))}},{key:"getNameText",value:function getNameText(i,u){var d,h,m,v,g,y;return i===Qe.USER_ROLE?((d=u.user)==null?void 0:d.text)||((h=u.default)==null?void 0:h.text)||"User":i===Qe.AI_ROLE?((m=u.ai)==null?void 0:m.text)||((v=u.default)==null?void 0:v.text)||"AI":((g=u[i])==null?void 0:g.text)||((y=u.default)==null?void 0:y.text)||i}},{key:"createName",value:function createName(i,u){var d=document.createElement("div");return d.classList.add(be.NAME_CLASS),d.textContent=be.getNameText(i,u),be.applyStyle(d,i,u),d}},{key:"add",value:function add(i,u,d){var h=typeof d=="boolean"?{}:d,m=be.createName(u,h),v=be.getPosition(u,h);m.classList.add(v==="left"?"left-item-position":"right-item-position"),i.insertAdjacentElement(v==="left"?"beforebegin":"afterend",m)}}])}();Ke.NAME_CLASS="name";var Ye=Ke;var Ze=function(){function ae(){_classCallCheck(this,ae)}return _createClass(ae,null,[{key:"getLastElementsByClass",value:function getLastElementsByClass(i,u,d){var h,m=function _loop(){var h=i[v];if(h.bubbleElement.classList.contains(u[0])&&!u.slice(1).find((function(i){return!h.bubbleElement.classList.contains(i)}))){if(!d)return{v:h};if(!d.find((function(i){return h.bubbleElement.classList.contains(i)})))return{v:h}}};for(var v=i.length-1;v>=0;v-=1){h=m();if(h)return h.v}}},{key:"getLastMessage",value:function getLastMessage(i,u,d){for(var h=i.length-1;h>=0;h-=1)if(i[h].role===u){if(!d)return i[h];if(i[h][d])return i[h]}}},{key:"getLastTextToElement",value:function getLastTextToElement(i,u){for(var d=i.length-1;d>=0;d-=1)if(i[d][0]===u)return i[d]}},{key:"overwriteMessage",value:function overwriteMessage(i,u,d,h,m,v){var g=ae.getLastElementsByClass(u,[ae.getRoleClass(h),v],["loading-message-text"]),y=ae.getLastMessage(i,h,m);return y&&(y[m]=d),g}},{key:"getRoleClass",value:function getRoleClass(i){return"".concat(i,"-message")}},{key:"fillEmptyMessageElement",value:function fillEmptyMessageElement(i,u){u.trim().length===0&&(i.classList.add(ae.EMPTY_MESSAGE_CLASS),i.innerHTML='<div style="color:#00000000">.</div>')}},{key:"unfillEmptyMessageElement",value:function unfillEmptyMessageElement(i,u){i.classList.contains(ae.EMPTY_MESSAGE_CLASS)&&u.trim().length>0&&i.replaceChildren()}},{key:"getLastMessageBubbleElement",value:function getLastMessageBubbleElement(i){var u,d,h;return Array.from(((h=(d=(u=ae.getLastMessageElement(i))==null?void 0:u.children)==null?void 0:d[0])==null?void 0:h.children)||[]).find((function(i){return i.classList.contains("message-bubble")}))}},{key:"getLastMessageElement",value:function getLastMessageElement(i){return i.children[i.children.length-1]}},{key:"addRoleElements",value:function addRoleElements(i,u,d,h){d&&Ve.add(i,u,d),h&&Ye.add(i,u,h)}},{key:"hideRoleElements",value:function hideRoleElements(i,u,d){var h=i[i.length-1].innerContainer;u&&Ve.hide(h),d&&Ye.hide(h)}}])}();Ze.AI_ROLE="ai",Ze.USER_ROLE="user",Ze.EMPTY_MESSAGE_CLASS="empty-message";var Qe=Ze;var tt=function(){function ze(){_classCallCheck(this,ze)}return _createClass(ze,null,[{key:"mouseUp",value:function mouseUp(i,u){d.unsetAllCSSMouseStates(i,u),Object.assign(i.style,u.default),Object.assign(i.style,u.hover)}},{key:"mouseDown",value:function mouseDown(i,u){Object.assign(i.style,u.click)}},{key:"mouseLeave",value:function mouseLeave(i,u){d.unsetAllCSSMouseStates(i,u),Object.assign(i.style,u.default)}},{key:"mouseEnter",value:function mouseEnter(i,u){Object.assign(i.style,u.hover)}},{key:"add",value:function add(i,u){i.addEventListener("mouseenter",ze.mouseEnter.bind(this,i,u)),i.addEventListener("mouseleave",ze.mouseLeave.bind(this,i,u)),i.addEventListener("mousedown",ze.mouseDown.bind(this,i,u)),i.addEventListener("mouseup",ze.mouseUp.bind(this,i,u))}}])}();var rt="deep-chat-temporary-message",ot="deep-chat-suggestion-button",pt={"deep-chat-button":{styles:{default:{backgroundColor:"white",padding:"5px",paddingLeft:"7px",paddingRight:"7px",border:"1px solid #c2c2c2",borderRadius:"6px",cursor:"pointer"},hover:{backgroundColor:"#fafafa"},click:{backgroundColor:"#f1f1f1"}}}},mt=Object.keys(pt);var vt=function(){function Le(){_classCallCheck(this,Le)}return _createClass(Le,null,[{key:"applySuggestionEvent",value:function applySuggestionEvent(i,u){setTimeout((function(){u.addEventListener("click",(function(){var d,h;(h=i.submitUserMessage)==null||h.call(i,{text:((d=u.textContent)==null?void 0:d.trim())||""})}))}))}},{key:"isElementTemporary",value:function isElementTemporary(i){var u;return!!i&&((u=i.bubbleElement.children[0])==null?void 0:u.classList.contains(rt))}},{key:"doesElementContainDeepChatClass",value:function doesElementContainDeepChatClass(i){return mt.find((function(u){return i.classList.contains(u)}))}},{key:"applyEvents",value:function applyEvents(i,u){var d=pt[u].events;Object.keys(d||[]).forEach((function(u){i.addEventListener(u,d==null?void 0:d[u])}))}},{key:"getProcessedStyles",value:function getProcessedStyles(i,u,h){var m=Array.from(u.classList).reduce((function(u,d){var h;var m=(h=i[d])==null?void 0:h.styles;return m&&i[d].styles&&u.push(m),u}),[]),v=pt[h].styles;if(v){var g=JSON.parse(JSON.stringify(v));g.default&&d.overwriteDefaultWithAlreadyApplied(g,u),m.unshift(g)}var y=d.mergeStatefulStyles(m);return d.processStateful(y,{},{})}},{key:"applyDeepChatUtilities",value:function applyDeepChatUtilities(i,u,d){mt.forEach((function(i){var h=d.getElementsByClassName(i);Array.from(h||[]).forEach((function(d){var h=Le.getProcessedStyles(u,d,i);gt.applyStylesToElement(d,h),Le.applyEvents(d,i)}))}));var h=d.getElementsByClassName(ot);Array.from(h).forEach((function(u){return Le.applySuggestionEvent(i,u)}))}}])}();var gt=function(){function Y(){_classCallCheck(this,Y)}return _createClass(Y,null,[{key:"applyStylesToElement",value:function applyStylesToElement(i,u){var h=d.processStateful(u,{},{});tt.add(i,h),Object.assign(i.style,h.default)}},{key:"applyEventsToElement",value:function applyEventsToElement(i,u){Object.keys(u).forEach((function(d){var h=u[d];h&&i.addEventListener(d,h)}))}},{key:"applyClassUtilitiesToElement",value:function applyClassUtilitiesToElement(i,u){var d=u.events,h=u.styles;d&&Y.applyEventsToElement(i,d),h&&!vt.doesElementContainDeepChatClass(i)&&Y.applyStylesToElement(i,h)}},{key:"applyCustomClassUtilities",value:function applyCustomClassUtilities(i,u){Object.keys(i).forEach((function(d){var h=u.getElementsByClassName(d);Array.from(h).forEach((function(u){i[d]&&Y.applyClassUtilitiesToElement(u,i[d])}))}))}},{key:"apply",value:function apply(i,u){vt.applyDeepChatUtilities(i,i.htmlClassUtilities,u),Y.applyCustomClassUtilities(i.htmlClassUtilities,u)}},{key:"traverseNodes",value:function traverseNodes(i,u){i.nodeType===Node.ELEMENT_NODE&&u.push(i.outerHTML),i.childNodes.forEach((function(i){Y.traverseNodes(i,u)}))}},{key:"splitHTML",value:function splitHTML(i){var u=(new DOMParser).parseFromString(i,"text/html"),d=[];return u.body.childNodes.forEach((function(i){Y.traverseNodes(i,d)})),d}}])}();var kt=function(){function dt(){_classCallCheck(this,dt)}return _createClass(dt,null,[{key:"addElement",value:function addElement(i,u){i.elementRef.appendChild(u),i.elementRef.scrollTop=i.elementRef.scrollHeight}},{key:"createElements",value:function createElements(i,u,d){var h=i.createNewMessageElement("",d);return h.bubbleElement.classList.add("html-message"),h.bubbleElement.innerHTML=u,h}},{key:"overwrite",value:function overwrite(i,u,d,h){var m=i.messages,v=Qe.overwriteMessage(m,h,u,d,"html","html-message");return v&&(v.bubbleElement.innerHTML=u,gt.apply(i,v.outerContainer),Te.flagHTMLUpdateClass(v.bubbleElement)),v}},{key:"add",value:function add(i,u,d,h,m){var v;if(m!=null&&m.status){var g=this.overwrite(i,u,d,h);if(g)return g;m.status=!1}var y=dt.createElements(i,u,d);return Qe.fillEmptyMessageElement(y.bubbleElement,u),gt.apply(i,y.outerContainer),Te.flagHTMLUpdateClass(y.bubbleElement),i.applyCustomStyles(y,d,!1,(v=i.messageStyles)==null?void 0:v.html),dt.addElement(i,y.outerContainer),y}}])}();var It;function Qn(i){return It=It||document.createElement("textarea"),It.innerHTML="&"+i+";",It.value}var Nt=Object.prototype.hasOwnProperty;function Ss(i,u){return!!i&&Nt.call(i,u)}function es(i){var u=[].slice.call(arguments,1);return u.forEach((function(u){if(u){if(_typeof(u)!="object")throw new TypeError(u+"must be object");Object.keys(u).forEach((function(d){i[d]=u[d]}))}})),i}var Dt=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function At(i){return i.indexOf("\\")<0?i:i.replace(Dt,"$1")}function ts(i){return!(i>=55296&&i<=57343||i>=64976&&i<=65007||(i&65535)===65535||(i&65535)===65534||i>=0&&i<=8||i===11||i>=14&&i<=31||i>=127&&i<=159||i>1114111)}function Ki(i){if(i>65535){i-=65536;var u=55296+(i>>10),d=56320+(i&1023);return String.fromCharCode(u,d)}return String.fromCharCode(i)}var Bt=/&([a-z#][a-z0-9]{1,31});/gi,Ut=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function ks(i,u){var d=0,h=Qn(u);return u!==h?h:u.charCodeAt(0)===35&&Ut.test(u)&&(d=u[1].toLowerCase()==="x"?parseInt(u.slice(2),16):parseInt(u.slice(1),10),ts(d))?Ki(d):i}function We(i){return i.indexOf("&")<0?i:i.replace(Bt,ks)}var Ht=/[&<>"]/,Gt=/[&<>"]/g,qt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Is(i){return qt[i]}function K(i){return Ht.test(i)?i.replace(Gt,Is):i}var zt={};zt.blockquote_open=function(){return"<blockquote>\n"};zt.blockquote_close=function(i,u){return"</blockquote>"+Kt(i,u)};zt.code=function(i,u){return i[u].block?"<pre><code>"+K(i[u].content)+"</code></pre>"+Kt(i,u):"<code>"+K(i[u].content)+"</code>"};zt.fence=function(i,u,d,h,m){var v,g,y,b=i[u],x="",A=d.langPrefix,P="";if(b.params){if(v=b.params.split(/\s+/g),g=v.join(" "),Ss(m.rules.fence_custom,v[0]))return m.rules.fence_custom[v[0]](i,u,d,h,m);P=K(We(At(g))),x=' class="'+A+P+'"'}return y=d.highlight&&d.highlight.apply(d.highlight,[b.content].concat(v))||K(b.content),"<pre><code"+x+">"+y+"</code></pre>"+Kt(i,u)};zt.fence_custom={};zt.heading_open=function(i,u){return"<h"+i[u].hLevel+">"};zt.heading_close=function(i,u){return"</h"+i[u].hLevel+">\n"};zt.hr=function(i,u,d){return(d.xhtmlOut?"<hr />":"<hr>")+Kt(i,u)};zt.bullet_list_open=function(){return"<ul>\n"};zt.bullet_list_close=function(i,u){return"</ul>"+Kt(i,u)};zt.list_item_open=function(){return"<li>"};zt.list_item_close=function(){return"</li>\n"};zt.ordered_list_open=function(i,u){var d=i[u],h=d.order>1?' start="'+d.order+'"':"";return"<ol"+h+">\n"};zt.ordered_list_close=function(i,u){return"</ol>"+Kt(i,u)};zt.paragraph_open=function(i,u){return i[u].tight?"":"<p>"};zt.paragraph_close=function(i,u){var d=!(i[u].tight&&u&&i[u-1].type==="inline"&&!i[u-1].content);return(i[u].tight?"":"</p>")+(d?Kt(i,u):"")};zt.link_open=function(i,u,d){var h=i[u].title?' title="'+K(We(i[u].title))+'"':"",m=d.linkTarget?' target="'+d.linkTarget+'"':"";return'<a href="'+K(i[u].href)+'"'+h+m+">"};zt.link_close=function(){return"</a>"};zt.image=function(i,u,d){var h=' src="'+K(i[u].src)+'"',m=i[u].title?' title="'+K(We(i[u].title))+'"':"",v=' alt="'+(i[u].alt?K(We(At(i[u].alt))):"")+'"',g=d.xhtmlOut?" /":"";return"<img"+h+v+m+g+">"};zt.table_open=function(){return"<table>\n"};zt.table_close=function(){return"</table>\n"};zt.thead_open=function(){return"<thead>\n"};zt.thead_close=function(){return"</thead>\n"};zt.tbody_open=function(){return"<tbody>\n"};zt.tbody_close=function(){return"</tbody>\n"};zt.tr_open=function(){return"<tr>"};zt.tr_close=function(){return"</tr>\n"};zt.th_open=function(i,u){var d=i[u];return"<th"+(d.align?' style="text-align:'+d.align+'"':"")+">"};zt.th_close=function(){return"</th>"};zt.td_open=function(i,u){var d=i[u];return"<td"+(d.align?' style="text-align:'+d.align+'"':"")+">"};zt.td_close=function(){return"</td>"};zt.strong_open=function(){return"<strong>"};zt.strong_close=function(){return"</strong>"};zt.em_open=function(){return"<em>"};zt.em_close=function(){return"</em>"};zt.del_open=function(){return"<del>"};zt.del_close=function(){return"</del>"};zt.ins_open=function(){return"<ins>"};zt.ins_close=function(){return"</ins>"};zt.mark_open=function(){return"<mark>"};zt.mark_close=function(){return"</mark>"};zt.sub=function(i,u){return"<sub>"+K(i[u].content)+"</sub>"};zt.sup=function(i,u){return"<sup>"+K(i[u].content)+"</sup>"};zt.hardbreak=function(i,u,d){return d.xhtmlOut?"<br />\n":"<br>\n"};zt.softbreak=function(i,u,d){return d.breaks?d.xhtmlOut?"<br />\n":"<br>\n":"\n"};zt.text=function(i,u){return K(i[u].content)};zt.htmlblock=function(i,u){return i[u].content};zt.htmltag=function(i,u){return i[u].content};zt.abbr_open=function(i,u){return'<abbr title="'+K(We(i[u].title))+'">'};zt.abbr_close=function(){return"</abbr>"};zt.footnote_ref=function(i,u){var d=Number(i[u].id+1).toString(),h="fnref"+d;return i[u].subId>0&&(h+=":"+i[u].subId),'<sup class="footnote-ref"><a href="#fn'+d+'" id="'+h+'">['+d+"]</a></sup>"};zt.footnote_block_open=function(i,u,d){var h=d.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n';return h+'<section class="footnotes">\n<ol class="footnotes-list">\n'};zt.footnote_block_close=function(){return"</ol>\n</section>\n"};zt.footnote_open=function(i,u){var d=Number(i[u].id+1).toString();return'<li id="fn'+d+'"  class="footnote-item">'};zt.footnote_close=function(){return"</li>\n"};zt.footnote_anchor=function(i,u){var d=Number(i[u].id+1).toString(),h="fnref"+d;return i[u].subId>0&&(h+=":"+i[u].subId),' <a href="#'+h+'" class="footnote-backref"></a>'};zt.dl_open=function(){return"<dl>\n"};zt.dt_open=function(){return"<dt>"};zt.dd_open=function(){return"<dd>"};zt.dl_close=function(){return"</dl>\n"};zt.dt_close=function(){return"</dt>\n"};zt.dd_close=function(){return"</dd>\n"};function is(i,u){return++u>=i.length-2?u:i[u].type==="paragraph_open"&&i[u].tight&&i[u+1].type==="inline"&&i[u+1].content.length===0&&i[u+2].type==="paragraph_close"&&i[u+2].tight?is(i,u+2):u}var Kt=zt.getBreak=function(i,u){return u=is(i,u),u<i.length&&i[u].type==="list_item_close"?"":"\n"};function dn(){this.rules=es({},zt),this.getBreak=zt.getBreak}dn.prototype.renderInline=function(i,u,d){for(var h=this.rules,m=i.length,v=0,g="";m--;)g+=h[i[v].type](i,v++,u,d,this);return g};dn.prototype.render=function(i,u,d){for(var h=this.rules,m=i.length,v=-1,g="";++v<m;)i[v].type==="inline"?g+=this.renderInline(i[v].children,u,d):g+=h[i[v].type](i,v,u,d,this);return g};function ee(){this.__rules__=[],this.__cache__=null}ee.prototype.__find__=function(i){for(var u=this.__rules__.length,d=-1;u--;)if(this.__rules__[++d].name===i)return d;return-1};ee.prototype.__compile__=function(){var i=this,u=[""];i.__rules__.forEach((function(i){i.enabled&&i.alt.forEach((function(i){u.indexOf(i)<0&&u.push(i)}))})),i.__cache__={},u.forEach((function(u){i.__cache__[u]=[],i.__rules__.forEach((function(d){d.enabled&&(u&&d.alt.indexOf(u)<0||i.__cache__[u].push(d.fn))}))}))};ee.prototype.at=function(i,u,d){var h=this.__find__(i),m=d||{};if(h===-1)throw new Error("Parser rule not found: "+i);this.__rules__[h].fn=u,this.__rules__[h].alt=m.alt||[],this.__cache__=null};ee.prototype.before=function(i,u,d,h){var m=this.__find__(i),v=h||{};if(m===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(m,0,{name:u,enabled:!0,fn:d,alt:v.alt||[]}),this.__cache__=null};ee.prototype.after=function(i,u,d,h){var m=this.__find__(i),v=h||{};if(m===-1)throw new Error("Parser rule not found: "+i);this.__rules__.splice(m+1,0,{name:u,enabled:!0,fn:d,alt:v.alt||[]}),this.__cache__=null};ee.prototype.push=function(i,u,d){var h=d||{};this.__rules__.push({name:i,enabled:!0,fn:u,alt:h.alt||[]}),this.__cache__=null};ee.prototype.enable=function(i,u){i=Array.isArray(i)?i:[i],u&&this.__rules__.forEach((function(i){i.enabled=!1})),i.forEach((function(i){var u=this.__find__(i);if(u<0)throw new Error("Rules manager: invalid rule name "+i);this.__rules__[u].enabled=!0}),this),this.__cache__=null};ee.prototype.disable=function(i){i=Array.isArray(i)?i:[i],i.forEach((function(i){var u=this.__find__(i);if(u<0)throw new Error("Rules manager: invalid rule name "+i);this.__rules__[u].enabled=!1}),this),this.__cache__=null};ee.prototype.getRules=function(i){return this.__cache__===null&&this.__compile__(),this.__cache__[i]||[]};function Ls(i){i.inlineMode?i.tokens.push({type:"inline",content:i.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):i.block.parse(i.src,i.options,i.env,i.tokens)}function Je(i,u,d,h,m){this.src=i,this.env=h,this.options=d,this.parser=u,this.tokens=m,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}Je.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""};Je.prototype.push=function(i){this.pending&&this.pushPending(),this.tokens.push(i),this.pendingLevel=this.level};Je.prototype.cacheSet=function(i,u){for(var d=this.cache.length;d<=i;d++)this.cache.push(0);this.cache[i]=u};Je.prototype.cacheGet=function(i){return i<this.cache.length?this.cache[i]:0};function Mt(i,u){var d,h,m,v=-1,g=i.posMax,y=i.pos,b=i.isInLabel;if(i.isInLabel)return-1;if(i.labelUnmatchedScopes)return i.labelUnmatchedScopes--,-1;for(i.pos=u+1,i.isInLabel=!0,d=1;i.pos<g;){if(m=i.src.charCodeAt(i.pos),m===91)d++;else if(m===93&&(d--,d===0)){h=!0;break}i.parser.skipToken(i)}return h?(v=i.pos,i.labelUnmatchedScopes=0):i.labelUnmatchedScopes=d-1,i.pos=y,i.isInLabel=b,v}function Ps(i,u,d,h){var m,v,g,y,b,x;if(i.charCodeAt(0)!==42||i.charCodeAt(1)!==91||i.indexOf("]:")===-1||(m=new Je(i,u,d,h,[]),v=Mt(m,1),v<0||i.charCodeAt(v+1)!==58))return-1;for(y=m.posMax,g=v+2;g<y&&m.src.charCodeAt(g)!==10;g++);return b=i.slice(2,v),x=i.slice(v+2,g).trim(),x.length===0?-1:(h.abbreviations||(h.abbreviations={}),_typeof(h.abbreviations[":"+b])>"u"&&(h.abbreviations[":"+b]=x),g)}function Os(i){var u,d,h,m,v=i.tokens;if(!i.inlineMode)for(u=1,d=v.length-1;u<d;u++)if(v[u-1].type==="paragraph_open"&&v[u].type==="inline"&&v[u+1].type==="paragraph_close"){for(h=v[u].content;h.length&&(m=Ps(h,i.inline,i.options,i.env),!(m<0));)h=h.slice(m).trim();v[u].content=h,h.length||(v[u-1].tight=!0,v[u+1].tight=!0)}}function Ji(i){var u=We(i);try{u=decodeURI(u)}catch(i){}return encodeURI(u)}function ns(i,u){var d,h,m,v=u,g=i.posMax;if(i.src.charCodeAt(u)===60){for(u++;u<g;){if(d=i.src.charCodeAt(u),d===10)return!1;if(d===62)return m=Ji(At(i.src.slice(v+1,u))),!!i.parser.validateLink(m)&&(i.pos=u+1,i.linkContent=m,!0);d===92&&u+1<g?u+=2:u++}return!1}for(h=0;u<g&&(d=i.src.charCodeAt(u),!(d===32||d<32||d===127));)if(d===92&&u+1<g)u+=2;else{if(d===40&&(h++,h>1)||d===41&&(h--,h<0))break;u++}return!(v===u||(m=At(i.src.slice(v,u)),!i.parser.validateLink(m)))&&(i.linkContent=m,i.pos=u,!0)}function ss(i,u){var d,h=u,m=i.posMax,v=i.src.charCodeAt(u);if(v!==34&&v!==39&&v!==40)return!1;for(u++,v===40&&(v=41);u<m;){if(d=i.src.charCodeAt(u),d===v)return i.pos=u+1,i.linkContent=At(i.src.slice(h+1,u)),!0;d===92&&u+1<m?u+=2:u++}return!1}function rs(i){return i.trim().replace(/\s+/g," ").toUpperCase()}function Ns(i,u,d,h){var m,v,g,y,b,x,A,P,D;if(i.charCodeAt(0)!==91||i.indexOf("]:")===-1||(m=new Je(i,u,d,h,[]),v=Mt(m,0),v<0||i.charCodeAt(v+1)!==58))return-1;for(y=m.posMax,g=v+2;g<y&&(b=m.src.charCodeAt(g),!(b!==32&&b!==10));g++);if(!ns(m,g))return-1;for(A=m.linkContent,g=m.pos,x=g,g+=1;g<y&&(b=m.src.charCodeAt(g),!(b!==32&&b!==10));g++);for(g<y&&x!==g&&ss(m,g)?(P=m.linkContent,g=m.pos):(P="",g=x);g<y&&m.src.charCodeAt(g)===32;)g++;return g<y&&m.src.charCodeAt(g)!==10?-1:(D=rs(i.slice(1,v)),_typeof(h.references[D])>"u"&&(h.references[D]={title:P,href:A}),g)}function Ds(i){var u,d,h,m,v=i.tokens;if(i.env.references=i.env.references||{},!i.inlineMode)for(u=1,d=v.length-1;u<d;u++)if(v[u].type==="inline"&&v[u-1].type==="paragraph_open"&&v[u+1].type==="paragraph_close"){for(h=v[u].content;h.length&&(m=Ns(h,i.inline,i.options,i.env),!(m<0));)h=h.slice(m).trim();v[u].content=h,h.length||(v[u-1].tight=!0,v[u+1].tight=!0)}}function Fs(i){var u,d,h,m=i.tokens;for(d=0,h=m.length;d<h;d++)u=m[d],u.type==="inline"&&i.inline.parse(u.content,i.options,i.env,u.children)}function Bs(i){var u,d,h,m,v,g,y,b,x,A=0,P=!1,D={};if(i.env.footnotes&&(i.tokens=i.tokens.filter((function(i){return i.type==="footnote_reference_open"?(P=!0,b=[],x=i.label,!1):i.type==="footnote_reference_close"?(P=!1,D[":"+x]=b,!1):(P&&b.push(i),!P)})),!!i.env.footnotes.list)){for(g=i.env.footnotes.list,i.tokens.push({type:"footnote_block_open",level:A++}),u=0,d=g.length;u<d;u++){for(i.tokens.push({type:"footnote_open",id:u,level:A++}),g[u].tokens?(y=[],y.push({type:"paragraph_open",tight:!1,level:A++}),y.push({type:"inline",content:"",level:A,children:g[u].tokens}),y.push({type:"paragraph_close",tight:!1,level:--A})):g[u].label&&(y=D[":"+g[u].label]),i.tokens=i.tokens.concat(y),v=i.tokens[i.tokens.length-1].type==="paragraph_close"?i.tokens.pop():null,m=g[u].count>0?g[u].count:1,h=0;h<m;h++)i.tokens.push({type:"footnote_anchor",id:u,subId:h,level:A});v&&i.tokens.push(v),i.tokens.push({type:"footnote_close",level:--A})}i.tokens.push({type:"footnote_block_close",level:--A})}}var $t=" \n()[]'\".,!?-";function Fi(i){return i.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}function js(i){var u,d,h,m,v,g,y,b,x,A,P,D,q=i.tokens;if(i.env.abbreviations)for(i.env.abbrRegExp||(D="(^|["+$t.split("").map(Fi).join("")+"])("+Object.keys(i.env.abbreviations).map((function(i){return i.substr(1)})).sort((function(i,u){return u.length-i.length})).map(Fi).join("|")+")($|["+$t.split("").map(Fi).join("")+"])",i.env.abbrRegExp=new RegExp(D,"g")),A=i.env.abbrRegExp,d=0,h=q.length;d<h;d++)if(q[d].type==="inline")for(m=q[d].children,u=m.length-1;u>=0;u--)if(v=m[u],v.type==="text"){for(b=0,g=v.content,A.lastIndex=0,x=v.level,y=[];P=A.exec(g);)A.lastIndex>b&&y.push({type:"text",content:g.slice(b,P.index+P[1].length),level:x}),y.push({type:"abbr_open",title:i.env.abbreviations[":"+P[2]],level:x++}),y.push({type:"text",content:P[2],level:x}),y.push({type:"abbr_close",level:--x}),b=A.lastIndex-P[3].length;y.length&&(b<g.length&&y.push({type:"text",content:g.slice(b),level:x}),q[d].children=m=[].concat(m.slice(0,u),y,m.slice(u+1)))}}var Jt=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,Yt=/\((c|tm|r|p)\)/gi,Zt={c:"",r:"",p:"",tm:""};function zs(i){return i.indexOf("(")<0?i:i.replace(Yt,(function(i,u){return Zt[u.toLowerCase()]}))}function Vs(i){var u,d,h,m,v;if(i.options.typographer)for(v=i.tokens.length-1;v>=0;v--)if(i.tokens[v].type==="inline")for(m=i.tokens[v].children,u=m.length-1;u>=0;u--)d=m[u],d.type==="text"&&(h=d.content,h=zs(h),Jt.test(h)&&(h=h.replace(/\+-/g,"").replace(/\.{2,}/g,"").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/gm,"$1$2").replace(/(^|\s)--(\s|$)/gm,"$1$2").replace(/(^|[^-\s])--([^-\s]|$)/gm,"$1$2")),d.content=h)}var Qt=/['"]/,en=/['"]/g,tn=/[-\s()\[\]]/,nn="";function kn(i,u){return!(u<0||u>=i.length)&&!tn.test(i[u])}function et(i,u,d){return i.substr(0,u)+d+i.substr(u+1)}function $s(i){var u,d,h,m,v,g,y,b,x,A,P,D,q,V,J,X,oe;if(i.options.typographer)for(oe=[],J=i.tokens.length-1;J>=0;J--)if(i.tokens[J].type==="inline")for(X=i.tokens[J].children,oe.length=0,u=0;u<X.length;u++)if(d=X[u],!(d.type!=="text"||Qt.test(d.text))){for(y=X[u].level,q=oe.length-1;q>=0&&!(oe[q].level<=y);q--);oe.length=q+1,h=d.content,v=0,g=h.length;e:for(;v<g&&(en.lastIndex=v,m=en.exec(h),!!m);)if(b=!kn(h,m.index-1),v=m.index+1,V=m[0]==="'",x=!kn(h,v),x||b){if(P=!x,D=!b,D)for(q=oe.length-1;q>=0&&(A=oe[q],!(oe[q].level<y));q--)if(A.single===V&&oe[q].level===y){A=oe[q],V?(X[A.token].content=et(X[A.token].content,A.pos,i.options.quotes[2]),d.content=et(d.content,m.index,i.options.quotes[3])):(X[A.token].content=et(X[A.token].content,A.pos,i.options.quotes[0]),d.content=et(d.content,m.index,i.options.quotes[1])),oe.length=q;continue e}P?oe.push({token:u,pos:m.index,single:V,level:y}):D&&V&&(d.content=et(d.content,m.index,nn))}else V&&(d.content=et(d.content,m.index,nn))}}var rn=[["block",Ls],["abbr",Os],["references",Ds],["inline",Fs],["footnote_tail",Bs],["abbr2",js],["replacements",Vs],["smartquotes",$s]];function os(){this.options={},this.ruler=new ee;for(var i=0;i<rn.length;i++)this.ruler.push(rn[i][0],rn[i][1])}os.prototype.process=function(i){var u,d,h;for(h=this.ruler.getRules(""),u=0,d=h.length;u<d;u++)h[u](i)};function Xe(i,u,d,h,m){var v,g,y,b,x,A,P;for(this.src=i,this.parser=u,this.options=d,this.env=h,this.tokens=m,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",g=this.src,A=0,P=!1,y=b=A=0,x=g.length;b<x;b++){if(v=g.charCodeAt(b),!P){if(v===32){A++;continue}P=!0}(v===10||b===x-1)&&(v!==10&&b++,this.bMarks.push(y),this.eMarks.push(b),this.tShift.push(A),P=!1,A=0,y=b+1)}this.bMarks.push(g.length),this.eMarks.push(g.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}Xe.prototype.isEmpty=function(i){return this.bMarks[i]+this.tShift[i]>=this.eMarks[i]};Xe.prototype.skipEmptyLines=function(i){for(var u=this.lineMax;i<u&&!(this.bMarks[i]+this.tShift[i]<this.eMarks[i]);i++);return i};Xe.prototype.skipSpaces=function(i){for(var u=this.src.length;i<u&&this.src.charCodeAt(i)===32;i++);return i};Xe.prototype.skipChars=function(i,u){for(var d=this.src.length;i<d&&this.src.charCodeAt(i)===u;i++);return i};Xe.prototype.skipCharsBack=function(i,u,d){if(i<=d)return i;for(;i>d;)if(u!==this.src.charCodeAt(--i))return i+1;return i};Xe.prototype.getLines=function(i,u,d,h){var m,v,g,y,b,x=i;if(i>=u)return"";if(x+1===u)return v=this.bMarks[x]+Math.min(this.tShift[x],d),g=h?this.eMarks[x]+1:this.eMarks[x],this.src.slice(v,g);for(y=new Array(u-i),m=0;x<u;x++,m++)b=this.tShift[x],b>d&&(b=d),b<0&&(b=0),v=this.bMarks[x]+b,g=x+1<u||h?this.eMarks[x]+1:this.eMarks[x],y[m]=this.src.slice(v,g);return y.join("")};function Ks(i,u,d){var h,m;if(i.tShift[u]-i.blkIndent<4)return!1;for(m=h=u+1;h<d;)if(i.isEmpty(h))h++;else{if(!(i.tShift[h]-i.blkIndent>=4))break;h++,m=h}return i.line=h,i.tokens.push({type:"code",content:i.getLines(u,m,4+i.blkIndent,!0),block:!0,lines:[u,i.line],level:i.level}),!0}function Js(i,u,d,h){var m,v,g,y,b,x=!1,A=i.bMarks[u]+i.tShift[u],P=i.eMarks[u];if(A+3>P||(m=i.src.charCodeAt(A),m!==126&&m!==96)||(b=A,A=i.skipChars(A,m),v=A-b,v<3)||(g=i.src.slice(A,P).trim(),g.indexOf("`")>=0))return!1;if(h)return!0;for(y=u;y++,!(y>=d||(A=b=i.bMarks[y]+i.tShift[y],P=i.eMarks[y],A<P&&i.tShift[y]<i.blkIndent));)if(i.src.charCodeAt(A)===m&&!(i.tShift[y]-i.blkIndent>=4)&&(A=i.skipChars(A,m),!(A-b<v)&&(A=i.skipSpaces(A),!(A<P)))){x=!0;break}return v=i.tShift[u],i.line=y+(x?1:0),i.tokens.push({type:"fence",params:g,content:i.getLines(u+1,y,v,!0),lines:[u,i.line],level:i.level}),!0}function Xs(i,u,d,h){var m,v,g,y,b,x,A,P,D,q,V,J=i.bMarks[u]+i.tShift[u],X=i.eMarks[u];if(J>X||i.src.charCodeAt(J++)!==62||i.level>=i.options.maxNesting)return!1;if(h)return!0;for(i.src.charCodeAt(J)===32&&J++,b=i.blkIndent,i.blkIndent=0,y=[i.bMarks[u]],i.bMarks[u]=J,J=J<X?i.skipSpaces(J):J,v=J>=X,g=[i.tShift[u]],i.tShift[u]=J-i.bMarks[u],P=i.parser.ruler.getRules("blockquote"),m=u+1;m<d&&(J=i.bMarks[m]+i.tShift[m],X=i.eMarks[m],!(J>=X));m++)if(i.src.charCodeAt(J++)!==62){if(v)break;for(V=!1,D=0,q=P.length;D<q;D++)if(P[D](i,m,d,!0)){V=!0;break}if(V)break;y.push(i.bMarks[m]),g.push(i.tShift[m]),i.tShift[m]=-1337}else i.src.charCodeAt(J)===32&&J++,y.push(i.bMarks[m]),i.bMarks[m]=J,J=J<X?i.skipSpaces(J):J,v=J>=X,g.push(i.tShift[m]),i.tShift[m]=J-i.bMarks[m];for(x=i.parentType,i.parentType="blockquote",i.tokens.push({type:"blockquote_open",lines:A=[u,0],level:i.level++}),i.parser.tokenize(i,u,m),i.tokens.push({type:"blockquote_close",level:--i.level}),i.parentType=x,A[1]=i.line,D=0;D<g.length;D++)i.bMarks[D+u]=y[D],i.tShift[D+u]=g[D];return i.blkIndent=b,!0}function Zs(i,u,d,h){var m,v,g,y=i.bMarks[u],b=i.eMarks[u];if(y+=i.tShift[u],y>b||(m=i.src.charCodeAt(y++),m!==42&&m!==45&&m!==95))return!1;for(v=1;y<b;){if(g=i.src.charCodeAt(y++),g!==m&&g!==32)return!1;g===m&&v++}return!(v<3)&&(h||(i.line=u+1,i.tokens.push({type:"hr",lines:[u,i.line],level:i.level})),!0)}function An(i,u){var d,h,m;return h=i.bMarks[u]+i.tShift[u],m=i.eMarks[u],h>=m||(d=i.src.charCodeAt(h++),d!==42&&d!==45&&d!==43)||h<m&&i.src.charCodeAt(h)!==32?-1:h}function Mn(i,u){var d,h=i.bMarks[u]+i.tShift[u],m=i.eMarks[u];if(h+1>=m||(d=i.src.charCodeAt(h++),d<48||d>57))return-1;for(;;){if(h>=m)return-1;if(d=i.src.charCodeAt(h++),!(d>=48&&d<=57)){if(d===41||d===46)break;return-1}}return h<m&&i.src.charCodeAt(h)!==32?-1:h}function Ys(i,u){var d,h,m=i.level+2;for(d=u+2,h=i.tokens.length-2;d<h;d++)i.tokens[d].level===m&&i.tokens[d].type==="paragraph_open"&&(i.tokens[d+2].tight=!0,i.tokens[d].tight=!0,d+=2)}function Qs(i,u,d,h){var m,v,g,y,b,x,A,P,D,q,V,J,X,oe,pe,fe,me,Ce,Te,Oe,Ne,De,Ve=!0;if((P=Mn(i,u))>=0)X=!0;else{if(!((P=An(i,u))>=0))return!1;X=!1}if(i.level>=i.options.maxNesting)return!1;if(J=i.src.charCodeAt(P-1),h)return!0;for(pe=i.tokens.length,X?(A=i.bMarks[u]+i.tShift[u],V=Number(i.src.substr(A,P-A-1)),i.tokens.push({type:"ordered_list_open",order:V,lines:me=[u,0],level:i.level++})):i.tokens.push({type:"bullet_list_open",lines:me=[u,0],level:i.level++}),m=u,fe=!1,Te=i.parser.ruler.getRules("list");m<d&&(oe=i.skipSpaces(P),D=i.eMarks[m],q=oe>=D?1:oe-P,q>4&&(q=1),q<1&&(q=1),v=P-i.bMarks[m]+q,i.tokens.push({type:"list_item_open",lines:Ce=[u,0],level:i.level++}),y=i.blkIndent,b=i.tight,g=i.tShift[u],x=i.parentType,i.tShift[u]=oe-i.bMarks[u],i.blkIndent=v,i.tight=!0,i.parentType="list",i.parser.tokenize(i,u,d,!0),(!i.tight||fe)&&(Ve=!1),fe=i.line-u>1&&i.isEmpty(i.line-1),i.blkIndent=y,i.tShift[u]=g,i.tight=b,i.parentType=x,i.tokens.push({type:"list_item_close",level:--i.level}),m=u=i.line,Ce[1]=m,oe=i.bMarks[u],!(m>=d||i.isEmpty(m)||i.tShift[m]<i.blkIndent));){for(De=!1,Oe=0,Ne=Te.length;Oe<Ne;Oe++)if(Te[Oe](i,m,d,!0)){De=!0;break}if(De)break;if(X){if(P=Mn(i,m),P<0)break}else if(P=An(i,m),P<0)break;if(J!==i.src.charCodeAt(P-1))break}return i.tokens.push({type:X?"ordered_list_close":"bullet_list_close",level:--i.level}),me[1]=m,i.line=m,Ve&&Ys(i,pe),!0}function er(i,u,d,h){var m,v,g,y,b,x=i.bMarks[u]+i.tShift[u],A=i.eMarks[u];if(x+4>A||i.src.charCodeAt(x)!==91||i.src.charCodeAt(x+1)!==94||i.level>=i.options.maxNesting)return!1;for(y=x+2;y<A;y++){if(i.src.charCodeAt(y)===32)return!1;if(i.src.charCodeAt(y)===93)break}return!(y===x+2||y+1>=A||i.src.charCodeAt(++y)!==58)&&(h||(y++,i.env.footnotes||(i.env.footnotes={}),i.env.footnotes.refs||(i.env.footnotes.refs={}),b=i.src.slice(x+2,y-2),i.env.footnotes.refs[":"+b]=-1,i.tokens.push({type:"footnote_reference_open",label:b,level:i.level++}),m=i.bMarks[u],v=i.tShift[u],g=i.parentType,i.tShift[u]=i.skipSpaces(y)-y,i.bMarks[u]=y,i.blkIndent+=4,i.parentType="footnote",i.tShift[u]<i.blkIndent&&(i.tShift[u]+=i.blkIndent,i.bMarks[u]-=i.blkIndent),i.parser.tokenize(i,u,d,!0),i.parentType=g,i.blkIndent-=4,i.tShift[u]=v,i.bMarks[u]=m,i.tokens.push({type:"footnote_reference_close",level:--i.level})),!0)}function tr(i,u,d,h){var m,v,g,y=i.bMarks[u]+i.tShift[u],b=i.eMarks[u];if(y>=b||(m=i.src.charCodeAt(y),m!==35||y>=b))return!1;for(v=1,m=i.src.charCodeAt(++y);m===35&&y<b&&v<=6;)v++,m=i.src.charCodeAt(++y);return!(v>6||y<b&&m!==32)&&(h||(b=i.skipCharsBack(b,32,y),g=i.skipCharsBack(b,35,y),g>y&&i.src.charCodeAt(g-1)===32&&(b=g),i.line=u+1,i.tokens.push({type:"heading_open",hLevel:v,lines:[u,i.line],level:i.level}),y<b&&i.tokens.push({type:"inline",content:i.src.slice(y,b).trim(),level:i.level+1,lines:[u,i.line],children:[]}),i.tokens.push({type:"heading_close",hLevel:v,level:i.level})),!0)}function ir(i,u,d){var h,m,v,g=u+1;return!(g>=d||i.tShift[g]<i.blkIndent||i.tShift[g]-i.blkIndent>3||(m=i.bMarks[g]+i.tShift[g],v=i.eMarks[g],m>=v)||(h=i.src.charCodeAt(m),h!==45&&h!==61)||(m=i.skipChars(m,h),m=i.skipSpaces(m),m<v))&&(m=i.bMarks[u]+i.tShift[u],i.line=g+1,i.tokens.push({type:"heading_open",hLevel:h===61?1:2,lines:[u,i.line],level:i.level}),i.tokens.push({type:"inline",content:i.src.slice(m,i.eMarks[u]).trim(),level:i.level+1,lines:[u,i.line-1],children:[]}),i.tokens.push({type:"heading_close",hLevel:h===61?1:2,level:i.level}),!0)}var an={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach((function(i){an[i]=!0}));var sn=/^<([a-zA-Z]{1,15})[\s\/>]/,on=/^<\/([a-zA-Z]{1,15})[\s>]/;function rr(i){var u=i|32;return u>=97&&u<=122}function or(i,u,d,h){var m,v,g,y=i.bMarks[u],b=i.eMarks[u],x=i.tShift[u];if(y+=x,!i.options.html||x>3||y+2>=b||i.src.charCodeAt(y)!==60)return!1;if(m=i.src.charCodeAt(y+1),m===33||m===63){if(h)return!0}else{if(m!==47&&!rr(m))return!1;if(m===47){if(v=i.src.slice(y,b).match(on),!v)return!1}else if(v=i.src.slice(y,b).match(sn),!v)return!1;if(an[v[1].toLowerCase()]!==!0)return!1;if(h)return!0}for(g=u+1;g<i.lineMax&&!i.isEmpty(g);)g++;return i.line=g,i.tokens.push({type:"htmlblock",level:i.level,lines:[u,i.line],content:i.getLines(u,g,0,!0)}),!0}function ji(i,u){var d=i.bMarks[u]+i.blkIndent,h=i.eMarks[u];return i.src.substr(d,h-d)}function ar(i,u,d,h){var m,v,g,y,b,x,A,P,D,q,V;if(u+2>d||(b=u+1,i.tShift[b]<i.blkIndent)||(g=i.bMarks[b]+i.tShift[b],g>=i.eMarks[b])||(m=i.src.charCodeAt(g),m!==124&&m!==45&&m!==58)||(v=ji(i,u+1),!/^[-:| ]+$/.test(v))||(x=v.split("|"),x<=2))return!1;for(P=[],y=0;y<x.length;y++){if(D=x[y].trim(),!D){if(y===0||y===x.length-1)continue;return!1}if(!/^:?-+:?$/.test(D))return!1;D.charCodeAt(D.length-1)===58?P.push(D.charCodeAt(0)===58?"center":"right"):D.charCodeAt(0)===58?P.push("left"):P.push("")}if(v=ji(i,u).trim(),v.indexOf("|")===-1||(x=v.replace(/^\||\|$/g,"").split("|"),P.length!==x.length))return!1;if(h)return!0;for(i.tokens.push({type:"table_open",lines:q=[u,0],level:i.level++}),i.tokens.push({type:"thead_open",lines:[u,u+1],level:i.level++}),i.tokens.push({type:"tr_open",lines:[u,u+1],level:i.level++}),y=0;y<x.length;y++)i.tokens.push({type:"th_open",align:P[y],lines:[u,u+1],level:i.level++}),i.tokens.push({type:"inline",content:x[y].trim(),lines:[u,u+1],level:i.level,children:[]}),i.tokens.push({type:"th_close",level:--i.level});for(i.tokens.push({type:"tr_close",level:--i.level}),i.tokens.push({type:"thead_close",level:--i.level}),i.tokens.push({type:"tbody_open",lines:V=[u+2,0],level:i.level++}),b=u+2;b<d&&!(i.tShift[b]<i.blkIndent||(v=ji(i,b).trim(),v.indexOf("|")===-1));b++){for(x=v.replace(/^\||\|$/g,"").split("|"),i.tokens.push({type:"tr_open",level:i.level++}),y=0;y<x.length;y++)i.tokens.push({type:"td_open",align:P[y],level:i.level++}),A=x[y].substring(x[y].charCodeAt(0)===124?1:0,x[y].charCodeAt(x[y].length-1)===124?x[y].length-1:x[y].length).trim(),i.tokens.push({type:"inline",content:A,level:i.level,children:[]}),i.tokens.push({type:"td_close",level:--i.level});i.tokens.push({type:"tr_close",level:--i.level})}return i.tokens.push({type:"tbody_close",level:--i.level}),i.tokens.push({type:"table_close",level:--i.level}),q[1]=V[1]=b,i.line=b,!0}function Wt(i,u){var d,h,m=i.bMarks[u]+i.tShift[u],v=i.eMarks[u];return m>=v||(h=i.src.charCodeAt(m++),h!==126&&h!==58)||(d=i.skipSpaces(m),m===d)||d>=v?-1:d}function lr(i,u){var d,h,m=i.level+2;for(d=u+2,h=i.tokens.length-2;d<h;d++)i.tokens[d].level===m&&i.tokens[d].type==="paragraph_open"&&(i.tokens[d+2].tight=!0,i.tokens[d].tight=!0,d+=2)}function cr(i,u,d,h){var m,v,g,y,b,x,A,P,D,q,V,J,X,oe;if(h)return!(i.ddIndent<0)&&Wt(i,u)>=0;if(A=u+1,i.isEmpty(A)&&++A>d||i.tShift[A]<i.blkIndent||(m=Wt(i,A),m<0)||i.level>=i.options.maxNesting)return!1;x=i.tokens.length,i.tokens.push({type:"dl_open",lines:b=[u,0],level:i.level++}),g=u,v=A;e:for(;;){for(oe=!0,X=!1,i.tokens.push({type:"dt_open",lines:[g,g],level:i.level++}),i.tokens.push({type:"inline",content:i.getLines(g,g+1,i.blkIndent,!1).trim(),level:i.level+1,lines:[g,g],children:[]}),i.tokens.push({type:"dt_close",level:--i.level});;){if(i.tokens.push({type:"dd_open",lines:y=[A,0],level:i.level++}),J=i.tight,D=i.ddIndent,P=i.blkIndent,V=i.tShift[v],q=i.parentType,i.blkIndent=i.ddIndent=i.tShift[v]+2,i.tShift[v]=m-i.bMarks[v],i.tight=!0,i.parentType="deflist",i.parser.tokenize(i,v,d,!0),(!i.tight||X)&&(oe=!1),X=i.line-v>1&&i.isEmpty(i.line-1),i.tShift[v]=V,i.tight=J,i.parentType=q,i.blkIndent=P,i.ddIndent=D,i.tokens.push({type:"dd_close",level:--i.level}),y[1]=A=i.line,A>=d||i.tShift[A]<i.blkIndent)break e;if(m=Wt(i,A),m<0)break;v=A}if(A>=d||(g=A,i.isEmpty(g))||i.tShift[g]<i.blkIndent||(v=g+1,v>=d)||(i.isEmpty(v)&&v++,v>=d)||i.tShift[v]<i.blkIndent||(m=Wt(i,v),m<0))break}return i.tokens.push({type:"dl_close",level:--i.level}),b[1]=A,i.line=A,oe&&lr(i,x),!0}function dr(i,u){var d,h,m,v,g,y,b=u+1;if(d=i.lineMax,b<d&&!i.isEmpty(b))for(y=i.parser.ruler.getRules("paragraph");b<d&&!i.isEmpty(b);b++)if(!(i.tShift[b]-i.blkIndent>3)){for(m=!1,v=0,g=y.length;v<g;v++)if(y[v](i,b,d,!0)){m=!0;break}if(m)break}return h=i.getLines(u,b,i.blkIndent,!1).trim(),i.line=b,h.length&&(i.tokens.push({type:"paragraph_open",tight:!1,lines:[u,i.line],level:i.level}),i.tokens.push({type:"inline",content:h,level:i.level+1,lines:[u,i.line],children:[]}),i.tokens.push({type:"paragraph_close",tight:!1,level:i.level})),!0}var ln=[["code",Ks],["fences",Js,["paragraph","blockquote","list"]],["blockquote",Xs,["paragraph","blockquote","list"]],["hr",Zs,["paragraph","blockquote","list"]],["list",Qs,["paragraph","blockquote"]],["footnote",er,["paragraph"]],["heading",tr,["paragraph","blockquote"]],["lheading",ir],["htmlblock",or,["paragraph","blockquote"]],["table",ar,["paragraph"]],["deflist",cr,["paragraph"]],["paragraph",dr]];function hn(){this.ruler=new ee;for(var i=0;i<ln.length;i++)this.ruler.push(ln[i][0],ln[i][1],{alt:(ln[i][2]||[]).slice()})}hn.prototype.tokenize=function(i,u,d){for(var h,m,v=this.ruler.getRules(""),g=v.length,y=u,b=!1;y<d&&(i.line=y=i.skipEmptyLines(y),!(y>=d||i.tShift[y]<i.blkIndent));){for(m=0;m<g&&(h=v[m](i,y,d,!1),!h);m++);if(i.tight=!b,i.isEmpty(i.line-1)&&(b=!0),y=i.line,y<d&&i.isEmpty(y)){if(b=!0,y++,y<d&&i.parentType==="list"&&i.isEmpty(y))break;i.line=y}}};var un=/[\n\t]/g,_n=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,Sn=/\u00a0/g;hn.prototype.parse=function(i,u,d,h){var m,v=0,g=0;if(!i)return[];i=i.replace(Sn," "),i=i.replace(_n,"\n"),i.indexOf("\t")>=0&&(i=i.replace(un,(function(u,d){var h;return i.charCodeAt(d)===10?(v=d+1,g=0,u):(h="    ".slice((d-v-g)%4),g=d-v+1,h)}))),m=new Xe(i,this,u,d,h),this.tokenize(m,m.line,m.lineMax)};function pr(i){switch(i){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}function mr(i,u){for(var d=i.pos;d<i.posMax&&!pr(i.src.charCodeAt(d));)d++;return d!==i.pos&&(u||(i.pending+=i.src.slice(i.pos,d)),i.pos=d,!0)}function gr(i,u){var d,h,m=i.pos;if(i.src.charCodeAt(m)!==10)return!1;if(d=i.pending.length-1,h=i.posMax,!u)if(d>=0&&i.pending.charCodeAt(d)===32)if(d>=1&&i.pending.charCodeAt(d-1)===32){for(var v=d-2;v>=0;v--)if(i.pending.charCodeAt(v)!==32){i.pending=i.pending.substring(0,v+1);break}i.push({type:"hardbreak",level:i.level})}else i.pending=i.pending.slice(0,-1),i.push({type:"softbreak",level:i.level});else i.push({type:"softbreak",level:i.level});for(m++;m<h&&i.src.charCodeAt(m)===32;)m++;return i.pos=m,!0}var Cn=[];for(var wn=0;wn<256;wn++)Cn.push(0);"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach((function(i){Cn[i.charCodeAt(0)]=1}));function br(i,u){var d,h=i.pos,m=i.posMax;if(i.src.charCodeAt(h)!==92)return!1;if(h++,h<m){if(d=i.src.charCodeAt(h),d<256&&Cn[d]!==0)return u||(i.pending+=i.src[h]),i.pos+=2,!0;if(d===10){for(u||i.push({type:"hardbreak",level:i.level}),h++;h<m&&i.src.charCodeAt(h)===32;)h++;return i.pos=h,!0}}return u||(i.pending+="\\"),i.pos++,!0}function vr(i,u){var d,h,m,v,g,y=i.pos,b=i.src.charCodeAt(y);if(b!==96)return!1;for(d=y,y++,h=i.posMax;y<h&&i.src.charCodeAt(y)===96;)y++;for(m=i.src.slice(d,y),v=g=y;(v=i.src.indexOf("`",g))!==-1;){for(g=v+1;g<h&&i.src.charCodeAt(g)===96;)g++;if(g-v===m.length)return u||i.push({type:"code",content:i.src.slice(y,v).replace(/[ \n]+/g," ").trim(),block:!1,level:i.level}),i.pos=g,!0}return u||(i.pending+=m),i.pos+=m.length,!0}function yr(i,u){var d,h,m,v,g,y=i.posMax,b=i.pos;if(i.src.charCodeAt(b)!==126||u||b+4>=y||i.src.charCodeAt(b+1)!==126||i.level>=i.options.maxNesting||(v=b>0?i.src.charCodeAt(b-1):-1,g=i.src.charCodeAt(b+2),v===126)||g===126||g===32||g===10)return!1;for(h=b+2;h<y&&i.src.charCodeAt(h)===126;)h++;if(h>b+3)return i.pos+=h-b,u||(i.pending+=i.src.slice(b,h)),!0;for(i.pos=b+2,m=1;i.pos+1<y;){if(i.src.charCodeAt(i.pos)===126&&i.src.charCodeAt(i.pos+1)===126&&(v=i.src.charCodeAt(i.pos-1),g=i.pos+2<y?i.src.charCodeAt(i.pos+2):-1,g!==126&&v!==126&&(v!==32&&v!==10?m--:g!==32&&g!==10&&m++,m<=0))){d=!0;break}i.parser.skipToken(i)}return d?(i.posMax=i.pos,i.pos=b+2,u||(i.push({type:"del_open",level:i.level++}),i.parser.tokenize(i),i.push({type:"del_close",level:--i.level})),i.pos=i.posMax+2,i.posMax=y,!0):(i.pos=b,!1)}function xr(i,u){var d,h,m,v,g,y=i.posMax,b=i.pos;if(i.src.charCodeAt(b)!==43||u||b+4>=y||i.src.charCodeAt(b+1)!==43||i.level>=i.options.maxNesting||(v=b>0?i.src.charCodeAt(b-1):-1,g=i.src.charCodeAt(b+2),v===43)||g===43||g===32||g===10)return!1;for(h=b+2;h<y&&i.src.charCodeAt(h)===43;)h++;if(h!==b+2)return i.pos+=h-b,u||(i.pending+=i.src.slice(b,h)),!0;for(i.pos=b+2,m=1;i.pos+1<y;){if(i.src.charCodeAt(i.pos)===43&&i.src.charCodeAt(i.pos+1)===43&&(v=i.src.charCodeAt(i.pos-1),g=i.pos+2<y?i.src.charCodeAt(i.pos+2):-1,g!==43&&v!==43&&(v!==32&&v!==10?m--:g!==32&&g!==10&&m++,m<=0))){d=!0;break}i.parser.skipToken(i)}return d?(i.posMax=i.pos,i.pos=b+2,u||(i.push({type:"ins_open",level:i.level++}),i.parser.tokenize(i),i.push({type:"ins_close",level:--i.level})),i.pos=i.posMax+2,i.posMax=y,!0):(i.pos=b,!1)}function Er(i,u){var d,h,m,v,g,y=i.posMax,b=i.pos;if(i.src.charCodeAt(b)!==61||u||b+4>=y||i.src.charCodeAt(b+1)!==61||i.level>=i.options.maxNesting||(v=b>0?i.src.charCodeAt(b-1):-1,g=i.src.charCodeAt(b+2),v===61)||g===61||g===32||g===10)return!1;for(h=b+2;h<y&&i.src.charCodeAt(h)===61;)h++;if(h!==b+2)return i.pos+=h-b,u||(i.pending+=i.src.slice(b,h)),!0;for(i.pos=b+2,m=1;i.pos+1<y;){if(i.src.charCodeAt(i.pos)===61&&i.src.charCodeAt(i.pos+1)===61&&(v=i.src.charCodeAt(i.pos-1),g=i.pos+2<y?i.src.charCodeAt(i.pos+2):-1,g!==61&&v!==61&&(v!==32&&v!==10?m--:g!==32&&g!==10&&m++,m<=0))){d=!0;break}i.parser.skipToken(i)}return d?(i.posMax=i.pos,i.pos=b+2,u||(i.push({type:"mark_open",level:i.level++}),i.parser.tokenize(i),i.push({type:"mark_close",level:--i.level})),i.pos=i.posMax+2,i.posMax=y,!0):(i.pos=b,!1)}function In(i){return i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122}function Ln(i,u){var d,h,m,v=u,g=!0,y=!0,b=i.posMax,x=i.src.charCodeAt(u);for(d=u>0?i.src.charCodeAt(u-1):-1;v<b&&i.src.charCodeAt(v)===x;)v++;return v>=b&&(g=!1),m=v-u,m>=4?g=y=!1:(h=v<b?i.src.charCodeAt(v):-1,(h===32||h===10)&&(g=!1),(d===32||d===10)&&(y=!1),x===95&&(In(d)&&(g=!1),In(h)&&(y=!1))),{can_open:g,can_close:y,delims:m}}function _r(i,u){var d,h,m,v,g,y,b,x=i.posMax,A=i.pos,P=i.src.charCodeAt(A);if(P!==95&&P!==42||u)return!1;if(b=Ln(i,A),d=b.delims,!b.can_open)return i.pos+=d,u||(i.pending+=i.src.slice(A,i.pos)),!0;if(i.level>=i.options.maxNesting)return!1;for(i.pos=A+d,y=[d];i.pos<x;)if(i.src.charCodeAt(i.pos)!==P)i.parser.skipToken(i);else{if(b=Ln(i,i.pos),h=b.delims,b.can_close){for(v=y.pop(),g=h;v!==g;){if(g<v){y.push(v-g);break}if(g-=v,y.length===0)break;i.pos+=v,v=y.pop()}if(y.length===0){d=v,m=!0;break}i.pos+=h;continue}b.can_open&&y.push(h),i.pos+=h}return m?(i.posMax=i.pos,i.pos=A+d,u||((d===2||d===3)&&i.push({type:"strong_open",level:i.level++}),(d===1||d===3)&&i.push({type:"em_open",level:i.level++}),i.parser.tokenize(i),(d===1||d===3)&&i.push({type:"em_close",level:--i.level}),(d===2||d===3)&&i.push({type:"strong_close",level:--i.level})),i.pos=i.posMax+d,i.posMax=x,!0):(i.pos=A,!1)}var Tn=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function wr(i,u){var d,h,m=i.posMax,v=i.pos;if(i.src.charCodeAt(v)!==126||u||v+2>=m||i.level>=i.options.maxNesting)return!1;for(i.pos=v+1;i.pos<m;){if(i.src.charCodeAt(i.pos)===126){d=!0;break}i.parser.skipToken(i)}return!d||v+1===i.pos||(h=i.src.slice(v+1,i.pos),h.match(/(^|[^\\])(\\\\)*\s/))?(i.pos=v,!1):(i.posMax=i.pos,i.pos=v+1,u||i.push({type:"sub",level:i.level,content:h.replace(Tn,"$1")}),i.pos=i.posMax+1,i.posMax=m,!0)}var Rn=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function Cr(i,u){var d,h,m=i.posMax,v=i.pos;if(i.src.charCodeAt(v)!==94||u||v+2>=m||i.level>=i.options.maxNesting)return!1;for(i.pos=v+1;i.pos<m;){if(i.src.charCodeAt(i.pos)===94){d=!0;break}i.parser.skipToken(i)}return!d||v+1===i.pos||(h=i.src.slice(v+1,i.pos),h.match(/(^|[^\\])(\\\\)*\s/))?(i.pos=v,!1):(i.posMax=i.pos,i.pos=v+1,u||i.push({type:"sup",level:i.level,content:h.replace(Rn,"$1")}),i.pos=i.posMax+1,i.posMax=m,!0)}function kr(i,u){var d,h,m,v,g,y,b,x,A=!1,P=i.pos,D=i.posMax,q=i.pos,V=i.src.charCodeAt(q);if(V===33&&(A=!0,V=i.src.charCodeAt(++q)),V!==91||i.level>=i.options.maxNesting||(d=q+1,h=Mt(i,q),h<0))return!1;if(y=h+1,y<D&&i.src.charCodeAt(y)===40){for(y++;y<D&&(x=i.src.charCodeAt(y),!(x!==32&&x!==10));y++);if(y>=D)return!1;for(q=y,ns(i,y)?(v=i.linkContent,y=i.pos):v="",q=y;y<D&&(x=i.src.charCodeAt(y),!(x!==32&&x!==10));y++);if(y<D&&q!==y&&ss(i,y))for(g=i.linkContent,y=i.pos;y<D&&(x=i.src.charCodeAt(y),!(x!==32&&x!==10));y++);else g="";if(y>=D||i.src.charCodeAt(y)!==41)return i.pos=P,!1;y++}else{if(i.linkLevel>0)return!1;for(;y<D&&(x=i.src.charCodeAt(y),!(x!==32&&x!==10));y++);if(y<D&&i.src.charCodeAt(y)===91&&(q=y+1,y=Mt(i,y),y>=0?m=i.src.slice(q,y++):y=q-1),m||(_typeof(m)>"u"&&(y=h+1),m=i.src.slice(d,h)),b=i.env.references[rs(m)],!b)return i.pos=P,!1;v=b.href,g=b.title}return u||(i.pos=d,i.posMax=h,A?i.push({type:"image",src:v,title:g,alt:i.src.substr(d,h-d),level:i.level}):(i.push({type:"link_open",href:v,title:g,level:i.level++}),i.linkLevel++,i.parser.tokenize(i),i.linkLevel--,i.push({type:"link_close",level:--i.level}))),i.pos=y,i.posMax=D,!0}function Ar(i,u){var d,h,m,v,g=i.posMax,y=i.pos;return!(y+2>=g||i.src.charCodeAt(y)!==94||i.src.charCodeAt(y+1)!==91||i.level>=i.options.maxNesting||(d=y+2,h=Mt(i,y+1),h<0))&&(u||(i.env.footnotes||(i.env.footnotes={}),i.env.footnotes.list||(i.env.footnotes.list=[]),m=i.env.footnotes.list.length,i.pos=d,i.posMax=h,i.push({type:"footnote_ref",id:m,level:i.level}),i.linkLevel++,v=i.tokens.length,i.parser.tokenize(i),i.env.footnotes.list[m]={tokens:i.tokens.splice(v)},i.linkLevel--),i.pos=h+1,i.posMax=g,!0)}function Mr(i,u){var d,h,m,v,g=i.posMax,y=i.pos;if(y+3>g||!i.env.footnotes||!i.env.footnotes.refs||i.src.charCodeAt(y)!==91||i.src.charCodeAt(y+1)!==94||i.level>=i.options.maxNesting)return!1;for(h=y+2;h<g;h++){if(i.src.charCodeAt(h)===32||i.src.charCodeAt(h)===10)return!1;if(i.src.charCodeAt(h)===93)break}return!(h===y+2||h>=g||(h++,d=i.src.slice(y+2,h-1),_typeof(i.env.footnotes.refs[":"+d])>"u"))&&(u||(i.env.footnotes.list||(i.env.footnotes.list=[]),i.env.footnotes.refs[":"+d]<0?(m=i.env.footnotes.list.length,i.env.footnotes.list[m]={label:d,count:0},i.env.footnotes.refs[":"+d]=m):m=i.env.footnotes.refs[":"+d],v=i.env.footnotes.list[m].count,i.env.footnotes.list[m].count++,i.push({type:"footnote_ref",id:m,subId:v,level:i.level})),i.pos=h,i.posMax=g,!0)}var On=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],Nn=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,Fn=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function Pr(i,u){var d,h,m,v,g,y=i.pos;return!(i.src.charCodeAt(y)!==60||(d=i.src.slice(y),d.indexOf(">")<0))&&(h=d.match(Fn),h?!(On.indexOf(h[1].toLowerCase())<0||(v=h[0].slice(1,-1),g=Ji(v),!i.parser.validateLink(v)))&&(u||(i.push({type:"link_open",href:g,level:i.level}),i.push({type:"text",content:v,level:i.level+1}),i.push({type:"link_close",level:i.level})),i.pos+=h[0].length,!0):(m=d.match(Nn),!!m&&(v=m[0].slice(1,-1),g=Ji("mailto:"+v),!!i.parser.validateLink(g)&&(u||(i.push({type:"link_open",href:g,level:i.level}),i.push({type:"text",content:v,level:i.level+1}),i.push({type:"link_close",level:i.level})),i.pos+=m[0].length,!0))))}function Ei(i,u){return i=i.source,u=u||"",function t(d,h){return d?(h=h.source||h,i=i.replace(d,h),t):new RegExp(i,u)}}var Dn=/[a-zA-Z_:][a-zA-Z0-9:._-]*/,Bn=/[^"'=<>`\x00-\x20]+/,jn=/'[^']*'/,Un=/"[^"]*"/,Hn=Ei(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",Bn)("single_quoted",jn)("double_quoted",Un)(),Gn=Ei(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",Dn)("attr_value",Hn)(),qn=Ei(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",Gn)(),zn=/<\/[A-Za-z][A-Za-z0-9]*\s*>/,Vn=/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/,Wn=/<[?].*?[?]>/,Kn=/<![A-Z]+\s+[^>]*>/,$n=/<!\[CDATA\[[\s\S]*?\]\]>/,Jn=Ei(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",qn)("close_tag",zn)("comment",Vn)("processing",Wn)("declaration",Kn)("cdata",$n)();function $r(i){var u=i|32;return u>=97&&u<=122}function Kr(i,u){var d,h,m,v=i.pos;return!(!i.options.html||(m=i.posMax,i.src.charCodeAt(v)!==60||v+2>=m)||(d=i.src.charCodeAt(v+1),d!==33&&d!==63&&d!==47&&!$r(d))||(h=i.src.slice(v).match(Jn),!h))&&(u||i.push({type:"htmltag",content:i.src.slice(v,v+h[0].length),level:i.level}),i.pos+=h[0].length,!0)}var Yn=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,Zn=/^&([a-z][a-z0-9]{1,31});/i;function Zr(i,u){var d,h,m,v=i.pos,g=i.posMax;if(i.src.charCodeAt(v)!==38)return!1;if(v+1<g)if(d=i.src.charCodeAt(v+1),d===35){if(m=i.src.slice(v).match(Yn),m)return u||(h=m[1][0].toLowerCase()==="x"?parseInt(m[1].slice(1),16):parseInt(m[1],10),i.pending+=ts(h)?Ki(h):Ki(65533)),i.pos+=m[0].length,!0}else if(m=i.src.slice(v).match(Zn),m){var y=Qn(m[1]);if(m[1]!==y)return u||(i.pending+=y),i.pos+=m[0].length,!0}return u||(i.pending+="&"),i.pos++,!0}var Xn=[["text",mr],["newline",gr],["escape",br],["backticks",vr],["del",yr],["ins",xr],["mark",Er],["emphasis",_r],["sub",wr],["sup",Cr],["links",kr],["footnote_inline",Ar],["footnote_ref",Mr],["autolink",Pr],["htmltag",Kr],["entity",Zr]];function _i(){this.ruler=new ee;for(var i=0;i<Xn.length;i++)this.ruler.push(Xn[i][0],Xn[i][1]);this.validateLink=Yr}_i.prototype.skipToken=function(i){var u,d,h=this.ruler.getRules(""),m=h.length,v=i.pos;if((d=i.cacheGet(v))>0)i.pos=d;else{for(u=0;u<m;u++)if(h[u](i,!0)){i.cacheSet(v,i.pos);return}i.pos++,i.cacheSet(v,i.pos)}};_i.prototype.tokenize=function(i){for(var u,d,h=this.ruler.getRules(""),m=h.length,v=i.posMax;i.pos<v;){for(d=0;d<m&&(u=h[d](i,!1),!u);d++);if(u){if(i.pos>=v)break}else i.pending+=i.src[i.pos++]}i.pending&&i.pushPending()};_i.prototype.parse=function(i,u,d,h){var m=new Je(i,this,u,d,h);this.tokenize(m)};function Yr(i){var u=["vbscript","javascript","file","data"],d=i.trim().toLowerCase();return d=We(d),!(d.indexOf(":")!==-1&&u.indexOf(d.split(":")[0])!==-1)}var nr={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},sr={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},ur={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}},hr={default:nr,full:sr,commonmark:ur};function ls(i,u,d){this.src=u,this.env=d,this.options=i.options,this.tokens=[],this.inlineMode=!1,this.inline=i.inline,this.block=i.block,this.renderer=i.renderer,this.typographer=i.typographer}function we(i,u){typeof i!="string"&&(u=i,i="default"),u&&u.linkify!=null&&console.warn("linkify option is removed. Use linkify plugin instead:\n\nimport Remarkable from 'remarkable';\nimport linkify from 'remarkable/linkify';\nnew Remarkable().use(linkify)\n"),this.inline=new _i,this.block=new hn,this.core=new os,this.renderer=new dn,this.ruler=new ee,this.options={},this.configure(hr[i]),this.set(u||{})}we.prototype.set=function(i){es(this.options,i)};we.prototype.configure=function(i){var u=this;if(!i)throw new Error("Wrong `remarkable` preset, check name/content");i.options&&u.set(i.options),i.components&&Object.keys(i.components).forEach((function(d){i.components[d].rules&&u[d].ruler.enable(i.components[d].rules,!0)}))};we.prototype.use=function(i,u){return i(this,u),this};we.prototype.parse=function(i,u){var d=new ls(this,i,u);return this.core.process(d),d.tokens};we.prototype.render=function(i,u){return u=u||{},this.renderer.render(this.parse(i,u),this.options,u)};we.prototype.parseInline=function(i,u){var d=new ls(this,i,u);return d.inlineMode=!0,this.core.process(d),d.tokens};we.prototype.renderInline=function(i,u){return u=u||{},this.renderer.render(this.parseInline(i,u),this.options,u)};var fr=function(){function Rt(){_classCallCheck(this,Rt)}return _createClass(Rt,null,[{key:"instantiate",value:function instantiate(){var i=window.hljs;return new we(i?{highlight:function highlight(u,d){if(d&&i.getLanguage(d))try{return i.highlight(d,u).value}catch(i){console.error("failed to setup the highlight dependency")}try{return i.highlightAuto(u).value}catch(i){console.error("failed to automatically highlight messages")}return""},html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"_blank",typographer:!0}:{linkTarget:"_blank"})}},{key:"createNew",value:function createNew(){var i=Rt.instantiate();return i.inline.validateLink=function(){return!0},i}}])}();var Sr=function(){function no(){_classCallCheck(this,no)}return _createClass(no,null,[{key:"replaceNewlineWithDouble",value:function replaceNewlineWithDouble(i){return i.replace(new RegExp("(?<!\\n)\\n(?!\\n)","g"),"\n\n")}}])}();var Tr=function(){function ve(){_classCallCheck(this,ve)}return _createClass(ve,null,[{key:"addMessage",value:function addMessage(i,u,d,h){var m;i.elementRef.appendChild(u.outerContainer),i.applyCustomStyles(u,h,!0,(m=i.messageStyles)==null?void 0:m[d]),i.elementRef.scrollTop=i.elementRef.scrollHeight}},{key:"wrapInLink",value:function wrapInLink(i,u,d){var h=document.createElement("a");return h.href=u,h.download=d||ve.DEFAULT_FILE_NAME,h.target="_blank",h.appendChild(i),h}},{key:"isNonLinkableDataUrl",value:function isNonLinkableDataUrl(i,u){return!(!u.startsWith("data")||i==="image")&&(i==="any"&&u.startsWith("data:text/javascript")||!u.startsWith("data:image")&&!u.startsWith("data:application"))}},{key:"processContent",value:function processContent(i,u,d,h){return!d||ve.isNonLinkableDataUrl(i,d)?u:ve.wrapInLink(u,d,h)}},{key:"waitToLoadThenScroll",value:function waitToLoadThenScroll(i){setTimeout((function(){i.scrollTop=i.scrollHeight}),60)}},{key:"scrollDownOnImageLoad",value:function scrollDownOnImageLoad(i,u){if(i.startsWith("data"))ve.waitToLoadThenScroll(u);else try{fetch(i,{mode:"no-cors"}).catch((function(){})).finally((function(){ve.waitToLoadThenScroll(u)}))}catch(i){u.scrollTop=u.scrollHeight}}},{key:"reAddFileRefToObject",value:function reAddFileRefToObject(i,u){var d;(d=i.files)==null||d.forEach((function(i,d){var h;i.ref&&(h=u.message.files)!=null&&h[d]&&(u.message.files[d].ref=i.ref)}))}},{key:"removeFileRef",value:function removeFileRef(i){var u=_objectSpread({},i);return delete u.ref,u}},{key:"isAudioFile",value:function isAudioFile(i){var u=/\.(mp3|ogg|wav|aac|webm|4a)$/i,d=i.type,h=i.src;return d==="audio"||(h==null?void 0:h.startsWith("data:audio"))||h&&u.test(h)}},{key:"isImageFile",value:function isImageFile(i){var u=i.type,d=i.src;return u==="image"||(d==null?void 0:d.startsWith("data:image"))||d&&ve.isImageFileExtension(d)}},{key:"isImageFileExtension",value:function isImageFileExtension(i){return/\.(jpg|jpeg|png|gif|bmp)$/i.test(i)}}])}();Tr.DEFAULT_FILE_NAME="file";var Rr=Tr;var Ir=function(){function ei(){_classCallCheck(this,ei)}return _createClass(ei,null,[{key:"onMessage",value:function onMessage(i,u,d){var h;var m=JSON.parse(JSON.stringify({message:u,isHistory:d,isInitial:d}));Rr.reAddFileRefToObject(u,m),(h=i.onMessage)==null||h.call(i,m),i.dispatchEvent(new CustomEvent("message",{detail:m})),Te.fireOnNewMessage(i,m)}},{key:"onClearMessages",value:function onClearMessages(i){var u;(u=i.onClearMessages)==null||u.call(i),i.dispatchEvent(new CustomEvent("clear-messages"))}},{key:"onRender",value:function onRender(i){var u;(u=i.onComponentRender)==null||u.call(i,i),i.dispatchEvent(new CustomEvent("render",{detail:i}))}},{key:"onError",value:function onError(i,u){var d;(d=i.onError)==null||d.call(i,u),i.dispatchEvent(new CustomEvent("error",{detail:u}))}}])}();var Lr=function(){function H(){_classCallCheck(this,H)}return _createClass(H,null,[{key:"applyCustomStylesToElements",value:function applyCustomStylesToElements(i,u,d){if(d&&(Object.assign(i.outerContainer.style,d.outerContainer),Object.assign(i.innerContainer.style,d.innerContainer),Object.assign(i.bubbleElement.style,d.bubble),u)){var h=i.bubbleElement.children[0],m=h.tagName.toLocaleLowerCase()!=="a"?h:h.children[0];Object.assign(m.style,d.media)}}},{key:"applySideStyles",value:function applySideStyles(i,u,d,h){h&&(H.applyCustomStylesToElements(i,d,h.shared),u===Qe.USER_ROLE?H.applyCustomStylesToElements(i,d,h.user):(H.applyCustomStylesToElements(i,d,h.ai),H.applyCustomStylesToElements(i,d,h[u])))}},{key:"isElementsStyles",value:function isElementsStyles(i){return!!(i.outerContainer||i.innerContainer||i.bubble||i.media)}},{key:"applyCustomStyles",value:function applyCustomStyles(i,u,d,h,m){var v;m&&i.default!==m?H.isElementsStyles(m)?(H.applyCustomStylesToElements(u,h,(v=i.default)==null?void 0:v.shared),H.applyCustomStylesToElements(u,h,m)):(H.applySideStyles(u,d,h,i.default),H.applySideStyles(u,d,h,m)):H.applySideStyles(u,d,h,i.default)}},{key:"extractParticularSharedStyles",value:function extractParticularSharedStyles(i,u){if(u!=null&&u.shared){var d=u.shared,h={outerContainer:{},innerContainer:{},bubble:{},media:{}};return i.forEach((function(i){var u,m,v,g;h.outerContainer[i]=((u=d.outerContainer)==null?void 0:u[i])||"",h.innerContainer[i]=((m=d.innerContainer)==null?void 0:m[i])||"",h.bubble[i]=((v=d.bubble)==null?void 0:v[i])||"",h.media[i]=((g=d.media)==null?void 0:g[i])||""})),h}}}])}();var Or=function(){function at(i){var u=this;_classCallCheck(this,at);this.messageElementRefs=[],this.messages=[],this.htmlClassUtilities={},this.textElementsToText=[],this.elementRef=at.createContainerElement(),this.messageStyles=i.messageStyles,this._remarkable=fr.createNew(),this._avatars=i.avatars,this._names=i.names,this._onMessage=Ir.onMessage.bind(this,i),i.htmlClassUtilities&&(this.htmlClassUtilities=i.htmlClassUtilities),setTimeout((function(){u.submitUserMessage=i.submitUserMessage}))}return _createClass(at,[{key:"addNewTextMessage",value:function addNewTextMessage(i,u,d){if(d!=null&&d.status){var h=this.overwriteText(u,i,this.messageElementRefs);if(h)return h;d.status=!1}var m=this.createAndAppendNewMessageElement(i,u);return m.bubbleElement.classList.add("text-message"),this.applyCustomStyles(m,u,!1),Qe.fillEmptyMessageElement(m.bubbleElement,i),this.textElementsToText.push([m,i]),m}},{key:"overwriteText",value:function overwriteText(i,u,d){var h=Qe.overwriteMessage(this.messages,d,u,i,"text","text-message");if(h){this.renderText(h.bubbleElement,u);var m=Qe.getLastTextToElement(this.textElementsToText,h);m&&(m[1]=u)}return h}},{key:"createAndAppendNewMessageElement",value:function createAndAppendNewMessageElement(i,u){var d=this;var h=this.createNewMessageElement(i,u);return this.elementRef.appendChild(h.outerContainer),setTimeout((function(){return fe.scrollToBottom(d.elementRef)})),h}},{key:"createNewMessageElement",value:function createNewMessageElement(i,u){var d;(d=this._introPanel)==null||d.hide();var h=this.messageElementRefs[this.messageElementRefs.length-1];return at.isTemporaryElement(h)&&(h.outerContainer.remove(),this.messageElementRefs.pop()),this.createMessageElements(i,u)}},{key:"createMessageElements",value:function createMessageElements(i,u){var d=at.createBaseElements(),h=d.outerContainer,m=d.innerContainer,v=d.bubbleElement;return h.appendChild(m),this.addInnerContainerElements(v,i,u),this.messageElementRefs.push(d),d}},{key:"addInnerContainerElements",value:function addInnerContainerElements(i,u,d){var h;return((h=this.messages[this.messages.length-1])==null?void 0:h.role)===d&&!this.isLastMessageError()&&Qe.hideRoleElements(this.messageElementRefs,!!this._avatars,!!this._names),i.classList.add("message-bubble",Qe.getRoleClass(d),d===Qe.USER_ROLE?"user-message-text":"ai-message-text"),this.renderText(i,u),Qe.addRoleElements(i,d,this._avatars,this._names),{bubbleElement:i}}},{key:"applyCustomStyles",value:function applyCustomStyles(i,u,d,h){i&&this.messageStyles&&Lr.applyCustomStyles(this.messageStyles,i,u,d,h)}},{key:"removeLastMessage",value:function removeLastMessage(){this.messageElementRefs[this.messageElementRefs.length-1].outerContainer.remove(),this.messageElementRefs.pop()}},{key:"isLastMessageError",value:function isLastMessageError(){var i;return(i=Qe.getLastMessageBubbleElement(this.elementRef))==null?void 0:i.classList.contains("error-message-text")}},{key:"sendClientUpdate",value:function sendClientUpdate(i){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];var d;(d=this._onMessage)==null||d.call(this,i,u)}},{key:"renderText",value:function renderText(i,u){var d=Sr.replaceNewlineWithDouble(u);i.innerHTML=this._remarkable.render(d),i.innerText.trim().length===0&&(i.innerText=d)}},{key:"refreshTextMessages",value:function refreshTextMessages(){var i=this;this._remarkable=fr.createNew(),this.textElementsToText.forEach((function(u){i.renderText(u[0].bubbleElement,u[1])}))}}],[{key:"createContainerElement",value:function createContainerElement(){var i=document.createElement("div");return i.id="messages",i}},{key:"isTemporaryElement",value:function isTemporaryElement(i){return(i==null?void 0:i.bubbleElement.classList.contains("loading-message-text"))||vt.isElementTemporary(i)}},{key:"createBaseElements",value:function createBaseElements(){var i=document.createElement("div"),u=document.createElement("div");u.classList.add("inner-message-container"),i.appendChild(u),i.classList.add("outer-message-container");var d=document.createElement("div");return d.classList.add("message-bubble"),u.appendChild(d),{outerContainer:i,innerContainer:u,bubbleElement:d}}},{key:"createMessageContent",value:function createMessageContent(i){var u=i.text,d=i.files,h=i.html,m=i._sessionId,v=i.role,g={role:v||Qe.AI_ROLE};return u&&(g.text=u),d&&(g.files=d),h&&(g.html=h),!u&&!d&&!h&&(g.text=""),m&&(g._sessionId=m),g}}])}();var Nr=function(){function Re(i){_classCallCheck(this,Re);this._fileAdded=!1,this._streamedContent="",this._streamType="",this._hasStreamEnded=!1,this._messages=i}return _createClass(Re,[{key:"upsertStreamedMessage",value:function upsertStreamedMessage(i){var u;if(!this._hasStreamEnded){if((i==null?void 0:i.text)===void 0&&(i==null?void 0:i.html)===void 0)return console.error(oe.INVALID_STREAM_EVENT);var d=(i==null?void 0:i.text)||(i==null?void 0:i.html)||"",h=fe.isScrollbarAtBottomOfElement(this._messages.elementRef),m=(i==null?void 0:i.text)!==void 0?"text":"html";if(this._elements||this._streamedContent!==""){if(this._streamType!==m)return console.error(oe.INVALID_STREAM_EVENT_MIX);this.updateBasedOnType(d,m,(u=this._elements)==null?void 0:u.bubbleElement,i==null?void 0:i.overwrite)}else this.setInitialState(m,d,i==null?void 0:i.role);h&&fe.scrollToBottom(this._messages.elementRef)}}},{key:"setInitialState",value:function setInitialState(i,u,d){var h;this._streamType=i,(h=d)!==null&&h!==void 0?h:d=Qe.AI_ROLE,this._elements=i==="text"?this._messages.addNewTextMessage(u,d):kt.add(this._messages,u,d,this._messages.messageElementRefs),this._elements.bubbleElement.classList.add(Re.MESSAGE_CLASS),this._streamedContent=u,this._activeMessageRole=d,this._message=_defineProperty({role:this._activeMessageRole},i,this._streamedContent),this._messages.messages.push(this._message)}},{key:"updateBasedOnType",value:function updateBasedOnType(i,u,d){var h=arguments.length>3&&arguments[3]!==void 0&&arguments[3];Qe.unfillEmptyMessageElement(d,i),(u==="text"?this.updateText:this.updateHTML).bind(this)(i,d,h)}},{key:"updateText",value:function updateText(i,u,d){this._streamedContent=d?i:this._streamedContent+i,this._messages.textElementsToText[this._messages.textElementsToText.length-1][1]=this._streamedContent,this._messages.renderText(u,this._streamedContent)}},{key:"updateHTML",value:function updateHTML(i,u,d){if(d)this._streamedContent=i,u.innerHTML=i;else{var h=document.createElement("span");h.innerHTML=i,u.appendChild(h),this._streamedContent=Re.HTML_CONTENT_PLACEHOLDER}}},{key:"finaliseStreamedMessage",value:function finaliseStreamedMessage(){var i,u;var d=this._messages.textElementsToText;if(!this._endStreamAfterOperation&&!(this._fileAdded&&!this._elements)){if(!this._elements)throw Error(oe.NO_VALID_STREAM_EVENTS_SENT);(i=this._elements.bubbleElement)!=null&&i.classList.contains(Re.MESSAGE_CLASS)&&(this._streamType==="text"?(d[d.length-1][1]=this._streamedContent,this._message&&(this._message.text=this._streamedContent),this._messages.textToSpeech&&Ce.speak(this._streamedContent,this._messages.textToSpeech)):this._streamType==="html"&&(this._streamedContent===Re.HTML_CONTENT_PLACEHOLDER&&(this._streamedContent=((u=this._elements.bubbleElement)==null?void 0:u.innerHTML)||""),this._elements&&gt.apply(this._messages,this._elements.outerContainer),this._message&&(this._message.html=this._streamedContent)),this._message&&this._messages.sendClientUpdate(Or.createMessageContent(this._message),!1),this._hasStreamEnded=!0)}}},{key:"markFileAdded",value:function markFileAdded(){this._fileAdded=!0}},{key:"newMessage",value:function newMessage(){this.finaliseStreamedMessage(),this._elements=void 0,this._streamedContent="",this._fileAdded=!1,this._hasStreamEnded=!1,this._activeMessageRole=void 0}},{key:"endStreamAfterFileDownloaded",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(i,u){var d,h,m,v;return _regeneratorRuntime().wrap((function _callee$(g){while(1)switch(g.prev=g.next){case 0:this._endStreamAfterOperation=!0;g.next=3;return u();case 3:h=g.sent;m=h.text;v=h.files;m&&this.updateBasedOnType(m,"text",(d=this._elements)==null?void 0:d.bubbleElement,!0),this._endStreamAfterOperation=!1,this.finaliseStreamedMessage(),v&&i.addNewMessage({files:v});case 7:case"end":return g.stop()}}),_callee,this)})));function endStreamAfterFileDownloaded(u,d){return i.apply(this,arguments)}return endStreamAfterFileDownloaded}()}])}();Nr.MESSAGE_CLASS="streamed-message",Nr.HTML_CONTENT_PLACEHOLDER="htmlplaceholder";var Fr=Nr;var Dr=function(){function He(){_classCallCheck(this,He)}return _createClass(He,null,[{key:"tempRemoveContentHeader",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(i,u,d){var h,m;return _regeneratorRuntime().wrap((function _callee2$(v){while(1)switch(v.prev=v.next){case 0:if(i!=null&&i.headers){v.next=2;break}throw new Error("Request settings have not been set up");case 2:h=i.headers[He.CONTENT_TYPE];delete i.headers[He.CONTENT_TYPE];v.prev=4;v.next=7;return u(d);case 7:m=v.sent;v.next=13;break;case 10:v.prev=10;v.t0=v.catch(4);throw i.headers[He.CONTENT_TYPE]=h,v.t0;case 13:return v.abrupt("return",(i.headers[He.CONTENT_TYPE]=h,m));case 14:case"end":return v.stop()}}),_callee2,null,[[4,10]])})));function tempRemoveContentHeader(u,d,h){return i.apply(this,arguments)}return tempRemoveContentHeader}()},{key:"displayError",value:function displayError(i,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"Service error, please try again.";if(console.error(u),_typeof(u)=="object")return u instanceof Error?i.addNewErrorMessage("service",u.message):Array.isArray(u)||typeof u.error=="string"?i.addNewErrorMessage("service",u):Object.keys(u).length===0?i.addNewErrorMessage("service",d):i.addNewErrorMessage("service",JSON.stringify(u));i.addNewErrorMessage("service",u)}},{key:"fetch",value:function(i){function fetch(u,d,h,m){return i.apply(this,arguments)}fetch.toString=function(){return i.toString()};return fetch}((function(i,u,d,h){var m,v;var g={method:((m=i.connectSettings)==null?void 0:m.method)||"POST",headers:u};return g.method!=="GET"&&(g.body=d?JSON.stringify(h):h),i.connectSettings.credentials&&(g.credentials=i.connectSettings.credentials),fetch(((v=i.connectSettings)==null?void 0:v.url)||i.url||"",g)}))},{key:"processResponseByType",value:function processResponseByType(i){var u=i.headers.get("content-type");return u!=null&&u.includes("application/json")?i.json():u!=null&&u.includes("text/plain")||!u?i:i.blob()}},{key:"processRequestInterceptor",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(i,u){var d,h,m,v;return _regeneratorRuntime().wrap((function _callee3$(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return(d=i.requestInterceptor)==null?void 0:d.call(i,u);case 2:g.t0=g.sent;if(g.t0){g.next=5;break}g.t0=u;case 5:h=g.t0;m=h;v=h;return g.abrupt("return",{body:m.body,headers:m.headers,error:v.error});case 9:case"end":return g.stop()}}),_callee3)})));function processRequestInterceptor(u,d){return i.apply(this,arguments)}return processRequestInterceptor}()},{key:"validateResponseFormat",value:function validateResponseFormat(i){return i&&_typeof(i)=="object"&&(typeof i.error=="string"||typeof i.text=="string"||typeof i.html=="string"||Array.isArray(i.files))}},{key:"onInterceptorError",value:function onInterceptorError(i,u,d){i.addNewErrorMessage("service",u),d==null||d()}}])}();Dr.CONTENT_TYPE="Content-Type";var Br=Dr;function so(i,u){return _so.apply(this,arguments)}function _so(){_so=_asyncToGenerator(_regeneratorRuntime().mark((function _callee122(i,u){var d,h;return _regeneratorRuntime().wrap((function _callee122$(m){while(1)switch(m.prev=m.next){case 0:d=i.getReader();case 1:m.next=3;return d.read();case 3:if((h=m.sent).done){m.next=7;break}u(h.value);case 5:m.next=1;break;case 7:case"end":return m.stop()}}),_callee122)})));return _so.apply(this,arguments)}function ro(i){var u,d,h,m=!1;return function(v){u===void 0?(u=v,d=0,h=-1):u=ao(u,v);var g=u.length;var y=0;for(;d<g;){m&&(u[d]===10&&(y=++d),m=!1);var b=-1;for(;d<g&&b===-1;++d)switch(u[d]){case 58:h===-1&&(h=d-y);break;case 13:m=!0;case 10:b=d;break}if(b===-1)break;i(u.subarray(y,b),h),y=d,h=-1}y===g?u=void 0:y!==0&&(u=u.subarray(y),d-=y)}}function oo(i,u,d){var h=Pn();var m=new TextDecoder;return function(v,g){if(v.length===0)d==null||d(h),h=Pn();else if(g>0){var y=m.decode(v.subarray(0,g)),b=g+(v[g+1]===32?2:1),x=m.decode(v.subarray(b));switch(y){case"data":h.data=h.data?h.data+"\n"+x:x;break;case"event":h.event=x;break;case"id":i(h.id=x);break;case"retry":var A=parseInt(x,10);isNaN(A)||u(h.retry=A);break}}}}function ao(i,u){var d=new Uint8Array(i.length+u.length);return d.set(i),d.set(u,i.length),d}function Pn(){return{data:"",event:"",id:"",retry:void 0}}var jr=function lo(i,u){var d={};for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&u.indexOf(h)<0&&(d[h]=i[h]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function"){var m=0;for(h=Object.getOwnPropertySymbols(i);m<h.length;m++)u.indexOf(h[m])<0&&Object.prototype.propertyIsEnumerable.call(i,h[m])&&(d[h[m]]=i[h[m]])}return d};var Ur="text/event-stream",Hr=1e3,Gr="last-event-id";function ho(i,u){var d=u.signal,h=u.headers,m=u.onopen,v=u.onmessage,g=u.onclose,y=u.onerror,b=u.openWhenHidden,x=u.fetch,A=jr(u,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((function(u,P){var D=Object.assign({},h);D.accept||(D.accept=Ur);var q;function p(){q.abort(),document.hidden||R()}b||document.addEventListener("visibilitychange",p);var V=Hr,J=0;function j(){document.removeEventListener("visibilitychange",p),window.clearTimeout(J),q.abort()}d==null||d.addEventListener("abort",(function(){j(),u()}));var X=x!==null&&x!==void 0?x:window.fetch,oe=m!==null&&m!==void 0?m:uo;function R(){return _R.apply(this,arguments)}function _R(){_R=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){var d,h,m;return _regeneratorRuntime().wrap((function _callee4$(b){while(1)switch(b.prev=b.next){case 0:q=new AbortController;b.prev=1;b.next=4;return X(i,Object.assign(Object.assign({},A),{headers:D,signal:q.signal}));case 4:h=b.sent;b.next=7;return oe(h);case 7:b.next=9;return so(h.body,ro(oo((function(i){i?D[Gr]=i:delete D[Gr]}),(function(i){V=i}),v)));case 9:g==null||g();j();u();b.next=17;break;case 14:b.prev=14;b.t0=b.catch(1);if(!q.signal.aborted)try{m=(d=y==null?void 0:y(b.t0))!==null&&d!==void 0?d:V;window.clearTimeout(J),J=window.setTimeout(R,m)}catch(i){j(),P(i)}case 17:case"end":return b.stop()}}),_callee4,null,[[1,14]])})));return _R.apply(this,arguments)}R()}))}function uo(i){var u=i.headers.get("content-type");if(!(u!=null&&u.startsWith(Ur)))throw new Error("Expected content-type to be ".concat(Ur,", Actual: ").concat(u))}var qr=function(){function C(){_classCallCheck(this,C)}return _createClass(C,null,[{key:"request",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(i,u,d){var h,m,v,g,y,b,x,A,P,D,q,V,J,X,oe,pe,fe,me,Ce,Te=arguments;return _regeneratorRuntime().wrap((function _callee7$(Oe){while(1)switch(Oe.prev=Oe.next){case 0:h=!(Te.length>3&&Te[3]!==void 0)||Te[3];m=Te.length>4&&Te[4]!==void 0&&Te[4];P={body:u,headers:(v=i.connectSettings)==null?void 0:v.headers};Oe.next=5;return Br.processRequestInterceptor(i.deepChat,P);case 5:D=Oe.sent;q=D.body;V=D.headers;J=D.error;X=i.streamHandlers;oe=X.onOpen;pe=X.onClose;fe=X.abortStream;if(!J){Oe.next=15;break}return Oe.abrupt("return",Br.onInterceptorError(d,J,pe));case 15:if(!((g=i.connectSettings)!=null&&g.handler)){Oe.next=17;break}return Oe.abrupt("return",Jr.stream(i,q,d));case 17:if(!(((y=i.connectSettings)==null?void 0:y.url)===Vr.URL)){Oe.next=19;break}return Oe.abrupt("return",Vr.requestStream(d,i.streamHandlers));case 19:me=new Fr(d),Ce=Br.fetch.bind(this,i,V,h);return Oe.abrupt("return",(ho(((b=i.connectSettings)==null?void 0:b.url)||i.url||"",{method:((x=i.connectSettings)==null?void 0:x.method)||"POST",headers:V,credentials:(A=i.connectSettings)==null?void 0:A.credentials,body:h?JSON.stringify(q):q,openWhenHidden:!0,onopen:function onopen(i){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){return _regeneratorRuntime().wrap((function _callee5$(u){while(1)switch(u.prev=u.next){case 0:if(!i.ok){u.next=2;break}return u.abrupt("return",oe());case 2:u.next=4;return Br.processResponseByType(i);case 4:throw u.sent;case 5:case"end":return u.stop()}}),_callee5)})))()},onmessage:function onmessage(u){return _asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){var h,m,v,g,y;return _regeneratorRuntime().wrap((function _callee6$(b){while(1)switch(b.prev=b.next){case 0:if(!(JSON.stringify(u.data)!==JSON.stringify("[DONE]"))){b.next=9;break}try{g=JSON.parse(u.data)}catch(i){g={}}b.next=4;return(m=(h=i.deepChat).responseInterceptor)==null?void 0:m.call(h,g);case 4:b.t0=b.sent;if(b.t0){b.next=7;break}b.t0=g;case 7:y=b.t0;(v=i.extractResultData)==null||v.call(i,y,Ce,q).then((function(u){i.asyncCallInProgress&&u&&u.text!==""?(C.simulate(d,i.streamHandlers,u),pe(),i.asyncCallInProgress=!1):C.upsertWFiles(d,me.upsertStreamedMessage.bind(me),me,u)})).catch((function(i){return Br.displayError(d,i)}));case 9:case"end":return b.stop()}}),_callee6)})))()},onerror:function onerror(i){throw pe(),i},onclose:function onclose(){if(!i.asyncCallInProgress)try{me.finaliseStreamedMessage(),pe()}catch(i){if(!m)throw i}},signal:fe.signal}).catch((function(u){var h;d.isLastMessageError()||(h=i.extractResultData)==null||h.call(i,u).then((function(){Br.displayError(d,u)})).catch((function(i){Br.displayError(d,i)}))})),me));case 21:case"end":return Oe.stop()}}),_callee7,this)})));function request(u,d,h){return i.apply(this,arguments)}return request}()},{key:"simulate",value:function simulate(i,u,d){var h=u;if(d.files&&i.addNewMessage(_objectSpread({sendUpdate:!1,ignoreText:!0},d),!1),d.text){u.onOpen();var m=d.text.split("");C.populateMessages(m,new Fr(i),h,"text")}if(d.html){u.onOpen();var v=gt.splitHTML(d.html);C.populateMessages(v,new Fr(i),h,"html")}}},{key:"populateMessages",value:function populateMessages(i,u,d,h){var m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;var v=i[m];if(v){u.upsertStreamedMessage(_defineProperty({},h,v));var g=setTimeout((function(){C.populateMessages(i,u,d,h,m+1)}),d.simulationInterim||6);d.abortStream.abort=function(){C.abort(g,u,d.onClose)}}else u.finaliseStreamedMessage(),d.onClose()}},{key:"isSimulation",value:function isSimulation(i){return _typeof(i)=="object"&&!!i.simulation}},{key:"isSimulatable",value:function isSimulatable(i,u){return C.isSimulation(i)&&u&&(u.text||u.html)}},{key:"abort",value:function abort(i,u,d){clearTimeout(i),u.finaliseStreamedMessage(),d()}},{key:"upsertWFiles",value:function upsertWFiles(i,u,d,h){if(h!=null&&h.text||h!=null&&h.html){var m;var v=u(h);(m=d)!==null&&m!==void 0?m:d=v||void 0}h!=null&&h.files&&(i.addNewMessage({files:h.files}),d==null||d.markFileAdded())}}])}();var zr=function(){function qe(){_classCallCheck(this,qe)}return _createClass(qe,null,[{key:"generateResponse",value:function generateResponse(i){var u=i.messages[i.messages.length-1];if(u.files&&u.files.length>0){if(u.files.length>1)return"These are interesting files!";var d=u.files[0];return d.src&&d.src.startsWith("data:image/gif")?"That is a nice gif!":d.type==="image"?"That is a nice image!":d.type==="audio"?"I like the sound of that!":"That is an interesting file!"}if(u.text){if(u.text.charAt(u.text.length-1)==="?")return"I'm sorry but I can't answer that question...";if(u.text.includes("updog"))return"What's updog?"}return"Hi there! This is a demo response!"}},{key:"getCustomResponse",value:function getCustomResponse(i,u){return typeof i=="function"?i(u):i}},{key:"getResponse",value:function getResponse(i){return i.customDemoResponse?qe.getCustomResponse(i.customDemoResponse,i.messages[i.messages.length-1]):{text:qe.generateResponse(i)}}},{key:"request",value:function request(i,u){var d=qe.getResponse(u);setTimeout(_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(){var h,m,v;return _regeneratorRuntime().wrap((function _callee8$(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return(m=(h=i.deepChat).responseInterceptor)==null?void 0:m.call(h,d);case 2:g.t0=g.sent;if(g.t0){g.next=5;break}g.t0=d;case 5:v=g.t0;v.error?(u.addNewErrorMessage("service",v.error),i.completionsHandlers.onFinish()):qr.isSimulatable(i.stream,v)?qr.simulate(u,i.streamHandlers,v):(u.addNewMessage(v),i.completionsHandlers.onFinish());case 7:case"end":return g.stop()}}),_callee8)}))),400)}},{key:"requestStream",value:function requestStream(i,u){setTimeout((function(){var d=qe.getResponse(i);qr.simulate(i,u,d)}),400)}}])}();zr.URL="deep-chat-demo";var Vr=zr;var Wr=function(){function B(){_classCallCheck(this,B)}return _createClass(B,null,[{key:"setup",value:function setup(i){i.connectSettings.url!==Vr.URL&&(i.permittedErrorPrefixes=["Connection error","Error in server message"],i.websocket="pending")}},{key:"isElementPresentInDOM",value:function isElementPresentInDOM(i){return i.getRootNode({composed:!0})instanceof Document}},{key:"createConnection",value:function createConnection(i,u){if(B.isElementPresentInDOM(i.deepChat)){var d=i.connectSettings.websocket;if(d){if(i.connectSettings.handler)return Jr.websocket(i,u);try{var h=typeof d!="boolean"?d:void 0,m=new WebSocket(i.connectSettings.url||"",h);i.websocket=m,i.websocket.onopen=function(){var d,h;u.removeError(),i.websocket&&_typeof(i.websocket)=="object"&&B.assignListeners(i,m,u),(h=(d=i.deepChat)._validationHandler)==null||h.call(d)},i.websocket.onerror=function(d){console.error(d),B.retryConnection(i,u)}}catch(h){console.error(h),B.retryConnection(i,u)}}}}},{key:"retryConnection",value:function retryConnection(i,u){var d,h;(h=(d=i.deepChat)._validationHandler)==null||h.call(d),B.isElementPresentInDOM(i.deepChat)&&(i.websocket="pending",u.isLastMessageError()||u.addNewErrorMessage("service","Connection error"),setTimeout((function(){B.createConnection(i,u)}),5e3))}},{key:"assignListeners",value:function assignListeners(i,u,d){var h=this;var m={};u.onmessage=function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(u){var v,g,y,b,x,A,P;return _regeneratorRuntime().wrap((function _callee9$(D){while(1)switch(D.prev=D.next){case 0:if(!i.extractResultData){D.next=20;break}D.prev=1;y=JSON.parse(u.data);D.next=5;return(g=(v=i.deepChat).responseInterceptor)==null?void 0:g.call(v,y);case 5:D.t0=D.sent;if(D.t0){D.next=8;break}D.t0=y;case 8:b=D.t0;D.next=11;return i.extractResultData(b);case 11:x=D.sent;if(!(!x||_typeof(x)!="object")){D.next=14;break}throw Error(oe.INVALID_RESPONSE(y,"server",!!i.deepChat.responseInterceptor,b));case 14:if(qr.isSimulation(i.stream)){A=B.stream.bind(h,i,d,m),P=m[y.role||Qe.AI_ROLE];qr.upsertWFiles(d,A,P,x)}else d.addNewMessage(x);D.next=20;break;case 17:D.prev=17;D.t1=D.catch(1);Br.displayError(d,D.t1,"Error in server message");case 20:case"end":return D.stop()}}),_callee9,null,[[1,17]])})));return function(i){return u.apply(this,arguments)}}(),u.onclose=function(){console.error("Connection closed"),d.isLastMessageError()||d.addNewErrorMessage("service","Connection error"),i.stream&&i.streamHandlers.abortStream.abort(),B.createConnection(i,d)}}},{key:"sendWebsocket",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(i,u,d){var h,m,v,g,y,b,x,A,P,D=arguments;return _regeneratorRuntime().wrap((function _callee10$(q){while(1)switch(q.prev=q.next){case 0:h=!(D.length>3&&D[3]!==void 0)||D[3];g=i.websocket;if(!(!g||g==="pending")){q.next=4;break}return q.abrupt("return");case 4:y={body:u,headers:(m=i.connectSettings)==null?void 0:m.headers};q.next=7;return Br.processRequestInterceptor(i.deepChat,y);case 7:b=q.sent;x=b.body;A=b.error;if(!A){q.next=12;break}return q.abrupt("return",d.addNewErrorMessage("service",A));case 12:if(B.isWebSocket(g)){q.next=14;break}return q.abrupt("return",g.newUserMessage.listener(x));case 14:P=h?JSON.stringify(x):x;if(!(((v=i.connectSettings)==null?void 0:v.url)===Vr.URL)){q.next=17;break}return q.abrupt("return",Vr.request(i,d));case 17:g.readyState===void 0||g.readyState!==g.OPEN?(console.error("Connection is not open"),d.isLastMessageError()||d.addNewErrorMessage("service","Connection error")):(g.send(JSON.stringify(P)),i.completionsHandlers.onFinish());case 18:case"end":return q.stop()}}),_callee10)})));function sendWebsocket(u,d,h){return i.apply(this,arguments)}return sendWebsocket}()},{key:"canSendMessage",value:function canSendMessage(i){return!i||i!=="pending"&&(B.isWebSocket(i)?i.readyState!==void 0&&i.readyState===i.OPEN:i.isOpen)}},{key:"isWebSocket",value:function isWebSocket(i){return i.send!==void 0}},{key:"stream",value:function stream(i,u,d,h){if(h){var m=i.stream.simulation;if(typeof m=="string"){var v;var g=h.role||Qe.AI_ROLE,y=d[g];h.text===m||h.html===m?(y==null||y.finaliseStreamedMessage(),delete d[g]):((v=d[g])!==null&&v!==void 0?v:d[g]=new Fr(u),d[g].upsertStreamedMessage(h))}else qr.simulate(u,i.streamHandlers,h)}}}])}();var Jr=function(){function _e(){_classCallCheck(this,_e)}return _createClass(_e,null,[{key:"request",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(i,u,d){var h,m,v,g,y;return _regeneratorRuntime().wrap((function _callee12$(b){while(1)switch(b.prev=b.next){case 0:v=!0;g=function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(u){var h,m,g;return _regeneratorRuntime().wrap((function _callee11$(y){while(1)switch(y.prev=y.next){case 0:if(v){y.next=2;break}return y.abrupt("return");case 2:v=!1;y.next=5;return(m=(h=i.deepChat).responseInterceptor)==null?void 0:m.call(h,u);case 5:y.t0=y.sent;if(y.t0){y.next=8;break}y.t0=u;case 8:g=y.t0;Br.validateResponseFormat(g)?typeof g.error=="string"?(console.error(g.error),d.addNewErrorMessage("service",g.error),i.completionsHandlers.onFinish()):qr.isSimulatable(i.stream,g)?qr.simulate(d,i.streamHandlers,g):(d.addNewMessage(g),i.completionsHandlers.onFinish()):(console.error(oe.INVALID_RESPONSE(u,"server",!!i.deepChat.responseInterceptor,g)),d.addNewErrorMessage("service","Error in server message"),i.completionsHandlers.onFinish());case 10:case"end":return y.stop()}}),_callee11)})));return function r(i){return u.apply(this,arguments)}}(),y=_e.generateOptionalSignals();(m=(h=i.connectSettings).handler)==null||m.call(h,u,_objectSpread(_objectSpread({},y),{},{onResponse:g}));case 3:case"end":return b.stop()}}),_callee12)})));function request(u,d,h){return i.apply(this,arguments)}return request}()},{key:"attemptToFinaliseStream",value:function attemptToFinaliseStream(i,u){try{i.finaliseStreamedMessage()}catch(i){console.error(i),u.addNewErrorMessage("service",i)}}},{key:"stream",value:function stream(i,u,d){var h,m;var v=!0,g=!1;var y=new Fr(d),b=function a(){g||!v||(i.streamHandlers.onOpen(),g=!0)},x=function l(){v&&(_e.attemptToFinaliseStream(y,d),i.streamHandlers.onClose(),v=!1)},A=function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(u){var h,m,g;return _regeneratorRuntime().wrap((function _callee13$(b){while(1)switch(b.prev=b.next){case 0:if(v){b.next=2;break}return b.abrupt("return");case 2:b.next=4;return(m=(h=i.deepChat).responseInterceptor)==null?void 0:m.call(h,u);case 4:b.t0=b.sent;if(b.t0){b.next=7;break}b.t0=u;case 7:g=b.t0;Br.validateResponseFormat(g)?g.error?(console.error(g.error),y.finaliseStreamedMessage(),d.addNewErrorMessage("service",g.error),i.streamHandlers.onClose(),v=!1):qr.upsertWFiles(d,y.upsertStreamedMessage.bind(y),y,g):console.error(oe.INVALID_RESPONSE(u,"server",!!i.deepChat.responseInterceptor,g));case 9:case"end":return b.stop()}}),_callee13)})));return function c(i){return u.apply(this,arguments)}}();i.streamHandlers.abortStream.abort=function(){_e.attemptToFinaliseStream(y,d),i.streamHandlers.onClose(),v=!1};var P=_e.generateOptionalSignals();(m=(h=i.connectSettings).handler)==null||m.call(h,u,_objectSpread(_objectSpread({},P),{},{onOpen:b,onResponse:A,onClose:x,stopClicked:i.streamHandlers.stopClicked}))}},{key:"websocket",value:function websocket(i,u){var d=this;var h,m;var v={isOpen:!1,newUserMessage:{listener:function listener(){}},roleToStream:{}};i.websocket=v;var g=function n(){u.removeError(),v.isOpen=!0},y=function r(){v.isOpen=!1},b=function(){var h=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(h){var m,g,y,b,x;return _regeneratorRuntime().wrap((function _callee14$(A){while(1)switch(A.prev=A.next){case 0:if(v.isOpen){A.next=2;break}return A.abrupt("return");case 2:A.next=4;return(g=(m=i.deepChat).responseInterceptor)==null?void 0:g.call(m,h);case 4:A.t0=A.sent;if(A.t0){A.next=7;break}A.t0=h;case 7:y=A.t0;if(Br.validateResponseFormat(y))if(typeof y.error=="string")console.error(y.error),u.isLastMessageError()||u.addNewErrorMessage("service",y.error);else if(qr.isSimulation(i.stream)){b=Wr.stream.bind(d,i,u,v.roleToStream),x=v.roleToStream[h.role||Qe.AI_ROLE];qr.upsertWFiles(u,b,x,h)}else u.addNewMessage(y);else console.error(oe.INVALID_RESPONSE(h,"server",!!i.deepChat.responseInterceptor,y)),u.addNewErrorMessage("service","Error in server message");case 9:case"end":return A.stop()}}),_callee14)})));return function o(i){return h.apply(this,arguments)}}(),x=_e.generateOptionalSignals();(m=(h=i.connectSettings).handler)==null||m.call(h,void 0,_objectSpread(_objectSpread({},x),{},{onOpen:g,onResponse:b,onClose:y,newUserMessage:v.newUserMessage}))}},{key:"generateOptionalSignals",value:function generateOptionalSignals(){return{onClose:function onClose(){},onOpen:function onOpen(){},stopClicked:{listener:function listener(){}},newUserMessage:{listener:function listener(){}}}}}])}();var Xr=function(){function T(){_classCallCheck(this,T)}return _createClass(T,null,[{key:"request",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(i,u,d){var h,m,v,g,y,b,x,A,P,D,q,V,J=arguments;return _regeneratorRuntime().wrap((function _callee16$(X){while(1)switch(X.prev=X.next){case 0:h=!(J.length>3&&J[3]!==void 0)||J[3];y={body:u,headers:(m=i.connectSettings)==null?void 0:m.headers};X.next=4;return Br.processRequestInterceptor(i.deepChat,y);case 4:b=X.sent;x=b.body;A=b.headers;P=b.error;D=i.completionsHandlers.onFinish;if(!P){X.next=11;break}return X.abrupt("return",Br.onInterceptorError(d,P,D));case 11:if(!((v=i.connectSettings)!=null&&v.handler)){X.next=13;break}return X.abrupt("return",Jr.request(i,x,d));case 13:if(!(((g=i.connectSettings)==null?void 0:g.url)===Vr.URL)){X.next=15;break}return X.abrupt("return",Vr.request(i,d));case 15:q=!0;V=Br.fetch.bind(this,i,A,h);V(x).then((function(i){return q=!!i.ok,i})).then((function(i){return Br.processResponseByType(i)})).then(function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(u){var h,m,v,g;return _regeneratorRuntime().wrap((function _callee15$(y){while(1)switch(y.prev=y.next){case 0:if(i.extractResultData){y.next=2;break}return y.abrupt("return");case 2:y.next=4;return(m=(h=i.deepChat).responseInterceptor)==null?void 0:m.call(h,u);case 4:y.t0=y.sent;if(y.t0){y.next=7;break}y.t0=u;case 7:v=y.t0;y.next=10;return i.extractResultData(v,V,x);case 10:g=y.sent;if(q){y.next=13;break}throw u;case 13:if(!(!g||_typeof(g)!="object")){y.next=15;break}throw Error(oe.INVALID_RESPONSE(u,"response",!!i.deepChat.responseInterceptor,v));case 15:g.makingAnotherRequest||(qr.isSimulatable(i.stream,g)?qr.simulate(d,i.streamHandlers,g):(d.addNewMessage(g),D()));case 16:case"end":return y.stop()}}),_callee15)})));return function(i){return u.apply(this,arguments)}}()).catch((function(i){Br.displayError(d,i),D()}));case 18:case"end":return X.stop()}}),_callee16,this)})));function request(u,d,h){return i.apply(this,arguments)}return request}()},{key:"executePollRequest",value:function executePollRequest(i,u,d,h){var m=i.completionsHandlers.onFinish;fetch(u,d).then((function(i){return i.json()})).then(function(){var v=_asyncToGenerator(_regeneratorRuntime().mark((function _callee17(v){var g,y,b;return _regeneratorRuntime().wrap((function _callee17$(x){while(1)switch(x.prev=x.next){case 0:if(i.extractPollResultData){x.next=2;break}return x.abrupt("return");case 2:x.t0=i;x.next=5;return(y=(g=i.deepChat).responseInterceptor)==null?void 0:y.call(g,v);case 5:x.t1=x.sent;if(x.t1){x.next=8;break}x.t1=v;case 8:x.t2=x.t1;x.next=11;return x.t0.extractPollResultData.call(x.t0,x.t2);case 11:b=x.sent;b.timeoutMS?setTimeout((function(){T.executePollRequest(i,u,d,h)}),b.timeoutMS):qr.isSimulatable(i.stream,b)?qr.simulate(h,i.streamHandlers,b):(h.addNewMessage(b),m());case 13:case"end":return x.stop()}}),_callee17)})));return function(i){return v.apply(this,arguments)}}()).catch((function(i){Br.displayError(h,i),m()}))}},{key:"poll",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee18(i,u,d){var h,m,v,g,y,b,x,A,P,D,q,V,J,X=arguments;return _regeneratorRuntime().wrap((function _callee18$(oe){while(1)switch(oe.prev=oe.next){case 0:h=!(X.length>3&&X[3]!==void 0)||X[3];y={body:u,headers:(m=i.connectSettings)==null?void 0:m.headers};oe.next=4;return Br.processRequestInterceptor(i.deepChat,y);case 4:b=oe.sent;x=b.body;A=b.headers;P=b.error;if(!P){oe.next=10;break}return oe.abrupt("return",Br.onInterceptorError(d,P));case 10:D=((v=i.connectSettings)==null?void 0:v.url)||i.url||"",q=((g=i.connectSettings)==null?void 0:g.method)||"POST",V=h?JSON.stringify(x):x,J={method:q,body:V,headers:A};i.connectSettings.credentials&&(J.credentials=i.connectSettings.credentials),T.executePollRequest(i,D,J,d);case 12:case"end":return oe.stop()}}),_callee18)})));function poll(u,d,h){return i.apply(this,arguments)}return poll}()},{key:"verifyKey",value:function verifyKey(i,u,d,h,m,v,g,y,b){if(i==="")return v(oe.INVALID_KEY);g(),fetch(u,{method:h,headers:d,body:b||null}).then((function(i){return Br.processResponseByType(i)})).then((function(u){y(u,i,m,v)})).catch((function(i){v(oe.CONNECTION_FAILED),console.error(i)}))}}])}();var Qr=function(){function ht(){_classCallCheck(this,ht)}return _createClass(ht,null,[{key:"getCharacterLimitMessages",value:function getCharacterLimitMessages(i,u){var d;if(u===-1)return i;var h=0,m=i.length-1;for(m;m>=0;m-=1){var v=(d=i[m])==null?void 0:d.text;if(v!==void 0&&(h+=v.length,h>u)){i[m].text=v.substring(0,v.length-(h-u));break}}return i.slice(Math.max(m,0))}},{key:"getMaxMessages",value:function getMaxMessages(i,u){return i.slice(Math.max(i.length-u,0))}},{key:"processMessages",value:function processMessages(i,u,d){return u!==void 0?u>0&&(i=ht.getMaxMessages(i,u)):i=[i[i.length-1]],i=JSON.parse(JSON.stringify(i)),d===void 0?i:ht.getCharacterLimitMessages(i,d)}}])}();var ea=function(){function I(){_classCallCheck(this,I)}return _createClass(I,null,[{key:"parseConfig",value:function parseConfig(i,u,d,h){var m;var v={files:u};if(_typeof(h)=="object"){var g=h.files,y=h.connect,b=h.button;g&&(g.infoModal&&(v.files.infoModal=g.infoModal,(m=g.infoModal)!=null&&m.textMarkDown&&(v.infoModalTextMarkUp=d.render(g.infoModal.textMarkDown))),g.acceptedFormats&&(v.files.acceptedFormats=g.acceptedFormats),g.maxNumberOfFiles&&(v.files.maxNumberOfFiles=g.maxNumberOfFiles)),v.button=b,y&&(y.headers||y.method||y.url||y.credentials||i.headers||i.method||i.url||i.credentials)&&(v.connect={url:(y==null?void 0:y.url)||i.url,method:(y==null?void 0:y.method)||i.method,headers:(y==null?void 0:y.headers)||i.headers,credentials:(y==null?void 0:y.credentials)||i.credentials})}return v}},{key:"processMixedFiles",value:function processMixedFiles(i,u,d){if(d){var h={acceptedFormats:""};i.fileTypes.mixedFiles=I.parseConfig(i.connectSettings,h,u,d)}}},{key:"processMicrophone",value:function processMicrophone(i,u,d,h){var m,v;var g,y,b,x,A,P;var D=_objectSpread({acceptedFormats:"audio/*"},((g=i.fileTypes.audio)==null?void 0:g.files)||{});d&&(navigator.mediaDevices.getUserMedia!==void 0?(i.recordAudio=I.parseConfig(i.connectSettings,D,u,d),_typeof(d)=="object"&&d.files&&((m=(y=i.recordAudio).files)!==null&&m!==void 0?m:y.files={},i.recordAudio.files.format=(b=d.files)==null?void 0:b.format,i.recordAudio.files.maxDurationSeconds=(x=d.files)==null?void 0:x.maxDurationSeconds,(A=i.fileTypes.audio)!=null&&A.files&&((v=(P=i.fileTypes.audio.files).maxNumberOfFiles)!==null&&v!==void 0?v:P.maxNumberOfFiles=d.files.maxNumberOfFiles))):h||(i.fileTypes.audio=I.parseConfig(i.connectSettings,D,u,d)))}},{key:"processAudioConfig",value:function processAudioConfig(i,u,d,h){if(d||h){var m=_objectSpread({acceptedFormats:"audio/*"},(h==null?void 0:h.files)||{});i.fileTypes.audio=I.parseConfig(i.connectSettings,m,u,d)}}},{key:"processGifConfig",value:function processGifConfig(i,u,d,h){if(d||h){var m=_objectSpread({acceptedFormats:"image/gif"},(h==null?void 0:h.files)||{});i.fileTypes.gifs=I.parseConfig(i.connectSettings,m,u,d)}}},{key:"processCamera",value:function processCamera(i,u,d,h){var m;var v,g,y,b;var x=_objectSpread({acceptedFormats:"image/*"},((v=i.fileTypes.images)==null?void 0:v.files)||{});d&&(navigator.mediaDevices.getUserMedia!==void 0?(i.camera=I.parseConfig(i.connectSettings,x,u,d),_typeof(d)=="object"&&(i.camera.modalContainerStyle=d.modalContainerStyle,d.files&&((m=(g=i.camera).files)!==null&&m!==void 0?m:g.files={},i.camera.files.format=(y=d.files)==null?void 0:y.format,i.camera.files.dimensions=(b=d.files)==null?void 0:b.dimensions))):h||(i.fileTypes.images=I.parseConfig(i.connectSettings,x,u,d)))}},{key:"processImagesConfig",value:function processImagesConfig(i,u,d,h){if(d||h){var m=_objectSpread({acceptedFormats:"image/*"},(h==null?void 0:h.files)||{});i.fileTypes.images=I.parseConfig(i.connectSettings,m,u,d)}}},{key:"populateDefaultFileIO",value:function populateDefaultFileIO(i,u){var d,h,m;var v,g;i&&((d=i.files)!==null&&d!==void 0?d:i.files={},(h=(v=i.files).acceptedFormats)!==null&&h!==void 0?h:v.acceptedFormats=u,(m=(g=i.files).maxNumberOfFiles)!==null&&m!==void 0?m:g.maxNumberOfFiles=1)}},{key:"set",value:function set(i,u,d){I.populateDefaultFileIO(d==null?void 0:d.audio,".4a,.mp3,.webm,.mp4,.mpga,.wav,.mpeg,.m4a"),I.populateDefaultFileIO(d==null?void 0:d.images,".png,.jpg");var h=fr.createNew();I.processImagesConfig(u,h,i.images,d==null?void 0:d.images),I.processCamera(u,h,i.camera,i.images),I.processGifConfig(u,h,i.gifs,d==null?void 0:d.gifs),I.processAudioConfig(u,h,i.audio,d==null?void 0:d.audio),I.processMicrophone(u,h,i.microphone,i.audio),I.processMixedFiles(u,h,i.mixedFiles)}}])}();var na=function(){function $e(i,u,d){var h;_classCallCheck(this,$e);var m,v,g,y,b;this.rawBody={},this.validateKeyProperty=!1,this.canSendMessage=$e.canSendMessage,this.connectSettings={},this.fileTypes={},this.completionsHandlers={},this.streamHandlers={},this.deepChat=i,this.demo=d,Object.assign(this.rawBody,(m=i.connect)==null?void 0:m.additionalBodyProps),this.totalMessagesMaxCharLength=(v=i==null?void 0:i.requestBodyLimits)==null?void 0:v.totalMessagesMaxCharLength,this.maxMessages=(g=i==null?void 0:i.requestBodyLimits)==null?void 0:g.maxMessages,ea.set(i,this,u),i.connect&&(this.connectSettings=i.connect),this.demo&&((h=(y=this.connectSettings).url)!==null&&h!==void 0?h:y.url=Vr.URL),this.connectSettings.websocket&&Wr.setup(this),this.stream=((b=this.deepChat.connect)==null?void 0:b.stream)||Te.checkForStream(this.deepChat)}return _createClass($e,[{key:"verifyKey",value:function verifyKey(i,u){}},{key:"getServiceIOByType",value:function getServiceIOByType(i){if(i.type.startsWith("audio")&&this.fileTypes.audio)return this.fileTypes.audio;if(i.type.startsWith("image")){if(this.fileTypes.gifs&&i.type.endsWith("/gif"))return this.fileTypes.gifs;if(this.fileTypes.images)return this.fileTypes.images;if(this.camera)return this.camera}return this.fileTypes.mixedFiles}},{key:"request",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee19(i,u){var d,h=arguments;return _regeneratorRuntime().wrap((function _callee19$(m){while(1)switch(m.prev=m.next){case 0:d=!(h.length>2&&h[2]!==void 0)||h[2];return m.abrupt("return",this.stream&&!qr.isSimulation(this.stream)?qr.request(this,i,u,d):Xr.request(this,i,u,d));case 2:case"end":return m.stop()}}),_callee19,this)})));function request(u,d){return i.apply(this,arguments)}return request}()},{key:"callAPIWithText",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee20(i,u){var d,h;var m,v,g,y,b,x;return _regeneratorRuntime().wrap((function _callee20$(A){while(1)switch(A.prev=A.next){case 0:b=_objectSpread({messages:u},this.rawBody);x=!1;(m=this.connectSettings.headers)!=null&&m["Content-Type"]||((d=(v=this.connectSettings).headers)!==null&&d!==void 0?d:v.headers={},(h=(g=this.connectSettings.headers)["Content-Type"])!==null&&h!==void 0?h:g["Content-Type"]="application/json",x=!0);A.next=5;return this.request(b,i);case 5:x&&((y=this.connectSettings.headers)==null||delete y["Content-Type"]);case 6:case"end":return A.stop()}}),_callee20,this)})));function callAPIWithText(u,d){return i.apply(this,arguments)}return callAPIWithText}()},{key:"callApiWithFiles",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee21(i,u,d){var h,m,v;return _regeneratorRuntime().wrap((function _callee21$(g){while(1)switch(g.prev=g.next){case 0:h=$e.createCustomFormDataBody(this.rawBody,u,d),m=this.connectSettings,v=this.getServiceIOByType(d[0]);this.connectSettings=(v==null?void 0:v.connect)||this.connectSettings;g.next=4;return this.request(h,i,!1);case 4:this.connectSettings=m;case 5:case"end":return g.stop()}}),_callee21,this)})));function callApiWithFiles(u,d,h){return i.apply(this,arguments)}return callApiWithFiles}()},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee22(i,u,d){return _regeneratorRuntime().wrap((function _callee22$(h){while(1)switch(h.prev=h.next){case 0:d?this.callApiWithFiles(i,u,d):this.callAPIWithText(i,u);case 1:case"end":return h.stop()}}),_callee22,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"callAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee23(i,u){var d,h;return _regeneratorRuntime().wrap((function _callee23$(m){while(1)switch(m.prev=m.next){case 0:if(this.connectSettings){m.next=2;break}throw new Error("Request settings have not been set up");case 2:d=Qr.processMessages(u.messages,this.maxMessages,this.totalMessagesMaxCharLength);if(this.connectSettings.websocket){h=_objectSpread({messages:d},this.rawBody);Wr.sendWebsocket(this,h,u,!1)}else this.callServiceAPI(u,d,i.files);case 4:case"end":return m.stop()}}),_callee23,this)})));function callAPI(u,d){return i.apply(this,arguments)}return callAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee24(i){return _regeneratorRuntime().wrap((function _callee24$(u){while(1)switch(u.prev=u.next){case 0:if(!i.error){u.next=2;break}throw i.error;case 2:if(!i.result){u.next=4;break}return u.abrupt("return",Te.handleResponseProperty(i));case 4:if(!Br.validateResponseFormat(i)){u.next=6;break}return u.abrupt("return",i);case 6:case"end":return u.stop()}}),_callee24)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()},{key:"isDirectConnection",value:function isDirectConnection(){return!1}},{key:"isWebModel",value:function isWebModel(){return!1}}],[{key:"canSendMessage",value:function canSendMessage(i,u,d){return!!d||(!!(i&&i.trim()!=="")||!!(u&&u.length>0))}},{key:"createCustomFormDataBody",value:function createCustomFormDataBody(i,u,d){var h=new FormData;d.forEach((function(i){return h.append("files",i)})),Object.keys(i).forEach((function(u){return h.append(u,String(i[u]))}));var m=0;u.slice(0,u.length-1).forEach((function(i){h.append("message".concat(m+=1),JSON.stringify(i))}));var v=u[u.length-1];return v.text&&(delete v.files,h.append("message".concat(m+=1),JSON.stringify(v))),h}}])}();var ia=function(i){function z(i,u,d,h,m){var v;_classCallCheck(this,z);var g;v=_callSuper(this,z,[i,m]),v.insertKeyPlaceholderText="API Key",v.keyHelpUrl="",Object.assign(v.rawBody,(g=i.connect)==null?void 0:g.additionalBodyProps),v.keyVerificationDetails=u,v.buildHeadersFunc=d,h&&v.setApiKeyProperties(h),v.connectSettings=v.buildConnectSettings(v.key||"",i.connect);return v}_inherits(z,i);return _createClass(z,[{key:"setApiKeyProperties",value:function setApiKeyProperties(i){this.key=i.key,i.validateKeyProperty&&(this.validateKeyProperty=i.validateKeyProperty)}},{key:"buildConnectSettings",value:function buildConnectSettings(i,u){var d;var h=u!==null&&u!==void 0?u:{};return(d=h.headers)!==null&&d!==void 0?d:h.headers={},Object.assign(h.headers,this.buildHeadersFunc(i)),h}},{key:"keyAuthenticated",value:function keyAuthenticated(i,u){this.connectSettings=this.buildConnectSettings(u,this.connectSettings),this.key=u,i()}},{key:"verifyKey",value:function verifyKey(i,u){var d=this.keyVerificationDetails,h=d.url,m=d.method,v=d.handleVerificationResult,g=d.createHeaders,y=d.body,b=(g==null?void 0:g(i))||this.buildHeadersFunc(i);Xr.verifyKey(i,h,b,m,this.keyAuthenticated.bind(this,u.onSuccess),u.onFail,u.onLoad,v,y)}},{key:"isDirectConnection",value:function isDirectConnection(){return!0}}])}(na);var sa=function(){function ti(){_classCallCheck(this,ti)}return _createClass(ti,null,[{key:"waitForPropertiesToBeUpdatedBeforeRender",value:function waitForPropertiesToBeUpdatedBeforeRender(i){i._propUpdated_=!1,setTimeout((function(){i._propUpdated_?ti.waitForPropertiesToBeUpdatedBeforeRender(i):(i._waitingToRender_=!1,i.onRender())}))}},{key:"attemptRender",value:function attemptRender(i){i._propUpdated_=!0,i._waitingToRender_||(i._waitingToRender_=!0,ti.waitForPropertiesToBeUpdatedBeforeRender(i))}}])}();var oa=function(i){function ye(){var i;_classCallCheck(this,ye);i=_callSuper(this,ye),i._waitingToRender_=!1,i._propUpdated_=!1,Object.keys(ye._attributeToProperty_).forEach((function(u){var d=ye._attributeToProperty_[u];i.constructPropertyAccessors(d),i.hasOwnProperty(u)||i.constructPropertyAccessors(d,u)}));return i}_inherits(ye,i);return _createClass(ye,[{key:"constructPropertyAccessors",value:function constructPropertyAccessors(i,u){var d;Object.defineProperty(this,u||i,{get:function get(){return d},set:function set(h){d=h,u?this[i]=h:sa.attemptRender(this)}})}},{key:"attributeChangedCallback",value:function attributeChangedCallback(i,u,d){if(u!==d){var h=ye._attributes_[i](d),m=ye._attributeToProperty_[i];this[m]=h}}},{key:"onRender",value:function onRender(){}}],[{key:"observedAttributes",get:function get(){return Object.keys(ye._attributes_)||[]}}])}(_wrapNativeSuper(HTMLElement));oa._attributes_={},oa._attributeToProperty_={};var ca=oa;var ua='<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path d="\n\t\t\tM669.727,273.516c-22.891-2.476-46.15-3.895-69.727-4.248c-103.025,0.457-209.823,25.517-310.913,73.536\n\t\t\tc-75.058,37.122-148.173,89.529-211.67,154.174C46.232,529.978,6.431,577.76,0,628.74c0.76,44.162,48.153,98.67,77.417,131.764\n\t\t\tc59.543,62.106,130.754,113.013,211.67,154.174c2.75,1.335,5.51,2.654,8.276,3.955l-75.072,131.102l102.005,60.286l551.416-960.033\n\t\t\tl-98.186-60.008L669.727,273.516z M902.563,338.995l-74.927,129.857c34.47,44.782,54.932,100.006,54.932,159.888\n\t\t\tc0,149.257-126.522,270.264-282.642,270.264c-6.749,0-13.29-0.728-19.922-1.172l-49.585,85.84c22.868,2.449,45.99,4.233,69.58,4.541\n\t\t\tc103.123-0.463,209.861-25.812,310.84-73.535c75.058-37.122,148.246-89.529,211.743-154.174\n\t\t\tc31.186-32.999,70.985-80.782,77.417-131.764c-0.76-44.161-48.153-98.669-77.417-131.763\n\t\t\tc-59.543-62.106-130.827-113.013-211.743-154.175C908.108,341.478,905.312,340.287,902.563,338.995L902.563,338.995z\n\t\t\tM599.927,358.478c6.846,0,13.638,0.274,20.361,0.732l-58.081,100.561c-81.514,16.526-142.676,85.88-142.676,168.897\n\t\t\tc0,20.854,3.841,40.819,10.913,59.325c0.008,0.021-0.008,0.053,0,0.074l-58.228,100.854\n\t\t\tc-34.551-44.823-54.932-100.229-54.932-160.182C317.285,479.484,443.808,358.477,599.927,358.478L599.927,358.478z M768.896,570.513\n\t\t\tL638.013,797.271c81.076-16.837,141.797-85.875,141.797-168.603C779.81,608.194,775.724,588.729,768.896,570.513L768.896,570.513z"\n\t\t\t/>\n</svg>\n',da='<?xml version="1.0" standalone="no"?>\n<svg version="1.1"\n\txmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n\txmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0.9em" height="0.9em"\n\tviewBox="0 0 1200 1200" enable-background="new 0 0 1200 1200">\n\t\t<path id="path6686" inkscape:connector-curvature="0" d="M779.843,599.925c0,95.331-80.664,172.612-180.169,172.612\n\t\t\tc-99.504,0-180.168-77.281-180.168-172.612c0-95.332,80.664-172.612,180.168-172.612\n\t\t\tC699.179,427.312,779.843,504.594,779.843,599.925z M600,240.521c-103.025,0.457-209.814,25.538-310.904,73.557\n\t\t\tc-75.058,37.122-148.206,89.496-211.702,154.141C46.208,501.218,6.431,549,0,599.981c0.76,44.161,48.13,98.669,77.394,131.763\n\t\t\tc59.543,62.106,130.786,113.018,211.702,154.179c94.271,45.751,198.616,72.092,310.904,73.557\n\t\t\tc103.123-0.464,209.888-25.834,310.866-73.557c75.058-37.122,148.243-89.534,211.74-154.179\n\t\t\tc31.185-32.999,70.962-80.782,77.394-131.763c-0.76-44.161-48.13-98.671-77.394-131.764\n\t\t\tc-59.543-62.106-130.824-112.979-211.74-154.141C816.644,268.36,712.042,242.2,600,240.521z M599.924,329.769\n\t\t\tc156.119,0,282.675,120.994,282.675,270.251c0,149.256-126.556,270.25-282.675,270.25S317.249,749.275,317.249,600.02\n\t\t\tC317.249,450.763,443.805,329.769,599.924,329.769L599.924,329.769z"/>\n</svg>\n';var pa=function(){function Q(){_classCallCheck(this,Q)}return _createClass(Q,null,[{key:"createSVGElement",value:function createSVGElement(i){return(new DOMParser).parseFromString(i,"image/svg+xml").documentElement}}])}();var ha=function(){function Ie(){_classCallCheck(this,Ie)}return _createClass(Ie,null,[{key:"changeVisibility",value:function changeVisibility(i,u,d,h){h.target.id===Ie.VISIBLE_ICON_ID?(u.style.display="none",d.style.display="block",i.type="password"):(u.style.display="block",d.style.display="none",i.type="text")}},{key:"createIconElement",value:function createIconElement(i,u){var d=pa.createSVGElement(i);return d.id=u,d.classList.add("visibility-icon"),d}},{key:"create",value:function create(i){var u=document.createElement("div");u.id="visibility-icon-container";var d=Ie.createIconElement(da,Ie.VISIBLE_ICON_ID);d.style.display="none",u.appendChild(d);var h=Ie.createIconElement(ua,"not-visible-icon");return u.appendChild(h),u.onclick=Ie.changeVisibility.bind(this,i,d,h),u}}])}();ha.VISIBLE_ICON_ID="visible-icon";var fa=ha;var ma=function(){function U(){_classCallCheck(this,U)}return _createClass(U,null,[{key:"createCautionText",value:function createCautionText(){var i=document.createElement("a");return i.classList.add("insert-key-input-help-text"),i.innerText="Please exercise CAUTION when inserting your API key outside of deepchat.dev or localhost!!",i}},{key:"createHelpLink",value:function createHelpLink(i){var u=document.createElement("a");return u.classList.add("insert-key-input-help-text"),u.href=i,u.innerText="Find more info here",u.target="_blank",u}},{key:"createFailText",value:function createFailText(){var i=document.createElement("div");return i.id="insert-key-input-invalid-text",i.style.display="none",i}},{key:"createHelpTextContainer",value:function createHelpTextContainer(i){var u=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];var d=document.createElement("div");d.id="insert-key-help-text-container";var h=document.createElement("div");h.id="insert-key-help-text-contents";var m=U.createFailText();if(h.appendChild(m),i){var v=U.createHelpLink(i);h.appendChild(v)}if(u===!0){var g=U.createCautionText();h.appendChild(g)}return d.appendChild(h),{helpTextContainerElement:d,failTextElement:m}}},{key:"onFail",value:function onFail(i,u,d,h){i.classList.replace("insert-key-input-valid","insert-key-input-invalid"),d.innerText=h,d.style.display="block",u.innerText="Start",i.classList.remove("loading")}},{key:"onLoad",value:function onLoad(i,u){i.classList.add("loading"),u.innerHTML='<div id="loading-ring"></div>'}},{key:"verifyKey",value:function verifyKey(i,u,d){var h=i.value.trim();d.verifyKey(h,u)}},{key:"addVerificationEvents",value:function addVerificationEvents(i,u,d,h,m){var v={onSuccess:h,onFail:U.onFail.bind(this,i,u,d),onLoad:U.onLoad.bind(this,i,u)},g=U.verifyKey.bind(this,i,v,m);u.onclick=g,i.onkeydown=function(u){!i.classList.contains("loading")&&u.key===b.ENTER&&g()}}},{key:"createStartButton",value:function createStartButton(){var i=document.createElement("div");return i.id="start-button",i.innerText="Start",i}},{key:"onInputFocus",value:function onInputFocus(i){i.target.classList.replace("insert-key-input-invalid","insert-key-input-valid")}},{key:"createInput",value:function createInput(i){var u=document.createElement("div");u.id="insert-key-input-container";var d=document.createElement("input");return d.id="insert-key-input",d.placeholder=i||"API Key",d.type="password",d.classList.add("insert-key-input-valid"),d.onfocus=U.onInputFocus,u.appendChild(d),u}},{key:"createContents",value:function createContents(i,u){var d;var h=document.createElement("div");h.id="insert-key-contents";var m=U.createInput(u.insertKeyPlaceholderText),v=m.children[0],g=fa.create(v);m.appendChild(g),h.appendChild(m);var y=U.createStartButton(),b=U.createHelpTextContainer(u.keyHelpUrl,(d=u.deepChat._insertKeyViewStyles)==null?void 0:d.displayCautionText),x=b.helpTextContainerElement,A=b.failTextElement;return h.appendChild(y),h.appendChild(x),U.addVerificationEvents(v,y,A,i,u),h}},{key:"createElements",value:function createElements(i,u){var d=document.createElement("div");d.id="insert-key-view";var h=U.createContents(i,u);return d.appendChild(h),d}},{key:"render",value:function render(i,u,d){var h=U.createElements(u,d);i.replaceChildren(h)}}])}();var va=function(){function Z(){_classCallCheck(this,Z)}return _createClass(Z,null,[{key:"enableButtons",value:function enableButtons(i,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;window.webLLM?(i&&(i.disabled=!1),u&&(u.disabled=!1)):d<ba.MODULE_SEARCH_LIMIT_S*4&&setTimeout((function(){return Z.enableButtons(i,u,d+1)}),250)}},{key:"setUpInitial",value:function setUpInitial(i,u,d,h){var m=(u==null?void 0:u.downloadClass)||Z.DOWNLOAD_BUTTON_CLASS,v=(u==null?void 0:u.uploadClass)||Z.UPLOAD_BUTTON_CLASS,g=(u==null?void 0:u.fileInputClass)||Z.FILE_INPUT_CLASS;return setTimeout((function(){var u=d==null?void 0:d.getElementsByClassName(m)[0],h=d==null?void 0:d.getElementsByClassName(g)[0],y=d==null?void 0:d.getElementsByClassName(v)[0];u&&(u.onclick=function(){return i()}),h&&(h.onchange=function(){h.files&&h.files.length>0&&i(h.files)}),y&&(y.onclick=function(){return h.click()}),(u||y)&&Z.enableButtons(u,y)})),(u==null?void 0:u.initialHtml)||'<div>\n        Download or upload a web model that will run entirely on your browser: <br/> \n        <button disabled class="'.concat(m,' deep-chat-button deep-chat-web-model-button">Download</button>\n        ').concat(h?"":'<input type="file" class="'.concat(g,'" hidden multiple />\n          <button disabled class="').concat(v,' deep-chat-button deep-chat-web-model-button">Upload</button>'),"\n      </div>")}},{key:"exportFile",value:function exportFile(i){var u=document.createElement("a"),d=4;var h=function _loop2(h){setTimeout((function(){var m=h*d;for(var v=m;v<Math.min(m+d,i.length);v+=1){var g=URL.createObjectURL(i[v]);u.href=g,u.download=i[v].name,document.body.appendChild(u),u.click(),URL.revokeObjectURL(g)}}),500*h)};for(var m=0;m<i.length/d;m+=1)h(m)}},{key:"setUpAfterLoad",value:function setUpAfterLoad(i,u,d,h){var m=(u==null?void 0:u.exportFilesClass)||Z.EXPORT_BUTTON_CLASS;return setTimeout((function(){var u=d==null?void 0:d.getElementsByClassName(m)[0];u&&(u.onclick=function(){return Z.exportFile(i)})})),(u==null?void 0:u.afterLoadHtml)||"<div>\n        Model loaded successfully and has been cached for future requests.\n        ".concat(h?"":'<br/> <button style="margin-top: 5px" class="'.concat(m,' deep-chat-button">Export</button>'),"\n      </div>")}}])}();va.DOWNLOAD_BUTTON_CLASS="deep-chat-download-button",va.UPLOAD_BUTTON_CLASS="deep-chat-upload-button",va.FILE_INPUT_CLASS="deep-chat-file-input",va.EXPORT_BUTTON_CLASS="deep-chat-export-button";var ga=va;var ya={model_list:[{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f32_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f32_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f32_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:9109.03,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:6749.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-7b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-7b-chat-hf-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-7b-chat-hf/Llama-2-7b-chat-hf-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:4618.52,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-13b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-13b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-13b-chat-hf/Llama-2-13b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:11814.09,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Llama-2-70b-chat-hf-q4f16_1-MLC/resolve/main/",local_id:"Llama-2-70b-chat-hf-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Llama-2-70b-chat-hf/Llama-2-70b-chat-hf-q4f16_1-ctx4k_cs1k-webgpu.wasm",vram_required_MB:43729.05,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f16_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f16_1-ctx2k-webgpu.wasm",vram_required_MB:2972.09,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f32_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f32_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f32_1-ctx2k-webgpu.wasm",vram_required_MB:3928.09,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f16_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:2041.09,low_resource_required:!0,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/RedPajama-INCITE-Chat-3B-v1-q4f32_1-MLC/resolve/main/",local_id:"RedPajama-INCITE-Chat-3B-v1-q4f32_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/RedPajama-INCITE-Chat-3B-v1/RedPajama-INCITE-Chat-3B-v1-q4f32_1-ctx1k-webgpu.wasm",vram_required_MB:2558.09,low_resource_required:!0},{model_url:"https://huggingface.co/mlc-ai/WizardMath-7B-V1.1-q4f16_1-MLC/resolve/main/",local_id:"WizardMath-7B-V1.1-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/Mistral-7B-Instruct-v0.2-q4f16_1-MLC/resolve/main/",local_id:"Mistral-7B-Instruct-v0.2-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/OpenHermes-2.5-Mistral-7B-q4f16_1-MLC/resolve/main/",local_id:"OpenHermes-2.5-Mistral-7B-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/NeuralHermes-2.5-Mistral-7B-q4f16_1-MLC/resolve/main/",local_id:"NeuralHermes-2.5-Mistral-7B-q4f16_1",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/Mistral-7B-Instruct-v0.2/Mistral-7B-Instruct-v0.2-q4f16_1-sw4k_cs1k-webgpu.wasm",vram_required_MB:6079.02,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q0f16-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q0f16",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q0f16-ctx2k-webgpu.wasm",vram_required_MB:5063.52,low_resource_required:!1,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q0f32-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q0f32",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q0f32-ctx2k-webgpu.wasm",vram_required_MB:5394.53,low_resource_required:!1},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q4f16_1-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q4f16_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q4f16_1-ctx1k-webgpu.wasm",vram_required_MB:899.11,low_resource_required:!0,required_features:["shader-f16"]},{model_url:"https://huggingface.co/mlc-ai/TinyLlama-1.1B-Chat-v0.4-q4f32_1-MLC/resolve/main/",local_id:"TinyLlama-1.1B-Chat-v0.4-q4f32_1-1k",model_lib_url:"https://raw.githubusercontent.com/mlc-ai/binary-mlc-llm-libs/main/TinyLlama-1.1B-Chat-v0.4/TinyLlama-1.1B-Chat-v0.4-q4f32_1-ctx1k-webgpu.wasm",vram_required_MB:992.11,low_resource_required:!0}],use_web_worker:!0},_a=function(i){function w(i){var u;_classCallCheck(this,w);var d,h;u=_callSuper(this,w,[i]),u._isModelLoaded=!1,u._isModelLoading=!1,u._loadOnFirstMessage=!1,u._webModel={},u.permittedErrorPrefixes=[w.MULTIPLE_MODELS_ERROR,w.WEB_LLM_NOT_FOUND_ERROR,w.GENERIC_ERROR],u._conversationHistory=[],_typeof(i.webModel)=="object"&&(u._webModel=i.webModel),(d=u._webModel.load)!=null&&d.clearCache&&w.clearAllCache(),u.findModelInWindow(i),u.canSendMessage=u.canSubmit.bind(_assertThisInitialized(u)),u._chatEl=(h=i.shadowRoot)==null?void 0:h.children[0],i.history&&w.setUpHistory(u._conversationHistory,i.history);return u}_inherits(w,i);return _createClass(w,[{key:"setUpMessages",value:function setUpMessages(i){var u=this;this._messages=i,this._removeIntro=function(){i.removeIntroductoryMessage(),u._removeIntro=void 0}}},{key:"findModelInWindow",value:function findModelInWindow(i){var u=this;var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;var h;window.webLLM?this.configureInit(this.shouldAddIntroMessage(i.introMessage)):d>w.MODULE_SEARCH_LIMIT_S?((h=this._messages)==null||h.addNewErrorMessage("service",w.WEB_LLM_NOT_FOUND_ERROR),console.error("The deep-chat-web-llm module has not been attached to the window object. Please see the following guide:"),console.error("https://deepchat.dev/examples/externalModules")):setTimeout((function(){return u.findModelInWindow(i,d+1)}),1e3)}},{key:"shouldAddIntroMessage",value:function shouldAddIntroMessage(i){var u;return!i&&this._webModel&&((u=this._webModel.introMessage)==null?void 0:u.displayed)!==!1}},{key:"scrollToTop",value:function scrollToTop(i){var u=this;var d;((d=this._webModel.introMessage)==null?void 0:d.autoScroll)!==!1&&setTimeout((function(){var i,d;(i=u._messages)!=null&&i.elementRef&&fe.scrollToTop((d=u._messages)==null?void 0:d.elementRef)}),i)}},{key:"getIntroMessage",value:function getIntroMessage(i){if(this.shouldAddIntroMessage(i)&&this._chatEl){var u=ga.setUpInitial(this.init.bind(this),this._webModel.introMessage,this._chatEl,!!this._webModel.worker);return this.scrollToTop(1),{role:Qe.AI_ROLE,html:u,sendUpdate:!1}}}},{key:"configureInit",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee25(i){var u;return _regeneratorRuntime().wrap((function _callee25$(d){while(1)switch(d.prev=d.next){case 0:u=this._webModel.load;if(!u){d.next=8;break}if(!u.onInit){d.next=5;break}this.init();return d.abrupt("return");case 5:if(!u.onMessage){d.next=8;break}this._loadOnFirstMessage=!0;return d.abrupt("return");case 8:i||this.init();case 9:case"end":return d.stop()}}),_callee25,this)})));function configureInit(u){return i.apply(this,arguments)}return configureInit}()},{key:"init",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee26(i){var u,d;return _regeneratorRuntime().wrap((function _callee26$(h){while(1)switch(h.prev=h.next){case 0:(u=this._messages)==null||u.removeError();d=this.attemptToCreateChat();h.t0=d;if(!h.t0){h.next=6;break}h.next=6;return this.loadModel(d,i);case 6:case"end":return h.stop()}}),_callee26,this)})));function init(u){return i.apply(this,arguments)}return init}()},{key:"attemptToCreateChat",value:function attemptToCreateChat(){var i;if(w.chat)(i=this._messages)==null||i.addNewErrorMessage("service",w.MULTIPLE_MODELS_ERROR),console.error(w.MULTIPLE_MODELS_ERROR);else if(!this._isModelLoaded&&!this._isModelLoading){var u=this._webModel.worker;return ya.use_web_worker&&u?new window.webLLM.ChatWorkerClient(u):new window.webLLM.ChatModule}}},{key:"getConfig",value:function getConfig(){var i;var u=w.DEFAULT_MODEL;this._webModel.model&&(u=this._webModel.model);var d=JSON.parse(JSON.stringify(ya));if(this._webModel.urls){var h=d.model_list.find((function(i){return i.local_id=u}));h&&(this._webModel.urls.model&&(h.model_url=this._webModel.urls.model),this._webModel.urls.wasm&&(h.model_lib_url=this._webModel.urls.wasm))}return(i=this._webModel.load)!=null&&i.skipCache&&(d.use_cache=!1),{model:u,appConfig:d}}},{key:"loadModel",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee27(i,u){var d=this;var h,m,v,g,y,b,x,A,P,D,q,V,J,X,oe;return _regeneratorRuntime().wrap((function _callee27$(pe){while(1)switch(pe.prev=pe.next){case 0:this.scrollToTop(),w.chat=i,this._isModelLoading=!0;A=((h=this._webModel.introMessage)==null?void 0:h.displayed)===!1;P=function n(i){var u;(u=d._messages)==null||u.addNewMessage({html:"<div>".concat(i.text,"</div>"),overwrite:!0,sendUpdate:!1}),A&&(setTimeout((function(){var i;return fe.scrollToBottom((i=d._messages)==null?void 0:i.elementRef)})),A=!1)};w.chat.setInitProgressCallback(P);pe.prev=4;q=this.getConfig(),V=q.model,J=q.appConfig,X={};this._webModel.instruction&&(X.conv_config={system:this._webModel.instruction});this._conversationHistory.length>0&&(X.conversation_history=this._conversationHistory);pe.next=10;return w.chat.reload(V,X,J,u);case 10:D=pe.sent;pe.next=16;break;case 13:pe.prev=13;pe.t0=pe.catch(4);return pe.abrupt("return",this.unloadChat(pe.t0));case 16:if((v=(m=this.deepChat)._validationHandler)==null||v.call(m),(g=this._webModel.introMessage)!=null&&g.removeAfterLoad)this._webModel.introMessage.displayed===!1?(b=this._messages)==null||b.removeLastMessage():(x=this._removeIntro)==null||x.call(this);else{oe=ga.setUpAfterLoad(D,this._webModel.introMessage,this._chatEl,!!this._webModel.worker);(y=this._messages)==null||y.addNewMessage({html:oe,overwrite:!0,sendUpdate:!1})}this._isModelLoaded=!0,this._isModelLoading=!1;case 18:case"end":return pe.stop()}}),_callee27,this,[[4,13]])})));function loadModel(u,d){return i.apply(this,arguments)}return loadModel}()},{key:"unloadChat",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee28(i){var u;return _regeneratorRuntime().wrap((function _callee28$(d){while(1)switch(d.prev=d.next){case 0:(u=this._messages)==null||u.addNewErrorMessage("service",w.GENERIC_ERROR);console.error(i);this._isModelLoaded=!1;this._isModelLoading=!1;d.t0=w.chat;if(!d.t0){d.next=9;break}d.next=8;return w.chat.unload();case 8:w.chat=void 0;case 9:case"end":return d.stop()}}),_callee28,this)})));function unloadChat(u){return i.apply(this,arguments)}return unloadChat}()},{key:"immediateResp",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee29(i,u,d){var h,m;return _regeneratorRuntime().wrap((function _callee29$(v){while(1)switch(v.prev=v.next){case 0:v.next=2;return d.generate(u,void 0,0);case 2:v.t0=v.sent;h={text:v.t0};v.next=6;return w.processResponse(this.deepChat,i,h);case 6:m=v.sent;m&&i.addNewMessage(m),this.completionsHandlers.onFinish();case 8:case"end":return v.stop()}}),_callee29,this)})));function immediateResp(u,d,h){return i.apply(this,arguments)}return immediateResp}()},{key:"streamResp",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee31(i,u,d){var h=this;var m;return _regeneratorRuntime().wrap((function _callee31$(v){while(1)switch(v.prev=v.next){case 0:this.streamHandlers.abortStream.abort=function(){d.interruptGenerate()},this.streamHandlers.onOpen();m=new Fr(i);v.next=4;return d.generate(u,function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee30(u,d){var v;return _regeneratorRuntime().wrap((function _callee30$(u){while(1)switch(u.prev=u.next){case 0:u.next=2;return w.processResponse(h.deepChat,i,{text:d});case 2:v=u.sent;v&&m.upsertStreamedMessage({text:v.text,overwrite:!0});case 4:case"end":return u.stop()}}),_callee30)})));return function(i,d){return u.apply(this,arguments)}}());case 4:m.finaliseStreamedMessage();this.streamHandlers.onClose();case 6:case"end":return v.stop()}}),_callee31,this)})));function streamResp(u,d,h){return i.apply(this,arguments)}return streamResp}()},{key:"generateRespByType",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee32(i,u,d,h){var m;return _regeneratorRuntime().wrap((function _callee32$(v){while(1)switch(v.prev=v.next){case 0:v.prev=0;if(!d){v.next=6;break}v.next=4;return this.streamResp(i,u,h);case 4:v.next=8;break;case 6:v.next=8;return this.immediateResp(i,u,h);case 8:v.next=13;break;case 10:v.prev=10;v.t0=v.catch(0);(m=this._messages)==null||m.addNewErrorMessage("service"),console.log(v.t0);case 13:case"end":return v.stop()}}),_callee32,this,[[0,10]])})));function generateRespByType(u,d,h,m){return i.apply(this,arguments)}return generateRespByType}()},{key:"generateResp",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee33(i,u,d){var h,m,v,g,y,b,x;return _regeneratorRuntime().wrap((function _callee33$(A){while(1)switch(A.prev=A.next){case 0:h=u[u.length-1].text;A.next=3;return Br.processRequestInterceptor(this.deepChat,{body:{text:h}});case 3:m=A.sent;v=m.body;g=m.error;y=!!this.stream;try{if(g)Br.displayError(i,new Error(g)),(y?this.streamHandlers.onClose:this.completionsHandlers.onFinish)();else if(v&&v.text)this.generateRespByType(i,v.text,!!this.stream,d);else{b=oe.INVALID_MODEL_REQUEST({body:v},!1);console.error(b);x=y?this.streamHandlers.onClose:this.completionsHandlers.onFinish;Br.onInterceptorError(i,b,x)}}catch(i){this.unloadChat(i)}case 8:case"end":return A.stop()}}),_callee33,this)})));function generateResp(u,d,h){return i.apply(this,arguments)}return generateResp}()},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee34(i,u){var d,h;return _regeneratorRuntime().wrap((function _callee34$(m){while(1)switch(m.prev=m.next){case 0:if(this._isModelLoaded){m.next=7;break}if(!this._loadOnFirstMessage){m.next=6;break}m.next=4;return this.init();case 4:m.next=7;break;case 6:return m.abrupt("return");case 7:!w.chat||this._isModelLoading||((d=this._webModel.introMessage)!=null&&d.removeAfterMessage&&((h=this._removeIntro)==null||h.call(this)),i.addLoadingMessage(),this.generateResp(i,u,w.chat));case 8:case"end":return m.stop()}}),_callee34,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"canSubmit",value:function canSubmit(i){return!(i==null||!i.trim()||this._isModelLoading)&&(!!this._loadOnFirstMessage||!!this._isModelLoaded)}},{key:"isWebModel",value:function isWebModel(){return!0}}],[{key:"setUpHistory",value:function setUpHistory(i,u){u.forEach((function(d,h){if(d.role===Qe.USER_ROLE&&d.text){var m=u[h+1];m!=null&&m.text&&m.role!==Qe.USER_ROLE&&i.push([d.text,m.text])}}))}},{key:"processResponse",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee35(i,u,d){var h,m,v;return _regeneratorRuntime().wrap((function _callee35$(g){while(1)switch(g.prev=g.next){case 0:g.next=2;return(h=i.responseInterceptor)==null?void 0:h.call(i,d);case 2:g.t0=g.sent;if(g.t0){g.next=5;break}g.t0=d;case 5:m=g.t0;if(!m.error){g.next=11;break}Br.displayError(u,new Error(m.error));return g.abrupt("return");case 11:if(!(!m||!m.text)){g.next=15;break}v=oe.INVALID_MODEL_RESPONSE(d,!!i.responseInterceptor,m);Br.displayError(u,new Error(v));return g.abrupt("return");case 15:return g.abrupt("return",m);case 16:case"end":return g.stop()}}),_callee35)})));function processResponse(u,d,h){return i.apply(this,arguments)}return processResponse}()},{key:"clearAllCache",value:function clearAllCache(){w.clearCache("webllm/model"),w.clearCache("webllm/wasm")}},{key:"clearCache",value:function clearCache(i){caches.open(i).then((function(i){i.keys().then((function(u){u.forEach((function(u){i.delete(u)}))}))}))}}])}(na);_a.GENERIC_ERROR="Error, please check the [troubleshooting](https://deepchat.dev/docs/webModel#troubleshooting) section of documentation for help.",_a.MULTIPLE_MODELS_ERROR="Cannot run multiple web models",_a.WEB_LLM_NOT_FOUND_ERROR="WebLLM module not found",_a.DEFAULT_MODEL="Llama-2-7b-chat-hf-q4f32_1",_a.MODULE_SEARCH_LIMIT_S=5;var ba=_a;var ka=function(){function ni(){_classCallCheck(this,ni)}return _createClass(ni,null,[{key:"buildHeaders",value:function buildHeaders(i){return{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}}},{key:"handleVerificationResult",value:function handleVerificationResult(i,u,d,h){var m=i;Array.isArray(m.error)&&m.error[0]==="Error in `parameters`: field required"?d(u):h(oe.INVALID_KEY)}},{key:"buildKeyVerificationDetails",value:function buildKeyVerificationDetails(){return{url:"https://api-inference.huggingface.co/models/gpt2",method:"POST",handleVerificationResult:ni.handleVerificationResult}}}])}();var Sa=function(i){function wt(i,u,d,h,m,v){var g;_classCallCheck(this,wt);g=_callSuper(this,wt,[i,ka.buildKeyVerificationDetails(),ka.buildHeaders,m,v]),g.insertKeyPlaceholderText="Hugging Face Token",g.keyHelpUrl="https://huggingface.co/settings/tokens",g.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Hugging Face</b></div>\n    <p>First message may take an extented amount of time to complete as the model needs to be initialized.</p>',g.permittedErrorPrefixes=["Authorization header"],g.url="".concat(wt.URL_PREFIX).concat(d),g.textInputPlaceholderText=u,_typeof(h)=="object"&&(h.model&&(g.url="".concat(wt.URL_PREFIX).concat(h.model)),h.options&&(g.rawBody.options=h.options),h.parameters&&(g.rawBody.parameters=h.parameters));return g}_inherits(wt,i);return _createClass(wt,[{key:"preprocessBody",value:function preprocessBody(i,u,d){var h;var m=JSON.parse(JSON.stringify(i)),v=u[u.length-1].text;if(v)return(h=m.options)!==null&&h!==void 0?h:m.options={},m.options.wait_for_model=!0,_objectSpread({inputs:v},m)}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee36(i,u,d){var h;return _regeneratorRuntime().wrap((function _callee36$(m){while(1)switch(m.prev=m.next){case 0:if(this.connectSettings){m.next=2;break}throw new Error("Request settings have not been set up");case 2:h=this.preprocessBody(this.rawBody,u,d);Xr.request(this,h,i);case 4:case"end":return m.stop()}}),_callee36,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()}])}(ia);Sa.URL_PREFIX="https://api-inference.huggingface.co/models/";var xa=Sa;var Ca=function(i){function Ft(i,u,d,h,m,v){var g;_classCallCheck(this,Ft);g=_callSuper(this,Ft,[i,u,d,h,m,v]),g.isTextInputDisabled=!0,g.canSendMessage=Ft.canSendFile;return g}_inherits(Ft,i);return _createClass(Ft,[{key:"preprocessBody",value:function preprocessBody(i,u,d){return d[0]}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee37(i,u,d){return _regeneratorRuntime().wrap((function _callee37$(u){while(1)switch(u.prev=u.next){case 0:if(this.connectSettings){u.next=2;break}throw new Error("Request settings have not been set up");case 2:if(d!=null&&d[0]){u.next=4;break}throw new Error("No file was added");case 4:Xr.poll(this,d[0],i,!1);case 5:case"end":return u.stop()}}),_callee37,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()}],[{key:"canSendFile",value:function canSendFile(i,u){return!!(u!=null&&u[0])}}])}(xa);var wa=function(i){function mo(i){_classCallCheck(this,mo);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.huggingFace)==null?void 0:d.audioClassification,v=(h=i.directConnection)==null?void 0:h.huggingFace;return _callSuper(this,mo,[i,"Attach an audio file","ehcalabres/wav2vec2-lg-xlsr-en-speech-emotion-recognition",m,v,{audio:{}}])}_inherits(mo,i);return _createClass(mo,[{key:"extractPollResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee38(i){var u;return _regeneratorRuntime().wrap((function _callee38$(d){while(1)switch(d.prev=d.next){case 0:if(!i.estimated_time){d.next=2;break}return d.abrupt("return",{timeoutMS:(i.estimated_time+1)*1e3});case 2:if(!i.error){d.next=4;break}throw i.error;case 4:return d.abrupt("return",{text:((u=i[0])==null?void 0:u.label)||""});case 5:case"end":return d.stop()}}),_callee38)})));function extractPollResultData(u){return i.apply(this,arguments)}return extractPollResultData}()}])}(Ca);var Ea=function(i){function go(i){_classCallCheck(this,go);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.huggingFace)==null?void 0:d.imageClassification,v=(h=i.directConnection)==null?void 0:h.huggingFace;return _callSuper(this,go,[i,"Attach an image file","google/vit-base-patch16-224",m,v,{images:{}}])}_inherits(go,i);return _createClass(go,[{key:"extractPollResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee39(i){var u;return _regeneratorRuntime().wrap((function _callee39$(d){while(1)switch(d.prev=d.next){case 0:if(!i.estimated_time){d.next=2;break}return d.abrupt("return",{timeoutMS:(i.estimated_time+1)*1e3});case 2:if(!i.error){d.next=4;break}throw i.error;case 4:return d.abrupt("return",{text:((u=i[0])==null?void 0:u.label)||""});case 5:case"end":return d.stop()}}),_callee39)})));function extractPollResultData(u){return i.apply(this,arguments)}return extractPollResultData}()}])}(Ca);var Ta="data:image/png;base64,";var Aa=function(){function ge(){_classCallCheck(this,ge)}return _createClass(ge,null,[{key:"buildHeaders",value:function buildHeaders(i){return{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}}},{key:"handleVerificationResult",value:function handleVerificationResult(i,u,d,h){i.message?h(oe.INVALID_KEY):d(u)}},{key:"buildKeyVerificationDetails",value:function buildKeyVerificationDetails(){return{url:"https://api.stability.ai/v1/engines/list",method:"GET",handleVerificationResult:ge.handleVerificationResult}}}])}();var Ra=function(i){function Si(i,u,d,h,m){var v;_classCallCheck(this,Si);v=_callSuper(this,Si,[i,u,d,h,m]),v.insertKeyPlaceholderText="Stability AI API Key",v.keyHelpUrl="https://platform.stability.ai/docs/getting-started/authentication",v.permittedErrorPrefixes=["Incorrect","invalid_"];return v}_inherits(Si,i);return _createClass(Si)}(ia);var Ia=function(i){function si(i){var u;_classCallCheck(this,si);var d;var h=JSON.parse(JSON.stringify(i.directConnection)),m=h==null?void 0:h.stabilityAI,v={images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}};u=_callSuper(this,si,[i,Aa.buildKeyVerificationDetails(),Aa.buildHeaders,m,v]),u.url="https://api.stability.ai/v1/generation/esrgan-v1-x2plus/image-to-image/upscale",u.textInputPlaceholderText="Describe image changes",u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI</b></div>\n    <div style="width: 100%; text-align: center; margin-left: -10px; margin-top: 5px"><b>Image to Image Upscale</b></div>\n    <p>Upload an image to generate a new one with higher resolution.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var g=(d=h==null?void 0:h.stabilityAI)==null?void 0:d.imageToImageUpscale;_typeof(g)=="object"&&(g.engine_id&&(u.url="https://api.stability.ai/v1/generation/".concat(g.engine_id,"/image-to-image/upscale")),si.cleanConfig(g),Object.assign(u.rawBody,g)),u.canSendMessage=si.canSendFileMessage;return u}_inherits(si,i);return _createClass(si,[{key:"createFormDataBody",value:function createFormDataBody(i,u){var d=new FormData;return d.append("image",u),Object.keys(i).forEach((function(u){d.append(u,String(i[u]))})),d}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee40(i,u,d){var h;return _regeneratorRuntime().wrap((function _callee40$(u){while(1)switch(u.prev=u.next){case 0:if(this.connectSettings){u.next=2;break}throw new Error("Request settings have not been set up");case 2:if(d){u.next=4;break}throw new Error("Image was not found");case 4:h=this.createFormDataBody(this.rawBody,d[0]);Br.tempRemoveContentHeader(this.connectSettings,Xr.request.bind(this,this,h,i),!1);case 6:case"end":return u.stop()}}),_callee40,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee41(i){return _regeneratorRuntime().wrap((function _callee41$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{files:i.artifacts.map((function(i){return{src:"".concat(Ta).concat(i.base64),type:"image"}}))});case 3:case"end":return u.stop()}}),_callee41)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"cleanConfig",value:function cleanConfig(i){delete i.engine_id}},{key:"canSendFileMessage",value:function canSendFileMessage(i,u){return!!(u!=null&&u[0])}}])}(Ra);var Ma=function(i){function ri(i){var u;_classCallCheck(this,ri);var d;var h=JSON.parse(JSON.stringify(i.directConnection)),m=h==null?void 0:h.stabilityAI,v={images:{files:{acceptedFormats:".png",maxNumberOfFiles:2}}};u=_callSuper(this,ri,[i,Aa.buildKeyVerificationDetails(),Aa.buildHeaders,m,v]),u.url="https://api.stability.ai/v1/generation/stable-diffusion-xl-1024-v1-0/image-to-image/masking",u._maskSource="MASK_IMAGE_WHITE",u.textInputPlaceholderText="Describe image changes",u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI</b></div>\n    <div style="width: 100%; text-align: center; margin-left: -10px; margin-top: 5px"><b>Image to Image Masking</b></div>\n    <p>Upload an image, its mask image to create a new one based on the changes you have described for the mask area.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var g=(d=h==null?void 0:h.stabilityAI)==null?void 0:d.imageToImageMasking;_typeof(g)=="object"&&(g.engine_id&&(u.url="https://api.stability.ai/v1/generation/".concat(g.engine_id,"/image-to-image/masking")),g.weight!==void 0&&g.weight!==null&&(u._imageWeight=g.weight),g.mask_source!==void 0&&g.mask_source!==null&&(u._maskSource=g.mask_source),ri.cleanConfig(g),Object.assign(u.rawBody,g)),u.canSendMessage=ri.canSendFileTextMessage;return u}_inherits(ri,i);return _createClass(ri,[{key:"createFormDataBody",value:function createFormDataBody(i,u,d,h){var m=new FormData;return m.append("init_image",u),m.append("mask_source",String(this._maskSource)),m.append("mask_image",d),h&&h!==""&&m.append("text_prompts[0][text]",h),this._imageWeight!==void 0&&this._imageWeight!==null&&m.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(i).forEach((function(u){m.append(u,String(i[u]))})),m.get("weight")===void 0&&m.append("weight",String(1)),m}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee42(i,u,d){var h,m,v,g;return _regeneratorRuntime().wrap((function _callee42$(y){while(1)switch(y.prev=y.next){case 0:if(this.connectSettings){y.next=2;break}throw new Error("Request settings have not been set up");case 2:if(!(!d||!d[0]||!d[1])){y.next=4;break}throw new Error("Image was not found");case 4:v=(m=(h=u[u.length-1])==null?void 0:h.text)==null?void 0:m.trim(),g=this.createFormDataBody(this.rawBody,d[0],d[1],v);Br.tempRemoveContentHeader(this.connectSettings,Xr.request.bind(this,this,g,i),!1);case 6:case"end":return y.stop()}}),_callee42,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee43(i){return _regeneratorRuntime().wrap((function _callee43$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{files:i.artifacts.map((function(i){return{src:"".concat(Ta).concat(i.base64),type:"image"}}))});case 3:case"end":return u.stop()}}),_callee43)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"cleanConfig",value:function cleanConfig(i){delete i.engine_id,delete i.weight}},{key:"canSendFileTextMessage",value:function canSendFileTextMessage(i,u){return!!(u!=null&&u[0])&&!!(i&&i.trim()!=="")}}])}(Ra);var La=function(i){function bo(i){_classCallCheck(this,bo);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.huggingFace)==null?void 0:d.audioSpeechRecognition,v=(h=i.directConnection)==null?void 0:h.huggingFace;return _callSuper(this,bo,[i,"Attach an audio file","facebook/wav2vec2-large-960h-lv60-self",m,v,{audio:{}}])}_inherits(bo,i);return _createClass(bo,[{key:"extractPollResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee44(i){return _regeneratorRuntime().wrap((function _callee44$(u){while(1)switch(u.prev=u.next){case 0:if(!i.estimated_time){u.next=2;break}return u.abrupt("return",{timeoutMS:(i.estimated_time+1)*1e3});case 2:if(!i.error){u.next=4;break}throw i.error;case 4:return u.abrupt("return",{text:i.text||""});case 5:case"end":return u.stop()}}),_callee44)})));function extractPollResultData(u){return i.apply(this,arguments)}return extractPollResultData}()}])}(Ca);var Oa=function(i){function vo(i){_classCallCheck(this,vo);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.huggingFace)==null?void 0:d.textGeneration,v=(h=i.directConnection)==null?void 0:h.huggingFace;return _callSuper(this,vo,[i,"Once upon a time","gpt2",m,v])}_inherits(vo,i);return _createClass(vo,[{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee45(i){var u;return _regeneratorRuntime().wrap((function _callee45$(d){while(1)switch(d.prev=d.next){case 0:if(!i.error){d.next=2;break}throw i.error;case 2:return d.abrupt("return",{text:((u=i[0])==null?void 0:u.generated_text)||""});case 3:case"end":return d.stop()}}),_callee45)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(xa);var Pa=function(i){function yo(i){var u;_classCallCheck(this,yo);var d,h,m;var v=(h=(d=i.directConnection)==null?void 0:d.huggingFace)==null?void 0:h.questionAnswer,g=(m=i.directConnection)==null?void 0:m.huggingFace;u=_callSuper(this,yo,[i,"Ask a question","bert-large-uncased-whole-word-masking-finetuned-squad",v,g]),u.permittedErrorPrefixes=["Authorization header","Error in"],u.context=v.context;return u}_inherits(yo,i);return _createClass(yo,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=u[u.length-1].text;if(d)return{inputs:{question:d,context:this.context,options:{wait_for_model:!0}}}}},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee46(i){return _regeneratorRuntime().wrap((function _callee46$(u){while(1)switch(u.prev=u.next){case 0:if(!i.error){u.next=2;break}throw i.error;case 2:return u.abrupt("return",{text:i.answer||""});case 3:case"end":return u.stop()}}),_callee46)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(xa);var Na=function(i){function xo(i){_classCallCheck(this,xo);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.huggingFace)==null?void 0:d.summarization,v=(h=i.directConnection)==null?void 0:h.huggingFace;return _callSuper(this,xo,[i,"Insert text to summarize","facebook/bart-large-cnn",m,v])}_inherits(xo,i);return _createClass(xo,[{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee47(i){var u;return _regeneratorRuntime().wrap((function _callee47$(d){while(1)switch(d.prev=d.next){case 0:if(!i.error){d.next=2;break}throw i.error;case 2:return d.abrupt("return",{text:((u=i[0])==null?void 0:u.summary_text)||""});case 3:case"end":return d.stop()}}),_callee47)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(xa);var Fa=function(i){function Eo(i){var u;var d;_classCallCheck(this,Eo);var h,m,v;var g=(m=(h=i.directConnection)==null?void 0:h.huggingFace)==null?void 0:m.conversation,y=(v=i.directConnection)==null?void 0:v.huggingFace;d=_callSuper(this,Eo,[i,"Ask me anything!","facebook/blenderbot-400M-distill",g,y]),(u=d.maxMessages)!==null&&u!==void 0?u:d.maxMessages=-1;return d}_inherits(Eo,i);return _createClass(Eo,[{key:"processMessages",value:function processMessages(i){var u=i.filter((function(i){return i.text})),d=u[u.length-1].text,h=u.slice(0,u.length-1);if(d){var m=h.filter((function(i){return i.role==="user"})).map((function(i){return i.text})),v=h.filter((function(i){return i.role==="ai"})).map((function(i){return i.text}));return{past_user_inputs:m,generated_responses:v,mostRecentMessageText:d}}}},{key:"preprocessBody",value:function preprocessBody(i,u){var d;var h=JSON.parse(JSON.stringify(i)),m=this.processMessages(u);if(m)return(d=h.options)!==null&&d!==void 0?d:h.options={},h.options.wait_for_model=!0,_objectSpread({inputs:{past_user_inputs:m.past_user_inputs,generated_responses:m.generated_responses,text:m.mostRecentMessageText}},h)}},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee48(i){return _regeneratorRuntime().wrap((function _callee48$(u){while(1)switch(u.prev=u.next){case 0:if(!i.error){u.next=2;break}throw i.error;case 2:return u.abrupt("return",{text:i.generated_text||""});case 3:case"end":return u.stop()}}),_callee48)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(xa);var Da=function(i){function oi(i){var u;_classCallCheck(this,oi);var d;var h=JSON.parse(JSON.stringify(i.directConnection)),m=h.stabilityAI,v={images:{files:{acceptedFormats:".png",maxNumberOfFiles:1}}};u=_callSuper(this,oi,[i,Aa.buildKeyVerificationDetails(),Aa.buildHeaders,m,v]),u.url="https://api.stability.ai/v1/generation/stable-diffusion-v1-6/image-to-image",u.textInputPlaceholderText="Describe image changes",u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI: Image to Image</b></div>\n    <p>Upload an image to create a new one with the changes you have described.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var g=(d=h.stabilityAI)==null?void 0:d.imageToImage;_typeof(g)=="object"&&(g.engine_id&&(u.url="https://api.stability.ai/v1/generation/".concat(g.engine_id,"/text-to-image")),g.weight!==void 0&&g.weight!==null&&(u._imageWeight=g.weight),oi.cleanConfig(g),Object.assign(u.rawBody,g)),u.canSendMessage=oi.canSendFileTextMessage;return u}_inherits(oi,i);return _createClass(oi,[{key:"createFormDataBody",value:function createFormDataBody(i,u,d){var h=new FormData;return h.append("init_image",u),d&&d!==""&&h.append("text_prompts[0][text]",d),this._imageWeight!==void 0&&this._imageWeight!==null&&h.append("text_prompts[0][weight]",String(this._imageWeight)),Object.keys(i).forEach((function(u){h.append(u,String(i[u]))})),h.get("weight")===void 0&&h.append("weight",String(1)),h}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee49(i,u,d){var h,m,v,g;return _regeneratorRuntime().wrap((function _callee49$(y){while(1)switch(y.prev=y.next){case 0:if(this.connectSettings){y.next=2;break}throw new Error("Request settings have not been set up");case 2:if(d){y.next=4;break}throw new Error("Image was not found");case 4:v=(m=(h=u[u.length-1])==null?void 0:h.text)==null?void 0:m.trim(),g=this.createFormDataBody(this.rawBody,d[0],v);Br.tempRemoveContentHeader(this.connectSettings,Xr.request.bind(this,this,g,i),!1);case 6:case"end":return y.stop()}}),_callee49,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee50(i){return _regeneratorRuntime().wrap((function _callee50$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{files:i.artifacts.map((function(i){return{src:"".concat(Ta).concat(i.base64),type:"image"}}))});case 3:case"end":return u.stop()}}),_callee50)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"cleanConfig",value:function cleanConfig(i){delete i.engine_id,delete i.weight}},{key:"canSendFileTextMessage",value:function canSendFileTextMessage(i,u){return!!(u!=null&&u[0])&&!!(i&&i.trim()!=="")}}])}(Ra);var Ba=function(i){function _o(i){_classCallCheck(this,_o);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.huggingFace)==null?void 0:d.translation,v=(h=i.directConnection)==null?void 0:h.huggingFace;return _callSuper(this,_o,[i,"Insert text to translate","Helsinki-NLP/opus-tatoeba-en-ja",m,v])}_inherits(_o,i);return _createClass(_o,[{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee51(i){var u;return _regeneratorRuntime().wrap((function _callee51$(d){while(1)switch(d.prev=d.next){case 0:if(!i.error){d.next=2;break}throw i.error;case 2:return d.abrupt("return",{text:((u=i[0])==null?void 0:u.translation_text)||""});case 3:case"end":return d.stop()}}),_callee51)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(xa);var ja=function(i){function ai(i){var u;_classCallCheck(this,ai);var d;var h=JSON.parse(JSON.stringify(i.directConnection)),m=h.stabilityAI;u=_callSuper(this,ai,[i,Aa.buildKeyVerificationDetails(),Aa.buildHeaders,m]),u.url="https://api.stability.ai/v1/generation/stable-diffusion-v1-6/text-to-image",u.textInputPlaceholderText="Describe an image",u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Stability AI: Text to Image</b></div>\n    <p>Insert text to generate an image.</p>\n    <p>Click <a href="https://platform.stability.ai/">here</a> for more info.</p>';var v=(d=h.stabilityAI)==null?void 0:d.textToImage;_typeof(v)=="object"&&(v.engine_id&&(u.url="https://api.stability.ai/v1/generation/".concat(v.engine_id,"/text-to-image")),v.weight!==void 0&&v.weight!==null&&(u._imageWeight=v.weight),ai.cleanConfig(v),Object.assign(u.rawBody,v)),u.canSendMessage=ai.canSendTextMessage;return u}_inherits(ai,i);return _createClass(ai,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=JSON.parse(JSON.stringify(i)),h={text:u};return this._imageWeight&&(h.weight=this._imageWeight),d.text_prompts=[h],d}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee52(i,u){var d;return _regeneratorRuntime().wrap((function _callee52$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u[u.length-1].text);Xr.request(this,d,i);case 4:case"end":return h.stop()}}),_callee52,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee53(i){return _regeneratorRuntime().wrap((function _callee53$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{files:i.artifacts.map((function(i){return{src:"".concat(Ta).concat(i.base64),type:"image"}}))});case 3:case"end":return u.stop()}}),_callee53)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"cleanConfig",value:function cleanConfig(i){delete i.engine_id,delete i.weight}},{key:"canSendTextMessage",value:function canSendTextMessage(i){return!!(i&&i.trim()!=="")}}])}(Ra);var Ua=function(i){function So(i){var u;_classCallCheck(this,So);var d,h,m;var v=(h=(d=i.directConnection)==null?void 0:d.huggingFace)==null?void 0:h.fillMask,g=(m=i.directConnection)==null?void 0:m.huggingFace;u=_callSuper(this,So,[i,"The goal of life is [MASK].","bert-base-uncased",v,g]),u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Hugging Face</b></div>\n    <p>Insert a sentence with the word [MASK] and the model will try to fill it for you. E.g. I want [MASK].</p>\n    <p>First message may take an extented amount of time to complete as the model needs to be initialized.</p>',u.permittedErrorPrefixes=["Authorization header","No mask_token"];return u}_inherits(So,i);return _createClass(So,[{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee54(i){var u;return _regeneratorRuntime().wrap((function _callee54$(d){while(1)switch(d.prev=d.next){case 0:if(!i.error){d.next=2;break}throw i.error;case 2:return d.abrupt("return",{text:((u=i[0])==null?void 0:u.sequence)||""});case 3:case"end":return d.stop()}}),_callee54)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(xa);var Ha=function(){function li(){_classCallCheck(this,li)}return _createClass(li,null,[{key:"buildHeaders",value:function buildHeaders(i){return{Authorization:"Bearer ".concat(i),"Content-Type":"application/json",accept:"application/json"}}},{key:"handleVerificationResult",value:function handleVerificationResult(i,u,d,h){var m;(m=i.message)!=null&&m.includes("invalid request: prompt must be at least 1 token long")?d(u):h(oe.INVALID_KEY)}},{key:"buildKeyVerificationDetails",value:function buildKeyVerificationDetails(){return{url:"https://api.cohere.ai/v1/generate",method:"POST",handleVerificationResult:li.handleVerificationResult,body:JSON.stringify({prompt:""})}}}])}();var Ga=function(i){function fn(i,u,d,h,m){var v;_classCallCheck(this,fn);v=_callSuper(this,fn,[i,Ha.buildKeyVerificationDetails(),Ha.buildHeaders,m]),v.insertKeyPlaceholderText="Cohere API Key",v.keyHelpUrl="https://dashboard.cohere.ai/api-keys",v.permittedErrorPrefixes=["invalid"],v.url=u,v.textInputPlaceholderText=d,h&&_typeof(h)=="object"&&Object.assign(v.rawBody,h);return v}_inherits(fn,i);return _createClass(fn)}(ia);var qa=function(i){function wo(i){_classCallCheck(this,wo);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.cohere)==null?void 0:d.textGeneration,v=(h=i.directConnection)==null?void 0:h.cohere;return _callSuper(this,wo,[i,"https://api.cohere.ai/v1/generate","Once upon a time",m,v])}_inherits(wo,i);return _createClass(wo,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=JSON.parse(JSON.stringify(i)),h=u[u.length-1].text;if(h)return _objectSpread({prompt:h},d)}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee55(i,u){var d;return _regeneratorRuntime().wrap((function _callee55$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u);Xr.request(this,d,i);case 4:case"end":return h.stop()}}),_callee55,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee56(i){var u;return _regeneratorRuntime().wrap((function _callee56$(d){while(1)switch(d.prev=d.next){case 0:if(!i.message){d.next=2;break}throw i.message;case 2:return d.abrupt("return",{text:((u=i.generations)==null?void 0:u[0].text)||""});case 3:case"end":return d.stop()}}),_callee56)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(Ga);var za=function(i){function To(i){_classCallCheck(this,To);var u,d,h;var m=(d=(u=i.directConnection)==null?void 0:u.cohere)==null?void 0:d.summarization,v=(h=i.directConnection)==null?void 0:h.cohere;return _callSuper(this,To,[i,"https://api.cohere.ai/v1/summarize","Insert text to summarize",m,v])}_inherits(To,i);return _createClass(To,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=JSON.parse(JSON.stringify(i)),h=u[u.length-1].text;if(h)return _objectSpread({text:h},d)}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee57(i,u){var d;return _regeneratorRuntime().wrap((function _callee57$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u);Xr.request(this,d,i);case 4:case"end":return h.stop()}}),_callee57,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee58(i){return _regeneratorRuntime().wrap((function _callee58$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{text:i.summary||""});case 3:case"end":return u.stop()}}),_callee58)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(Ga);var Va=function(){function O(){_classCallCheck(this,O)}return _createClass(O,null,[{key:"buildHeaders",value:function buildHeaders(i){return{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}}},{key:"handleVerificationResult",value:function handleVerificationResult(i,u,d,h){var m=i;m.error?m.error.code==="invalid_api_key"?h(oe.INVALID_KEY):h(oe.CONNECTION_FAILED):d(u)}},{key:"buildKeyVerificationDetails",value:function buildKeyVerificationDetails(){return{url:"https://api.openai.com/v1/models",method:"GET",handleVerificationResult:O.handleVerificationResult}}},{key:"directFetch",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee59(i,u,d){var h,m,v=arguments;return _regeneratorRuntime().wrap((function _callee59$(g){while(1)switch(g.prev=g.next){case 0:h=!(v.length>3&&v[3]!==void 0)||v[3];i.connectSettings.method=d;g.next=4;return Br.fetch(i,i.connectSettings.headers,h,u).then((function(i){return Br.processResponseByType(i)}));case 4:m=g.sent;if(!m.error){g.next=7;break}throw m.error.message;case 7:return g.abrupt("return",m);case 8:case"end":return g.stop()}}),_callee59)})));function directFetch(u,d,h){return i.apply(this,arguments)}return directFetch}()}])}();var Wa=function(i){function st(i){var u,d;var h;_classCallCheck(this,st);var m,v,g;var y=JSON.parse(JSON.stringify(i.directConnection)),b=y==null?void 0:y.openAI;h=_callSuper(this,st,[i,Va.buildKeyVerificationDetails(),Va.buildHeaders,b]),h.insertKeyPlaceholderText="OpenAI API Key",h.keyHelpUrl="https://platform.openai.com/account/api-keys",h.url="https://api.openai.com/v1/audio/speech",h.permittedErrorPrefixes=["Invalid"],h.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI : Text To Speech</b></div>\n    <p>Generate an audio file based on your text input.</p>\n    <p>Click <a href="https://platform.openai.com/docs/guides/text-to-speech">here</a> for more information.</p>';var x=(m=y==null?void 0:y.openAI)==null?void 0:m.textToSpeech;_typeof(x)=="object"&&Object.assign(h.rawBody,x),(u=(v=h.rawBody).model)!==null&&u!==void 0?u:v.model=st.DEFAULT_MODEL,(d=(g=h.rawBody).voice)!==null&&d!==void 0?d:g.voice=st.DEFAULT_VOIDE,h.textInputPlaceholderText="Insert text to generate audio",h.rawBody.response_format="mp3";return h}_inherits(st,i);return _createClass(st,[{key:"preprocessBody",value:function preprocessBody(i,u){var d,h;var m=JSON.parse(JSON.stringify(i)),v=(h=(d=u[u.length-1])==null?void 0:d.text)==null?void 0:h.trim();return v&&v!==""&&(m.input=v),m}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee60(i,u){var d,h;return _regeneratorRuntime().wrap((function _callee60$(m){while(1)switch(m.prev=m.next){case 0:if((d=this.connectSettings)!=null&&d.headers){m.next=2;break}throw new Error("Request settings have not been set up");case 2:this.url=this.connectSettings.url||this.url;h=this.preprocessBody(this.rawBody,u);Xr.request(this,h,i);case 5:case"end":return m.stop()}}),_callee60,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee61(i){return _regeneratorRuntime().wrap((function _callee61$(u){while(1)switch(u.prev=u.next){case 0:if(!(i instanceof Blob)){u.next=2;break}return u.abrupt("return",new Promise((function(u){var d=new FileReader;d.readAsDataURL(i),d.onload=function(i){u({files:[{src:i.target.result,type:"audio"}]})}})));case 2:if(!i.error){u.next=4;break}throw i.error.message;case 4:return u.abrupt("return",{error:"error"});case 5:case"end":return u.stop()}}),_callee61)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(ia);Wa.DEFAULT_MODEL="tts-1",Wa.DEFAULT_VOIDE="alloy";var Ka=Wa;var $a=function(i){function le(i){var u;var d;_classCallCheck(this,le);var h,m;var v=JSON.parse(JSON.stringify(i.directConnection)),g=v==null?void 0:v.openAI;d=_callSuper(this,le,[i,Va.buildKeyVerificationDetails(),Va.buildHeaders,g,{audio:{}}]),d.insertKeyPlaceholderText="OpenAI API Key",d.keyHelpUrl="https://platform.openai.com/account/api-keys",d.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI : Speech To Text</b></div>\n    <p><b>Upload an audio file</b> to transcribe it into text. You can optionally provide text to guide the audio\n      processing.\n    <p>Click <a href="https://platform.openai.com/docs/guides/speech-to-text">here</a> for more info.</p>',d.url="",d.permittedErrorPrefixes=["Invalid"],d.textInputPlaceholderText="Upload an audio file",d._service_url=le.AUDIO_TRANSCRIPTIONS_URL;var y=(h=v==null?void 0:v.openAI)==null?void 0:h.audio;_typeof(y)=="object"&&(d.processConfig(y),le.cleanConfig(y),Object.assign(d.rawBody,y)),(u=(m=d.rawBody).model)!==null&&u!==void 0?u:m.model=le.DEFAULT_MODEL,d.rawBody.response_format="json",d.canSendMessage=le.canSendFileMessage;return d}_inherits(le,i);return _createClass(le,[{key:"processConfig",value:function processConfig(i){i!=null&&i.type&&i.type==="translation"&&(this._service_url=le.AUDIO_TRANSLATIONS_URL,delete i.language)}},{key:"preprocessBody",value:function preprocessBody(i,u){var d,h;var m=JSON.parse(JSON.stringify(i)),v=(h=(d=u[u.length-1])==null?void 0:d.text)==null?void 0:h.trim();return v&&v!==""&&(m.prompt=v),m}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee62(i,u,d){var h,m,v;return _regeneratorRuntime().wrap((function _callee62$(g){while(1)switch(g.prev=g.next){case 0:if((h=this.connectSettings)!=null&&h.headers){g.next=2;break}throw new Error("Request settings have not been set up");case 2:if(d!=null&&d[0]){g.next=4;break}throw new Error("No file was added");case 4:this.url=this.connectSettings.url||this._service_url;m=this.preprocessBody(this.rawBody,u),v=le.createFormDataBody(m,d[0]);Br.tempRemoveContentHeader(this.connectSettings,Xr.request.bind(this,this,v,i),!1);case 7:case"end":return g.stop()}}),_callee62,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee63(i){return _regeneratorRuntime().wrap((function _callee63$(u){while(1)switch(u.prev=u.next){case 0:if(!i.error){u.next=2;break}throw i.error.message;case 2:return u.abrupt("return",{text:i.text});case 3:case"end":return u.stop()}}),_callee63)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"canSendFileMessage",value:function canSendFileMessage(i,u){return!!(u!=null&&u[0])}},{key:"cleanConfig",value:function cleanConfig(i){delete i.type}},{key:"createFormDataBody",value:function createFormDataBody(i,u){var d=new FormData;return d.append("file",u),Object.keys(i).forEach((function(u){d.append(u,String(i[u]))})),d}}])}(ia);$a.AUDIO_TRANSCRIPTIONS_URL="https://api.openai.com/v1/audio/transcriptions",$a.AUDIO_TRANSLATIONS_URL="https://api.openai.com/v1/audio/translations",$a.DEFAULT_MODEL="whisper-1";var Ja=$a;var Ya=function(){function re(){_classCallCheck(this,re)}return _createClass(re,null,[{key:"buildTextToSpeechHeaders",value:function buildTextToSpeechHeaders(i,u){return{"Ocp-Apim-Subscription-Key":u,"Content-Type":"application/ssml+xml","X-Microsoft-OutputFormat":i}}},{key:"buildSpeechToTextHeaders",value:function buildSpeechToTextHeaders(i){return{"Ocp-Apim-Subscription-Key":i,Accept:"application/json"}}},{key:"handleSpeechVerificationResult",value:function handleSpeechVerificationResult(i,u,d,h){i.error?h(oe.INVALID_KEY):d(u)}},{key:"buildSpeechKeyVerificationDetails",value:function buildSpeechKeyVerificationDetails(i){return{url:"https://".concat(i,".api.cognitive.microsoft.com/sts/v1.0/issuetoken"),method:"POST",createHeaders:function createHeaders(i){return{"Ocp-Apim-Subscription-Key":"".concat(i)}},handleVerificationResult:re.handleSpeechVerificationResult}}},{key:"buildSummarizationHeader",value:function buildSummarizationHeader(i){return{"Ocp-Apim-Subscription-Key":i,"Content-Type":"application/json"}}},{key:"handleLanguageVerificationResult",value:function handleLanguageVerificationResult(i,u,d,h){var m;((m=i.error)==null?void 0:m.code)==="401"?h(oe.INVALID_KEY):d(u)}},{key:"buildLanguageKeyVerificationDetails",value:function buildLanguageKeyVerificationDetails(i){return{url:"".concat(i,"/language/analyze-text/jobs?api-version=2022-10-01-preview"),method:"POST",createHeaders:function createHeaders(i){return{"Ocp-Apim-Subscription-Key":"".concat(i)}},handleVerificationResult:re.handleLanguageVerificationResult}}},{key:"handleTranslationVerificationResult",value:function handleTranslationVerificationResult(i,u,d,h){i.json().then((function(i){Array.isArray(i)||i.error.code!==401e3?d(u):h(oe.INVALID_KEY)}))}},{key:"buildTranslationKeyVerificationDetails",value:function buildTranslationKeyVerificationDetails(i){return{url:"https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=es",method:"POST",createHeaders:function createHeaders(u){return re.buildTranslationHeaders(i,u)},handleVerificationResult:re.handleTranslationVerificationResult}}},{key:"buildTranslationHeaders",value:function buildTranslationHeaders(i,u){var d={"Ocp-Apim-Subscription-Key":u,"Content-Type":"application/json"};return i&&(d["Ocp-Apim-Subscription-Region"]=i),d}}])}();var Za=function(i){function Co(i,u,d,h,m){var v;_classCallCheck(this,Co);v=_callSuper(this,Co,[i,Ya.buildLanguageKeyVerificationDetails(d),u,h,m]),v.insertKeyPlaceholderText="Azure Language Subscription Key",v.keyHelpUrl="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",v.permittedErrorPrefixes=["Access"];return v}_inherits(Co,i);return _createClass(Co)}(ia);var Xa=function(i){function ko(i){var u;var d;_classCallCheck(this,ko);var h,m,v,g;var y=(m=(h=i.directConnection)==null?void 0:h.azure)==null?void 0:m.summarization,b=(v=i.directConnection)==null?void 0:v.azure;d=_callSuper(this,ko,[i,Ya.buildSummarizationHeader,y.endpoint,b]),d.url="",d.textInputPlaceholderText="Insert text to summarize",(u=(g=d.rawBody).language)!==null&&u!==void 0?u:g.language="en",Object.assign(d.rawBody,y),d.url="".concat(y.endpoint,"/language/analyze-text/jobs?api-version=2022-10-01-preview");return d}_inherits(ko,i);return _createClass(ko,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=u[u.length-1].text;if(d)return{analysisInput:{documents:[{id:"1",language:i.language,text:d}]},tasks:[{kind:"ExtractiveSummarization"}]}}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee64(i,u){var d;return _regeneratorRuntime().wrap((function _callee64$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u);Xr.request(this,d,i),this.messages=i;case 4:case"end":return h.stop()}}),_callee64,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee65(i){var u,d,h;return _regeneratorRuntime().wrap((function _callee65$(m){while(1)switch(m.prev=m.next){case 0:if(!i.error){m.next=2;break}throw i.error.message;case 2:if(this.messages&&this.completionsHandlers){d=i.headers.get("operation-location"),h={method:"GET",headers:(u=this.connectSettings)==null?void 0:u.headers};Xr.executePollRequest(this,d,h,this.messages)}return m.abrupt("return",{makingAnotherRequest:!0});case 4:case"end":return m.stop()}}),_callee65,this)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()},{key:"extractPollResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee66(i){var u,d,h,m;return _regeneratorRuntime().wrap((function _callee66$(v){while(1)switch(v.prev=v.next){case 0:if(!i.error){v.next=2;break}throw i.error;case 2:if(!(i.status==="running")){v.next=4;break}return v.abrupt("return",{timeoutMS:2e3});case 4:if(!(i.errors.length>0)){v.next=6;break}throw i.errors[0];case 6:if(!(i.tasks.items[0].results.errors.length>0)){v.next=8;break}throw i.tasks.items[0].results.errors[0];case 8:u="";d=_createForOfIteratorHelper(i.tasks.items[0].results.documents[0].sentences);try{for(d.s();!(h=d.n()).done;){m=h.value;u+=m.text}}catch(i){d.e(i)}finally{d.f()}return v.abrupt("return",{text:u||""});case 12:case"end":return v.stop()}}),_callee66)})));function extractPollResultData(u){return i.apply(this,arguments)}return extractPollResultData}()}])}(Za);var Qa=function(){function yt(){_classCallCheck(this,yt)}return _createClass(yt,null,[{key:"poll",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee67(i,u){var d,h,m,v;return _regeneratorRuntime().wrap((function _callee67$(g){while(1)switch(g.prev=g.next){case 0:d={authorization:i,"content-type":"application/json"};g.t0="https://api.assemblyai.com/v2/transcript/";g.next=4;return fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",body:JSON.stringify({audio_url:u}),headers:d});case 4:g.next=6;return g.sent.json();case 6:g.t1=g.sent.id;h=g.t0.concat.call(g.t0,g.t1);case 8:if(m){g.next=24;break}g.next=11;return fetch(h,{headers:d});case 11:g.next=13;return g.sent.json();case 13:v=g.sent;if(!(v.status==="completed")){g.next=18;break}m=v;g.next=22;break;case 18:if(!(v.status==="error")){g.next=20;break}throw new Error("Transcription failed: ".concat(v.error));case 20:g.next=22;return new Promise((function(i){return setTimeout(i,3e3)}));case 22:g.next=8;break;case 24:return g.abrupt("return",m);case 25:case"end":return g.stop()}}),_callee67)})));function poll(u,d){return i.apply(this,arguments)}return poll}()},{key:"buildHeaders",value:function buildHeaders(i){return{Authorization:i,"Content-Type":"application/octet-stream"}}},{key:"handleVerificationResult",value:function handleVerificationResult(i,u,d,h){var m=i;m.error?m.error.code==="invalid_api_key"?h(oe.INVALID_KEY):h(oe.CONNECTION_FAILED):d(u)}},{key:"buildKeyVerificationDetails",value:function buildKeyVerificationDetails(){return{url:"https://api.assemblyai.com/v2/upload",method:"POST",handleVerificationResult:yt.handleVerificationResult}}}])}();var ii=function(i){function pn(i){var u;_classCallCheck(this,pn);var d;var h=(d=i.directConnection)==null?void 0:d.assemblyAI;u=_callSuper(this,pn,[i,Qa.buildKeyVerificationDetails(),Qa.buildHeaders,h,{audio:{}}]),u.insertKeyPlaceholderText="AssemblyAI API Key",u.keyHelpUrl="https://www.assemblyai.com/app/account",u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>AssemblyAI Audio</b></div>\n    <p><b>Upload an audio file</b> to transcribe it into text.\n    <p>\n      Click <a href="https://www.assemblyai.com/docs/Guides/transcribing_an_audio_file#get-started">here</a> for more info.\n    </p>',u.url="https://api.assemblyai.com/v2/upload",u.isTextInputDisabled=!0,u.textInputPlaceholderText="Upload an audio file",u.permittedErrorPrefixes=["Authentication","Invalid"],u.canSendMessage=pn.canFileSendMessage;return u}_inherits(pn,i);return _createClass(pn,[{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee68(i,u,d){var h;return _regeneratorRuntime().wrap((function _callee68$(u){while(1)switch(u.prev=u.next){case 0:if((h=this.connectSettings)!=null&&h.headers){u.next=2;break}throw new Error("Request settings have not been set up");case 2:if(d!=null&&d[0]){u.next=4;break}throw new Error("No file was added");case 4:Xr.request(this,d[0],i,!1);case 5:case"end":return u.stop()}}),_callee68,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee69(i){var u,d,h;return _regeneratorRuntime().wrap((function _callee69$(m){while(1)switch(m.prev=m.next){case 0:if(!i.error){m.next=2;break}throw i.error;case 2:h=(d=(u=this.connectSettings)==null?void 0:u.headers)==null?void 0:d.Authorization;m.next=5;return Qa.poll(h,i.upload_url);case 5:m.t0=m.sent.text;return m.abrupt("return",{text:m.t0});case 7:case"end":return m.stop()}}),_callee69,this)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"canFileSendMessage",value:function canFileSendMessage(i,u){return!!(u!=null&&u[0])}}])}(ia);var ki=function(i){function cs(i,u,d,h,m){var v;_classCallCheck(this,cs);v=_callSuper(this,cs,[i,Ya.buildSpeechKeyVerificationDetails(d),u,h,m]),v.insertKeyPlaceholderText="Azure Speech Subscription Key",v.keyHelpUrl="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal";return v}_inherits(cs,i);return _createClass(cs)}(ia);var Ci=function(i){function yi(i){var u,d,h;var m;_classCallCheck(this,yi);var v,g,y,b,x,A;var P=(g=(v=i.directConnection)==null?void 0:v.azure)==null?void 0:g.textToSpeech,D=(y=i.directConnection)==null?void 0:y.azure;m=_callSuper(this,yi,[i,Ya.buildTextToSpeechHeaders.bind({},(P==null?void 0:P.outputFormat)||"audio-16khz-128kbitrate-mono-mp3"),P.region,D]),m.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Azure Text To Speech</b></div>\n    <p>Insert text to synthesize it to audio.\n    <p>\n      Click <a href="'.concat(yi.HELP_LINK,'">here</a> for more info.\n    </p>'),m.url="",Object.assign(m.rawBody,P),(u=(b=m.rawBody).lang)!==null&&u!==void 0?u:b.lang="en-US",(d=(x=m.rawBody).name)!==null&&d!==void 0?d:x.name="en-US-JennyNeural",(h=(A=m.rawBody).gender)!==null&&h!==void 0?h:A.gender="Female",m.url="https://".concat(P.region,".tts.speech.microsoft.com/cognitiveservices/v1");return m}_inherits(yi,i);return _createClass(yi,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=u[u.length-1].text;if(d)return"<speak version='1.0' xml:lang='".concat(i.lang,"'>\n      <voice xml:lang='").concat(i.lang,"' xml:gender='").concat(i.gender,"' name='").concat(i.name,"'>\n        ").concat(d,"\n      </voice>\n    </speak>")}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee70(i,u){var d;return _regeneratorRuntime().wrap((function _callee70$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u);Xr.request(this,d,i,!1);case 4:case"end":return h.stop()}}),_callee70,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee71(i){return _regeneratorRuntime().wrap((function _callee71$(u){while(1)switch(u.prev=u.next){case 0:return u.abrupt("return",new Promise((function(u){var d=new FileReader;d.readAsDataURL(i),d.onload=function(i){u({files:[{src:i.target.result,type:"audio"}]})}})));case 1:case"end":return u.stop()}}),_callee71)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(ki);Ci.HELP_LINK="https://learn.microsoft.com/en-GB/azure/cognitive-services/speech-service/get-started-text-to-speech?tabs=windows%2Cterminal&pivots=programming-language-rest";var wi=Ci;var Ti=function(i){function Tt(i){var u;_classCallCheck(this,Tt);var d,h,m;var v=(h=(d=i.directConnection)==null?void 0:d.azure)==null?void 0:h.speechToText,g=(m=i.directConnection)==null?void 0:m.azure,y={audio:{files:{acceptedFormats:".wav,.ogg"}}};u=_callSuper(this,Tt,[i,Ya.buildSpeechToTextHeaders,v.region,g,y]),u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>Azure Speech To Text</b></div>\n    <p><b>Upload a .wav or .ogg audio file</b> to transcribe it into text.\n    <p>\n      Click <a href="'.concat(Tt.HELP_LINK,'">here</a> for more info.\n    </p>'),u.url="",u.isTextInputDisabled=!0,u.textInputPlaceholderText="Upload an audio file",u.canSendMessage=Tt.canFileSendMessage;var b=v.lang||"en-US";u.url="https://".concat(v.region,".stt.speech.microsoft.com/speech/recognition/conversation/cognitiveservices/v1?language=").concat(b,"&format=detailed"),u.recordAudio=void 0;return u}_inherits(Tt,i);return _createClass(Tt,[{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee72(i,u,d){var h,m;return _regeneratorRuntime().wrap((function _callee72$(u){while(1)switch(u.prev=u.next){case 0:if((h=this.connectSettings)!=null&&h.headers){u.next=2;break}throw new Error("Request settings have not been set up");case 2:if(d!=null&&d[0]){u.next=4;break}throw new Error("No file was added");case 4:(m=this.connectSettings)!=null&&m.headers&&(this.connectSettings.headers["Content-Type"]=d[0].name.toLocaleLowerCase().endsWith(".wav")?"audio/wav; codecs=audio/pcm; samplerate=16000":"audio/ogg; codecs=opus"),Xr.request(this,d[0],i,!1);case 5:case"end":return u.stop()}}),_callee72,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee73(i){return _regeneratorRuntime().wrap((function _callee73$(u){while(1)switch(u.prev=u.next){case 0:if(!i.error){u.next=2;break}throw i.error;case 2:return u.abrupt("return",{text:i.DisplayText||""});case 3:case"end":return u.stop()}}),_callee73)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"canFileSendMessage",value:function canFileSendMessage(i,u){return!!(u!=null&&u[0])}}])}(ki);Ti.HELP_LINK="https://learn.microsoft.com/en-GB/azure/cognitive-services/speech-service/get-started-text-to-speech?tabs=windows%2Cterminal&pivots=programming-language-rest";var Ai=Ti;var Ri=function(i){function Ao(i){var u;_classCallCheck(this,Ao);var d,h,m;var v=(h=(d=i.directConnection)==null?void 0:d.azure)==null?void 0:h.translation,g=(m=i.directConnection)==null?void 0:m.azure;u=_callSuper(this,Ao,[i,Ya.buildTranslationKeyVerificationDetails(v.region),Ya.buildTranslationHeaders.bind({},v==null?void 0:v.region),g]),u.insertKeyPlaceholderText="Azure Translate Subscription Key",u.keyHelpUrl="https://learn.microsoft.com/en-us/azure/api-management/api-management-subscriptions#create-and-manage-subscriptions-in-azure-portal",u.url="",u.url="https://api.cognitive.microsofttranslator.com/translate?api-version=3.0&to=".concat(v.language||"es");return u}_inherits(Ao,i);return _createClass(Ao,[{key:"preprocessBody",value:function preprocessBody(i){var u=i[i.length-1].text;if(u)return[{Text:u}]}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee74(i,u){var d;return _regeneratorRuntime().wrap((function _callee74$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(u);Xr.request(this,d,i);case 4:case"end":return h.stop()}}),_callee74,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee75(i){var u;return _regeneratorRuntime().wrap((function _callee75$(d){while(1)switch(d.prev=d.next){case 0:if(!Array.isArray(i)){d.next=2;break}return d.abrupt("return",{text:((u=i[0].translations)==null?void 0:u[0].text)||""});case 2:throw i.error;case 3:case"end":return d.stop()}}),_callee75)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(ia);var Ii=function(){function ne(){_classCallCheck(this,ne)}return _createClass(ne,null,[{key:"storeFiles",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee77(i,u,d){var h,m,v,g;return _regeneratorRuntime().wrap((function _callee77$(y){while(1)switch(y.prev=y.next){case 0:h=i.connectSettings.headers;if(h){y.next=3;break}return y.abrupt("return");case 3:i.url="https://api.openai.com/v1/files";m=h[Br.CONTENT_TYPE];delete h[Br.CONTENT_TYPE];v=d.map(function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee76(u){var d;return _regeneratorRuntime().wrap((function _callee76$(h){while(1)switch(h.prev=h.next){case 0:d=new FormData;return h.abrupt("return",(d.append("purpose","assistants"),d.append("file",u),new Promise((function(u){u(Va.directFetch(i,d,"POST",!1))}))));case 2:case"end":return h.stop()}}),_callee76)})));return function(i){return u.apply(this,arguments)}}());y.prev=7;y.next=10;return Promise.all(v);case 10:g=y.sent.map((function(i){return{id:i.id,name:i.filename}}));return y.abrupt("return",(h[Br.CONTENT_TYPE]=m,g));case 14:y.prev=14;y.t0=y.catch(7);throw h[Br.CONTENT_TYPE]=m,Br.displayError(u,y.t0),i.completionsHandlers.onFinish(),y.t0;case 17:case"end":return y.stop()}}),_callee77,null,[[7,14]])})));function storeFiles(u,d,h){return i.apply(this,arguments)}return storeFiles}()},{key:"getType",value:function getType(i,u){var d=i[u].path;return!d||d.endsWith("png")?"image":"any"}},{key:"getFiles",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee78(i,u){var d,h;return _regeneratorRuntime().wrap((function _callee78$(m){while(1)switch(m.prev=m.next){case 0:d=u.map((function(u){var d=u.fileId;return i.url="https://api.openai.com/v1/files/".concat(d,"/content"),new Promise((function(u){u(Va.directFetch(i,void 0,"GET",!1))}))}));m.next=3;return Promise.all(d);case 3:h=m.sent.map((function(i,d){return new Promise((function(h){var m=new FileReader;m.readAsDataURL(i),m.onload=function(i){h({src:i.target.result,name:u[d].name,type:ne.getType(u,d)})}}))}));m.next=6;return Promise.all(h);case 6:return m.abrupt("return",m.sent);case 7:case"end":return m.stop()}}),_callee78)})));function getFiles(u,d){return i.apply(this,arguments)}return getFiles}()},{key:"getFileName",value:function getFileName(i){var u=i.split("/");return u[u.length-1]}},{key:"getFileDetails",value:function getFileDetails(i,u){var d;var h=[];return(d=u==null?void 0:u.text)!=null&&d.value&&i.content.forEach((function(i){var u,d;(d=(u=i.text)==null?void 0:u.annotations)==null||d.forEach((function(i){var u;i.text&&i.text.startsWith("sandbox:")&&!Rr.isImageFile({src:i.text})&&(u=i.file_path)!=null&&u.file_id&&h.push({path:i.text,fileId:i.file_path.file_id,name:ne.getFileName(i.text)})}))})),u!=null&&u.image_file&&h.push({fileId:u.image_file.file_id}),h}},{key:"getFilesAndNewText",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee79(i,u,d,h){var m,v,g;return _regeneratorRuntime().wrap((function _callee79$(y){while(1)switch(y.prev=y.next){case 0:y.t0=u.length>0;if(!y.t0){y.next=6;break}y.next=4;return ne.getFiles(i,u);case 4:g=y.sent;(m=h==null?void 0:h.text)!=null&&m.value&&g.forEach((function(i,d){var m;if(i.src){var v=u[d].path;(m=h==null?void 0:h.text)!=null&&m.value&&v&&(h.text.value=h.text.value.replace(v,i.src))}}));case 6:return y.abrupt("return",{files:g,text:(v=h==null?void 0:h.text)==null?void 0:v.value,role:d});case 7:case"end":return y.stop()}}),_callee79)})));function getFilesAndNewText(u,d,h,m){return i.apply(this,arguments)}return getFilesAndNewText}()},{key:"getFilesAndText",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee80(i,u,d){var h;return _regeneratorRuntime().wrap((function _callee80$(m){while(1)switch(m.prev=m.next){case 0:h=ne.getFileDetails(u,d);m.next=3;return ne.getFilesAndNewText(i,h,u.role,d);case 3:return m.abrupt("return",m.sent);case 4:case"end":return m.stop()}}),_callee80)})));function getFilesAndText(u,d,h){return i.apply(this,arguments)}return getFilesAndText}()},{key:"parseResult",value:function parseResult(i,u){var d=[];if(u)d=i.data;else for(var h=0;h<i.data.length;h+=1){var m=i.data[h];if(m.role!=="assistant")break;d.push(m)}return d.reverse()}},{key:"parseMessages",value:function parseMessages(i,u){var d=[];return u.forEach(function(){var u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee82(u){return _regeneratorRuntime().wrap((function _callee82$(h){while(1)switch(h.prev=h.next){case 0:u.content.filter((function(i){return!!i.text||!!i.image_file})).sort((function(i){return i.text?-1:i.image_file?1:0})).forEach(function(){var h=_asyncToGenerator(_regeneratorRuntime().mark((function _callee81(h){return _regeneratorRuntime().wrap((function _callee81$(m){while(1)switch(m.prev=m.next){case 0:d.push(ne.getFilesAndText(i,u,h));case 1:case"end":return m.stop()}}),_callee81)})));return function(i){return h.apply(this,arguments)}}());case 1:case"end":return h.stop()}}),_callee82)})));return function(i){return u.apply(this,arguments)}}()),Promise.all(d)}},{key:"processStreamMessages",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee83(i,u){return _regeneratorRuntime().wrap((function _callee83$(d){while(1)switch(d.prev=d.next){case 0:return d.abrupt("return",ne.parseMessages(i,[{content:u,role:"assistant"}]));case 1:case"end":return d.stop()}}),_callee83)})));function processStreamMessages(u,d){return i.apply(this,arguments)}return processStreamMessages}()},{key:"processAPIMessages",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee84(i,u,d){var h;return _regeneratorRuntime().wrap((function _callee84$(m){while(1)switch(m.prev=m.next){case 0:h=ne.parseResult(u,d);return m.abrupt("return",ne.parseMessages(i,h));case 2:case"end":return m.stop()}}),_callee84)})));function processAPIMessages(u,d,h){return i.apply(this,arguments)}return processAPIMessages}()}])}();Ii.FILES_WITH_TEXT_ERROR="content with type `text` must have `text` values";var Mi=Ii;var Li=function(i){function L(i){var u,d;var h;_classCallCheck(this,L);var m,v,g,y,b,x;var A=JSON.parse(JSON.stringify(i.directConnection)),P=A.openAI;h=_callSuper(this,L,[i,Va.buildKeyVerificationDetails(),Va.buildHeaders,P]),h.insertKeyPlaceholderText="OpenAI API Key",h.keyHelpUrl="https://platform.openai.com/account/api-keys",h.url="",h.permittedErrorPrefixes=["Incorrect","Please send text"],h.searchedForThreadId=!1,h.config={},h.newAssistantDetails={model:"gpt-4"},h.shouldFetchHistory=!1,h.waitingForStreamResponse=!1,h.isSSEStream=!1;var D=(m=A.openAI)==null?void 0:m.assistant;if(_typeof(D)=="object"){h.config=D;var q=h.config,V=q.new_assistant,J=q.thread_id,X=q.load_thread_history;Object.assign(h.newAssistantDetails,V),J&&(h.sessionId=J),X&&(h.shouldFetchHistory=!0);var oe=(g=(v=i.directConnection)==null?void 0:v.openAI)==null?void 0:g.assistant,pe=oe.function_handler;pe&&(h._functionHandler=pe),h.filesToolType=D.files_tool_type}else(y=A.openAI)!=null&&y.assistant&&(A.openAI.assistant=D);(u=(b=h.connectSettings).headers)!==null&&u!==void 0?u:b.headers={},(d=(x=h.connectSettings.headers)["OpenAI-Beta"])!==null&&d!==void 0?d:x["OpenAI-Beta"]="assistants=v2",h.maxMessages=1,h.isSSEStream=!!(h.stream&&(_typeof(h.stream)!="object"||!h.stream.simulation)),h.shouldFetchHistory&&h.sessionId&&(h.fetchHistory=h.fetchHistoryFunc.bind(h));return h}_inherits(L,i);return _createClass(L,[{key:"fetchHistoryFunc",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee85(){var i=this;var u;return _regeneratorRuntime().wrap((function _callee85$(d){while(1)switch(d.prev=d.next){case 0:setTimeout((function(){return i.deepChat.disableSubmitButton()}),2);d.prev=1;d.next=4;return this.getThreadMessages(this.sessionId,!0);case 4:u=d.sent;return d.abrupt("return",(this.deepChat.disableSubmitButton(!1),u.reverse()));case 8:d.prev=8;d.t0=d.catch(1);return d.abrupt("return",[{error:"failed to fetch thread history"}]);case 11:case"end":return d.stop()}}),_callee85,this,[[1,8]])})));function fetchHistoryFunc(){return i.apply(this,arguments)}return fetchHistoryFunc}()},{key:"processMessage",value:function processMessage(i,u){var d=this.totalMessagesMaxCharLength||-1,h=Qr.getCharacterLimitMessages(i,d)[0];if(u&&u.length>0){var m=this.filesToolType;if(typeof this.filesToolType=="function"){var v=this.filesToolType(u.map((function(i){var u=i.name;return u})));v==="code_interpreter"||v==="file_search"||v==="images"?m=v:(console.error('Tool type "'.concat(v,'" is not valid')),console.error('Expected "code_interpreter" or "file_search" or "images". Going to default to "images"'))}if(m==="file_search")return L.processAttachmentsMessage(h,u,"file_search");if(m==="code_interpreter")return L.processAttachmentsMessage(h,u,"code_interpreter");if(u.find((function(i){var u=i.name;return!Rr.isImageFileExtension(u)})))console.error("The uploaded files contained a non-image file"),console.error('Make sure only images can be uploaded or define a "code_interpreter" or "file_search" value in the "files_tool_type" property'),console.warn('Make sure your existing assistant supports these "tools" or specify them in the "new_assistant" property');else{var g=L.processImageMessage(h,u);if(g)return g}}return{content:h.text||"",role:"user"}}},{key:"createNewThreadMessages",value:function createNewThreadMessages(i,u,d){var h=JSON.parse(JSON.stringify(i)),m=this.processMessage(u,d);return h.thread={messages:[m]},h}},{key:"callService",value:function callService(i,u,d){if(this.messages=i,this.sessionId){this.url="".concat(L.THREAD_PREFIX,"/").concat(this.sessionId,"/messages");var h=this.processMessage(u,d);Xr.request(this,h,i)}else{this.url="".concat(L.THREAD_PREFIX,"/runs");var m=this.createNewThreadMessages(this.rawBody,u,d);this.isSSEStream?this.createStreamRun(m):Xr.request(this,m,i)}}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee86(i,u,d){var h;var m,v;return _regeneratorRuntime().wrap((function _callee86$(g){while(1)switch(g.prev=g.next){case 0:if(!(this.waitingForStreamResponse=!1,!this.connectSettings)){g.next=2;break}throw new Error("Request settings have not been set up");case 2:if(!((h=(m=this.rawBody).assistant_id)!==null&&h!==void 0)){g.next=6;break}h;g.next=12;break;case 6:g.t0=this.config.assistant_id;if(g.t0){g.next=11;break}g.next=10;return this.createNewAssistant();case 10:g.t0=g.sent;case 11:m.assistant_id=g.t0;case 12:this.streamedMessageId=void 0;this.searchedForThreadId||this.searchPreviousMessagesForThreadId(i.messages);if(!d){g.next=20;break}g.next=17;return Mi.storeFiles(this,i,d);case 17:g.t1=g.sent;g.next=21;break;case 20:g.t1=void 0;case 21:v=g.t1;this.connectSettings.method="POST",this.callService(i,u,v);case 23:case"end":return g.stop()}}),_callee86,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"createNewAssistant",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee87(){var i;return _regeneratorRuntime().wrap((function _callee87$(u){while(1)switch(u.prev=u.next){case 0:u.prev=0;this.url=L.NEW_ASSISTANT_URL;u.next=4;return Va.directFetch(this,JSON.parse(JSON.stringify(this.newAssistantDetails)),"POST");case 4:i=u.sent;return u.abrupt("return",(this.config.assistant_id=i.id,this.config.assistant_id));case 8:u.prev=8;u.t0=u.catch(0);console.error(u.t0),console.error("Failed to create a new assistant");case 11:case"end":return u.stop()}}),_callee87,this,[[0,8]])})));function createNewAssistant(){return i.apply(this,arguments)}return createNewAssistant}()},{key:"searchPreviousMessagesForThreadId",value:function searchPreviousMessagesForThreadId(i){var u=i.find((function(i){return i._sessionId}));u&&(this.sessionId=u._sessionId),this.searchedForThreadId=!0}},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee88(i){var u,d,h;return _regeneratorRuntime().wrap((function _callee88$(m){while(1)switch(m.prev=m.next){case 0:if(!(this.waitingForStreamResponse||this.isSSEStream&&this.sessionId)){m.next=4;break}m.next=3;return this.handleStream(i);case 3:return m.abrupt("return",m.sent);case 4:if(!i.error){m.next=6;break}throw i.error.message.startsWith(Mi.FILES_WITH_TEXT_ERROR)?Error("Please send text with your file(s)"):i.error.message;case 6:m.next=8;return this.assignThreadAndRun(i);case 8:d="".concat(L.THREAD_PREFIX,"/").concat(this.sessionId,"/runs/").concat(this.run_id),h={method:"GET",headers:(u=this.connectSettings)==null?void 0:u.headers};return m.abrupt("return",(Xr.executePollRequest(this,d,h,this.messages),{makingAnotherRequest:!0}));case 10:case"end":return m.stop()}}),_callee88,this)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()},{key:"assignThreadAndRun",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee89(i){var u;return _regeneratorRuntime().wrap((function _callee89$(d){while(1)switch(d.prev=d.next){case 0:if(!this.sessionId){d.next=8;break}this.url="".concat(L.THREAD_PREFIX,"/").concat(this.sessionId,"/runs");d.next=4;return Va.directFetch(this,JSON.parse(JSON.stringify(this.rawBody)),"POST");case 4:u=d.sent;this.run_id=u.id;d.next=9;break;case 8:this.sessionId=i.thread_id,this.run_id=i.id,this.messages&&(this.messages.messages[this.messages.messages.length-1]._sessionId=this.sessionId);case 9:case"end":return d.stop()}}),_callee89,this)})));function assignThreadAndRun(u){return i.apply(this,arguments)}return assignThreadAndRun}()},{key:"getThreadMessages",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee90(i){var u,d,h,m,v=arguments;return _regeneratorRuntime().wrap((function _callee90$(g){while(1)switch(g.prev=g.next){case 0:u=v.length>1&&v[1]!==void 0&&v[1];this.url="".concat(L.THREAD_PREFIX,"/").concat(i,"/messages");g.next=4;return Va.directFetch(this,{},"GET");case 4:m=g.sent;g.t0=!u&&this.deepChat.responseInterceptor;if(!g.t0){g.next=10;break}g.next=9;return(h=(d=this.deepChat).responseInterceptor)==null?void 0:h.call(d,m);case 9:m=g.sent;case 10:return g.abrupt("return",Mi.processAPIMessages(this,m,u));case 11:case"end":return g.stop()}}),_callee90,this)})));function getThreadMessages(u){return i.apply(this,arguments)}return getThreadMessages}()},{key:"extractPollResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee91(i){var u=this;var d,h,m,v,g,y,b,x;return _regeneratorRuntime().wrap((function _callee91$(A){while(1)switch(A.prev=A.next){case 0:h=i.status,m=i.required_action;if(!(h==="queued"||h==="in_progress")){A.next=3;break}return A.abrupt("return",{timeoutMS:L.POLLING_TIMEOUT_MS});case 3:if(!(h==="completed"&&this.messages)){A.next=11;break}A.next=6;return this.getThreadMessages(i.thread_id);case 6:v=A.sent;g=v.shift();y=g.text;b=g.files;return A.abrupt("return",(setTimeout((function(){v.forEach((function(i){return u.deepChat.addMessage(i)}))})),{text:y,_sessionId:this.sessionId,files:b}));case 11:x=(d=m==null?void 0:m.submit_tool_outputs)==null?void 0:d.tool_calls;if(!(h==="requires_action"&&x)){A.next=16;break}A.next=15;return this.handleTools(x);case 15:return A.abrupt("return",A.sent);case 16:throw Error("Thread run status: ".concat(h));case 17:case"end":return A.stop()}}),_callee91,this)})));function extractPollResultData(u){return i.apply(this,arguments)}return extractPollResultData}()},{key:"handleTools",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee92(i){var u,d,h;return _regeneratorRuntime().wrap((function _callee92$(m){while(1)switch(m.prev=m.next){case 0:if(this._functionHandler){m.next=2;break}throw Error("Please define the `function_handler` property inside the [openAI](https://deepchat.dev/docs/directConnection/openAI#Assistant) object.");case 2:u=i.map((function(i){return{name:i.function.name,arguments:i.function.arguments}}));m.next=5;return this._functionHandler(u);case 5:d=m.sent;if(!(!Array.isArray(d)||d.find((function(i){return typeof i!="string"}))||i.length!==d.length)){m.next=8;break}throw Error("Response must contain an array of strings for each individual function/tool_call, see https://deepchat.dev/docs/directConnection/OpenAI/#assistant-functions.");case 8:h=d.map((function(u,d){return{tool_call_id:i[d].id,output:u}}));this.url="".concat(L.THREAD_PREFIX,"/").concat(this.sessionId,"/runs/").concat(this.run_id,"/submit_tool_outputs");if(!this.isSSEStream){m.next=15;break}m.next=13;return this.createStreamRun({tool_outputs:h});case 13:m.next=17;break;case 15:m.next=17;return Va.directFetch(this,{tool_outputs:h},"POST");case 17:return m.abrupt("return",{timeoutMS:L.POLLING_TIMEOUT_MS});case 18:case"end":return m.stop()}}),_callee92,this)})));function handleTools(u){return i.apply(this,arguments)}return handleTools}()},{key:"handleStream",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee93(i){var u,d,h,m;return _regeneratorRuntime().wrap((function _callee93$(v){while(1)switch(v.prev=v.next){case 0:h=(d=(u=i.required_action)==null?void 0:u.submit_tool_outputs)==null?void 0:d.tool_calls;if(!(i.status==="requires_action"&&h)){v.next=6;break}this.run_id=i.id;v.next=5;return this.handleTools(h);case 5:return v.abrupt("return",v.sent);case 6:if(!this.waitingForStreamResponse){v.next=8;break}return v.abrupt("return",this.parseStreamResult(i));case 8:if(this.isSSEStream&&this.sessionId){this.url="".concat(L.THREAD_PREFIX,"/").concat(this.sessionId,"/runs");m=JSON.parse(JSON.stringify(this.rawBody));this.createStreamRun(m)}return v.abrupt("return",{makingAnotherRequest:!0});case 10:case"end":return v.stop()}}),_callee93,this)})));function handleStream(u){return i.apply(this,arguments)}return handleStream}()},{key:"parseStreamResult",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee94(i){var u,d,h,m,v,g,y,b,x,A;return _regeneratorRuntime().wrap((function _callee94$(P){while(1)switch(P.prev=P.next){case 0:if(!(i.content&&i.content.length>0&&this.messages)){P.next=5;break}y=i.content.find((function(i){return i.text}));if(!((u=y==null?void 0:y.text)!=null&&u.annotations&&y.text.annotations.length>0)){P.next=5;break}b=Mi.getFilesAndText.bind(this,this,{role:"assistant",content:i.content},i.content[0]);return P.abrupt("return",((d=this.messageStream)==null||d.endStreamAfterFileDownloaded(this.messages,b),{text:""}));case 5:if(!((h=i.delta)!=null&&h.content)){P.next=14;break}if(!(this.streamedMessageId?this.streamedMessageId!==i.id&&(this.streamedMessageId=i.id,(m=this.messageStream)==null||m.newMessage()):this.streamedMessageId=i.id,i.delta.content.length>1)){P.next=13;break}x=i.delta.content.find((function(i){return i.text}));if(!((v=x==null?void 0:x.text)!=null&&v.annotations&&x.text.annotations.length===0)){P.next=13;break}P.next=11;return Mi.processStreamMessages(this,i.delta.content);case 11:A=P.sent;return P.abrupt("return",{text:A[0].text,files:A[1].files});case 13:return P.abrupt("return",{text:(g=i.delta.content[0].text)==null?void 0:g.value});case 14:return P.abrupt("return",(!this.sessionId&&i.thread_id&&(this.sessionId=i.thread_id),{makingAnotherRequest:!0}));case 15:case"end":return P.stop()}}),_callee94,this)})));function parseStreamResult(u){return i.apply(this,arguments)}return parseStreamResult}()},{key:"createStreamRun",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee95(i){return _regeneratorRuntime().wrap((function _callee95$(u){while(1)switch(u.prev=u.next){case 0:i.stream=!0;this.waitingForStreamResponse=!0;u.next=4;return qr.request(this,i,this.messages,!0,!0);case 4:this.messageStream=u.sent;case 5:case"end":return u.stop()}}),_callee95,this)})));function createStreamRun(u){return i.apply(this,arguments)}return createStreamRun}()}],[{key:"processImageMessage",value:function processImageMessage(i,u){var d=u==null?void 0:u.filter((function(i){return Rr.isImageFileExtension(i.name)})).map((function(i){return{type:"image_file",image_file:{file_id:i.id}}}));if(d&&d.length>0)return i.text&&i.text.length>0&&d.push({type:"text",text:i.text}),{content:d,role:"user"}}},{key:"processAttachmentsMessage",value:function processAttachmentsMessage(i,u,d){return{attachments:u.map((function(i){return{tools:[{type:d}],file_id:i.id}})),content:[{type:"text",text:i.text}],role:"user"}}}])}(ia);Li.THREAD_PREFIX="https://api.openai.com/v1/threads",Li.NEW_ASSISTANT_URL="https://api.openai.com/v1/assistants",Li.POLLING_TIMEOUT_MS=800;var Oi=Li;var Pi=function(i){function ce(i){var u;_classCallCheck(this,ce);var d;var h=i.directConnection,m=h==null?void 0:h.openAI,v={images:{files:{acceptedFormats:".png",maxNumberOfFiles:2}}};u=_callSuper(this,ce,[i,Va.buildKeyVerificationDetails(),Va.buildHeaders,m,v]),u.insertKeyPlaceholderText="OpenAI API Key",u.keyHelpUrl="https://platform.openai.com/account/api-keys",u.introPanelMarkUp='\n    <div style="width: 100%; text-align: center; margin-left: -10px"><b>OpenAI DALLE</b></div>\n    <p><b>Insert text</b> to generate an image.</p>\n    <p><b>Upload 1</b> PNG image to generate its variation and optionally insert text to specify the change.</p>\n    <p><b>Upload 2</b> PNG images where the second is a copy of the first with a transparent area where the edit should\n      take place and text to specify the edit.</p>\n    <p>Click <a href="https://platform.openai.com/docs/guides/images/introduction">here</a> for more info.</p>',u.url="",u.permittedErrorPrefixes=["Incorrect","Invalid input image"];var g=(d=h==null?void 0:h.openAI)==null?void 0:d.images;if(u.camera){var y=_typeof(g)=="object"&&g.size?Number.parseInt(g.size):1024;u.camera.files={dimensions:{width:y,height:y}}}_typeof(g)=="object"&&Object.assign(u.rawBody,g),u.canSendMessage=ce.canFileSendMessage;return u}_inherits(ce,i);return _createClass(ce,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=JSON.parse(JSON.stringify(i));return u&&u!==""&&(d.prompt=u),d}},{key:"callApiWithImage",value:function callApiWithImage(i,u,d){var h,m;var v;var g=(m=(h=u[u.length-1])==null?void 0:h.text)==null?void 0:m.trim();if(d[1]||g&&g!==""){this.url=ce.IMAGE_EDIT_URL;var y=this.preprocessBody(this.rawBody,g);v=ce.createFormDataBody(y,d[0],d[1])}else this.url=ce.IMAGE_VARIATIONS_URL,v=ce.createFormDataBody(this.rawBody,d[0]);Br.tempRemoveContentHeader(this.connectSettings,Xr.request.bind(this,this,v,i),!1)}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee96(i,u,d){var h,m;return _regeneratorRuntime().wrap((function _callee96$(v){while(1)switch(v.prev=v.next){case 0:if((h=this.connectSettings)!=null&&h.headers){v.next=2;break}throw new Error("Request settings have not been set up");case 2:if(!(d!=null&&d[0])){v.next=6;break}this.callApiWithImage(i,u,d);v.next=11;break;case 6:if(this.connectSettings){v.next=8;break}throw new Error("Request settings have not been set up");case 8:this.url=ce.IMAGE_GENERATION_URL;m=this.preprocessBody(this.rawBody,u[u.length-1].text);Xr.request(this,m,i);case 11:case"end":return v.stop()}}),_callee96,this)})));function callServiceAPI(u,d,h){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee97(i){return _regeneratorRuntime().wrap((function _callee97$(u){while(1)switch(u.prev=u.next){case 0:if(!i.error){u.next=2;break}throw i.error.message;case 2:return u.abrupt("return",{files:i.data.map((function(i){return i.url?{src:i.url,type:"image"}:{src:"".concat(Ta).concat(i.b64_json),type:"image"}}))});case 3:case"end":return u.stop()}}),_callee97)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}],[{key:"canFileSendMessage",value:function canFileSendMessage(i,u){return!!(u!=null&&u[0])||!!(i&&i.trim()!=="")}},{key:"createFormDataBody",value:function createFormDataBody(i,u,d){var h=new FormData;return h.append("image",u),d&&h.append("mask",d),Object.keys(i).forEach((function(u){h.append(u,String(i[u]))})),h}}])}(ia);Pi.IMAGE_GENERATION_URL="https://api.openai.com/v1/images/generations",Pi.IMAGE_VARIATIONS_URL="https://api.openai.com/v1/images/variations",Pi.IMAGE_EDIT_URL="https://api.openai.com/v1/images/edits";var Ni=Pi;var Di=function(i){function xt(i){var u,d;var h;_classCallCheck(this,xt);var m,v,g,y;var b=JSON.parse(JSON.stringify(i.directConnection)),x=b.openAI;h=_callSuper(this,xt,[i,Va.buildKeyVerificationDetails(),Va.buildHeaders,x]),h.insertKeyPlaceholderText="OpenAI API Key",h.keyHelpUrl="https://platform.openai.com/account/api-keys",h.url="https://api.openai.com/v1/chat/completions",h.permittedErrorPrefixes=["Incorrect"],h.asyncCallInProgress=!1,h._systemMessage=xt.generateSystemMessage("You are a helpful assistant.");var A=(m=b.openAI)==null?void 0:m.chat;if(_typeof(A)=="object"){A.system_prompt&&(h._systemMessage=xt.generateSystemMessage(A.system_prompt));var P=(g=(v=i.directConnection)==null?void 0:v.openAI)==null?void 0:g.chat,D=P.function_handler;D&&(h._functionHandler=D),h.cleanConfig(A),Object.assign(h.rawBody,A)}(u=h.maxMessages)!==null&&u!==void 0?u:h.maxMessages=-1,(d=(y=h.rawBody).model)!==null&&d!==void 0?d:y.model="gpt-4o";return h}_inherits(xt,i);return _createClass(xt,[{key:"cleanConfig",value:function cleanConfig(i){delete i.system_prompt,delete i.function_handler}},{key:"preprocessBody",value:function preprocessBody(i,u){var d;var h=JSON.parse(JSON.stringify(i)),m=Qr.getCharacterLimitMessages(u,this.totalMessagesMaxCharLength?this.totalMessagesMaxCharLength-this._systemMessage.content.length:-1).map((function(i){return{content:xt.getContent(i),role:i.role===Qe.USER_ROLE?"user":"assistant"}}));return u.find((function(i){return i.files&&i.files.length>0}))&&((d=h.max_tokens)!==null&&d!==void 0?d:h.max_tokens=300),h.messages=[this._systemMessage].concat(_toConsumableArray(m)),h}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee98(i,u){var d,h;return _regeneratorRuntime().wrap((function _callee98$(m){while(1)switch(m.prev=m.next){case 0:if(this.connectSettings){m.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u),h=this.stream;h&&(_typeof(h)!="object"||!h.simulation)||d.stream?(d.stream=!0,qr.request(this,d,i)):Xr.request(this,d,i);case 4:case"end":return m.stop()}}),_callee98,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee99(i,u,d){var h,m,v,g;return _regeneratorRuntime().wrap((function _callee99$(y){while(1)switch(y.prev=y.next){case 0:if(!i.error){y.next=2;break}throw i.error.message;case 2:return y.abrupt("return",(m=(h=i.choices)==null?void 0:h[0])!=null&&m.delta?this.extractStreamResult(i.choices[0],u,d):(g=(v=i.choices)==null?void 0:v[0])!=null&&g.message?i.choices[0].message.tool_calls?this.handleTools(i.choices[0].message,u,d):{text:i.choices[0].message.content}:{text:""});case 3:case"end":return y.stop()}}),_callee99,this)})));function extractResultData(u,d,h){return i.apply(this,arguments)}return extractResultData}()},{key:"extractStreamResult",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee100(i,u,d){var h=this;var m,v,g;return _regeneratorRuntime().wrap((function _callee100$(y){while(1)switch(y.prev=y.next){case 0:m=i.delta,v=i.finish_reason;if(!(v==="tool_calls")){y.next=7;break}this.asyncCallInProgress=!0;g={tool_calls:this._streamToolCalls};return y.abrupt("return",(this._streamToolCalls=void 0,this.handleTools(g,u,d)));case 7:m!=null&&m.tool_calls&&(this._streamToolCalls?m.tool_calls.forEach((function(i,u){h._streamToolCalls&&(h._streamToolCalls[u].function.arguments+=i.function.arguments)})):this._streamToolCalls=m.tool_calls);case 8:return y.abrupt("return",{text:(m==null?void 0:m.content)||""});case 9:case"end":return y.stop()}}),_callee100,this)})));function extractStreamResult(u,d,h){return i.apply(this,arguments)}return extractStreamResult}()},{key:"handleTools",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee101(i,u,d){var h,m,v,g,y,b,x,A,P,D;return _regeneratorRuntime().wrap((function _callee101$(q){while(1)switch(q.prev=q.next){case 0:if(!(!i.tool_calls||!u||!d||!this._functionHandler)){q.next=2;break}throw Error("Please define the `function_handler` property inside the [openAI](https://deepchat.dev/docs/directConnection/openAI#Chat) object.");case 2:b=JSON.parse(JSON.stringify(d));x=i.tool_calls.map((function(i){return{name:i.function.name,arguments:i.function.arguments}}));q.next=6;return(h=this._functionHandler)==null?void 0:h.call(this,x);case 6:A=q.sent;if(!A.text){q.next=15;break}P={text:A.text};q.next=11;return(v=(m=this.deepChat).responseInterceptor)==null?void 0:v.call(m,P);case 11:q.t0=q.sent;if(q.t0){q.next=14;break}q.t0=P;case 14:return q.abrupt("return",q.t0);case 15:if(!(b.messages.push({tool_calls:i.tool_calls,role:"assistant",content:null}),Array.isArray(A)&&!A.find((function(i){return typeof i!="string"}))||x.length===A.length)){q.next=35;break}A.forEach((function(u,d){var h;var m=(h=i.tool_calls)==null?void 0:h[d];b==null||b.messages.push({role:"tool",tool_call_id:m==null?void 0:m.id,name:m==null?void 0:m.function.name,content:u.response})})),delete b.tools,delete b.tool_choice,delete b.stream;q.prev=17;q.next=20;return u==null?void 0:u(b).then((function(i){return Br.processResponseByType(i)}));case 20:D=q.sent;q.next=23;return(y=(g=this.deepChat).responseInterceptor)==null?void 0:y.call(g,D);case 23:q.t1=q.sent;if(q.t1){q.next=26;break}q.t1=D;case 26:D=q.t1;if(!D.error){q.next=29;break}throw D.error.message;case 29:return q.abrupt("return",{text:D.choices[0].message.content||""});case 32:q.prev=32;q.t2=q.catch(17);throw this.asyncCallInProgress=!1,q.t2;case 35:throw Error("Response object must either be {response: string}[] for each individual function or {text: string} for a direct response, see https://deepchat.dev/docs/directConnection/OpenAI#FunctionHandler.");case 36:case"end":return q.stop()}}),_callee101,this,[[17,32]])})));function handleTools(u,d,h){return i.apply(this,arguments)}return handleTools}()}],[{key:"generateSystemMessage",value:function generateSystemMessage(i){return{role:"system",content:i}}},{key:"getContent",value:function getContent(i){if(i.files&&i.files.length>0){var u=i.files.map((function(i){return{type:"image_url",image_url:{url:i.src}}}));return i.text&&i.text.trim().length>0&&u.unshift({type:"text",text:i.text}),u}return i.text}}])}(ia);var Bi=function(i){function Mo(i){var u;var d;_classCallCheck(this,Mo);var h;var m=JSON.parse(JSON.stringify(i.directConnection)),v=(h=m.cohere)==null?void 0:h.chat,g=m.cohere;d=_callSuper(this,Mo,[i,"https://api.cohere.ai/v1/chat","Ask me anything!",v,g]),_typeof(v)=="object"&&Object.assign(d.rawBody,v),(u=d.maxMessages)!==null&&u!==void 0?u:d.maxMessages=-1;return d}_inherits(Mo,i);return _createClass(Mo,[{key:"preprocessBody",value:function preprocessBody(i,u){var d=JSON.parse(JSON.stringify(i)),h=u.filter((function(i){return i.text}));return d.query=h[h.length-1].text,d.chat_history=h.slice(0,h.length-1).map((function(i){return{text:i.text,user_name:i.role==="ai"?"CHATBOT":"USER"}})),d}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee102(i,u){var d;return _regeneratorRuntime().wrap((function _callee102$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u);Xr.request(this,d,i);case 4:case"end":return h.stop()}}),_callee102,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee103(i){return _regeneratorRuntime().wrap((function _callee103$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{text:i.text});case 3:case"end":return u.stop()}}),_callee103)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(Ga);var Ui=function(){function ci(){_classCallCheck(this,ci)}return _createClass(ci,null,[{key:"buildHeaders",value:function buildHeaders(i){return{Authorization:"Bearer ".concat(i),"Content-Type":"application/json",accept:"application/json"}}},{key:"handleVerificationResult",value:function handleVerificationResult(i,u,d,h){var m;(m=i.message)!=null&&m.includes("invalid request: prompt must be at least 1 token long")?d(u):h(oe.INVALID_KEY)}},{key:"buildKeyVerificationDetails",value:function buildKeyVerificationDetails(){return{url:"https://api.mistral.ai/v1/models",method:"GET",handleVerificationResult:ci.handleVerificationResult}}}])}();var Hi=function(i){function Ro(i){var u,d;var h;_classCallCheck(this,Ro);var m;var v=JSON.parse(JSON.stringify(i.directConnection)).mistral;h=_callSuper(this,Ro,[i,Ui.buildKeyVerificationDetails(),Ui.buildHeaders,v]),h.insertKeyPlaceholderText="Mistral API Key",h.keyHelpUrl="https://console.mistral.ai/api-keys/",h.url="https://api.mistral.ai/v1/chat/completions",h.permittedErrorPrefixes=["invalid"],v&&(h.cleanConfig(v),Object.assign(h.rawBody,v)),(u=h.maxMessages)!==null&&u!==void 0?u:h.maxMessages=-1,(d=(m=h.rawBody).model)!==null&&d!==void 0?d:m.model="open-mistral-7b";return h}_inherits(Ro,i);return _createClass(Ro,[{key:"cleanConfig",value:function cleanConfig(i){delete i.key}},{key:"preprocessBody",value:function preprocessBody(i,u){var d=JSON.parse(JSON.stringify(i)),h=u.filter((function(i){return i.text}));return d.messages=h.slice(0,h.length-1).map((function(i){return{text:i.text,user_name:i.role==="ai"?"system":"user"}})),d}},{key:"callServiceAPI",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee104(i,u){var d;return _regeneratorRuntime().wrap((function _callee104$(h){while(1)switch(h.prev=h.next){case 0:if(this.connectSettings){h.next=2;break}throw new Error("Request settings have not been set up");case 2:d=this.preprocessBody(this.rawBody,u);Xr.request(this,d,i);case 4:case"end":return h.stop()}}),_callee104,this)})));function callServiceAPI(u,d){return i.apply(this,arguments)}return callServiceAPI}()},{key:"extractResultData",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee105(i){return _regeneratorRuntime().wrap((function _callee105$(u){while(1)switch(u.prev=u.next){case 0:if(!i.message){u.next=2;break}throw i.message;case 2:return u.abrupt("return",{text:i.text});case 3:case"end":return u.stop()}}),_callee105)})));function extractResultData(u){return i.apply(this,arguments)}return extractResultData}()}])}(ia);var Gi=function(){function Io(){_classCallCheck(this,Io)}return _createClass(Io,null,[{key:"create",value:function create(i){var u=i.directConnection,d=i.connect,h=i.demo,m=i.webModel;if(m)return new ba(i);if(u){if(u.openAI)return u.openAI.images?new Ni(i):u.openAI.speechToText?new Ja(i):u.openAI.textToSpeech?new Ka(i):u.openAI.assistant?new Oi(i):new Di(i);if(u.assemblyAI)return new ii(i);if(u.cohere)return u.cohere.textGeneration?new qa(i):u.cohere.summarization?new za(i):new Bi(i);if(u.huggingFace)return u.huggingFace.textGeneration?new Oa(i):u.huggingFace.summarization?new Na(i):u.huggingFace.translation?new Ba(i):u.huggingFace.fillMask?new Ua(i):u.huggingFace.questionAnswer?new Pa(i):u.huggingFace.audioSpeechRecognition?new La(i):u.huggingFace.audioClassification?new wa(i):u.huggingFace.imageClassification?new Ea(i):new Fa(i);if(u.azure){if(u.azure.speechToText)return new Ai(i);if(u.azure.textToSpeech)return new wi(i);if(u.azure.summarization)return new Xa(i);if(u.azure.translation)return new Ri(i)}if(u.stabilityAI)return u.stabilityAI.imageToImage?new Da(i):u.stabilityAI.imageToImageUpscale?new Ia(i):u.stabilityAI.imageToImageMasking?new Ma(i):new ja(i);if(u.mistral)return new Hi(i)}return!d||h&&d.stream?new na(i,void 0,h||!0):new na(i)}}])}();var qi=_createClass((function xn(){_classCallCheck(this,xn)}));qi.attibutes={string:function string(i){return i},number:function number(i){return parseFloat(i)},boolean:function boolean(i){return i==="true"},object:function object(i){return JSON.parse(i)},array:function array(i){return JSON.parse(i)},function:function _function(i){return new Function("return ".concat(i))()}};var zi=qi;function _(i){return function(u,d){Object.defineProperty(u,d,{});var h=u.constructor,m=d.toLocaleLowerCase();h._attributes_[m]=zi.attibutes[i],h._attributeToProperty_[m]=d}}var Vi=function(){function mn(){_classCallCheck(this,mn)}return _createClass(mn,null,[{key:"colorToHex",value:function colorToHex(i){var u=document.createElement("div");return u.style.color=i,document.body.appendChild(u),"#".concat(window.getComputedStyle(u).color.match(/\d+/g).map((function(i){return parseInt(i).toString(16).padStart(2,"0")})).join(""))}},{key:"set",value:function set(i,u){var d,h,m,v;if((h=(d=u==null?void 0:u.loading)==null?void 0:d.bubble)!=null&&h.color){var g=mn.colorToHex((v=(m=u==null?void 0:u.loading)==null?void 0:m.bubble)==null?void 0:v.color);i.style.setProperty("--message-dots-color",g),i.style.setProperty("--message-dots-color-fade","".concat(g,"33"))}else i.style.setProperty("--message-dots-color","#848484"),i.style.setProperty("--message-dots-color-fade","#55555533")}}])}();var Wi=function(){function di(i,u,d){_classCallCheck(this,di);this._isDisplayed=!1,i?(this._elementRef=this.createIntroPanelWithChild(i,d),this._isDisplayed=!0):u&&(this._elementRef=this.createInternalIntroPanel(u,d),this._isDisplayed=!0)}return _createClass(di,[{key:"createIntroPanelWithChild",value:function createIntroPanelWithChild(i,u){var d=di.createIntroPanel(u);return i.style.display==="none"&&(i.style.display="block"),d.appendChild(i),d}},{key:"createInternalIntroPanel",value:function createInternalIntroPanel(i,u){var d=di.createIntroPanel(u);return d.id="internal-intro-panel",d.innerHTML=i,d}},{key:"hide",value:function hide(){this._isDisplayed&&this._elementRef&&(this._elementRef.style.display="none",this._isDisplayed=!1)}},{key:"display",value:function display(){!this._isDisplayed&&this._elementRef&&(this._elementRef.style.display="",this._isDisplayed=!0)}}],[{key:"createIntroPanel",value:function createIntroPanel(i){var u=document.createElement("div");return u.classList.add("intro-panel"),Object.assign(u.style,i),u}}])}();var $i=function(){function Lo(){_classCallCheck(this,Lo)}return _createClass(Lo,null,[{key:"getText",value:function getText(i,u){var d;if(!i.directConnection&&!i.connect&&!i.webModel&&!i.demo)return"Connect to any API using the [connect](https://deepchat.dev/docs/connect#connect-1) property or a popular service via [directConnection](https://deepchat.dev/docs/directConnection/#directConnection).\n Host AI entirely on your browser via a [webModel](https://deepchat.dev/docs/webModel).\n To get started checkout the [Start](https://deepchat.dev/start) page and live code [examples](https://deepchat.dev/examples/frameworks).\n To remove this message set the [demo](https://deepchat.dev/docs/demo#demo) property to true.";if(i.directConnection){if(!u.isDirectConnection())return"Please define a valid service inside\n          the [directConnection](https://deepchat.dev/docs/directConnection/#directConnection) object.";var h=(d=i.directConnection.openAI)==null?void 0:d.chat;if(_typeof(h)=="object"&&h.tools&&!h.function_handler)return"Please define the `function_handler` property inside the openAI [chat](https://deepchat.dev/docs/directConnection/openAI#Chat) object."}else if(i.connect&&!i.connect.url&&!i.connect.handler)return i.demo?i.connect.stream?null:"When [demo](https://deepchat.dev/docs/demo) mode is enabled - the [connect](https://deepchat.dev/docs/connect#connect-1) object can only accept the [stream](https://deepchat.dev/docs/connect#Stream) property.":"Please define a `url` or a `handler` property inside the [connect](https://deepchat.dev/docs/connect#connect-1) object.";return null}}])}();var Yi='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \n\t viewBox="50 30 420 450" xml:space="preserve">\n<g filter="brightness(0) saturate(100%) invert(16%) sepia(0%) saturate(1942%) hue-rotate(215deg) brightness(99%) contrast(93%)">\n\t<g>\n\t\t<path d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008\n\t\t\tC350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237\n\t\t\th333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931\n\t\t\tl50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278\n\t\t\tc-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239\n\t\t\th66.527V486.763z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/>\n\t</g>\n</g>\n<g>\n\t<g>\n\t\t<path d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256\n\t\t\tc6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/>\n\t</g>\n</g>\n</svg>';var Zi=function(){function ke(){_classCallCheck(this,ke)}return _createClass(ke,null,[{key:"createImage",value:function createImage(i,u){var d=new Image;return d.src=i.src,Rr.scrollDownOnImageLoad(d.src,u),Rr.processContent("image",d,d.src,i.name)}},{key:"addNewImageMessage",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee106(i,u,d){var h,m;return _regeneratorRuntime().wrap((function _callee106$(v){while(1)switch(v.prev=v.next){case 0:h=ke.createImage(u,i.elementRef),m=i.createNewMessageElement("",d);m.bubbleElement.appendChild(h),m.bubbleElement.classList.add("image-message"),Rr.addMessage(i,m,"image",d);case 2:case"end":return v.stop()}}),_callee106)})));function addNewImageMessage(u,d,h){return i.apply(this,arguments)}return addNewImageMessage}()},{key:"createAudioElement",value:function createAudioElement(i,u){var d=document.createElement("audio");return d.src=i.src,d.classList.add("audio-player"),d.controls=!0,x.IS_SAFARI&&(d.classList.add("audio-player-safari"),d.classList.add(u===Qe.USER_ROLE?"audio-player-safari-right":"audio-player-safari-left")),d}},{key:"addNewAudioMessage",value:function addNewAudioMessage(i,u,d){var h=ke.createAudioElement(u,d),m=i.createNewMessageElement("",d);m.bubbleElement.appendChild(h),m.bubbleElement.classList.add("audio-message"),Rr.addMessage(i,m,"audio",d)}},{key:"createAnyFile",value:function createAnyFile(i){var u=document.createElement("div");u.classList.add("any-file-message-contents");var d=document.createElement("div");d.classList.add("any-file-message-icon-container");var h=pa.createSVGElement(Yi);h.classList.add("any-file-message-icon"),d.appendChild(h);var m=document.createElement("div");return m.classList.add("any-file-message-text"),m.textContent=i.name||Rr.DEFAULT_FILE_NAME,u.appendChild(d),u.appendChild(m),Rr.processContent("any",u,i.src,m.textContent)}},{key:"addNewAnyFileMessage",value:function addNewAnyFileMessage(i,u,d){var h=i.createNewMessageElement("",d),m=ke.createAnyFile(u);h.bubbleElement.classList.add("any-file-message-bubble"),h.bubbleElement.appendChild(m),Rr.addMessage(i,h,"file",d)}},{key:"addMessages",value:function addMessages(i,u,d){u.forEach((function(u){u.ref&&(u=Rr.removeFileRef(u)),Rr.isAudioFile(u)?ke.addNewAudioMessage(i,u,d):Rr.isImageFile(u)?ke.addNewImageMessage(i,u,d):ke.addNewAnyFileMessage(i,u,d)}))}}])}();var Xi=function(i){function Ae(i,u,d){var h;_classCallCheck(this,Ae);var m,v;h=_callSuper(this,Ae,[i]);var g=u.permittedErrorPrefixes,y=u.introPanelMarkUp,b=u.demo;h._errorMessageOverrides=(m=i.errorMessages)==null?void 0:m.overrides,h._onClearMessages=Ir.onClearMessages.bind(h,i),h._onError=Ir.onError.bind(h,i),h._displayLoadingMessage=Ae.getDisplayLoadingMessage(i,u),h._permittedErrorPrefixes=g,h.addSetupMessageIfNeeded(i,u)||h.populateIntroPanel(d,y,i.introPanelStyle),h.addIntroductoryMessage(i,u),h.populateHistory(i),h._displayServiceErrorMessages=(v=i.errorMessages)==null?void 0:v.displayServiceErrorMessages,i.getMessages=function(){return JSON.parse(JSON.stringify(h.messages))},i.clearMessages=h.clearMessages.bind(h,u),i.refreshMessages=h.refreshTextMessages.bind(h),i.scrollToBottom=fe.scrollToBottom.bind(h,h.elementRef),i.addMessage=function(i,u){h.addAnyMessage(_objectSpread(_objectSpread({},i),{},{sendUpdate:!!u}),!u)},u.isWebModel()&&u.setUpMessages(h),b&&h.prepareDemo(b),i.textToSpeech&&Ce.processConfig(i.textToSpeech,(function(i){h.textToSpeech=i})),u.fetchHistory&&h.fetchHistory(u.fetchHistory);return h}_inherits(Ae,i);return _createClass(Ae,[{key:"prepareDemo",value:function prepareDemo(i){_typeof(i)=="object"&&(i.response&&(this.customDemoResponse=i.response),i.displayErrors&&(i.displayErrors.default&&this.addNewErrorMessage("",""),i.displayErrors.service&&this.addNewErrorMessage("service",""),i.displayErrors.speechToText&&this.addNewErrorMessage("speechToText","")),i.displayLoadingBubble&&this.addLoadingMessage())}},{key:"addSetupMessageIfNeeded",value:function addSetupMessageIfNeeded(i,u){var d=$i.getText(i,u);if(d){var h=this.createAndAppendNewMessageElement(d,Qe.AI_ROLE);this.applyCustomStyles(h,Qe.AI_ROLE,!1)}return!!d}},{key:"addIntroductoryMessage",value:function addIntroductoryMessage(i,u){var d;var h;i!=null&&i.shadowRoot&&(this._introMessage=i.introMessage);var m=this._introMessage;if(u!=null&&u.isWebModel()&&((d=m)!==null&&d!==void 0?d:m=u.getIntroMessage(m)),m){var v;m!=null&&m.text?v=this.createAndAppendNewMessageElement(m.text,Qe.AI_ROLE):m!=null&&m.html&&(v=kt.add(this,m.html,Qe.AI_ROLE,this.messageElementRefs)),v&&(this.applyCustomStyles(v,Qe.AI_ROLE,!1,(h=this.messageStyles)==null?void 0:h.intro),v.outerContainer.classList.add("deep-chat-intro"))}}},{key:"removeIntroductoryMessage",value:function removeIntroductoryMessage(){var i=this.messageElementRefs[0];i.outerContainer.classList.contains("deep-chat-intro")&&(i.outerContainer.remove(),this.messageElementRefs.shift())}},{key:"populateHistory",value:function populateHistory(i){var u=this;var d=i.history||Te.processHistory(i);d&&(d.forEach((function(i){Te.processHistoryFile(i),u.addNewMessage(i,!0)})),setTimeout((function(){return fe.scrollToBottom(u.elementRef)}),0))}},{key:"fetchHistory",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee107(i){var u=this;return _regeneratorRuntime().wrap((function _callee107$(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return i();case 2:d.sent.forEach((function(i){return u.addAnyMessage(i,!0)}));setTimeout((function(){return fe.scrollToBottom(u.elementRef)}),0);case 4:case"end":return d.stop()}}),_callee107)})));function fetchHistory(u){return i.apply(this,arguments)}return fetchHistory}()},{key:"addAnyMessage",value:function addAnyMessage(i){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];i.error?this.addNewErrorMessage("service",i.error):this.addNewMessage(i,u)}},{key:"addNewMessage",value:function addNewMessage(i){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];var d=Ae.createMessageContent(i),h={status:i.overwrite};if(!i.ignoreText&&d.text!==void 0&&i.text!==null&&(this.addNewTextMessage(d.text,d.role,h),!u&&this.textToSpeech&&d.role!==Qe.USER_ROLE&&Ce.speak(d.text,this.textToSpeech)),d.files&&Array.isArray(d.files)&&Zi.addMessages(this,d.files,d.role),d.html!==void 0&&d.html!==null){var m=kt.add(this,d.html,d.role,this.messageElementRefs,h);vt.isElementTemporary(m)&&delete d.html}this.isValidMessageContent(d)&&this.updateStateOnMessage(d,i.overwrite,i.sendUpdate,u)}},{key:"isValidMessageContent",value:function isValidMessageContent(i){return i.text||i.html||i.files&&i.files.length>0}},{key:"updateStateOnMessage",value:function updateStateOnMessage(i,u){var d=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];var h=arguments.length>3&&arguments[3]!==void 0&&arguments[3];u||this.messages.push(i),d&&this.sendClientUpdate(i,h)}},{key:"removeMessageOnError",value:function removeMessageOnError(){var i=this.messageElementRefs[this.messageElementRefs.length-1],u=i==null?void 0:i.bubbleElement;(u!=null&&u.classList.contains(Fr.MESSAGE_CLASS)&&u.textContent===""||Ae.isTemporaryElement(i))&&this.removeLastMessage()}},{key:"addNewErrorMessage",value:function addNewErrorMessage(i,u){var d,h,m,v,g;this.removeMessageOnError();var y=Ae.createBaseElements(),b=y.outerContainer,x=y.bubbleElement;x.classList.add("error-message-text");var A=this.getPermittedMessage(u)||((d=this._errorMessageOverrides)==null?void 0:d[i])||((h=this._errorMessageOverrides)==null?void 0:h.default)||"Error, please try again.";this.renderText(x,A);var P=Lr.extractParticularSharedStyles(["fontSize","fontFamily"],(m=this.messageStyles)==null?void 0:m.default);Lr.applyCustomStylesToElements(y,!1,P),Lr.applyCustomStylesToElements(y,!1,(v=this.messageStyles)==null?void 0:v.error),this.elementRef.appendChild(b),fe.scrollToBottom(this.elementRef),this.textToSpeech&&Ce.speak(A,this.textToSpeech),(g=this._onError)==null||g.call(this,A)}},{key:"getPermittedMessage",value:function getPermittedMessage(i){if(i){var u=Ae.extractErrorMessages(i);for(var d=0;d<u.length;d+=1){var h=u[d];if(typeof h=="string"){if(this._displayServiceErrorMessages)return h;if(this._permittedErrorPrefixes){var m=Ae.checkPermittedErrorPrefixes(this._permittedErrorPrefixes,h);if(m)return m}}}}}},{key:"removeError",value:function removeError(){this.isLastMessageError()&&Qe.getLastMessageElement(this.elementRef).remove()}},{key:"addLoadingMessage",value:function addLoadingMessage(){var i;if(this._displayLoadingMessage){var u=this.createMessageElements("",Qe.AI_ROLE),d=u.outerContainer,h=u.bubbleElement;h.classList.add("loading-message-text");var m=document.createElement("div");m.classList.add("dots-flashing"),h.appendChild(m),this.applyCustomStyles(u,Qe.AI_ROLE,!1,(i=this.messageStyles)==null?void 0:i.loading),Vi.set(h,this.messageStyles),this.elementRef.appendChild(d),fe.scrollToBottom(this.elementRef)}}},{key:"populateIntroPanel",value:function populateIntroPanel(i,u,d){(i||u)&&(this._introPanel=new Wi(i,u,d),this._introPanel._elementRef&&(gt.apply(this,this._introPanel._elementRef),this.elementRef.appendChild(this._introPanel._elementRef)))}},{key:"addMultipleFiles",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee108(i){return _regeneratorRuntime().wrap((function _callee108$(u){while(1)switch(u.prev=u.next){case 0:return u.abrupt("return",Promise.all((i||[]).map((function(i){return new Promise((function(u){if(i.type&&i.type!=="any"){var d=new FileReader;d.readAsDataURL(i.file),d.onload=function(){u({src:d.result,type:i.type,ref:i.file})}}else{var h=i.file.name||Rr.DEFAULT_FILE_NAME;u({name:h,type:"any",ref:i.file})}}))}))));case 1:case"end":return u.stop()}}),_callee108)})));function addMultipleFiles(u){return i.apply(this,arguments)}return addMultipleFiles}()},{key:"clearMessages",value:function clearMessages(i,u){var d,h;var m=[];this.messageElementRefs.forEach((function(i){var u=i.bubbleElement.classList;u.contains("loading-message-text")||u.contains(Fr.MESSAGE_CLASS)?m.push(i):i.outerContainer.remove()})),Array.from(this.elementRef.children).forEach((function(i){var u;var d=(u=i.children[0])==null?void 0:u.children[0];d!=null&&d.classList.contains("error-message-text")&&i.remove()})),this.messageElementRefs=m,u!==!1&&((d=this._introPanel)!=null&&d._elementRef&&this._introPanel.display(),this.addIntroductoryMessage()),this.messages.splice(0,this.messages.length),this.textElementsToText.splice(0,this.textElementsToText.length),(h=this._onClearMessages)==null||h.call(this),delete i.sessionId}}],[{key:"getDisplayLoadingMessage",value:function getDisplayLoadingMessage(i,u){var d;return!u.websocket&&((d=i.displayLoadingBubble)===null||d===void 0||d)}},{key:"checkPermittedErrorPrefixes",value:function checkPermittedErrorPrefixes(i,u){for(var d=0;d<i.length;d+=1)if(u.startsWith(i[d]))return u}},{key:"extractErrorMessages",value:function extractErrorMessages(i){return Array.isArray(i)?i:i instanceof Error?[i.message]:typeof i=="string"?[i]:_typeof(i)=="object"&&i.error?[i.error]:[]}}])}(Or);var Qi=function(){function N(){_classCallCheck(this,N)}return _createClass(N,null,[{key:"adjustInputPadding",value:function adjustInputPadding(i,u){u["inside-left"].length>0&&i.classList.add("text-input-inner-left-adjustment"),u["inside-right"].length>0&&i.classList.add("text-input-inner-right-adjustment")}},{key:"adjustForOutsideButton",value:function adjustForOutsideButton(i,u,d){d["outside-right"].length===0&&d["outside-left"].length>0?(i[0].classList.add(N.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS),u.classList.add(N.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS)):d["outside-left"].length===0&&d["outside-right"].length>0&&(i[3].classList.add(N.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS),u.classList.add(N.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS))}},{key:"adjustOutsideSubmit",value:function adjustOutsideSubmit(i,u,d){if(!(d["inside-left"].length>0||d["inside-right"].length>0)){if(d["outside-right"].length===0&&d["outside-left"].length>0)return i[0].classList.add(N.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS),u.classList.add(N.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS),d["outside-left"].map((function(i){return i.button.elementRef.classList.add("submit-button-enlarged")}));if(d["outside-left"].length===0&&d["outside-right"].length>0)return i[3].classList.add(N.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS),u.classList.add(N.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS),d["outside-right"].map((function(i){return i.button.elementRef.classList.add("submit-button-enlarged")}))}}},{key:"set",value:function set(i,u,d,h){!!N.adjustOutsideSubmit(u,d,h)||N.adjustForOutsideButton(u,d,h),N.adjustInputPadding(i,h)}}])}();Qi.INPUT_OUTSIDE_LEFT_ADJUSTMENT_CLASS="text-input-container-left-adjustment",Qi.INPUT_OUTSIDE_RIGHT_ADJUSTMENT_CLASS="text-input-container-right-adjustment",Qi.INPUT_OUTSIDE_LEFT_SMALL_ADJUSTMENT_CLASS="text-input-container-left-small-adjustment",Qi.INPUT_OUTSIDE_RIGHT_SMALL_ADJUSTMENT_CLASS="text-input-container-right-small-adjustment";var as=Qi;var ds=function(){function ut(){_classCallCheck(this,ut)}return _createClass(ut,null,[{key:"create",value:function create(){return Array.from({length:4}).map((function(i,u){var d=document.createElement("div");return d.classList.add("input-button-container"),(u===0||u===3)&&d.classList.add("outer-button-container"),(u===1||u===2)&&d.classList.add("inner-button-container"),d}))}},{key:"add",value:function add(i,u){i.insertBefore(u[1],i.firstChild),i.insertBefore(u[0],i.firstChild),i.appendChild(u[2]),i.appendChild(u[3])}},{key:"getContainerIndex",value:function getContainerIndex(i){return i==="outside-left"?0:i==="inside-left"?1:i==="inside-right"?2:3}},{key:"addButton",value:function addButton(i,u,d){u.classList.add(d);var h=ut.getContainerIndex(d);i[h].appendChild(u),h===3&&u.classList.add("outside-right")}}])}();var vs=["camera","gifs","images","audio","mixedFiles","submit","microphone"];var ys=function(){function $(){_classCallCheck(this,$)}return _createClass($,null,[{key:"createTextElement",value:function createTextElement(i){var u=document.createElement("div");return u.classList.add("text-button"),u.innerText=i,u}},{key:"createElement",value:function createElement(i,u){return u?$.createTextElement(i):pa.createSVGElement(i)}},{key:"createCustomElement",value:function createCustomElement(i,u){var d,h,m,v;var g=u==null?void 0:u[i];return(d=g==null?void 0:g.svg)!=null&&d.content?$.createElement((h=g==null?void 0:g.svg)==null?void 0:h.content,!1):(m=g==null?void 0:g.text)!=null&&m.content?$.createElement((v=g==null?void 0:g.text)==null?void 0:v.content,!0):void 0}},{key:"processElement",value:function processElement(i,u){u!=null&&u.classList.contains("text-button")||i.classList.add("input-button-svg")}},{key:"createSpecificStateElement",value:function createSpecificStateElement(i,u,d){var h;return d&&(h=$.createCustomElement(u,d)),$.processElement(i,h),h}},{key:"createInnerElement",value:function createInnerElement(i,u,d,h){var m=arguments.length>4&&arguments[4]!==void 0&&arguments[4];var v,g;return(!m||(g=(v=h==null?void 0:h[d])==null?void 0:v.svg)!=null&&g.content)&&$.createSpecificStateElement(i,d,h)||u}}])}();var _s='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <path d="M16 0c-8.836 0-16 7.163-16 16s7.163 16 16 16c8.837 0 16-7.163 16-16s-7.163-16-16-16zM16 30.032c-7.72 0-14-6.312-14-14.032s6.28-14 14-14 14 6.28 14 14-6.28 14.032-14 14.032zM23 15h-6v-6c0-0.552-0.448-1-1-1s-1 0.448-1 1v6h-6c-0.552 0-1 0.448-1 1s0.448 1 1 1h6v6c0 0.552 0.448 1 1 1s1-0.448 1-1v-6h6c0.552 0 1-0.448 1-1s-0.448-1-1-1z"></path>\n</svg>';var xs=function(){function he(){_classCallCheck(this,he)}return _createClass(he,null,[{key:"unsetAllCSS",value:function unsetAllCSS(i,u){var h,m;u.container&&d.unsetAllCSSMouseStates(i,u.container),(h=u.svg)!=null&&h.styles&&d.unsetAllCSSMouseStates(i.children[0],u.svg.styles),(m=u.text)!=null&&m.styles&&d.unsetAllCSSMouseStates(i.children[0],u.text.styles)}},{key:"unsetActionCSS",value:function unsetActionCSS(i,u){var h,m;u.container&&d.unsetActivityCSSMouseStates(i,u.container),(h=u.svg)!=null&&h.styles&&d.unsetActivityCSSMouseStates(i.children[0],u.svg.styles),(m=u.text)!=null&&m.styles&&d.unsetActivityCSSMouseStates(i.children[0],u.text.styles)}},{key:"setElementsCSS",value:function setElementsCSS(i,u,d){var h,m,v,g,y;Object.assign(i.style,(h=u.container)==null?void 0:h[d]),Object.assign(i.children[0].style,(v=(m=u.svg)==null?void 0:m.styles)==null?void 0:v[d]),Object.assign(i.children[0].style,(y=(g=u.text)==null?void 0:g.styles)==null?void 0:y[d])}},{key:"setElementCssUpToState",value:function setElementCssUpToState(i,u,d){he.setElementsCSS(i,u,"default"),d!=="default"&&(he.setElementsCSS(i,u,"hover"),d!=="hover"&&he.setElementsCSS(i,u,"click"))}}])}();var Cs=function(){function jt(i,u,d,h){_classCallCheck(this,jt);this._mouseState={state:"default"},this.elementRef=i,this._customStyles=d,this.position=u,this.dropupText=h}return _createClass(jt,[{key:"buttonMouseLeave",value:function buttonMouseLeave(i){this._mouseState.state="default",i&&(xs.unsetAllCSS(this.elementRef,i),xs.setElementsCSS(this.elementRef,i,"default"))}},{key:"buttonMouseEnter",value:function buttonMouseEnter(i){this._mouseState.state="hover",i&&xs.setElementsCSS(this.elementRef,i,"hover")}},{key:"buttonMouseUp",value:function buttonMouseUp(i){i&&xs.unsetActionCSS(this.elementRef,i),this.buttonMouseEnter(i)}},{key:"buttonMouseDown",value:function buttonMouseDown(i){this._mouseState.state="click",i&&xs.setElementsCSS(this.elementRef,i,"click")}},{key:"setEvents",value:function setEvents(i){this.elementRef.onmousedown=this.buttonMouseDown.bind(this,i),this.elementRef.onmouseup=this.buttonMouseUp.bind(this,i),this.elementRef.onmouseenter=this.buttonMouseEnter.bind(this,i),this.elementRef.onmouseleave=this.buttonMouseLeave.bind(this,i)}},{key:"unsetCustomStateStyles",value:function unsetCustomStateStyles(i){if(this._customStyles)for(var u=0;u<i.length;u+=1){var d=i[u],h=d&&this._customStyles[d];h&&xs.unsetActionCSS(this.elementRef,h)}}},{key:"reapplyStateStyle",value:function reapplyStateStyle(i,u){if(this._customStyles){u&&this.unsetCustomStateStyles(u);var d=this._customStyles[i];d&&xs.setElementCssUpToState(this.elementRef,d,this._mouseState.state),this.setEvents(d)}}}])}();var ws=function(){function Lt(){_classCallCheck(this,Lt)}return _createClass(Lt,null,[{key:"focusItemWhenOnEdge",value:function focusItemWhenOnEdge(i,u){var d=u?i.children[0]:i.children[i.children.length-1];Lt.focusSiblingItem(d,i,u,!0)}},{key:"focusSiblingItem",value:function focusSiblingItem(i,u,d){var h=arguments.length>3&&arguments[3]!==void 0&&arguments[3];var m=h?i:i[d?"nextSibling":"previousSibling"];m?(i.dispatchEvent(new MouseEvent("mouseleave")),m.dispatchEvent(new MouseEvent("mouseenter"))):(i.dispatchEvent(new MouseEvent("mouseleave")),Lt.focusItemWhenOnEdge(u,d))}}])}();var Es=function(){function Fe(){_classCallCheck(this,Fe)}return _createClass(Fe,null,[{key:"addItemEvents",value:function addItemEvents(i,u,d,h){tt.add(u,h),u.addEventListener("click",(function(){d.click()})),u.addEventListener("mouseenter",(function(u){i.highlightedItem=u.target})),u.addEventListener("mouseleave",(function(){i.highlightedItem=void 0}))}},{key:"createItemText",value:function createItemText(i,u){var d=document.createElement("div");return Object.assign(d.style,u),d.classList.add("dropup-menu-item-text"),d.textContent=i||"File",d}},{key:"createItemIcon",value:function createItemIcon(i,u){var d=document.createElement("div");return Object.assign(d.style,u),d.classList.add("dropup-menu-item-icon"),d.appendChild(i.children[0]),d}},{key:"populateItem",value:function populateItem(i,u,d,h){var m=i.children[0];m.classList.contains("text-button")?u.appendChild(Fe.createItemText(m.textContent,h==null?void 0:h.text)):(u.appendChild(Fe.createItemIcon(i,h==null?void 0:h.iconContainer)),u.appendChild(Fe.createItemText(d,h==null?void 0:h.text)))}},{key:"createItem",value:function createItem(i,u,h){var m;var v=u.elementRef,g=u.dropupText,y=document.createElement("div");Object.assign(y.style,(m=h==null?void 0:h.item)==null?void 0:m.default),Fe.populateItem(v,y,g,h),y.classList.add("dropup-menu-item");var b=d.processStateful((h==null?void 0:h.item)||{},{backgroundColor:"#f3f3f3"},{backgroundColor:"#ebebeb"});return Fe.addItemEvents(i,y,v,b),y}}])}();var Ts=function(){function gn(i,u){var d=this;_classCallCheck(this,gn);var h;this._isOpen=!0,this._styles=u,this.elementRef=gn.createElement((h=this._styles)==null?void 0:h.container),this.close(),setTimeout((function(){return d.addWindowEvents(i)}))}return _createClass(gn,[{key:"open",value:function open(){this.elementRef.style.display="block",this._isOpen=!0}},{key:"close",value:function close(){this._isOpen&&(this.elementRef.style.display="none",this._isOpen=!1)}},{key:"toggle",value:function toggle(){this._isOpen?this.close():this.open()}},{key:"addItem",value:function addItem(i){var u=Es.createItem(this,i,this._styles);this.elementRef.appendChild(u)}},{key:"addWindowEvents",value:function addWindowEvents(i){this.clickEvent=this.windowClick.bind(this,i),window.addEventListener("click",this.clickEvent),this.keyDownEvent=this.windowKeyDown.bind(this,i),window.addEventListener("keydown",this.keyDownEvent)}},{key:"windowClick",value:function windowClick(i,u){var d;!i.isConnected&&this.clickEvent?window.removeEventListener("click",this.clickEvent):i.parentElement!==((d=u.target.shadowRoot)==null?void 0:d.children[0])&&this.close()}},{key:"windowKeyDown",value:function windowKeyDown(i,u){var d,h,m;!i.isConnected&&this.keyDownEvent?window.removeEventListener("keydown",this.keyDownEvent):this._isOpen&&(u.key===b.ESCAPE?(this.close(),(d=this.highlightedItem)==null||d.dispatchEvent(new MouseEvent("mouseleave"))):u.key===b.ENTER?((h=this.highlightedItem)==null||h.click(),(m=this.highlightedItem)==null||m.dispatchEvent(new MouseEvent("mouseleave"))):u.key===b.ARROW_DOWN?ws.focusSiblingItem(this.highlightedItem||this.elementRef.children[this.elementRef.children.length-1],this.elementRef,!0):u.key===b.ARROW_UP&&ws.focusSiblingItem(this.highlightedItem||this.elementRef.children[0],this.elementRef,!1))}}],[{key:"createElement",value:function createElement(i){var u=document.createElement("div");return u.id="dropup-menu",Object.assign(u.style,i),u}}])}();var As=function(i){function lt(i,u){var d;_classCallCheck(this,lt);var h;d=_callSuper(this,lt,[lt.createButtonElement(),void 0,{styles:(h=u==null?void 0:u.button)==null?void 0:h.styles}]);var m=d.createInnerElements(d._customStyles);d._menu=new Ts(i,u==null?void 0:u.menu),d.addClickEvent(),d.buttonContainer=lt.createButtonContainer(),d.elementRef.appendChild(m.styles),d.buttonContainer.appendChild(d.elementRef),d.elementRef.classList.add("dropup-icon","upload-file-button"),d.elementRef.children[0].id="dropup-icon",d.buttonContainer.appendChild(d._menu.elementRef),d.reapplyStateStyle("styles"),d.addContainerEvents(i);return d}_inherits(lt,i);return _createClass(lt,[{key:"createInnerElements",value:function createInnerElements(i){return{styles:this.createInnerElement(lt.createSVGIconElement(),"styles",i)}}},{key:"createInnerElement",value:function createInnerElement(i,u,d){return ys.createSpecificStateElement(this.elementRef,u,d)||i}},{key:"addClickEvent",value:function addClickEvent(){this.elementRef.onclick=this._menu.toggle.bind(this._menu)}},{key:"addItem",value:function addItem(i){this._menu.addItem(i)}},{key:"addContainerEvents",value:function addContainerEvents(i){var u=this;i.addEventListener("click",(function(i){i.target.classList.contains("dropup-icon")||u._menu.close()}))}}],[{key:"createButtonElement",value:function createButtonElement(){var i=document.createElement("div");return i.classList.add("input-button"),i}},{key:"createSVGIconElement",value:function createSVGIconElement(){return pa.createSVGElement(_s)}},{key:"createButtonContainer",value:function createButtonContainer(){var i=document.createElement("div");return i.id="dropup-container",i}},{key:"getPosition",value:function getPosition(i,u){var d,h;return(d=u==null?void 0:u.button)!=null&&d.position?(h=u==null?void 0:u.button)==null?void 0:h.position:i["outside-left"].length>0&&i["outside-right"].length===0?"outside-right":"outside-left"}}])}(Cs);var Rs=function(){function G(){_classCallCheck(this,G)}return _createClass(G,null,[{key:"addToDropup",value:function addToDropup(i,u,d,h){var m=new As(d,h);vs.forEach((function(i){var d=u["dropup-menu"].findIndex((function(u){return u.buttonType===i})),h=u["dropup-menu"][d];h&&(m.addItem(h.button),u["dropup-menu"].splice(d,1))}));var v=As.getPosition(u,h);ds.addButton(i,m.buttonContainer,v),u[v].push({})}},{key:"addToSideContainer",value:function addToSideContainer(i,u){["inside-left","inside-right","outside-left","outside-right"].forEach((function(d){var h=d;u[h].forEach((function(u){ds.addButton(i,u.button.elementRef,h)}))}))}},{key:"setPosition",value:function setPosition(i,u,d){var h=_objectSpread(_objectSpread({},i[u]),{},{buttonType:u});d.push(h),delete i[u]}},{key:"createPositionsObj",value:function createPositionsObj(){return{"dropup-menu":[],"outside-left":[],"inside-left":[],"inside-right":[],"outside-right":[]}}},{key:"generatePositions",value:function generatePositions(i){var u=G.createPositionsObj();Object.keys(i).forEach((function(d){var h;var m=(h=i[d])==null?void 0:h.button.position;m&&G.setPosition(i,d,u[m])})),u["inside-right"].length===0&&i.submit&&G.setPosition(i,"submit",u["inside-right"]),u["outside-right"].length===0&&(i.submit?G.setPosition(i,"submit",u["outside-right"]):i.microphone?G.setPosition(i,"microphone",u["outside-right"]):i.camera&&G.setPosition(i,"camera",u["outside-right"])),i.submit&&G.setPosition(i,"submit",u["outside-left"].length===0?u["outside-left"]:u["inside-right"]),i.microphone&&G.setPosition(i,"microphone",u["outside-left"].length===0?u["outside-left"]:u["inside-right"]);var d=Object.keys(i);return d.length>1||u["dropup-menu"].length>0?vs.forEach((function(d){i[d]&&u["dropup-menu"].push(_objectSpread(_objectSpread({},i[d]),{},{buttonType:d}))})):d.length===1&&G.setPosition(i,d[0],u["outside-right"].length===0?u["outside-right"]:u["outside-left"]),u}},{key:"addButtons",value:function addButtons(i,u,d,h){var m=G.generatePositions(u);return G.addToSideContainer(i,m),m["dropup-menu"].length>0&&G.addToDropup(i,m,d,h),m}}])}();var Ms='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<title>file</title>\n<path d="M20 10.9696L11.9628 18.5497C10.9782 19.4783 9.64274 20 8.25028 20C6.85782 20 5.52239 19.4783 4.53777 18.5497C3.55315 17.6211 3 16.3616 3 15.0483C3 13.7351 3.55315 12.4756 4.53777 11.547L12.575 3.96687C13.2314 3.34779 14.1217 3 15.05 3C15.9783 3 16.8686 3.34779 17.525 3.96687C18.1814 4.58595 18.5502 5.4256 18.5502 6.30111C18.5502 7.17662 18.1814 8.01628 17.525 8.63535L9.47904 16.2154C9.15083 16.525 8.70569 16.6989 8.24154 16.6989C7.77738 16.6989 7.33224 16.525 7.00403 16.2154C6.67583 15.9059 6.49144 15.4861 6.49144 15.0483C6.49144 14.6106 6.67583 14.1907 7.00403 13.8812L14.429 6.88674" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',Us='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n  <path d="M20,15.2928932 L20,5.5 C20,4.67157288 19.3284271,4 18.5,4 L5.5,4 C4.67157288,4 4,4.67157288 4,5.5 L4,12.2928932 L7.14644661,9.14644661 C7.34170876,8.95118446 7.65829124,8.95118446 7.85355339,9.14644661 L13.5,14.7928932 L16.1464466,12.1464466 C16.3417088,11.9511845 16.6582912,11.9511845 16.8535534,12.1464466 L20,15.2928932 Z M20,16.7071068 L16.5,13.2071068 L13.8535534,15.8535534 C13.6582912,16.0488155 13.3417088,16.0488155 13.1464466,15.8535534 L7.5,10.2071068 L4,13.7071068 L4,18.5 C4,19.3284271 4.67157288,20 5.5,20 L18.5,20 C19.3284271,20 20,19.3284271 20,18.5 L20,16.7071068 Z M3,5.5 C3,4.11928813 4.11928813,3 5.5,3 L18.5,3 C19.8807119,3 21,4.11928813 21,5.5 L21,18.5 C21,19.8807119 19.8807119,21 18.5,21 L5.5,21 C4.11928813,21 3,19.8807119 3,18.5 L3,5.5 Z M15,6 L17,6 C17.5522847,6 18,6.44771525 18,7 L18,9 C18,9.55228475 17.5522847,10 17,10 L15,10 C14.4477153,10 14,9.55228475 14,9 L14,7 C14,6.44771525 14.4477153,6 15,6 Z M15,7 L15,9 L17,9 L17,7 L15,7 Z"/>\n</svg>\n',Hs='<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-49.49 -49.49 593.87 593.87" stroke-width="3.95908" transform="rotate(0)">\n  <g stroke-width="0"></g>\n  <g stroke-linecap="round" stroke-linejoin="round" stroke-width="0.98977"></g>\n  <g>\n    <g>\n      <g>\n        <path d="M163.205,76.413v293.301c-3.434-3.058-7.241-5.867-11.486-8.339c-21.38-12.452-49.663-15.298-77.567-7.846 c-49.038,13.096-80.904,54.519-71.038,92.337c4.019,15.404,14.188,28.221,29.404,37.087c13.553,7.894,29.87,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.447-4.087c42.74-11.406,72.411-44.344,72.807-77.654h0.011v-0.162c0.002-0.166,0-0.331,0-0.496V187.072 l290.971-67.3v178.082c-3.433-3.055-7.238-5.863-11.481-8.334c-21.385-12.452-49.654-15.308-77.567-7.846 c-49.038,13.087-80.904,54.519-71.038,92.356c4.019,15.385,14.183,28.212,29.404,37.067c13.548,7.894,29.875,11.933,47.115,11.933 c9.962,0,20.231-1.356,30.452-4.087c42.74-11.413,72.411-44.346,72.804-77.654h0.004v-0.065c0.003-0.236,0.001-0.469,0-0.704V0 L163.205,76.413z M104.999,471.779c-22.543,6.038-45.942,3.846-62.572-5.846c-10.587-6.163-17.591-14.817-20.255-25.038 c-7.144-27.375,18.452-58.029,57.062-68.346c8.409-2.25,16.938-3.346,25.188-3.346c13.87,0,26.962,3.115,37.389,9.192 c10.587,6.163,17.591,14.817,20.255,25.029c0.809,3.102,1.142,6.248,1.139,9.4v0.321h0.014 C162.99,437.714,139.082,462.678,104.999,471.779z M182.898,166.853V92.067l290.971-67.298v74.784L182.898,166.853z M415.677,399.923c-22.558,6.038-45.942,3.837-62.587-5.846c-10.587-6.163-17.587-14.817-20.25-25.019 c-7.144-27.385,18.452-58.058,57.058-68.365c8.414-2.25,16.942-3.346,25.192-3.346c13.875,0,26.962,3.115,37.385,9.192 c10.596,6.163,17.596,14.817,20.26,25.029v0.01c0.796,3.05,1.124,6.144,1.135,9.244v0.468h0.02 C473.668,365.851,449.763,390.814,415.677,399.923z">\n        </path>\n      </g>\n    </g>\n  </g>\n</svg>',Gs='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 5.9266752 5.6408391" height="21.31971" width="22.4">\n  <g>\n    <path d="m 5.2564627,1.548212 c -3.1136005,-0.4796804 -1.5568006,-0.2398402 0,0 z M 2.0001198,2.0922063 c 0.1556781,0 0.2657489,0.020893 0.3917849,0.080366 0.081154,0.038347 0.1153492,0.134065 0.076377,0.2138602 -0.038973,0.07979 -0.1363527,0.1134129 -0.2175069,0.075091 -0.078199,-0.036919 -0.1407455,-0.048792 -0.250655,-0.048792 -0.2260486,0 -0.3921482,0.2042182 -0.3921482,0.4801409 0,0.2761822 0.1663188,0.4810688 0.3921482,0.4810688 0.1117901,0 0.2064255,-0.046133 0.255659,-0.1284198 l 0.00162,-0.00389 V 3.0534032 l -0.098011,1.75e-4 c -0.081844,0 -0.1495979,-0.059305 -0.1612403,-0.1365887 l -0.00175,-0.023683 c 0,-0.08047 0.060311,-0.1470874 0.1389194,-0.1585331 l 0.024085,-0.00195 h 0.2612303 c 0.081842,0 0.149598,0.059305 0.1612404,0.1365891 l 0.00175,0.023683 -3.398e-4,0.3968809 v 0 l -0.00168,0.014211 v 0 l -0.00553,0.023034 v 0 l -0.00532,0.014145 c -0.098178,0.22826 -0.3236506,0.3528713 -0.5706303,0.3528713 -0.4240855,0 -0.7181621,-0.3622714 -0.7181621,-0.8016063 0,-0.4391857 0.2940275,-0.8006848 0.7181621,-0.8006848 z m 1.2034759,0.031275 c 0.081843,0 0.1495977,0.059305 0.1612403,0.1365891 l 0.00175,0.023683 v 1.2211775 c 0,0.088516 -0.07298,0.1602721 -0.1630073,0.1602721 -0.081841,0 -0.1495972,-0.059305 -0.1612397,-0.1365892 L 3.040589,3.5049308 V 2.2837527 c 0,-0.088516 0.07298,-0.1602721 0.1630067,-0.1602714 z m 0.7813442,0 0.5209469,0.00195 c 0.090025,3.048e-4 0.1627543,0.072306 0.1624458,0.1608234 -2.809e-4,0.08047 -0.06083,0.1468798 -0.1394772,0.158066 l -0.024092,0.00195 -0.3575326,-0.0013 v 0.4497782 l 0.2928918,2.27e-4 c 0.081842,0 0.1495979,0.059305 0.1612403,0.136589 l 0.00175,0.023683 c 0,0.080469 -0.06031,0.1470871 -0.1389193,0.1585393 l -0.024092,0.00195 -0.2928919,-2.336e-4 1.563e-4,0.2860316 c 0,0.080471 -0.06031,0.1470873 -0.1389193,0.1585395 l -0.024085,0.00195 c -0.081843,0 -0.1495979,-0.059305 -0.1612403,-0.1365826 l -0.00175,-0.023691 V 2.2841354 c 2.798e-4,-0.08047 0.060829,-0.1468797 0.1394758,-0.1580594 z"/>\n    <path d="m 5.0894191,1.0943261 c 0,-0.21918999 -0.177687,-0.39686999 -0.396876,-0.39686999 h -3.43959 c -0.2191879,0 -0.391262,0.1777519 -0.3968759,0.39686999 l -0.027082,3.4379266 c 0.040152,0.2939927 0.4235456,0.409415 0.4235456,0.409415 l 3.4785583,-0.00851 c 0,0 0.3008506,-0.1402998 0.3236271,-0.4201576 0.042911,-0.5272495 0.034693,-1.6106146 0.034693,-3.4186761 z m -4.49792494,0 c 0,-0.36530999 0.29614504,-0.66145999 0.66145894,-0.66145999 h 3.43959 c 0.365314,0 0.66146,0.29615 0.66146,0.66145999 v 3.43959 c 0,0.36532 -0.296146,0.66146 -0.66146,0.66146 h -3.43959 c -0.3653139,0 -0.66145894,-0.29614 -0.66145894,-0.66146 z"/>\n  </g>\n</svg>\n',qs={images:{id:"upload-images-icon",svgString:Us,dropupText:"Image"},gifs:{id:"upload-gifs-icon",svgString:Gs,dropupText:"GIF"},audio:{id:"upload-audio-icon",svgString:Hs,dropupText:"Audio"},mixedFiles:{id:"upload-mixed-files-icon",svgString:Ms,dropupText:"File"}},Ws='<?xml version="1.0" encoding="iso-8859-1"?>\n<svg height="1.4em" width="1.4em" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n\t viewBox="0 0 490.9 490.9" xml:space="preserve">\n\t<g>\n\t\t<g>\n\t\t\t<path d="M245.5,322.9c53,0,96.2-43.2,96.2-96.2V96.2c0-53-43.2-96.2-96.2-96.2s-96.2,43.2-96.2,96.2v130.5\n\t\t\t\tC149.3,279.8,192.5,322.9,245.5,322.9z M173.8,96.2c0-39.5,32.2-71.7,71.7-71.7s71.7,32.2,71.7,71.7v130.5\n\t\t\t\tc0,39.5-32.2,71.7-71.7,71.7s-71.7-32.2-71.7-71.7V96.2z"/>\n\t\t\t<path d="M94.4,214.5c-6.8,0-12.3,5.5-12.3,12.3c0,85.9,66.7,156.6,151.1,162.8v76.7h-63.9c-6.8,0-12.3,5.5-12.3,12.3\n\t\t\t\ts5.5,12.3,12.3,12.3h152.3c6.8,0,12.3-5.5,12.3-12.3s-5.5-12.3-12.3-12.3h-63.9v-76.7c84.4-6.3,151.1-76.9,151.1-162.8\n\t\t\t\tc0-6.8-5.5-12.3-12.3-12.3s-12.3,5.5-12.3,12.3c0,76.6-62.3,138.9-138.9,138.9s-138.9-62.3-138.9-138.9\n\t\t\t\tC106.6,220,101.2,214.5,94.4,214.5z"/>\n\t\t</g>\n\t</g>\n</svg>\n';var eo=function(i){function Pt(i){var u;_classCallCheck(this,Pt);(i==null?void 0:i.position)==="dropup-menu"&&(i.position="outside-right"),u=_callSuper(this,Pt,[Pt.createMicrophoneElement(),i==null?void 0:i.position,i]),u.isActive=!1,u._innerElements=u.createInnerElements(u._customStyles),u.changeToDefault();return u}_inherits(Pt,i);return _createClass(Pt,[{key:"createInnerElements",value:function createInnerElements(i){var u=Pt.createSVGIconElement();return{default:this.createInnerElement(u,"default",i),active:this.createInnerElement(u,"active",i),unsupported:this.createInnerElement(u,"unsupported",i),commandMode:this.createInnerElement(u,"commandMode",i)}}},{key:"createInnerElement",value:function createInnerElement(i,u,d){return ys.createSpecificStateElement(this.elementRef,u,d)||i}},{key:"changeToActive",value:function changeToActive(){this.elementRef.replaceChildren(this._innerElements.active),this.toggleIconFilter("active"),this.reapplyStateStyle("active",["default","commandMode"]),this.isActive=!0}},{key:"changeToDefault",value:function changeToDefault(){this.elementRef.replaceChildren(this._innerElements.default),this.toggleIconFilter("default"),this.reapplyStateStyle("default",["active","commandMode"]),this.isActive=!1}},{key:"changeToCommandMode",value:function changeToCommandMode(){this.elementRef.replaceChildren(this._innerElements.unsupported),this.toggleIconFilter("command"),this.reapplyStateStyle("commandMode",["active"])}},{key:"changeToUnsupported",value:function changeToUnsupported(){this.elementRef.replaceChildren(this._innerElements.unsupported),this.elementRef.classList.add("unsupported-microphone"),this.reapplyStateStyle("unsupported",["active"])}},{key:"toggleIconFilter",value:function toggleIconFilter(i){var u=this.elementRef.children[0];if(u.tagName.toLocaleLowerCase()==="svg")switch(i){case"default":u.classList.remove("active-microphone-icon","command-microphone-icon"),u.classList.add("default-microphone-icon");break;case"active":u.classList.remove("default-microphone-icon","command-microphone-icon"),u.classList.add("active-microphone-icon");break;case"command":u.classList.remove("active-microphone-icon","default-microphone-icon"),u.classList.add("command-microphone-icon");break}}}],[{key:"createMicrophoneElement",value:function createMicrophoneElement(){var i=document.createElement("div");return i.id="microphone-button",i.classList.add("input-button"),i}},{key:"createSVGIconElement",value:function createSVGIconElement(){var i=pa.createSVGElement(Ws);return i.id="microphone-icon",i}}])}(Cs);var to={},io={},co={},po={},fo={};Object.defineProperty(fo,"__esModule",{value:!0});fo.Text=void 0;var Oo=function(){function Pe(){_classCallCheck(this,Pe)}return _createClass(Pe,null,[{key:"capitalize",value:function capitalize(i){return i.replace(Pe.FIRST_CHAR_REGEX,(function(i){return i.toUpperCase()}))}},{key:"lineBreak",value:function lineBreak(i){return i.replace(Pe.DOUBLE_LINE,"<p></p>").replace(Pe.ONE_LINE,"<br>")}},{key:"isCharDefined",value:function isCharDefined(i){return i!==void 0&&i!==""&&i!==" "&&i!=="\n"&&i!==""}},{key:"breakupIntoWordsArr",value:function breakupIntoWordsArr(i){return i.split(/(\W+)/)}}])}();fo.Text=Oo;Oo.FIRST_CHAR_REGEX=/\S/;Oo.DOUBLE_LINE=/\n\n/g;Oo.ONE_LINE=/\n/g;Object.defineProperty(po,"__esModule",{value:!0});po.Translate=void 0;var Po=fo;var No=function(){function qo(){_classCallCheck(this,qo)}return _createClass(qo,null,[{key:"translate",value:function translate(i,u){var d=Po.Text.breakupIntoWordsArr(i);for(var h=0;h<d.length;h+=1)u[d[h]]&&(d[h]=u[d[h]]);return d.join("")}}])}();po.Translate=No;Object.defineProperty(co,"__esModule",{value:!0});co.WebSpeechTranscript=void 0;var Fo=po;var Do=function(){function zo(){_classCallCheck(this,zo)}return _createClass(zo,null,[{key:"extract",value:function extract(i,u,d){var h="";for(var m=i.resultIndex;m<i.results.length;++m){var v=i.results[m][0].transcript;d&&(v=Fo.Translate.translate(v,d)),i.results[m].isFinal?u+=v:h+=v}return{interimTranscript:h,finalTranscript:u,newText:h||u}}},{key:"extractSafari",value:function extractSafari(i,u,d){var h="";var m="";for(var v=i.resultIndex;v<i.results.length;++v){var g=i.results[v][0].transcript;d&&(g=Fo.Translate.translate(g,d)),h+=g}return{interimTranscript:m,finalTranscript:h,newText:m||h}}}])}();co.WebSpeechTranscript=Do;var Bo={};Object.defineProperty(Bo,"__esModule",{value:!0});Bo.Browser=void 0;var jo=_createClass((function bt(){_classCallCheck(this,bt)}));Bo.Browser=jo;jo.IS_SAFARI=function(){return jo._IS_SAFARI===void 0&&(jo._IS_SAFARI=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),jo._IS_SAFARI};var Uo={},Ho={};Object.defineProperty(Ho,"__esModule",{value:!0});Ho.EventListeners=void 0;var Wo=function(){function se(){_classCallCheck(this,se)}return _createClass(se,null,[{key:"getElementIfFocusedOnAvailable",value:function getElementIfFocusedOnAvailable(i,u){return Array.isArray(i)?i.find((function(i){return u===i})):u===i?i:void 0}},{key:"keyDownWindow",value:function keyDownWindow(i){var u=this;i.element&&se.getElementIfFocusedOnAvailable(i.element,document.activeElement)&&(se.KEY_DOWN_TIMEOUT!==null&&clearTimeout(se.KEY_DOWN_TIMEOUT),se.KEY_DOWN_TIMEOUT=setTimeout((function(){se.KEY_DOWN_TIMEOUT=null,u.resetRecording(i)}),500))}},{key:"mouseDownWindow",value:function mouseDownWindow(i,u){this.mouseDownElement=se.getElementIfFocusedOnAvailable(i,u.target)}},{key:"mouseUpWindow",value:function mouseUpWindow(i){this.mouseDownElement&&this.resetRecording(i),this.mouseDownElement=void 0}},{key:"add",value:function add(i,u){var d=(u==null?void 0:u.insertInCursorLocation)===void 0||(u==null?void 0:u.insertInCursorLocation);u!=null&&u.element&&d&&(i.mouseDownEvent=se.mouseDownWindow.bind(i,u.element),document.addEventListener("mousedown",i.mouseDownEvent),i.mouseUpEvent=se.mouseUpWindow.bind(i,u),document.addEventListener("mouseup",i.mouseUpEvent),i.keyDownEvent=se.keyDownWindow.bind(i,u),document.addEventListener("keydown",i.keyDownEvent))}},{key:"remove",value:function remove(i){document.removeEventListener("mousedown",i.mouseDownEvent),document.removeEventListener("mouseup",i.mouseUpEvent),document.removeEventListener("keydown",i.keyDownEvent)}}])}();Ho.EventListeners=Wo;Wo.KEY_DOWN_TIMEOUT=null;var Ko={};Object.defineProperty(Ko,"__esModule",{value:!0});Ko.PreResultUtils=void 0;var $o=function(){function Vo(){_classCallCheck(this,Vo)}return _createClass(Vo,null,[{key:"process",value:function process(i,u,d,h,m){var v=h==null?void 0:h(u,d);return!!v&&(setTimeout((function(){v.restart?i.resetRecording(m):v.stop&&i.stop()})),(v.stop||v.restart)&&v.removeNewText)}}])}();Ko.PreResultUtils=$o;var Jo={},Yo={};Object.defineProperty(Yo,"__esModule",{value:!0});Yo.AutoScroll=void 0;var Xo=function(){function bn(){_classCallCheck(this,bn)}return _createClass(bn,null,[{key:"changeStateIfNeeded",value:function changeStateIfNeeded(i,u){u&&!i.isCursorAtEnd&&(i.endPadding="",i.scrollingSpan.innerHTML="&nbsp;")}},{key:"scrollGeneric",value:function scrollGeneric(i,u){i.isCursorAtEnd?u.scrollTop=u.scrollHeight:i.scrollingSpan.scrollIntoView({block:"nearest"})}},{key:"scrollSafariPrimitiveToEnd",value:function scrollSafariPrimitiveToEnd(i){i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight}},{key:"isElementOverflown",value:function isElementOverflown(i){return i.scrollHeight>i.clientHeight||i.scrollWidth>i.clientWidth}},{key:"isRequired",value:function isRequired(i,u){return i&&bn.isElementOverflown(u)}}])}();Yo.AutoScroll=Xo;var el={};Object.defineProperty(el,"__esModule",{value:!0});el.Elements=void 0;var tl=function(){function Go(){_classCallCheck(this,Go)}return _createClass(Go,null,[{key:"isPrimitiveElement",value:function isPrimitiveElement(i){return i.tagName==="INPUT"||i.tagName==="TEXTAREA"}},{key:"createInterimSpan",value:function createInterimSpan(){var i=document.createElement("span");return i.style.color="grey",i.style.pointerEvents="none",i}},{key:"createGenericSpan",value:function createGenericSpan(){var i=document.createElement("span");return i.style.pointerEvents="none",i}},{key:"appendSpans",value:function appendSpans(i,u){if(i.spansPopulated=!0,i.insertInCursorLocation&&document.activeElement===u){var d=window.getSelection();if(d!=null&&d.focusNode){var h=d.getRangeAt(0);h.insertNode(i.scrollingSpan),h.insertNode(i.interimSpan),h.insertNode(i.finalSpan),h.collapse(!1),d.removeAllRanges(),d.addRange(h);return}}u.appendChild(i.finalSpan),u.appendChild(i.interimSpan),u.appendChild(i.scrollingSpan)}},{key:"applyCustomColors",value:function applyCustomColors(i,u){u.interim&&(i.interimSpan.style.color=u.interim),u.final&&(i.finalSpan.style.color=u.final)}},{key:"isInsideShadowDOM",value:function isInsideShadowDOM(i){return i.getRootNode()instanceof ShadowRoot}}])}();el.Elements=tl;var nl={};Object.defineProperty(nl,"__esModule",{value:!0});nl.Cursor=void 0;var rl=function(){function Et(){_classCallCheck(this,Et)}return _createClass(Et,null,[{key:"setOffsetForGeneric",value:function setOffsetForGeneric(i,u){var d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;var h=0;for(var m=0;m<i.childNodes.length;m+=1){var v=i.childNodes[m];if(v.childNodes.length>0){var g=Et.setOffsetForGeneric(v,u,d);if(g===-1)return-1;d+=g}else if(v.textContent!==null){if(d+v.textContent.length>u){var y=document.createRange();y.setStart(v,u-d),y.collapse(!0);var b=window.getSelection();return b==null||b.removeAllRanges(),b==null||b.addRange(y),i.focus(),-1}d+=v.textContent.length,h+=v.textContent.length}}return h}},{key:"focusEndOfGeneric",value:function focusEndOfGeneric(i){var u=document.createRange();u.selectNodeContents(i),u.collapse(!1);var d=window.getSelection();d&&(d.removeAllRanges(),d.addRange(u))}},{key:"setOffsetForSafariGeneric",value:function setOffsetForSafariGeneric(i,u){var d=window.getSelection();if(d){var h=Et.getGenericElementCursorOffset(i,d,!0);console.log(h),setTimeout((function(){}),100),Et.setOffsetForGeneric(i,h+u)}}},{key:"setOffsetForPrimitive",value:function setOffsetForPrimitive(i,u,d){d&&i.blur(),i.setSelectionRange(u,u),i.focus()}},{key:"getGenericElementCursorOffset",value:function getGenericElementCursorOffset(i,u,d){var h=0;if(u.rangeCount>0){var m=u.getRangeAt(0),v=m.cloneRange();v.selectNodeContents(i),d?v.setEnd(m.startContainer,m.startOffset):v.setEnd(m.endContainer,m.endOffset),h=v.toString().length}return h}}])}();nl.Cursor=rl;Object.defineProperty(Jo,"__esModule",{value:!0});Jo.CommandUtils=void 0;var al=Yo,il=el,sl=Bo,ol=nl,ll=fo;var cl=function(){function te(){_classCallCheck(this,te)}return _createClass(te,null,[{key:"processCommand",value:function processCommand(i,u){return(!u||!u.caseSensitive)&&(i=i.toLowerCase()),(u==null?void 0:u.substrings)===!1?ll.Text.breakupIntoWordsArr(i):i}},{key:"process",value:function process(i){var u;return((u=i.settings)===null||u===void 0?void 0:u.caseSensitive)===!0?i:Object.keys(i).reduce((function(u,d){var h=i[d];return u[d]=typeof h=="string"?te.processCommand(h,i.settings):h,u}),{})}},{key:"toggleCommandModeOn",value:function toggleCommandModeOn(i){var u;i.isWaitingForCommand=!0,(u=i.onCommandModeTrigger)===null||u===void 0||u.call(i,!0)}},{key:"toggleCommandModeOff",value:function toggleCommandModeOff(i){var u;i.isWaitingForCommand&&((u=i.onCommandModeTrigger)===null||u===void 0||u.call(i,!1),i.isWaitingForCommand=!1)}},{key:"setText",value:function setText(i,u,d,h){te.toggleCommandModeOff(i),il.Elements.isPrimitiveElement(h)?(h.value=d,i.isTargetInShadow||ol.Cursor.setOffsetForPrimitive(h,d.length,!0),sl.Browser.IS_SAFARI()&&i.autoScroll&&al.AutoScroll.scrollSafariPrimitiveToEnd(h)):(h.textContent=d,i.isTargetInShadow||ol.Cursor.focusEndOfGeneric(h),setTimeout((function(){return al.AutoScroll.scrollGeneric(i,h)}))),i.resetRecording(u)}},{key:"checkIfMatchesSubstring",value:function checkIfMatchesSubstring(i,u){return u.includes(i)}},{key:"checkIfMatchesWord",value:function checkIfMatchesWord(i,u,d){var h=i;for(var m=d.length-1;m>=0;m-=1){var v=m,g=h.length-1;for(;d[v]===h[g]&&g>=0;)v-=1,g-=1;if(g<0)return!0}return!1}},{key:"execCommand",value:function execCommand(i,u,d,h,m){var v,g,y;var b=i.commands;if(b&&h&&d){var x=((v=b.settings)===null||v===void 0?void 0:v.caseSensitive)===!0?u:u.toLowerCase(),A=ll.Text.breakupIntoWordsArr(x),P=((g=b.settings)===null||g===void 0?void 0:g.substrings)===!1?te.checkIfMatchesWord:te.checkIfMatchesSubstring;if(b.commandMode&&P(b.commandMode,x,A))return i.setInterimColorToFinal(),setTimeout((function(){return te.toggleCommandModeOn(i)})),{doNotProcessTranscription:!1};if(!(b.commandMode&&!i.isWaitingForCommand)){if(b.stop&&P(b.stop,x,A))return te.toggleCommandModeOff(i),setTimeout((function(){return i.stop()})),{doNotProcessTranscription:!1};if(b.pause&&P(b.pause,x,A))return te.toggleCommandModeOff(i),i.setInterimColorToFinal(),setTimeout((function(){var u;i.isPaused=!0,(u=i.onPauseTrigger)===null||u===void 0||u.call(i,!0)})),{doNotProcessTranscription:!1};if(b.resume&&P(b.resume,x,A))return i.isPaused=!1,(y=i.onPauseTrigger)===null||y===void 0||y.call(i,!1),te.toggleCommandModeOff(i),i.resetRecording(d),{doNotProcessTranscription:!0};if(b.reset&&P(b.reset,x,A))return m!==void 0&&te.setText(i,d,m,h),{doNotProcessTranscription:!0};if(b.removeAllText&&P(b.removeAllText,x,A))return te.setText(i,d,"",h),{doNotProcessTranscription:!0}}}}}])}();Jo.CommandUtils=cl;var ul={};Object.defineProperty(ul,"__esModule",{value:!0});ul.Highlight=void 0;var dl=el,pl=nl;var hl=function(){function hi(){_classCallCheck(this,hi)}return _createClass(hi,null,[{key:"setStateForPrimitive",value:function setStateForPrimitive(i,u){var d,h;u.selectionStart!==null&&(d=u.selectionStart),u.selectionEnd!==null&&(h=u.selectionEnd),i.isHighlighted=d!==h}},{key:"setStateForGeneric",value:function setStateForGeneric(i,u){var d=window.getSelection();if(d!=null&&d.focusNode){var h=pl.Cursor.getGenericElementCursorOffset(u,d,!0),m=pl.Cursor.getGenericElementCursorOffset(u,d,!1);i.isHighlighted=h!==m}}},{key:"setState",value:function setState(i,u){document.activeElement===u&&(dl.Elements.isPrimitiveElement(u)?hi.setStateForPrimitive(i,u):hi.setStateForGeneric(i,u))}},{key:"removeForGeneric",value:function removeForGeneric(i,u){var d=window.getSelection();if(d){var h=pl.Cursor.getGenericElementCursorOffset(u,d,!0);d.deleteFromDocument(),pl.Cursor.setOffsetForGeneric(u,h),i.isHighlighted=!1}}},{key:"removeForPrimitive",value:function removeForPrimitive(i,u){var d=u.selectionStart,h=u.selectionEnd,m=u.value;if(d&&h){var v=m.substring(0,d)+m.substring(h);u.value=v,pl.Cursor.setOffsetForPrimitive(u,d,i.autoScroll)}i.isHighlighted=!1}}])}();ul.Highlight=hl;var fl={};Object.defineProperty(fl,"__esModule",{value:!0});fl.Padding=void 0;var ml=el,vl=nl,gl=fo;var yl=function(){function ui(){_classCallCheck(this,ui)}return _createClass(ui,null,[{key:"setStateForPrimitiveElement",value:function setStateForPrimitiveElement(i,u){if(document.activeElement!==u||u.selectionStart===null){var d=u.value[u.value.length-1];gl.Text.isCharDefined(d)&&(i.startPadding=" ",i.numberOfSpacesBeforeNewText=1),i.isCursorAtEnd=!0}else{var h=u.selectionStart,m=u.value[h-1],v=u.selectionEnd===null?h:u.selectionEnd,g=u.value[v];gl.Text.isCharDefined(m)&&(i.startPadding=" ",i.numberOfSpacesBeforeNewText=1),gl.Text.isCharDefined(g)&&(i.endPadding=" ",i.numberOfSpacesAfterNewText=1),i.isCursorAtEnd=u.value.length===v}}},{key:"setStateForGenericElement",value:function setStateForGenericElement(i,u){var d,h,m;if(document.activeElement===u){var v=window.getSelection();if(v!=null&&v.focusNode){var g=vl.Cursor.getGenericElementCursorOffset(u,v,!0),y=(d=u.textContent)===null||d===void 0?void 0:d[g-1],b=vl.Cursor.getGenericElementCursorOffset(u,v,!1),x=(h=u.textContent)===null||h===void 0?void 0:h[b];gl.Text.isCharDefined(y)&&(i.startPadding=" "),gl.Text.isCharDefined(x)&&(i.endPadding=" "),i.isCursorAtEnd=((m=u.textContent)===null||m===void 0?void 0:m.length)===b;return}}var A=u.innerText.charAt(u.innerText.length-1);gl.Text.isCharDefined(A)&&(i.startPadding=" "),i.isCursorAtEnd=!0}},{key:"setState",value:function setState(i,u){ml.Elements.isPrimitiveElement(u)?ui.setStateForPrimitiveElement(i,u):ui.setStateForGenericElement(i,u)}},{key:"adjustStateAfterRecodingPrimitiveElement",value:function adjustStateAfterRecodingPrimitiveElement(i,u){i.primitiveTextRecorded=!0,i.insertInCursorLocation&&document.activeElement===u&&(u.selectionEnd!==null&&(i.endPadding=i.endPadding+u.value.slice(u.selectionEnd)),u.selectionStart!==null)?i.startPadding=u.value.slice(0,u.selectionStart)+i.startPadding:i.startPadding=u.value+i.startPadding}},{key:"adjustSateForNoTextPrimitiveElement",value:function adjustSateForNoTextPrimitiveElement(i){i.numberOfSpacesBeforeNewText===1&&(i.startPadding=i.startPadding.substring(0,i.startPadding.length-1),i.numberOfSpacesBeforeNewText=0),i.numberOfSpacesAfterNewText===1&&(i.endPadding=i.endPadding.substring(1),i.numberOfSpacesAfterNewText=0)}}])}();fl.Padding=yl;Object.defineProperty(Uo,"__esModule",{value:!0});Uo.Speech=void 0;var _l=Ho,bl=Ko,kl=Jo,Sl=Yo,xl=ul,Cl=el,wl=fl,El=Bo,Tl=nl,Al=fo;var Rl=function(){function Zo(){_classCallCheck(this,Zo);this.finalTranscript="",this.interimSpan=Cl.Elements.createInterimSpan(),this.finalSpan=Cl.Elements.createGenericSpan(),this.scrollingSpan=Cl.Elements.createGenericSpan(),this.isCursorAtEnd=!1,this.spansPopulated=!1,this.startPadding="",this.endPadding="",this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.recognizing=!1,this._displayInterimResults=!0,this.insertInCursorLocation=!0,this.autoScroll=!0,this.isRestarting=!1,this.isPaused=!1,this.isWaitingForCommand=!1,this.isTargetInShadow=!1,this.cannotBeStopped=!1,this.resetState()}return _createClass(Zo,[{key:"prepareBeforeStart",value:function prepareBeforeStart(i){var u,d;if(i!=null&&i.element)if(_l.EventListeners.add(this,i),Array.isArray(i.element)){var h=i.element.find((function(i){return i===document.activeElement}))||i.element[0];if(!h)return;this.prepare(h)}else this.prepare(i.element);(i==null?void 0:i.displayInterimResults)!==void 0&&(this._displayInterimResults=i.displayInterimResults),i!=null&&i.textColor&&(this._finalTextColor=(u=i==null?void 0:i.textColor)===null||u===void 0?void 0:u.final,Cl.Elements.applyCustomColors(this,i.textColor)),(i==null?void 0:i.insertInCursorLocation)!==void 0&&(this.insertInCursorLocation=i.insertInCursorLocation),(i==null?void 0:i.autoScroll)!==void 0&&(this.autoScroll=i.autoScroll),this._onResult=i==null?void 0:i.onResult,this._onPreResult=i==null?void 0:i.onPreResult,this._onStart=i==null?void 0:i.onStart,this._onStop=i==null?void 0:i.onStop,this._onError=i==null?void 0:i.onError,this.onCommandModeTrigger=i==null?void 0:i.onCommandModeTrigger,this.onPauseTrigger=i==null?void 0:i.onPauseTrigger,this._options=i,!((d=this._options)===null||d===void 0)&&d.commands&&(this.commands=kl.CommandUtils.process(this._options.commands))}},{key:"prepare",value:function prepare(i){wl.Padding.setState(this,i),xl.Highlight.setState(this,i),this.isTargetInShadow=Cl.Elements.isInsideShadowDOM(i),Cl.Elements.isPrimitiveElement(i)?(this._primitiveElement=i,this._originalText=this._primitiveElement.value):(this._genericElement=i,this._originalText=this._genericElement.textContent)}},{key:"resetRecording",value:function resetRecording(i){this.isRestarting=!0,this.stop(!0),this.resetState(!0),this.start(i,!0)}},{key:"updateElements",value:function updateElements(i,u,d){var h;var m=Al.Text.capitalize(u);if(this.finalTranscript!==m||i!==""){bl.PreResultUtils.process(this,d,i==="",this._onPreResult,this._options)&&(i="",d="");var v=this.commands&&kl.CommandUtils.execCommand(this,d,this._options,this._primitiveElement||this._genericElement,this._originalText);if(v){if(v.doNotProcessTranscription)return;i="",d=""}if(!this.isPaused&&!this.isWaitingForCommand){(h=this._onResult)===null||h===void 0||h.call(this,d,i===""),this.finalTranscript=m,this._displayInterimResults||(i="");var g=this.finalTranscript===""&&i==="";this._primitiveElement?this.updatePrimitiveElement(this._primitiveElement,i,g):this._genericElement&&this.updateGenericElement(this._genericElement,i,g)}}}},{key:"updatePrimitiveElement",value:function updatePrimitiveElement(i,u,d){this.isHighlighted&&xl.Highlight.removeForPrimitive(this,i),this.primitiveTextRecorded||wl.Padding.adjustStateAfterRecodingPrimitiveElement(this,i),d&&wl.Padding.adjustSateForNoTextPrimitiveElement(this);var h=this.startPadding+this.finalTranscript+u;if(i.value=h+this.endPadding,!this.isTargetInShadow){var m=h.length+this.numberOfSpacesAfterNewText;Tl.Cursor.setOffsetForPrimitive(i,m,this.autoScroll)}this.autoScroll&&El.Browser.IS_SAFARI()&&this.isCursorAtEnd&&Sl.AutoScroll.scrollSafariPrimitiveToEnd(i)}},{key:"updateGenericElement",value:function updateGenericElement(i,u,d){this.isHighlighted&&xl.Highlight.removeForGeneric(this,i),this.spansPopulated||Cl.Elements.appendSpans(this,i);var h=(d?"":this.startPadding)+Al.Text.lineBreak(this.finalTranscript);this.finalSpan.innerHTML=h;var m=Sl.AutoScroll.isRequired(this.autoScroll,i);Sl.AutoScroll.changeStateIfNeeded(this,m);var v=Al.Text.lineBreak(u)+(d?"":this.endPadding);this.interimSpan.innerHTML=v,El.Browser.IS_SAFARI()&&this.insertInCursorLocation&&Tl.Cursor.setOffsetForSafariGeneric(i,h.length+v.length),m&&Sl.AutoScroll.scrollGeneric(this,i),d&&(this.scrollingSpan.innerHTML="")}},{key:"finalise",value:function finalise(i){this._genericElement&&(i?(this.finalSpan=Cl.Elements.createGenericSpan(),this.setInterimColorToFinal(),this.interimSpan=Cl.Elements.createInterimSpan(),this.scrollingSpan=Cl.Elements.createGenericSpan()):this._genericElement.textContent=this._genericElement.textContent,this.spansPopulated=!1),_l.EventListeners.remove(this)}},{key:"setInterimColorToFinal",value:function setInterimColorToFinal(){this.interimSpan.style.color=this._finalTextColor||"black"}},{key:"resetState",value:function resetState(i){this._primitiveElement=void 0,this._genericElement=void 0,this.finalTranscript="",this.finalSpan.innerHTML="",this.interimSpan.innerHTML="",this.scrollingSpan.innerHTML="",this.startPadding="",this.endPadding="",this.isHighlighted=!1,this.primitiveTextRecorded=!1,this.numberOfSpacesBeforeNewText=0,this.numberOfSpacesAfterNewText=0,i||(this.stopTimeout=void 0)}},{key:"setStateOnStart",value:function setStateOnStart(){var i;this.recognizing=!0,this.isRestarting?this.isRestarting=!1:(i=this._onStart)===null||i===void 0||i.call(this)}},{key:"setStateOnStop",value:function setStateOnStop(){var i;this.recognizing=!1,this.isRestarting||(i=this._onStop)===null||i===void 0||i.call(this)}},{key:"setStateOnError",value:function setStateOnError(i){var u;(u=this._onError)===null||u===void 0||u.call(this,i),this.recognizing=!1}}])}();Uo.Speech=Rl;Object.defineProperty(io,"__esModule",{value:!0});io.WebSpeech=void 0;var Il=co,Ml=Bo,Ll=Uo;var Ol=function(i){function fi(){_classCallCheck(this,fi);return _callSuper(this,fi)}_inherits(fi,i);return _createClass(fi,[{key:"start",value:function start(i){var u;this._extractText===void 0&&(this._extractText=Ml.Browser.IS_SAFARI()?Il.WebSpeechTranscript.extractSafari:Il.WebSpeechTranscript.extract),this.validate()&&(this.prepareBeforeStart(i),this.instantiateService(i),(u=this._service)===null||u===void 0||u.start(),this._translations=i==null?void 0:i.translations)}},{key:"validate",value:function validate(){return!!fi.getAPI()||(this.error("Speech Recognition is unsupported"),!1)}},{key:"instantiateService",value:function instantiateService(i){var u,d;var h=fi.getAPI();this._service=new h,this._service.continuous=!0,this._service.interimResults=(u=i==null?void 0:i.displayInterimResults)===null||u===void 0||u,this._service.lang=((d=i==null?void 0:i.language)===null||d===void 0?void 0:d.trim())||"en-US",this.setEvents()}},{key:"setEvents",value:function setEvents(){var i=this;this._service&&(this._service.onstart=function(){i.setStateOnStart()},this._service.onerror=function(u){Ml.Browser.IS_SAFARI()&&u.message==="Another request is started"||u.error==="aborted"&&i.isRestarting||u.error!=="no-speech"&&i.error(u.message||u.error)},this._service.onaudioend=function(){i.setStateOnStop()},this._service.onend=function(){i._stopping=!1},this._service.onresult=function(u){if(_typeof(u.results)>"u"&&i._service)i._service.onend=null,i._service.stop();else if(i._extractText&&!i._stopping){var d=i._extractText(u,i.finalTranscript,i._translations),h=d.interimTranscript,m=d.finalTranscript,v=d.newText;i.updateElements(h,m,v)}})}},{key:"stop",value:function stop(i){var u;this._stopping=!0,(u=this._service)===null||u===void 0||u.stop(),this.finalise(i)}},{key:"error",value:function error(i){console.error(i),this.setStateOnError(i),this.stop()}}],[{key:"getAPI",value:function getAPI(){return window.webkitSpeechRecognition||window.SpeechRecognition}}])}(Ll.Speech);io.WebSpeech=Ol;var Pl={};Object.defineProperty(Pl,"__esModule",{value:!0});Pl.GlobalState=void 0;var Nl=function(){function ct(){_classCallCheck(this,ct)}return _createClass(ct,null,[{key:"doubleClickDetector",value:function doubleClickDetector(){return!!ct.doubleClickPending||(ct.doubleClickPending=!0,setTimeout((function(){ct.doubleClickPending=!1}),300),!1)}}])}();Pl.GlobalState=Nl;Nl.doubleClickPending=!1;var Fl={},Dl={};Object.defineProperty(Dl,"__esModule",{value:!0});Dl.PreventConnectionStop=void 0;var Bl=function(){function Qo(){_classCallCheck(this,Qo)}return _createClass(Qo,null,[{key:"applyPrevention",value:function applyPrevention(i){clearTimeout(i._manualConnectionStopPrevention),i.cannotBeStopped=!0,i._manualConnectionStopPrevention=setTimeout((function(){i.cannotBeStopped=!1}),800)}},{key:"clearPrevention",value:function clearPrevention(i){clearTimeout(i._manualConnectionStopPrevention),i.cannotBeStopped=!1}}])}();Dl.PreventConnectionStop=Bl;var jl={},Ul={};Object.defineProperty(Ul,"__esModule",{value:!0});Ul.README_URL=void 0;Ul.README_URL="https://github.com/OvidijusParsiunas/speech-to-element";Object.defineProperty(jl,"__esModule",{value:!0});jl.AzureSpeechConfig=void 0;var Hl=Ul;var Gl=function(){function pi(){_classCallCheck(this,pi)}return _createClass(pi,null,[{key:"validateOptions",value:function validateOptions(i,u){return u?u.subscriptionKey||u.token||u.retrieveToken?!!u.region||(i("Please define a 'region' property - more info: ".concat(Hl.README_URL)),!1):(i("Please define a 'subscriptionKey', 'token' or 'retrieveToken' property - more info: ".concat(Hl.README_URL)),!1):(i("Please provide subscription details - more info: ".concat(Hl.README_URL)),!1)}},{key:"getNewSpeechConfig",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee109(i,u){return _regeneratorRuntime().wrap((function _callee109$(d){while(1)switch(d.prev=d.next){case 0:if(!u.region){d.next=2;break}return d.abrupt("return",u.subscriptionKey?i.fromSubscription(u.subscriptionKey.trim(),u.region.trim()):u.token?i.fromAuthorizationToken(u.token.trim(),u.region.trim()):u.retrieveToken?u.retrieveToken().then((function(d){return u.region?i.fromAuthorizationToken((d==null?void 0:d.trim())||"",u.region.trim()):null})).catch((function(i){return console.error(i),null})):null);case 2:case"end":return d.stop()}}),_callee109)})));function getNewSpeechConfig(u,d){return i.apply(this,arguments)}return getNewSpeechConfig}()},{key:"process",value:function process(i,u){u.language&&(i.speechRecognitionLanguage=u.language.trim())}},{key:"get",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee110(i,u){var d;return _regeneratorRuntime().wrap((function _callee110$(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return pi.getNewSpeechConfig(i,u);case 2:d=h.sent;return h.abrupt("return",(d&&pi.process(d,u),d));case 4:case"end":return h.stop()}}),_callee110)})));function get(u,d){return i.apply(this,arguments)}return get}()}])}();jl.AzureSpeechConfig=Gl;var ql={};Object.defineProperty(ql,"__esModule",{value:!0});ql.StopTimeout=void 0;var zl=function(){function Ot(){_classCallCheck(this,Ot)}return _createClass(Ot,null,[{key:"set",value:function set(i){i.stopTimeout=setTimeout((function(){return i.stop()}),i.stopTimeoutMS)}},{key:"reset",value:function reset(i,u){i.stopTimeoutMS=u||Ot.DEFAULT_MS,i.stopTimeout&&clearTimeout(i.stopTimeout),Ot.set(i)}}])}();ql.StopTimeout=zl;zl.DEFAULT_MS=2e4;var Vl={};Object.defineProperty(Vl,"__esModule",{value:!0});Vl.AzureTranscript=void 0;var Wl=po;var Kl=function(){function ta(){_classCallCheck(this,ta)}return _createClass(ta,null,[{key:"extract",value:function extract(i,u,d,h){return h&&(i=Wl.Translate.translate(i,h)),d?{interimTranscript:"",finalTranscript:u+i,newText:i}:{interimTranscript:i,finalTranscript:u,newText:i}}}])}();Vl.AzureTranscript=Kl;Object.defineProperty(Fl,"__esModule",{value:!0});Fl.Azure=void 0;var $l=Dl,Jl=jl,Yl=ql,Zl=Vl,Xl=Uo;var Ql=function(i){function mi(){var i;_classCallCheck(this,mi);i=_callSuper(this,mi,arguments),i._newTextPadding="";return i}_inherits(mi,i);return _createClass(mi,[{key:"start",value:function start(i,u){this._newTextPadding="",this.stopTimeout===void 0&&Yl.StopTimeout.reset(this,i==null?void 0:i.stopAfterSilenceMs),this.prepareBeforeStart(i),this.startAsync(i),u||$l.PreventConnectionStop.applyPrevention(this)}},{key:"startAsync",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee111(i){var u;return _regeneratorRuntime().wrap((function _callee111$(d){while(1)switch(d.prev=d.next){case 0:d.t0=this.validate(i);if(!d.t0){d.next=6;break}d.next=4;return this.instantiateService(i);case 4:this._translations=i==null?void 0:i.translations;(u=this._service)===null||u===void 0||u.startContinuousRecognitionAsync((function(){}),this.error);case 6:case"end":return d.stop()}}),_callee111,this)})));function startAsync(u){return i.apply(this,arguments)}return startAsync}()},{key:"validate",value:function validate(i){return mi.getAPI()?Jl.AzureSpeechConfig.validateOptions(this.error.bind(this),i):(this.moduleNotFound(),!1)}},{key:"instantiateService",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee112(i){var u,d,h,m;return _regeneratorRuntime().wrap((function _callee112$(v){while(1)switch(v.prev=v.next){case 0:u=mi.getAPI();d=u.AudioConfig.fromDefaultMicrophoneInput();v.next=4;return Jl.AzureSpeechConfig.get(u.SpeechConfig,i);case 4:h=v.sent;if(h){m=new u.SpeechRecognizer(h,d);this.setEvents(m),this._service=m,i.retrieveToken&&this.retrieveTokenInterval(i.retrieveToken)}else this.error("Unable to contact Azure server");case 6:case"end":return v.stop()}}),_callee112,this)})));function instantiateService(u){return i.apply(this,arguments)}return instantiateService}()},{key:"setEvents",value:function setEvents(i){i.recognizing=this.onRecognizing.bind(this),i.recognized=this.onRecognized.bind(this),i.sessionStarted=this.onSessionStarted.bind(this),i.canceled=this.onCanceled.bind(this),i.sessionStopped=this.onSessionStopped.bind(this)}},{key:"onRecognizing",value:function onRecognizing(i,u){if(!this._stopping){var d=Zl.AzureTranscript.extract(this._newTextPadding+u.result.text,this.finalTranscript,!1,this._translations),h=d.interimTranscript,m=d.finalTranscript,v=d.newText;Yl.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(h,m,v)}}},{key:"onRecognized",value:function onRecognized(i,u){var d=u.result;switch(d.reason){case window.SpeechSDK.ResultReason.Canceled:break;case window.SpeechSDK.ResultReason.RecognizedSpeech:if(d.text&&!this._stopping){var h=Zl.AzureTranscript.extract(this._newTextPadding+d.text,this.finalTranscript,!0,this._translations),m=h.interimTranscript,v=h.finalTranscript,g=h.newText;Yl.StopTimeout.reset(this,this.stopTimeoutMS),this.updateElements(m,v,g),v!==""&&(this._newTextPadding=" ")}break}}},{key:"onCanceled",value:function onCanceled(i,u){u.reason===window.SpeechSDK.CancellationReason.Error&&this.error(u.errorDetails)}},{key:"onSessionStarted",value:function onSessionStarted(){$l.PreventConnectionStop.clearPrevention(this),this.setStateOnStart()}},{key:"onSessionStopped",value:function onSessionStopped(){this._retrieveTokenInterval||clearInterval(this._retrieveTokenInterval),this._stopping=!1,this.setStateOnStop()}},{key:"retrieveTokenInterval",value:function retrieveTokenInterval(i){var u=this;this._retrieveTokenInterval=setInterval((function(){i==null||i().then((function(i){u._service&&(u._service.authorizationToken=(i==null?void 0:i.trim())||"")})).catch((function(i){u.error(i)}))}),1e4)}},{key:"stop",value:function stop(i){var u;!i&&this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),this._stopping=!0,(u=this._service)===null||u===void 0||u.stopContinuousRecognitionAsync(),this.finalise(i)}},{key:"moduleNotFound",value:function moduleNotFound(){console.error("speech recognition module not found:"),console.error("please install the 'microsoft-cognitiveservices-speech-sdk' npm package or add a script tag: <script src=\"https://aka.ms/csspeech/jsbrowserpackageraw\"><\/script>"),this.setStateOnError("speech recognition module not found")}},{key:"error",value:function error(i){this._retrieveTokenInterval&&clearInterval(this._retrieveTokenInterval),console.error(i),this.setStateOnError(i),this.stop()}}],[{key:"getAPI",value:function getAPI(){return window.SpeechSDK}}])}(Xl.Speech);Fl.Azure=Ql;Object.defineProperty(to,"__esModule",{value:!0});var ec=io,tc=Jo,nc=Pl,rc=Fl;var ac=function(){function it(){_classCallCheck(this,it)}return _createClass(it,null,[{key:"toggle",value:function toggle(i,u){var d,h;var m=i.toLocaleLowerCase().trim();(d=nc.GlobalState.service)===null||d===void 0||!d.recognizing?m==="webspeech"?it.startWebSpeech(u):m==="azure"?it.startAzure(u):(console.error("service not found - must be either 'webspeech' or 'azure'"),(h=u==null?void 0:u.onError)===null||h===void 0||h.call(u,"service not found - must be either 'webspeech' or 'azure'")):this.stop()}},{key:"startWebSpeech",value:function startWebSpeech(i){it.stop()||(nc.GlobalState.service=new ec.WebSpeech,nc.GlobalState.service.start(i))}},{key:"isWebSpeechSupported",value:function isWebSpeechSupported(){return!!ec.WebSpeech.getAPI()}},{key:"startAzure",value:function startAzure(i){var u;it.stop()||!((u=nc.GlobalState.service)===null||u===void 0)&&u.cannotBeStopped||(nc.GlobalState.service=new rc.Azure,nc.GlobalState.service.start(i))}},{key:"stop",value:function stop(){var i;return!!nc.GlobalState.doubleClickDetector()||(!((i=nc.GlobalState.service)===null||i===void 0)&&i.recognizing&&nc.GlobalState.service.stop(),!1)}},{key:"endCommandMode",value:function endCommandMode(){nc.GlobalState.service&&tc.CommandUtils.toggleCommandModeOff(nc.GlobalState.service)}}])}();var ic=to.default=ac;var sc=function(){function ra(i,u){_classCallCheck(this,ra);this.silenceMS=2e3,this.stop=!0,typeof u=="boolean"&&u===!1&&(this.stop=!1),typeof i=="number"&&(this.silenceMS=i)}return _createClass(ra,[{key:"setSilenceTimeout",value:function setSilenceTimeout(i,u){var d=this;this._silenceTimeout=setTimeout((function(){var h;(h=i.submit)==null||h.call(i),ic.stop(),d.stop||setTimeout(u,lc.MICROPHONE_RESET_TIMEOUT_MS)}),this.silenceMS)}},{key:"clearSilenceTimeout",value:function clearSilenceTimeout(){this._silenceTimeout&&clearTimeout(this._silenceTimeout)}},{key:"resetSilenceTimeout",value:function resetSilenceTimeout(i,u){this.clearSilenceTimeout(),this.setSilenceTimeout(i,u)}},{key:"onPause",value:function onPause(i,u,d){i?this.resetSilenceTimeout(u,d):this.clearSilenceTimeout()}}])}();var oc=function(i){function Ct(i,u,d){var h;_classCallCheck(this,Ct);var m=_typeof(i.speechToText)=="object"?i.speechToText:{};h=_callSuper(this,Ct,[m==null?void 0:m.button]);var v=h.processConfiguration(u,i.speechToText),g=v.serviceName,y=v.processedConfig;if(h._addErrorMessage=d,g!=="webspeech"||ic.isWebSpeechSupported()){var b=!i.textInput||!i.textInput.disabled;h.elementRef.onclick=h.buttonClick.bind(h,u,b,g,y)}else h.changeToUnsupported();setTimeout((function(){h._validationHandler=i._validationHandler}));return h}_inherits(Ct,i);return _createClass(Ct,[{key:"processConfiguration",value:function processConfiguration(i,u){var d,h,m,v,g;var y;var b=_typeof(u)=="object"?u:{},x=_typeof(b.webSpeech)=="object"?b.webSpeech:{},A=b.azure||{},P=_objectSpread(_objectSpread({displayInterimResults:(d=b.displayInterimResults)!==null&&d!==void 0?d:void 0,textColor:(h=b.textColor)!==null&&h!==void 0?h:void 0,translations:(m=b.translations)!==null&&m!==void 0?m:void 0,commands:(v=b.commands)!==null&&v!==void 0?v:void 0,events:(g=b.events)!==null&&g!==void 0?g:void 0},x),A),D=(y=b.commands)==null?void 0:y.submit;return D&&(P.onPreResult=function(u){return u.toLowerCase().includes(D)?(setTimeout((function(){var u;return(u=i.submit)==null?void 0:u.call(i)})),ic.endCommandMode(),{restart:!0,removeNewText:!0}):null}),b.submitAfterSilence&&(this._silenceSubmit=new sc(b.submitAfterSilence,b.stopAfterSubmit)),{serviceName:Ct.getServiceName(b),processedConfig:P}}},{key:"buttonClick",value:function buttonClick(i,u,d,h){var m=this;var v=h==null?void 0:h.events;i.removeTextIfPlaceholder(),ic.toggle(d,_objectSpread({insertInCursorLocation:!1,element:u?i.inputElementRef:void 0,onError:function onError(){var i;m.onError(),(i=m._silenceSubmit)==null||i.clearSilenceTimeout()},onStart:function onStart(){var i;m.changeToActive(),(i=v==null?void 0:v.onStart)==null||i.call(v)},onStop:function onStop(){var i,u,d;(i=m._validationHandler)==null||i.call(m),(u=m._silenceSubmit)==null||u.clearSilenceTimeout(),m.changeToDefault(),(d=v==null?void 0:v.onStop)==null||d.call(v)},onPauseTrigger:function onPauseTrigger(u){var d,h;(d=m._silenceSubmit)==null||d.onPause(u,i,m.elementRef.onclick),(h=v==null?void 0:v.onPauseTrigger)==null||h.call(v,u)},onPreResult:function onPreResult(i,u){var d;(d=v==null?void 0:v.onPreResult)==null||d.call(v,i,u)},onResult:function onResult(u,d){var h,g,y;d&&((h=m._validationHandler)==null||h.call(m)),(g=m._silenceSubmit)==null||g.resetSilenceTimeout(i,m.elementRef.onclick),(y=v==null?void 0:v.onResult)==null||y.call(v,u,d)},onCommandModeTrigger:function onCommandModeTrigger(i){var u;m.onCommandModeTrigger(i),(u=v==null?void 0:v.onCommandModeTrigger)==null||u.call(v,i)}},h))}},{key:"onCommandModeTrigger",value:function onCommandModeTrigger(i){i?this.changeToCommandMode():this.changeToActive()}},{key:"onError",value:function onError(){this._addErrorMessage("speechToText","speech input error")}}],[{key:"getServiceName",value:function getServiceName(i){return i.azure?"azure":"webspeech"}},{key:"toggleSpeechAfterSubmit",value:function toggleSpeechAfterSubmit(i){var u=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];i.click(),u||setTimeout((function(){return i.click()}),Ct.MICROPHONE_RESET_TIMEOUT_MS)}}])}(eo);oc.MICROPHONE_RESET_TIMEOUT_MS=300;var lc=oc;var cc=function(){function Se(i,u,d,h){var m=this;_classCallCheck(this,Se);this._attachments=[],this._fileCountLimit=99,this._acceptedFormat="",u.maxNumberOfFiles&&(this._fileCountLimit=u.maxNumberOfFiles),this._toggleContainerDisplay=d,this._fileAttachmentsContainerRef=h,u.acceptedFormats&&(this._acceptedFormat=u.acceptedFormats),setTimeout((function(){m._validationHandler=i._validationHandler}))}return _createClass(Se,[{key:"attemptAddFile",value:function attemptAddFile(i,u){return!!Se.isFileTypeValid(i,this._acceptedFormat)&&(this.addAttachmentBasedOnType(i,u,!0),!0)}},{key:"addAttachmentBasedOnType",value:function addAttachmentBasedOnType(i,u,d){var h=Se.getTypeFromBlob(i);if(h==="image"){var m=Se.createImageAttachment(u);this.addFileAttachment(i,"image",m,d)}else if(h==="audio"){var v=hc.createAudioAttachment(u);this.addFileAttachment(i,"audio",v,d)}else{var g=Se.createAnyFileAttachment(i.name);this.addFileAttachment(i,"any",g,d)}}},{key:"addFileAttachment",value:function addFileAttachment(i,u,d,h){var m;var v=Se.createContainer(d);if(this._attachments.length>=this._fileCountLimit){var g=this._attachments[this._attachments.length-1].removeButton;g==null||g.click();var y=this._fileAttachmentsContainerRef.children;this._fileAttachmentsContainerRef.insertBefore(v,y[0])}else this._fileAttachmentsContainerRef.appendChild(v);var b={file:i,attachmentContainerElement:v,fileType:u};return h&&(b.removeButton=this.createRemoveAttachmentButton(b),v.appendChild(b.removeButton)),this._toggleContainerDisplay(!0),this._attachments.push(b),this._fileAttachmentsContainerRef.scrollTop=this._fileAttachmentsContainerRef.scrollHeight,(m=this._validationHandler)==null||m.call(this),b}},{key:"createRemoveAttachmentButton",value:function createRemoveAttachmentButton(i){var u=document.createElement("div");u.classList.add("remove-file-attachment-button"),u.onclick=this.removeAttachment.bind(this,i);var d=document.createElement("div");return d.classList.add("x-icon"),d.innerText="",u.appendChild(d),u}},{key:"removeAttachment",value:function removeAttachment(i){var u;var d=this._attachments.findIndex((function(u){return u===i})),h=this._attachments[d].attachmentContainerElement;this._attachments.splice(d,1),hc.stopAttachmentPlayback(h),h.remove(),this._toggleContainerDisplay(!1),(u=this._validationHandler)==null||u.call(this)}},{key:"getFiles",value:function getFiles(){return Array.from(this._attachments).map((function(i){return{file:i.file,type:i.fileType}}))}},{key:"removeAllAttachments",value:function removeAllAttachments(){this._attachments.forEach((function(i){setTimeout((function(){var u;return(u=i.removeButton)==null?void 0:u.click()}))}))}}],[{key:"isFileTypeValid",value:function isFileTypeValid(i,u){if(u==="")return!0;var d=u.split(",");for(var h=0;h<d.length;h++){var m=d[h].trim();if(i.type===m)return!0;if(m.startsWith(".")){var v=m.slice(1);if(i.name.endsWith(v))return!0}else{if(i.name.endsWith(m))return!0;if(m.endsWith("/*")&&i.type.startsWith(m.slice(0,-2)))return!0}}return!1}},{key:"getTypeFromBlob",value:function getTypeFromBlob(i){var u=i.type;return u.startsWith("image")?"image":u.startsWith("audio")?"audio":"any"}},{key:"createImageAttachment",value:function createImageAttachment(i){var u=new Image;return u.src=i,u.classList.add("image-attachment"),u}},{key:"createAnyFileAttachment",value:function createAnyFileAttachment(i){var u=document.createElement("div");u.classList.add("border-bound-attachment"),x.IS_SAFARI&&u.classList.add("border-bound-attachment-safari");var d=document.createElement("div");d.classList.add("any-file-attachment-text");var h=document.createElement("div");return h.classList.add("file-attachment-text-container"),h.appendChild(d),d.textContent=i,u.appendChild(h),u}},{key:"createContainer",value:function createContainer(i){var u=document.createElement("div");return u.classList.add("file-attachment"),u.appendChild(i),u}}])}();var uc='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <title>play</title>\n  <path d="M5.92 24.096q0 1.088 0.928 1.728 0.512 0.288 1.088 0.288 0.448 0 0.896-0.224l16.16-8.064q0.48-0.256 0.8-0.736t0.288-1.088-0.288-1.056-0.8-0.736l-16.16-8.064q-0.448-0.224-0.896-0.224-0.544 0-1.088 0.288-0.928 0.608-0.928 1.728v16.16z"></path>\n</svg>',dc='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n<title>stop</title>\n<path d="M5.92 24.096q0 0.832 0.576 1.408t1.44 0.608h16.128q0.832 0 1.44-0.608t0.576-1.408v-16.16q0-0.832-0.576-1.44t-1.44-0.576h-16.128q-0.832 0-1.44 0.576t-0.576 1.44v16.16z"></path>\n</svg>',pc=function(i){function xe(i,u,d,h){_classCallCheck(this,xe);return _callSuper(this,xe,[i,u,d,h])}_inherits(xe,i);return _createClass(xe,[{key:"createTimer",value:function createTimer(i,u){var d=this;var h=0;var m=u!==void 0&&u<xe.TIMER_LIMIT_S?u:xe.TIMER_LIMIT_S;return setInterval((function(){var u;h+=1,h===m&&((u=d.stopPlaceholderCallback)==null||u.call(d),d.clearTimer()),h===600&&i.classList.add("audio-placeholder-text-4-digits");var v=Math.floor(h/60),g=(h%60).toString().padStart(2,"0");i.textContent="".concat(v,":").concat(g)}),1e3)}},{key:"createPlaceholderAudioAttachment",value:function createPlaceholderAudioAttachment(i){var u=xe.createAudioContainer(),d=document.createElement("div");d.classList.add("audio-placeholder-text-3-digits");var h=document.createElement("div");h.classList.add("file-attachment-text-container","audio-placeholder-text-3-digits-container"),h.appendChild(d);var m=pa.createSVGElement(dc);return m.classList.add("attachment-icon","stop-icon","not-removable-attachment-icon"),d.textContent="0:00",this._activePlaceholderTimer=this.createTimer(d,i),u.appendChild(h),this.addPlaceholderAudioAttachmentEvents(u,m,h),u}},{key:"addPlaceholderAudioAttachmentEvents",value:function addPlaceholderAudioAttachmentEvents(i,u,d){var h=this;var m=function n(){return i.replaceChildren(u)};i.addEventListener("mouseenter",m);var v=function r(){return i.replaceChildren(d)};i.addEventListener("mouseleave",v);var g=function o(){var i;return(i=h.stopPlaceholderCallback)==null?void 0:i.call(h)};i.addEventListener("click",g)}},{key:"addPlaceholderAttachment",value:function addPlaceholderAttachment(i,u){var d=this.createPlaceholderAudioAttachment(u);this._activePlaceholderAttachment=this.addFileAttachment(new File([],""),"audio",d,!1),this.stopPlaceholderCallback=i}},{key:"completePlaceholderAttachment",value:function completePlaceholderAttachment(i,u){var d=this._activePlaceholderAttachment;d&&(d.file=i,xe.addAudioElements(d.attachmentContainerElement.children[0],u),d.removeButton=this.createRemoveAttachmentButton(d),d.attachmentContainerElement.appendChild(d.removeButton),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"removePlaceholderAttachment",value:function removePlaceholderAttachment(){this._activePlaceholderAttachment&&(this.removeAttachment(this._activePlaceholderAttachment),this._activePlaceholderAttachment=void 0,this.clearTimer())}},{key:"clearTimer",value:function clearTimer(){this._activePlaceholderTimer!==void 0&&(clearInterval(this._activePlaceholderTimer),this._activePlaceholderTimer=void 0,this.stopPlaceholderCallback=void 0)}}],[{key:"createAudioContainer",value:function createAudioContainer(){var i=document.createElement("div");return i.classList.add("border-bound-attachment","audio-attachment-icon-container"),x.IS_SAFARI&&i.classList.add("border-bound-attachment-safari"),i}},{key:"addAudioElements",value:function addAudioElements(i,u){var d=i.parentElement?fe.cloneElement(i):i,h=document.createElement("audio");h.src=u;var m=pa.createSVGElement(uc);m.classList.add("attachment-icon","play-icon");var v=pa.createSVGElement(dc);v.classList.add("attachment-icon","stop-icon"),d.replaceChildren(m),h.onplay=function(){d.replaceChildren(v)},h.onpause=function(){d.replaceChildren(m),h.currentTime=0},h.onended=function(){d.replaceChildren(m)},d.onclick=function(){h.paused?h.play():h.pause()}}},{key:"createAudioAttachment",value:function createAudioAttachment(i){var u=xe.createAudioContainer();return xe.addAudioElements(u,i),u}},{key:"stopAttachmentPlayback",value:function stopAttachmentPlayback(i){var u,d,h;(h=(d=(u=i.children[0])==null?void 0:u.children)==null?void 0:d[0])!=null&&h.classList.contains("stop-icon")&&i.children[0].click()}}])}(cc);pc.TIMER_LIMIT_S=5999;var hc=pc;var fc=function(){function aa(){_classCallCheck(this,aa)}return _createClass(aa,null,[{key:"create",value:function create(i,u,d,h,m){return m==="audio"?new hc(i,u,d,h):new cc(i,u,d,h)}}])}();var mc=function(){function Vt(i,u,d){_classCallCheck(this,Vt);this._fileAttachmentsTypes=[],this.elementRef=this.createAttachmentContainer();var h=_typeof(d)=="object"&&!!d.displayFileAttachmentContainer;this.toggleContainerDisplay(h),i.appendChild(this.elementRef),u&&Object.assign(this.elementRef.style,u)}return _createClass(Vt,[{key:"addType",value:function addType(i,u,d){var h=fc.create(i,u,this.toggleContainerDisplay.bind(this),this.elementRef,d);return this._fileAttachmentsTypes.push(h),h}},{key:"createAttachmentContainer",value:function createAttachmentContainer(){var i=document.createElement("div");return i.id="file-attachment-container",i}},{key:"toggleContainerDisplay",value:function toggleContainerDisplay(i){i?this.elementRef.style.display="block":this.elementRef.children.length===0&&(this.elementRef.style.display="none")}},{key:"getAllFileData",value:function getAllFileData(){var i=this._fileAttachmentsTypes.map((function(i){return i.getFiles()})).flat();return i.length>0?i:void 0}},{key:"completePlaceholders",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee114(){return _regeneratorRuntime().wrap((function _callee114$(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return Promise.all(this._fileAttachmentsTypes.map(function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee113(i){var u;return _regeneratorRuntime().wrap((function _callee113$(d){while(1)switch(d.prev=d.next){case 0:return d.abrupt("return",(u=i.stopPlaceholderCallback)==null?void 0:u.call(i));case 1:case"end":return d.stop()}}),_callee113)})));return function(u){return i.apply(this,arguments)}}()));case 2:case"end":return i.stop()}}),_callee114,this)})));function completePlaceholders(){return i.apply(this,arguments)}return completePlaceholders}()},{key:"addFilesToAnyType",value:function addFilesToAnyType(i){Vt.addFilesToType(i,this._fileAttachmentsTypes)}},{key:"removeAllFiles",value:function removeAllFiles(){this._fileAttachmentsTypes.forEach((function(i){return i.removeAllAttachments()})),this.elementRef.replaceChildren(),this.toggleContainerDisplay(!1)}},{key:"getNumberOfTypes",value:function getNumberOfTypes(){return this._fileAttachmentsTypes.length}}],[{key:"addFilesToType",value:function addFilesToType(i,u){i.forEach((function(i){var d=new FileReader;d.readAsDataURL(i),d.onload=function(d){for(var h=0;h<u.length&&!u[h].attemptAddFile(i,d.target.result);h+=1);}}))}}])}();var vc=function(){function de(i,u,d){_classCallCheck(this,de);this._isOpen=!1,this._contentRef=de.createModalContent(u,d==null?void 0:d.backgroundColor),this._buttonPanel=de.createButtonPanel(d==null?void 0:d.backgroundColor),this._elementRef=de.createContainer(this._contentRef,d),this._elementRef.appendChild(this._buttonPanel),i.appendChild(this._elementRef),this._backgroundPanelRef=de.createDarkBackgroundPanel(),i.appendChild(this._backgroundPanelRef),this.addWindowEvents(i)}return _createClass(de,[{key:"isOpen",value:function isOpen(){return this._isOpen}},{key:"addButtons",value:function addButtons(){var i=this;for(var u=arguments.length,d=new Array(u),h=0;h<u;h++)d[h]=arguments[h];d.forEach((function(u){return i._buttonPanel.appendChild(u)}))}},{key:"close",value:function close(){var i=this;this._elementRef.classList.remove("show-modal"),this._elementRef.classList.add("hide-modal"),this._backgroundPanelRef.classList.remove("show-modal-background"),this._backgroundPanelRef.classList.add("hide-modal-background"),this._isOpen=!1,setTimeout((function(){i._elementRef.style.display="none",i._backgroundPanelRef.style.display="none"}),de.MODAL_CLOSE_TIMEOUT_MS)}},{key:"displayModalElements",value:function displayModalElements(){this._elementRef.style.display="flex",this._elementRef.classList.remove("hide-modal"),this._elementRef.classList.add("show-modal"),this._backgroundPanelRef.style.display="block",this._backgroundPanelRef.classList.remove("hide-modal-background"),this._backgroundPanelRef.classList.add("show-modal-background"),this._isOpen=!0}},{key:"openTextModal",value:function openTextModal(i){this._contentRef.innerHTML=i,this.displayModalElements()}},{key:"addCloseButton",value:function addCloseButton(i,u,d){var h=this;var m=u?de.createSVGButton(i):de.createTextButton(i);return this.addButtons(m),m.onclick=function(){h.close(),setTimeout((function(){d==null||d()}),140)},m}},{key:"addWindowEvents",value:function addWindowEvents(i){this.keyDownEvent=this.windowKeyDown.bind(this,i),window.addEventListener("keydown",this.keyDownEvent)}},{key:"windowKeyDown",value:function windowKeyDown(i,u){var d,h;!i.isConnected&&this.keyDownEvent?window.removeEventListener("keydown",this.keyDownEvent):this._isOpen&&(u.key===b.ESCAPE?(this.close(),(d=this.extensionCloseCallback)==null||d.call(this)):u.key===b.ENTER&&(this.close(),(h=this.extensionCloseCallback)==null||h.call(this)))}}],[{key:"createContainer",value:function createContainer(i,u){var d=document.createElement("div");return d.classList.add("modal"),d.appendChild(i),u&&delete u.backgroundColor,Object.assign(d.style,u),d}},{key:"createModalContent",value:function createModalContent(i,u){var d;var h=document.createElement("div");return(d=h.classList).add.apply(d,_toConsumableArray(i)),u&&(h.style.backgroundColor=u),document.createElement("div").appendChild(h),h}},{key:"createButtonPanel",value:function createButtonPanel(i){var u=document.createElement("div");return u.classList.add("modal-button-panel"),i&&(u.style.backgroundColor=i),u}},{key:"createDarkBackgroundPanel",value:function createDarkBackgroundPanel(){var i=document.createElement("div");return i.id="modal-background-panel",i}},{key:"createTextButton",value:function createTextButton(i){var u=document.createElement("div");return u.classList.add("modal-button"),u.textContent=i,u}},{key:"createSVGButton",value:function createSVGButton(i){var u=document.createElement("div");u.classList.add("modal-button","modal-svg-button");var d=pa.createSVGElement(i);return d.classList.add("modal-svg-button-icon"),u.appendChild(d),u}},{key:"createTextModalFunc",value:function createTextModalFunc(i,u,d){var h;if(_typeof(u)=="object"&&(h=u.files)!=null&&h.infoModal){var m=new de(i,["modal-content"],u.files.infoModal.containerStyle);return m.addCloseButton("OK",!1,d),m.openTextModal.bind(m,u.infoModalTextMarkUp||"")}}}])}();vc.MODAL_CLOSE_TIMEOUT_MS=190;var gc=vc;var yc=function(i){function _t(i,u,d,h,m,v){var g;_classCallCheck(this,_t);var y,b,x,A,P,D,q,V,J;var X=(y=d==null?void 0:d.button)==null?void 0:y.position,oe=((A=(x=(b=d==null?void 0:d.button)==null?void 0:b.styles)==null?void 0:x.text)==null?void 0:A.content)||v;g=_callSuper(this,_t,[_t.createButtonElement(),X,d.button,oe]);var pe=X==="dropup-menu",fe=g.createInnerElements(h,m,g._customStyles,pe);g._inputElement=_t.createInputElement((P=d==null?void 0:d.files)==null?void 0:P.acceptedFormats),g.addClickEvent(i,d),g.elementRef.replaceChildren(fe.styles),g.reapplyStateStyle("styles"),g._fileAttachmentsType=u,g._openModalOnce=((q=(D=d.files)==null?void 0:D.infoModal)==null?void 0:q.openModalOnce)===!1||(J=(V=d.files)==null?void 0:V.infoModal)==null?void 0:J.openModalOnce;return g}_inherits(_t,i);return _createClass(_t,[{key:"createInnerElements",value:function createInnerElements(i,u,d){var h=arguments.length>3&&arguments[3]!==void 0&&arguments[3];var m=_t.createSVGIconElement(i,u);return{styles:ys.createInnerElement(this.elementRef,m,"styles",d,h)}}},{key:"triggerImportPrompt",value:function triggerImportPrompt(i){i.onchange=this.import.bind(this,i),i.click()}},{key:"import",value:function _import(i){mc.addFilesToType(Array.from(i.files||[]),[this._fileAttachmentsType]),i.value=""}},{key:"addClickEvent",value:function addClickEvent(i,u){var d=this.triggerImportPrompt.bind(this,this._inputElement),h=gc.createTextModalFunc(i,u,d);this.elementRef.onclick=this.click.bind(this,h)}},{key:"click",value:function click(i){!i||this._openModalOnce!==void 0&&this._openModalOnce!==!0?this.triggerImportPrompt(this._inputElement):(i(),this._openModalOnce===!0&&(this._openModalOnce=!1))}}],[{key:"createInputElement",value:function createInputElement(i){var u=document.createElement("input");return u.type="file",u.accept=i||"",u.hidden=!0,u.multiple=!0,u}},{key:"createButtonElement",value:function createButtonElement(){var i=document.createElement("div");return i.classList.add("input-button","upload-file-button"),i}},{key:"createSVGIconElement",value:function createSVGIconElement(i,u){var d=pa.createSVGElement(u);return d.id=i,d}}])}(Cs);var _c=function(){function Ee(){_classCallCheck(this,Ee)}return _createClass(Ee,null,[{key:"create",value:function create(i,u,d){var h=Ee.createElement(d);Ee.addEvents(h,i,u),i.appendChild(h)}},{key:"createElement",value:function createElement(i){var u=document.createElement("div");return u.id="drag-and-drop",_typeof(i)=="object"&&Object.assign(u.style,i),u}},{key:"addEvents",value:function addEvents(i,u,d){u.ondragenter=function(u){u.preventDefault(),Ee.display(i)},i.ondragleave=function(u){u.preventDefault(),Ee.hide(i)},i.ondragover=function(i){i.preventDefault()},i.ondrop=function(u){u.preventDefault(),Ee.uploadFile(d,u),Ee.hide(i)}}},{key:"uploadFile",value:function uploadFile(i,u){var d;var h=(d=u.dataTransfer)==null?void 0:d.files;h&&i.addFilesToAnyType(Array.from(h))}},{key:"display",value:function display(i){i.style.display="block"}},{key:"hide",value:function hide(i){i.style.display="none"}},{key:"isEnabled",value:function isEnabled(i,u){return(u===void 0||u!==!1)&&(!!u||i.getNumberOfTypes()>0)}}])}();var bc=function(){function Be(){_classCallCheck(this,Be)}return _createClass(Be,null,[{key:"validate",value:function validate(i,u,d,h,m){var v=i(d,h,m);return v?u.changeToSubmitIcon():u.changeToDisabledIcon(),v}},{key:"useValidationFunc",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee115(i,u,d,h){var m,v,g,y;return _regeneratorRuntime().wrap((function _callee115$(b){while(1)switch(b.prev=b.next){case 0:m=u.inputElementRef,v=m.classList.contains("text-input-placeholder")?"":m.textContent;b.next=3;return d.completePlaceholders();case 3:g=d.getAllFileData(),y=g==null?void 0:g.map((function(i){return i.file}));return b.abrupt("return",Be.validate(i,h,v,y));case 5:case"end":return b.stop()}}),_callee115)})));function useValidationFunc(u,d,h,m){return i.apply(this,arguments)}return useValidationFunc}()},{key:"useValidationFuncProgrammatic",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee116(i,u,d){var h,m;return _regeneratorRuntime().wrap((function _callee116$(v){while(1)switch(v.prev=v.next){case 0:m=(h=u.files)==null?void 0:h.map((function(i){return i.file}));return v.abrupt("return",Be.validate(i,d,u.text,m,!0));case 2:case"end":return v.stop()}}),_callee116)})));function useValidationFuncProgrammatic(u,d,h){return i.apply(this,arguments)}return useValidationFuncProgrammatic}()},{key:"validateWebsocket",value:function validateWebsocket(i,u){return!(i.websocket&&!Wr.canSendMessage(i.websocket))||(u.changeToDisabledIcon(),!1)}},{key:"attach",value:function attach(i,u,d,h,m){var v=i.validateInput||Te.processValidateInput(i);i._validationHandler=function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee117(i){var g;return _regeneratorRuntime().wrap((function _callee117$(y){while(1)switch(y.prev=y.next){case 0:if(!(m.status.loadingActive||m.status.requestInProgress||u.isSubmitProgrammaticallyDisabled===!0||!Be.validateWebsocket(u,m))){y.next=2;break}return y.abrupt("return",!1);case 2:g=v||u.canSendMessage;return y.abrupt("return",g?i?Be.useValidationFuncProgrammatic(g,i,m):Be.useValidationFunc(g,d,h,m):null);case 4:case"end":return y.stop()}}),_callee117)})));return function(u){return i.apply(this,arguments)}}()}}])}();var kc=function(){function hs(){_classCallCheck(this,hs)}return _createClass(hs,null,[{key:"getFileName",value:function getFileName(i,u){var d=new Date,h=String(d.getHours()).padStart(2,"0"),m=String(d.getMinutes()).padStart(2,"0"),v=String(d.getSeconds()).padStart(2,"0");return"".concat(i,"-").concat(h,"-").concat(m,"-").concat(v,".").concat(u)}}])}();var Sc=function(i){function la(i,u){var d;_classCallCheck(this,la);var h,m;d=_callSuper(this,la,[u.button]),d._waitingForBrowserApproval=!1,d._audioType=i,d._extension=((h=u.files)==null?void 0:h.format)||"mp3",d._maxDurationSeconds=(m=u.files)==null?void 0:m.maxDurationSeconds,d.elementRef.onclick=d.buttonClick.bind(_assertThisInitialized(d));return d}_inherits(la,i);return _createClass(la,[{key:"buttonClick",value:function buttonClick(){this._waitingForBrowserApproval||(this.isActive?this.stop():(this._waitingForBrowserApproval=!0,this.record()))}},{key:"stop",value:function stop(){var i=this;return new Promise((function(u){var d,h;i.changeToDefault(),(d=i._mediaRecorder)==null||d.stop(),(h=i._mediaStream)==null||h.getTracks().forEach((function(i){return i.stop()})),setTimeout((function(){u()}),10)}))}},{key:"record",value:function record(){var i=this;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(u){i.changeToActive(),i._mediaRecorder=new MediaRecorder(u),i._audioType.addPlaceholderAttachment(i.stop.bind(i),i._maxDurationSeconds),i._mediaStream=u,i._mediaRecorder.addEventListener("dataavailable",(function(u){i.createFile(u)})),i._mediaRecorder.start()})).catch((function(u){console.error(u),i.stop()})).finally((function(){i._waitingForBrowserApproval=!1}))}},{key:"createFile",value:function createFile(i){var u=this;var d=new Blob([i.data],{type:"audio/".concat(this._extension)}),h=kc.getFileName(this._newFilePrefix||"audio",this._extension),m=new File([d],h,{type:d.type}),v=new FileReader;v.readAsDataURL(m),v.onload=function(i){u._audioType.completePlaceholderAttachment(m,i.target.result)}}}])}(eo);var xc='<?xml version="1.0" standalone="no"?>\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">\n<svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none" stroke-width="1" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">\n  <line x1="22" y1="2" x2="11" y2="14"></line>\n  <polygon points="22 2 15 22 11 14 2 10 22 2"></polygon>\n</svg>\n';var Cc=function(){function W(){_classCallCheck(this,W)}return _createClass(W,null,[{key:"setPropertyValueIfDoesNotExist",value:function setPropertyValueIfDoesNotExist(i,u,d){var h,m;var v=u[0];u.length===1?(h=i[v])!==null&&h!==void 0?h:i[v]=d:((m=i[v])!==null&&m!==void 0?m:i[v]={},u.shift(),W.setPropertyValueIfDoesNotExist(i[v],u,d))}},{key:"setPropertyValue",value:function setPropertyValue(i,u,d){var h;var m=u[0];u.length===1?i[m]=d:((h=i[m])!==null&&h!==void 0?h:i[m]={},u.shift(),W.setPropertyValue(i[m],u,d))}},{key:"getObjectValue",value:function getObjectValue(i,u){var d=u[0],h=i[d];return h===void 0||u.length===1?h:W.getObjectValue(h,u.slice(1))}},{key:"overwritePropertyObjectFromAnother",value:function overwritePropertyObjectFromAnother(i,u,d){var h=W.getObjectValue(u,d);if(h){var m=_objectSpread(_objectSpread({},h),W.getObjectValue(i,d)||{});W.setPropertyValue(i,d,m)}}}])}();var wc=function(){function Ge(){_classCallCheck(this,Ge)}return _createClass(Ge,null,[{key:"resetSubmit",value:function resetSubmit(i,u){u?i.unsetCustomStateStyles(["loading","submit"]):i.unsetCustomStateStyles(["stop","loading","submit"]),i.reapplyStateStyle("submit")}},{key:"overwriteDefaultStyleWithSubmit",value:function overwriteDefaultStyleWithSubmit(i,u){if(i.submit){var d=JSON.parse(JSON.stringify(i[u]||{}));Cc.overwritePropertyObjectFromAnother(d,i.submit,["container","default"]),Cc.overwritePropertyObjectFromAnother(d,i.submit,["text","styles","default"]),Cc.overwritePropertyObjectFromAnother(d,i.submit,["svg","styles","default"]),i[u]=d}}},{key:"setUpDisabledButton",value:function setUpDisabledButton(i){Cc.setPropertyValueIfDoesNotExist(i,["submit","container","default","backgroundColor"],""),Cc.setPropertyValueIfDoesNotExist(i,["disabled","container","default","backgroundColor"],"unset"),Cc.setPropertyValueIfDoesNotExist(i.submit,["svg","styles","default","filter"],""),Cc.setPropertyValueIfDoesNotExist(i.disabled,["svg","styles","default","filter"],"brightness(0) saturate(100%) invert(70%) sepia(0%) saturate(5564%) hue-rotate(207deg) brightness(100%) contrast(97%)"),Ge.overwriteDefaultStyleWithSubmit(i,"disabled")}},{key:"process",value:function process(i){var u=JSON.parse(JSON.stringify(i||{}));return Ge.overwriteDefaultStyleWithSubmit(u,"loading"),Ge.overwriteDefaultStyleWithSubmit(u,"stop"),i!=null&&i.alwaysEnabled||Ge.setUpDisabledButton(u),u}}])}();var Ec=function(i){function k(i,u,d,h,m,v){var g;_classCallCheck(this,k);var y=wc.process(i.submitButtonStyles);g=_callSuper(this,k,[k.createButtonContainerElement(),y==null?void 0:y.position,y]),g._isSVGLoadingIconOverriden=!1,g.status={requestInProgress:!1,loadingActive:!1},g._messages=d,g._inputElementRef=u,g._fileAttachments=m,g._innerElements=g.createInnerElements(),g._abortStream=new AbortController,g._stopClicked={listener:function listener(){}},g._serviceIO=h,g._alwaysEnabled=!!(y!=null&&y.alwaysEnabled),i.disableSubmitButton=g.disableSubmitButton.bind(_assertThisInitialized(g),h),g.attemptOverwriteLoadingStyle(i),v.microphone&&g.setUpSpeechToText(v.microphone.button,i.speechToText),setTimeout((function(){var u;g._validationHandler=i._validationHandler,g.assignHandlers(g._validationHandler),(u=g._validationHandler)==null||u.call(_assertThisInitialized(g))}));return g}_inherits(k,i);return _createClass(k,[{key:"createInnerElements",value:function createInnerElements(){var i=this.createCustomElements(),u=i.submit,d=i.loading,h=i.stop,m=u||k.createSubmitIconElement();return{submit:m,loading:d||k.createLoadingIconElement(),stop:h||k.createStopIconElement(),disabled:this.createDisabledIconElement(m)}}},{key:"createCustomElements",value:function createCustomElements(){var i=this;var u=ys.createSpecificStateElement(this.elementRef,"submit",this._customStyles),d={loading:void 0,stop:void 0};return Object.keys(d).forEach((function(u){var h=u,m=ys.createCustomElement(h,i._customStyles);m&&(d[h]=m)})),d.submit=u,d}},{key:"createDisabledIconElement",value:function createDisabledIconElement(i){return ys.createCustomElement("disabled",this._customStyles)||i.cloneNode(!0)}},{key:"attemptOverwriteLoadingStyle",value:function attemptOverwriteLoadingStyle(i){var u,d,h,m,v,g,y,b,x;if(!((d=(u=this._customStyles)==null?void 0:u.submit)!=null&&d.svg||(v=(m=(h=this._customStyles)==null?void 0:h.loading)==null?void 0:m.svg)!=null&&v.content||(b=(y=(g=this._customStyles)==null?void 0:g.loading)==null?void 0:y.text)!=null&&b.content)&&(i.displayLoadingBubble===void 0||i.displayLoadingBubble===!0)){var A=document.createElement("style");A.textContent="\n        .loading-button > * {\n          filter: brightness(0) saturate(100%) invert(72%) sepia(0%) saturate(3044%) hue-rotate(322deg) brightness(100%)\n            contrast(96%) !important;\n        }",(x=i.shadowRoot)==null||x.appendChild(A),this._isSVGLoadingIconOverriden=!0}}},{key:"assignHandlers",value:function assignHandlers(i){this._serviceIO.completionsHandlers={onFinish:this.resetSubmit.bind(this,i)},this._serviceIO.streamHandlers={onOpen:this.changeToStopIcon.bind(this),onClose:this.resetSubmit.bind(this,i),abortStream:this._abortStream,stopClicked:this._stopClicked};var u=this._serviceIO.stream;_typeof(u)=="object"&&typeof u.simulation=="number"&&(this._serviceIO.streamHandlers.simulationInterim=u.simulation)}},{key:"setUpSpeechToText",value:function setUpSpeechToText(i,u){this._microphoneButton=i,this._stopSTTAfterSubmit=_typeof(u)=="object"&&u.stopAfterSubmit}},{key:"resetSubmit",value:function resetSubmit(i){this.status.requestInProgress=!1,this.status.loadingActive=!1,i()}},{key:"submitFromInput",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee118(){var i,u;return _regeneratorRuntime().wrap((function _callee118$(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return this._fileAttachments.completePlaceholders();case 2:i=this._fileAttachments.getAllFileData();if(this._inputElementRef.classList.contains("text-input-placeholder"))this.attemptSubmit({text:"",files:i});else{u=this._inputElementRef.innerText.trim();this.attemptSubmit({text:u,files:i})}case 4:case"end":return d.stop()}}),_callee118,this)})));function submitFromInput(){return i.apply(this,arguments)}return submitFromInput}()},{key:"programmaticSubmit",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee119(i){var u=this;var d;return _regeneratorRuntime().wrap((function _callee119$(h){while(1)switch(h.prev=h.next){case 0:typeof i=="string"&&(i=Te.processSubmitUserMessage(i));d={text:i.text};i.files&&(d.files=Array.from(i.files).map((function(i){return{file:i,type:cc.getTypeFromBlob(i)}}))),setTimeout((function(){return u.attemptSubmit(d,!0)}));case 3:case"end":return h.stop()}}),_callee119)})));function programmaticSubmit(u){return i.apply(this,arguments)}return programmaticSubmit}()},{key:"attemptSubmit",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee120(i){var u,d,h,m,v,g,y=arguments;return _regeneratorRuntime().wrap((function _callee120$(b){while(1)switch(b.prev=b.next){case 0:u=y.length>1&&y[1]!==void 0&&y[1];b.next=3;return(d=this._validationHandler)==null?void 0:d.call(this,u?i:void 0);case 3:b.t0=b.sent;b.t1=!1;if(!(b.t0===b.t1)){b.next=7;break}return b.abrupt("return");case 7:this.changeToLoadingIcon();b.next=10;return this.addNewMessage(i);case 10:this._serviceIO.isWebModel()||this._messages.addLoadingMessage();V.clear(this._inputElementRef);v=(h=i.files)==null?void 0:h.map((function(i){return i.file})),g={text:i.text===""?void 0:i.text,files:v};b.next=15;return this._serviceIO.callAPI(g,this._messages);case 15:(m=this._fileAttachments)==null||m.removeAllFiles();case 16:case"end":return b.stop()}}),_callee120,this)})));function attemptSubmit(u){return i.apply(this,arguments)}return attemptSubmit}()},{key:"addNewMessage",value:function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee121(i){var u,d,h;return _regeneratorRuntime().wrap((function _callee121$(m){while(1)switch(m.prev=m.next){case 0:u=i.text,d=i.files;h={role:Qe.USER_ROLE};u&&(h.text=u);m.t0=d;if(!m.t0){m.next=8;break}m.next=7;return this._messages.addMultipleFiles(d);case 7:h.files=m.sent;case 8:this._serviceIO.sessionId&&(h._sessionId=this._serviceIO.sessionId);Object.keys(h).length>0&&this._messages.addNewMessage(h);case 10:case"end":return m.stop()}}),_callee121,this)})));function addNewMessage(u){return i.apply(this,arguments)}return addNewMessage}()},{key:"stopStream",value:function stopStream(){var i;this._abortStream.abort(),(i=this._stopClicked)==null||i.listener(),this._validationHandler&&this.resetSubmit(this._validationHandler)}},{key:"changeToStopIcon",value:function changeToStopIcon(){this._serviceIO.websocket||(this.elementRef.classList.remove(k.LOADING_CLASS,k.DISABLED_CLASS,k.SUBMIT_CLASS),this.elementRef.replaceChildren(this._innerElements.stop),this.reapplyStateStyle("stop",["loading","submit"]),this.elementRef.onclick=this.stopStream.bind(this),this.status.loadingActive=!1)}},{key:"changeToLoadingIcon",value:function changeToLoadingIcon(){this._serviceIO.websocket||(this._isSVGLoadingIconOverriden||this.elementRef.replaceChildren(this._innerElements.loading),this.elementRef.classList.remove(k.SUBMIT_CLASS,k.DISABLED_CLASS),this.elementRef.classList.add(k.LOADING_CLASS),this.reapplyStateStyle("loading",["submit"]),this.elementRef.onclick=function(){},this.status.requestInProgress=!0,this.status.loadingActive=!0)}},{key:"changeToSubmitIcon",value:function changeToSubmitIcon(){var i=this;this.elementRef.classList.contains(k.SUBMIT_CLASS)||(this.elementRef.classList.remove(k.LOADING_CLASS,k.DISABLED_CLASS),this.elementRef.classList.add(k.SUBMIT_CLASS),this.elementRef.replaceChildren(this._innerElements.submit),wc.resetSubmit(this,this.status.loadingActive),this.elementRef.onclick=function(){var u;i.submitFromInput(),(u=i._microphoneButton)!=null&&u.isActive&&lc.toggleSpeechAfterSubmit(i._microphoneButton.elementRef,!!i._stopSTTAfterSubmit)})}},{key:"changeToDisabledIcon",value:function changeToDisabledIcon(){var i=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this._alwaysEnabled&&!i?this.changeToSubmitIcon():this.elementRef.classList.contains(k.DISABLED_CLASS)||(this.elementRef.classList.remove(k.LOADING_CLASS,k.SUBMIT_CLASS),this.elementRef.classList.add(k.DISABLED_CLASS),this.elementRef.replaceChildren(this._innerElements.disabled),this.reapplyStateStyle("disabled",["submit"]),this.elementRef.onclick=function(){})}},{key:"disableSubmitButton",value:function disableSubmitButton(i,u){var d;i.isSubmitProgrammaticallyDisabled=u!==!1,!(this.status.requestInProgress||this.status.loadingActive)&&(u===!1?(d=this._validationHandler)==null||d.call(this):this.changeToDisabledIcon(!0))}}],[{key:"createButtonContainerElement",value:function createButtonContainerElement(){var i=document.createElement("div");return i.classList.add("input-button"),i}},{key:"createSubmitIconElement",value:function createSubmitIconElement(){var i=pa.createSVGElement(xc);return i.id="submit-icon",i}},{key:"createLoadingIconElement",value:function createLoadingIconElement(){var i=document.createElement("div");return i.classList.add("dots-jumping"),i}},{key:"createStopIconElement",value:function createStopIconElement(){var i=document.createElement("div");return i.id="stop-icon",i}}])}(Cs);Ec.SUBMIT_CLASS="submit-button",Ec.LOADING_CLASS="loading-button",Ec.DISABLED_CLASS="disabled-button";var Tc=Ec;var Ac='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">\n  <path d="M27.1 14.313V5.396L24.158 8.34c-2.33-2.325-5.033-3.503-8.11-3.503C9.902 4.837 4.901 9.847 4.899 16c.001 6.152 5.003 11.158 11.15 11.16 4.276 0 9.369-2.227 10.836-8.478l.028-.122h-3.23l-.022.068c-1.078 3.242-4.138 5.421-7.613 5.421a8 8 0 0 1-5.691-2.359A7.993 7.993 0 0 1 8 16.001c0-4.438 3.611-8.049 8.05-8.049 2.069 0 3.638.58 5.924 2.573l-3.792 3.789H27.1z"/>\n</svg>\n',Rc='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <title>capture</title>\n  <path d="M0 16q0 3.264 1.28 6.208t3.392 5.12 5.12 3.424 6.208 1.248 6.208-1.248 5.12-3.424 3.392-5.12 1.28-6.208-1.28-6.208-3.392-5.12-5.088-3.392-6.24-1.28q-3.264 0-6.208 1.28t-5.12 3.392-3.392 5.12-1.28 6.208zM4 16q0-3.264 1.6-6.016t4.384-4.352 6.016-1.632 6.016 1.632 4.384 4.352 1.6 6.016-1.6 6.048-4.384 4.352-6.016 1.6-6.016-1.6-4.384-4.352-1.6-6.048z"></path>\n</svg>\n',Ic='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n  <path d="M195.2 195.2a64 64 0 0 1 90.496 0L512 421.504 738.304 195.2a64 64 0 0 1 90.496 90.496L602.496 512 828.8 738.304a64 64 0 0 1-90.496 90.496L512 602.496 285.696 828.8a64 64 0 0 1-90.496-90.496L421.504 512 195.2 285.696a64 64 0 0 1 0-90.496z"/>\n</svg>',Mc='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path d="M4.89163 13.2687L9.16582 17.5427L18.7085 8" stroke="#000000" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>';var Lc=function(i){function vn(i,u,d,h){var m;_classCallCheck(this,vn);m=_callSuper(this,vn,[i,["modal-content","modal-camera-content"],d]),m._stopped=!1,m._format="image/png",m._canvas=document.createElement("canvas"),m._canvas.classList.add("camera-modal-canvas");var v=m.addButtonsAndTheirEvents(u),g=v.captureButton,y=v.submitButton;m._captureButton=g,m._submitButton=y,m._captureIcon=m._captureButton.children[0],m._refreshIcon=pa.createSVGElement(Ac),m._refreshIcon.classList.add("modal-svg-button-icon","modal-svg-refresh-icon"),(h==null?void 0:h.format)==="jpeg"&&(m._format="image/jpeg"),h!=null&&h.dimensions&&(m._dimensions=h.dimensions),m._contentRef.appendChild(m._canvas),m.extensionCloseCallback=m.stop;return m}_inherits(vn,i);return _createClass(vn,[{key:"addButtonsAndTheirEvents",value:function addButtonsAndTheirEvents(i){var u=gc.createSVGButton(Rc);u.classList.add("modal-svg-camera-button"),u.children[0].classList.add("modal-svg-camera-icon");var d=this.addCloseButton(Ic,!0);d.classList.add("modal-svg-close-button"),d.children[0].classList.add("modal-svg-close-icon");var h=gc.createSVGButton(Mc);return h.classList.add("modal-svg-submit-button"),this.addButtons(u,h),this.addButtonEvents(u,d,h,i),{captureButton:u,submitButton:h}}},{key:"addButtonEvents",value:function addButtonEvents(i,u,d,h){var m=this;i.onclick=function(){m.capture()},u.addEventListener("click",this.stop.bind(this)),d.onclick=function(){var i=m.getFile();i&&mc.addFilesToType([i],[h]),m.stop(),m.close()}}},{key:"stop",value:function stop(){var i=this;this._mediaStream&&this._mediaStream.getTracks().forEach((function(i){return i.stop()})),this._stopped=!0,setTimeout((function(){i._captureButton.replaceChildren(i._captureIcon),i._captureButton.classList.replace("modal-svg-refresh-button","modal-svg-camera-button");var u=i._canvas.getContext("2d");u==null||u.clearRect(0,0,i._canvas.width,i._canvas.height)}),gc.MODAL_CLOSE_TIMEOUT_MS)}},{key:"start",value:function start(){var i=this;this._dataURL=void 0,this._submitButton.classList.add("modal-svg-submit-disabled"),this._stopped=!1,navigator.mediaDevices.getUserMedia({video:this._dimensions||!0}).then((function(u){if(i._mediaStream=u,!i.isOpen())return i.stop();var d=document.createElement("video");d.srcObject=u,d.play(),requestAnimationFrame(i.updateCanvas.bind(i,d,i._canvas))})).catch((function(u){console.error(u),i.stop(),i.close()}))}},{key:"capture",value:function capture(){this._dataURL?(this._captureButton.replaceChildren(this._captureIcon),this._captureButton.classList.replace("modal-svg-refresh-button","modal-svg-camera-button"),this._submitButton.classList.add("modal-svg-submit-disabled"),this._dataURL=void 0):(this._captureButton.replaceChildren(this._refreshIcon),this._captureButton.classList.replace("modal-svg-camera-button","modal-svg-refresh-button"),this._submitButton.classList.remove("modal-svg-submit-disabled"),this._dataURL=this._canvas.toDataURL())}},{key:"getFile",value:function getFile(){if(this._dataURL){var i=atob(this._dataURL.split(",")[1]),u=new Array(i.length);for(var d=0;d<i.length;d++)u[d]=i.charCodeAt(d);var h=new Uint8Array(u),m=new Blob([h],{type:this._format}),v=this._format==="image/jpeg"?"jpeg":"png",g=kc.getFileName(this._newFilePrefix||"photo",v);return new File([m],g,{type:m.type})}}},{key:"updateCanvas",value:function updateCanvas(i,u){if(!this._stopped){if(!this._dataURL){u.width=i.videoWidth,u.height=i.videoHeight;var d=u.getContext("2d");d==null||d.drawImage(i,0,0,u.width,u.height)}requestAnimationFrame(this.updateCanvas.bind(this,i,u))}}},{key:"openCameraModal",value:function openCameraModal(i){this.displayModalElements(),i.start()}}],[{key:"createCameraModalFunc",value:function createCameraModalFunc(i,u,d,h){var m=new vn(i,u,d,h);return m.openCameraModal.bind(m,m)}}])}(gc);var Oc='<?xml version="1.0" encoding="utf-8"?>\n<svg viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">\n  <path d="M29 7h-4.599l-2.401-4h-12l-2.4 4h-4.6c-1 0-3 1-3 2.969v16.031c0 1.657 1.5 3 2.792 3h26.271c1.313 0 2.938-1.406 2.938-2.968v-16.032c0-1-1-3-3-3zM30 26.032c0 0.395-0.639 0.947-0.937 0.969h-26.265c-0.232-0.019-0.797-0.47-0.797-1v-16.031c0-0.634 0.851-0.953 1-0.969h5.732l2.4-4h9.802l1.785 3.030 0.55 0.97h5.731c0.705 0 0.99 0.921 1 1v16.032zM16 10c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zM16 22c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path>\n</svg>';var Pc=function(i){function gi(i,u,d){var h;_classCallCheck(this,gi);var m,v,g,y;var b=(m=d==null?void 0:d.button)==null?void 0:m.position,x=((y=(g=(v=d==null?void 0:d.button)==null?void 0:v.styles)==null?void 0:g.text)==null?void 0:y.content)||"Photo";h=_callSuper(this,gi,[gi.createButtonElement(),b,(d==null?void 0:d.button)||{},x]);var A=h.createInnerElements(h._customStyles,b==="dropup-menu");d&&h.addClickEvent(i,u,d.modalContainerStyle,d.files),h.elementRef.classList.add("upload-file-button"),h.elementRef.appendChild(A.styles),h.reapplyStateStyle("styles");return h}_inherits(gi,i);return _createClass(gi,[{key:"createInnerElements",value:function createInnerElements(i){var u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return{styles:ys.createInnerElement(this.elementRef,gi.createSVGIconElement(),"styles",i,u)}}},{key:"addClickEvent",value:function addClickEvent(i,u,d,h){var m=Lc.createCameraModalFunc(i,u,d,h);this.elementRef.onclick=m}}],[{key:"createButtonElement",value:function createButtonElement(){var i=document.createElement("div");return i.classList.add("input-button"),i}},{key:"createSVGIconElement",value:function createSVGIconElement(){var i=pa.createSVGElement(Oc);return i.id="camera-icon",i}}])}(Cs);var Nc=function(){function St(i,u,d,h){_classCallCheck(this,St);this.elementRef=St.createPanelElement(i.inputAreaStyle);var m={},v=this.createFileUploadComponents(i,d,h,m),g=new V(i,d,v);i.speechToText&&!m.microphone&&(m.microphone={button:new lc(i,g,u.addNewErrorMessage.bind(u))});var y=new Tc(i,g.inputElementRef,u,d,v,m);g.submit=y.submitFromInput.bind(y),bc.attach(i,d,g,v,y),i.submitUserMessage=y.programmaticSubmit.bind(y),m.submit={button:y},St.addElements(this.elementRef,g,m,h,v,i.dropupStyles)}return _createClass(St,[{key:"createFileUploadComponents",value:function createFileUploadComponents(i,u,d,h){var m,v,g,y;var b=new mc(this.elementRef,i.attachmentContainerStyle,u.demo);if(St.createUploadButtons(i,u.fileTypes||{},b,d,h),(m=u.camera)!=null&&m.files){var x=((v=h.images)==null?void 0:v.fileType)||b.addType(i,u.camera.files,"images");h.camera={button:new Pc(d,x,u.camera)}}if((g=u.recordAudio)!=null&&g.files){var A=((y=h.audio)==null?void 0:y.fileType)||b.addType(i,u.recordAudio.files,"audio");h.microphone={button:new Sc(A,u.recordAudio)}}return _c.isEnabled(b,i.dragAndDrop)&&_c.create(d,b,i.dragAndDrop),b}}],[{key:"createPanelElement",value:function createPanelElement(i){var u=document.createElement("div");return u.id="input",Object.assign(u.style,i),u}},{key:"createUploadButtons",value:function createUploadButtons(i,u,d,h,m){Object.keys(u).forEach((function(v){var g=v,y=u[g];if(y.files){var b=d.addType(i,y.files,g),x=qs[g],A=x.id,P=x.svgString,D=x.dropupText,q=new yc(h,b,y,A,P,D);m[g]={button:q,fileType:b}}}))}},{key:"addElements",value:function addElements(i,u,d,h,m,v){fe.addElements(i,u.elementRef);var g=ds.create(),y=Rs.addButtons(g,d,h,v);as.set(u.inputElementRef,g,m.elementRef,y),ds.add(i,g)}}])}();var Fc=function(){function yn(){_classCallCheck(this,yn)}return _createClass(yn,null,[{key:"createElements",value:function createElements(i,u,d){var h=document.createElement("div");h.id="chat-view";var m=new Xi(i,u,d);u.websocket&&Wr.createConnection(u,m);var v=new Nc(i,m,u,h);return fe.addElements(h,m.elementRef,v.elementRef),h}},{key:"render",value:function render(i,u,d,h){var m=yn.createElements(i,d,h);u.replaceChildren(m)}}])}();var Dc='#validate-property-key-view{height:100%;position:relative;display:flex;justify-content:center;align-items:center;padding:8px}#large-loading-ring{display:inline-block;width:50px;height:50px}#large-loading-ring:after{content:" ";display:block;width:38px;height:38px;margin:1px;border-radius:50%;border:5px solid #5fb2ff;border-color:#5fb2ff transparent #5fb2ff transparent;animation:large-loading-ring 1.4s linear infinite}@keyframes large-loading-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#insert-key-view{height:100%;position:relative}#insert-key-contents{text-align:center;position:absolute;top:44%;left:50%;transform:translate(-50%,-50%);width:82%;display:flex;max-width:700px}#insert-key-title{margin-bottom:15px}#insert-key-input-container{margin-right:2.7em;width:calc(100% - 80px)}#insert-key-input{padding:.3em 1.7em .3em .3em;border-width:1px;border-style:solid;border-radius:3px;width:100%;font-size:inherit}.insert-key-input-valid{border-color:gray}.insert-key-input-invalid{border-color:red}#visibility-icon-container{position:relative;float:right;cursor:pointer;-webkit-user-select:none;user-select:none}.visibility-icon{filter:brightness(0) saturate(100%) invert(63%) sepia(1%) saturate(9%) hue-rotate(43deg) brightness(98%) contrast(92%);position:absolute;right:-1.7em;top:-1.43em}#visible-icon{top:-1.4em}.visibility-icon:hover{filter:unset}.visibility-icon>*{pointer-events:none}#start-button{border:1px solid grey;color:#454545;border-radius:4px;width:3em;display:flex;justify-content:center;align-items:center;cursor:pointer;padding:.28em .3em;-webkit-user-select:none;user-select:none;background-color:#fff}#start-button:hover{background-color:#f2f2f2}#start-button:active{background-color:#d2d2d2}#insert-key-help-text-container{width:100%;position:absolute;margin-top:32px;margin-bottom:20px}#insert-key-help-text-contents{width:100%;position:absolute}#insert-key-input-invalid-text{display:block;margin-top:1em;margin-bottom:.5em;color:red}.insert-key-input-help-text{display:block;margin-top:16px}#loading-ring{display:inline-block;width:16px;height:16px}#loading-ring:after{content:" ";display:block;width:11px;height:11px;margin:1px;border-radius:50%;border:2px solid #0084ff;border-color:#0084ff transparent #0084ff transparent;animation:loading-ring 1.2s linear infinite}@keyframes loading-ring{0%{transform:rotate(0)}to{transform:rotate(360deg)}}#error-view{color:red;font-size:1.2em;line-height:1.3em;margin-top:-5px;text-align:center;height:100%;display:flex;justify-content:center;align-items:center;padding-left:8px;padding-right:8px}.intro-panel{position:absolute;display:flex;justify-content:center;right:0;bottom:0;left:0;margin:auto;height:fit-content;top:-2.5em}#internal-intro-panel{width:250px;height:min-content;display:block;border-radius:5px;overflow:auto;border:1px solid rgb(203,203,203);padding:10px;max-height:calc(100% - 6.8em)}#internal-intro-panel>p{margin-block-start:.8em;margin-block-end:.8em}pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}/*!\n  Theme: a11y-dark\n  Author: @ericwbailey\n  Maintainer: @ericwbailey\n\n  Based on the Tomorrow Night Eighties theme: https://github.com/isagalaev/highlight.js/blob/master/src/styles/tomorrow-night-eighties.css\n*/.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast: active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}#messages{overflow:auto}.outer-message-container:last-child{margin-bottom:5px}.inner-message-container{display:flex;margin-left:auto;margin-right:auto;width:calc(97.5% - 24px);max-width:100%}.message-bubble{margin-top:10px;word-wrap:break-word;width:fit-content;max-width:60%;border-radius:10px;padding:.42em .55em;height:fit-content;line-height:1.26em}.user-message-text{color:#fff;background-color:#0084ff;margin-right:0;margin-left:auto}.ai-message-text{color:#000;background-color:#e4e6eb;margin-left:0;margin-right:auto}.html-message{max-width:unset}.error-message-text{margin:14px auto 10px;background-color:#f4c0c0;color:#474747;text-align:center;max-width:95%}.loading-message-text{width:1em;padding:.6em .75em .6em 1.3em}.message-bubble>p:first-child{margin-top:0}.message-bubble>p:last-child{margin-bottom:0}pre{overflow:auto;display:block;word-break:break-all;word-wrap:break-word;border-radius:7px;background:#2b2b2b;color:#f8f8f2;margin-top:.8em;margin-bottom:.8em;padding:.6em;font-size:.9em;line-height:1.5em}.image-message{padding:0;display:flex;background-color:#ddd}.image-message>*,.image-message>*>*{width:100%;border-radius:8px;display:flex}.audio-message{width:60%;max-width:300px;height:2.2em;max-height:54px;padding:0;background-color:unset}.audio-player{width:100%;height:100%}.audio-player-safari{height:fit-content;width:40px}.audio-player-safari-left{float:left}.audio-player-safari-right{float:right}.any-file-message-bubble{padding:1px}.any-file-message-contents{display:flex}.any-file-message-icon-container{width:1.3em;min-width:1.3em;position:relative;border-radius:4px;margin-left:6px;margin-right:2px}.any-file-message-icon{background-color:#fff;border-radius:4px;position:absolute;width:1em;height:1.25em;padding:1px;margin-top:auto;margin-bottom:auto;top:0;bottom:0}.any-file-message-text{padding-top:5px;overflow-wrap:anywhere;padding-bottom:5px;padding-right:7px}.message-bubble>a{color:inherit}.left-item-position{margin-right:10px}.right-item-position{margin-left:10px}.avatar{padding-top:5px;width:1.5em;height:1.5em;border-radius:1px}.avatar-container{margin-top:9px}.name{margin-top:16px;font-size:15px}#drag-and-drop{position:absolute;display:none;z-index:10;height:calc(100% - 10px);width:calc(100% - 10px);background-color:#70c6ff4d;border:5px dashed #6dafff}#file-attachment-container{position:absolute;height:3.6em;width:calc(80% - 4px);top:-2.5em;border-radius:5px;overflow:auto;text-align:left;background-color:#d7d7d73b;padding-left:4px}.file-attachment{width:2.85em;height:2.85em;display:inline-flex;margin-right:.6em;margin-bottom:.44em;margin-top:4px;position:relative;background-color:#fff;border-radius:5px}.image-attachment{width:100%;height:100%;object-fit:cover;border-radius:5px}.border-bound-attachment{width:calc(100% - 2px);height:calc(100% - 2px);border:1px solid #c3c3c3;border-radius:5px;overflow:hidden}.border-bound-attachment-safari{width:calc(100% - 1px);height:calc(100% - 1px)}.audio-attachment-icon-container{cursor:pointer}.audio-attachment-icon-container:hover{background-color:#f8f8f8}.attachment-icon{left:0;right:0;bottom:0;top:2px;margin:auto;position:absolute;width:25px;-webkit-user-select:none;user-select:none}.not-removable-attachment-icon{top:0;right:0;bottom:0;left:0}.play-icon{filter:brightness(0) saturate(100%) invert(17%) sepia(0%) saturate(1392%) hue-rotate(67deg) brightness(98%) contrast(97%)}.stop-icon{filter:brightness(0) saturate(100%) invert(29%) sepia(90%) saturate(1228%) hue-rotate(198deg) brightness(93%) contrast(98%)}.audio-placeholder-text-3-digits{padding-left:.26rem}.audio-placeholder-text-4-digits{padding-left:.1rem}.any-file-attachment{padding:2px 0}.file-attachment-text-container{position:absolute;width:inherit;display:flex;align-items:center;height:100%;top:-1px}.audio-placeholder-text-3-digits-container{padding-top:1px;cursor:default}.any-file-attachment-text{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;padding-left:.13em;margin-left:auto;margin-right:auto}.remove-file-attachment-button{height:1.25em;width:1.25em;border:1px solid #cfcfcf;border-radius:25px;background-color:#fff;top:-4px;right:-5px;position:absolute;display:flex;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}.remove-file-attachment-button:hover{background-color:#e4e4e4}.remove-file-attachment-button:active{background-color:#d7d7d7}.x-icon{color:#4e4e4e;top:-.075em;position:relative;font-size:1.05em}.modal{display:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;width:80%;max-width:420px;max-height:80%;margin:auto;top:0;right:0;bottom:0;left:0;z-index:2}.modal-content{border-top:1px solid rgb(217,217,217);border-left:1px solid rgb(217,217,217);border-right:1px solid rgb(217,217,217);border-top-left-radius:inherit;border-top-right-radius:inherit;background-color:#fff;overflow-y:auto;height:fit-content;max-height:calc(100% - 3.3em);width:100%}.modal-content>p{margin-left:1em;margin-right:1em}.modal-content>ul{margin-right:1em}.modal-button-panel{height:3.3em;border:1px solid;border-color:rgb(223,223,223) rgb(217,217,217) rgb(217,217,217);border-bottom-left-radius:inherit;border-bottom-right-radius:inherit;background-color:#fff;text-align:center;justify-content:center;display:flex;width:100%}.modal-button{min-width:2.5em;text-align:center;color:#fff;border-radius:5px;padding:.4em .4em .3em;height:1.25em;background-color:#3279b2;top:0;bottom:0;cursor:pointer;-webkit-user-select:none;user-select:none;margin:auto .31em}.modal-button:hover{background-color:#276da7}.modal-button:active{background-color:#1b5687}.modal-svg-button{padding:0 0 2px;width:2em;height:1.8em}.modal-svg-button-icon{width:100%;height:100%;filter:brightness(0) saturate(100%) invert(100%) sepia(15%) saturate(4%) hue-rotate(346deg) brightness(101%) contrast(102%)}#modal-background-panel{position:absolute;width:100%;height:100%;background-color:#00000042;z-index:1;display:none}.show-modal-background{animation:fadeInBackground .3s ease-in-out}@keyframes fadeInBackground{0%{opacity:0}to{opacity:1}}.show-modal{animation:fadeInModal .3s ease-in-out}@keyframes fadeInModal{0%{opacity:0;scale:.95}to{opacity:1;scale:1}}.hide-modal-background{animation:fadeOutBackground .2s ease-in-out}@keyframes fadeOutBackground{0%{opacity:1}to{opacity:0}}.hide-modal{animation:fadeOutModal .2s ease-in-out}@keyframes fadeOutModal{0%{opacity:1;scale:1}to{opacity:0;scale:.95}}.modal-camera-content{overflow:hidden;text-align:center;border:unset;height:100%;background-color:#2a2a2a;display:flex;justify-content:center}.camera-modal-canvas{max-width:100%;max-height:100%;margin-top:auto;margin-bottom:auto}.modal-svg-submit-button{background-color:green}.modal-svg-submit-button:hover{background-color:#007500}.modal-svg-submit-button:active{background-color:#006500}.modal-svg-submit-disabled{pointer-events:none;background-color:#747474}.modal-svg-close-button{height:1.56em;padding-top:.37em;padding-bottom:0;background-color:#c13e3e}.modal-svg-close-button:hover{background-color:#b43434}.modal-svg-close-button:active{background-color:#972929}.modal-svg-close-icon{width:80%;height:80%}.modal-svg-camera-button{height:1.6em;padding-top:.38em;padding-bottom:0}.modal-svg-camera-icon{height:76%}.modal-svg-refresh-icon{height:105%}.modal-svg-refresh-button{height:1.66em;padding-top:.11em;padding-bottom:.21em}.input-button-container{position:relative;z-index:1}.inside-right{position:absolute;right:calc(10% + .35em);bottom:.85em}.inside-left{position:absolute;left:calc(10% + .35em);bottom:.85em}.outside-left{position:absolute;right:calc(11px - .55em);bottom:.88em}.outside-right{position:absolute;left:calc(11px - .55em);bottom:.88em}#upload-images-icon{position:absolute;pointer-events:none;width:1.45em;height:1.45em;left:.11em;bottom:.08em;filter:brightness(0) saturate(100%) invert(43%) sepia(0%) saturate(740%) hue-rotate(77deg) brightness(99%) contrast(92%)}#upload-gifs-icon{position:absolute;pointer-events:none;width:1.5em;height:1.48em;left:.07em;bottom:.08em;filter:brightness(0) saturate(100%) invert(49%) sepia(0%) saturate(2586%) hue-rotate(12deg) brightness(93%) contrast(90%)}#upload-audio-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.17em;bottom:.2em;filter:brightness(0) saturate(100%) invert(15%) sepia(0%) saturate(337%) hue-rotate(125deg) brightness(91%) contrast(94%);transform:scaleX(.95)}#camera-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.23em;bottom:.2em;filter:brightness(0) saturate(100%) invert(52%) sepia(0%) saturate(161%) hue-rotate(164deg) brightness(91%) contrast(92%);transform:scaleX(.95)}#upload-mixed-files-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.25em;bottom:.2em;filter:brightness(0) saturate(100%) invert(53%) sepia(0%) saturate(36%) hue-rotate(74deg) brightness(98%) contrast(93%);transform:scaleX(.95)}#interim-text{color:gray}#microphone-button{padding-top:.5px}.outer-button-container>#microphone-button{padding-bottom:1px}#microphone-icon{position:absolute;pointer-events:none;width:1.21em;height:1.21em;left:.25em;bottom:.25em}.default-microphone-icon{filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%)}.active-microphone-icon{filter:brightness(0) saturate(100%) invert(10%) sepia(97%) saturate(7495%) hue-rotate(0deg) brightness(101%) contrast(107%);border-radius:10px}.command-microphone-icon{filter:brightness(0) saturate(100%) invert(42%) sepia(96%) saturate(1067%) hue-rotate(77deg) brightness(99%) contrast(102%)}.unsupported-microphone{display:none}#submit-icon{height:100%;filter:brightness(0) saturate(100%) invert(32%) sepia(0%) saturate(924%) hue-rotate(46deg) brightness(95%) contrast(99%);width:1.21em}#stop-icon{background-color:#acacac;position:absolute;width:.95em;height:.95em;left:.35em;bottom:.35em;border-radius:2px}.submit-button-enlarged{scale:1.1;margin-right:.3em;margin-left:.3em}.dots-jumping{position:relative;left:calc(-9990px + .275em);width:.22em;height:.22em;border-radius:5px;background-color:#848484;color:#848484;box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484;animation:dots-jumping 1.5s infinite linear;bottom:-.75em}@keyframes dots-jumping{0%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}16.667%{box-shadow:9990px -6px #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}33.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}50%{box-shadow:9990px 0 #848484,calc(9990px + .44em) -6px 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}66.667%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}83.333%{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) -6px 0 0 #848484}to{box-shadow:9990px 0 #848484,calc(9990px + .44em) 0 0 0 #848484,calc(9990px + .8em) 0 0 0 #848484}}.dots-flashing{position:relative;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite linear alternate;animation-delay:.5s}.dots-flashing:before,.dots-flashing:after{content:"";display:inline-block;position:absolute;top:0}.dots-flashing:before{left:-.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite alternate;animation-delay:0s}.dots-flashing:after{left:.7em;width:.45em;height:.45em;border-radius:5px;background-color:var(--message-dots-color);color:var(--message-dots-color);animation:dots-flashing 1s infinite alternate;animation-delay:1s}@keyframes dots-flashing{0%{background-color:var(--message-dots-color)}50%,to{background-color:var(--message-dots-color-fade)}}.input-button{border-radius:4px;cursor:pointer;margin-bottom:.2em;-webkit-user-select:none;user-select:none}.input-button-svg{width:1.65em;height:1.65em}.input-button:hover{background-color:#9c9c9c2e}.input-button:active{background-color:#9c9c9c5e}.loading-button{cursor:auto}.loading-button:hover{background-color:unset}.text-button{filter:unset!important;display:flex;justify-content:center;align-items:center;margin-left:4px;margin-right:4px;height:1.6em}#text-input-container{background-color:#fff;width:80%;display:flex;border:1px solid #0000001a;border-radius:5px;margin-top:.8em;margin-bottom:.8em;box-shadow:#959da533 0 1px 12px;overflow-y:auto;max-height:200px;position:relative}.text-input-container-left-adjustment{margin-left:1.5em}.text-input-container-right-adjustment{margin-right:1.5em}.text-input-container-left-small-adjustment{margin-left:1.1em}.text-input-container-left-small-adjustment>.outside-left{right:calc(14px - .55em)}.text-input-container-right-small-adjustment{margin-right:1.1em}.text-input-container-right-small-adjustment>.outside-right{left:calc(14px - .55em)}#text-input{text-align:left;outline:none;word-wrap:break-word;line-break:auto}.text-input-styling{padding:.4em .5em;overflow:overlay;width:100%}.text-input-inner-left-adjustment{padding-left:2.2em}.text-input-inner-right-adjustment{padding-right:2em}.text-input-disabled{pointer-events:none;-webkit-user-select:none;user-select:none}.text-input-placeholder{color:gray}.outside-right>#dropup-menu,.inside-right>#dropup-menu{right:0}#dropup-icon{position:absolute;pointer-events:none;width:1.16em;height:1.2em;left:.265em;bottom:.43em;filter:brightness(0) saturate(100%) invert(54%) sepia(0%) saturate(724%) hue-rotate(6deg) brightness(92%) contrast(90%)}#dropup-menu{background-color:#fff;position:absolute;transform:translateY(-100%);border-radius:5px;z-index:1;top:-.49em;box-shadow:#0003 -1px 2px 10px,#0000001a 0 2px 4px;cursor:pointer;-webkit-user-select:none;user-select:none}.dropup-menu-item{height:1.4em;padding:.28em .84em .28em .35em;display:flex;position:relative}.dropup-menu-item:first-child{padding-top:.49em;border-top-left-radius:inherit;border-top-right-radius:inherit}.dropup-menu-item:last-child{padding-bottom:.45em;border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.dropup-menu-item-icon{width:1.39em;position:relative;margin-right:.56em}.dropup-menu-item-icon>svg{bottom:0!important;top:0!important;margin-bottom:auto;margin-top:auto}.dropup-menu-item-text{margin-top:.08em;width:max-content}#input{width:100%;display:inline-flex;text-align:center;margin-left:auto;margin-right:auto;margin-top:auto;position:relative;justify-content:center}#chat-view{height:100%;display:grid;grid-template-columns:100%}::-webkit-scrollbar{width:9px;height:9px}::-webkit-scrollbar-thumb{background-color:#d0d0d0;border-radius:5px}::-webkit-scrollbar-track{background-color:#f2f2f2}.deep-chat-web-model-button{margin-top:10px;margin-bottom:5px;margin-left:1px}:host{all:initial;display:table-cell}#container{height:inherit;width:inherit;overflow:hidden}';var Bc=Object.defineProperty,jc=Object.getOwnPropertyDescriptor,Uc=function S(i,u,d,h){for(var m,v=h>1?void 0:h?jc(u,d):u,g=i.length-1;g>=0;g--)(m=i[g])&&(v=(h?m(u,d,v):m(v))||v);return h&&v&&Bc(u,d,v),v};var Hc=function(i){function E(){var i;_classCallCheck(this,E);i=_callSuper(this,E),i.getMessages=function(){return[]},i.submitUserMessage=function(){return console.warn("submitUserMessage failed - please wait for chat view to render before calling this property.")},i.addMessage=function(){return console.warn("addMessage failed - please wait for chat view to render before calling this property.")},i.focusInput=function(){return J.focusFromParentElement(i._elementRef)},i.refreshMessages=function(){},i.clearMessages=function(){},i.scrollToBottom=function(){},i.disableSubmitButton=function(){},i._hasBeenRendered=!1,i._auxiliaryStyleApplied=!1,i._elementRef=document.createElement("div"),i._elementRef.id="container",i.attachShadow({mode:"open"}).appendChild(i._elementRef),g.apply(Dc,i.shadowRoot),setTimeout((function(){i._hasBeenRendered||i.onRender()}),20);return i}_inherits(E,i);return _createClass(E,[{key:"changeToChatView",value:function changeToChatView(){this._activeService&&(this._activeService.validateKeyProperty=!1),this.onRender()}},{key:"onRender",value:function onRender(){var i;m.attemptAppendStyleSheetToHead(this.style),Te.processConnect(this),(!this._activeService||this._activeService.demo)&&(this._activeService=Gi.create(this)),this.auxiliaryStyle&&!this._auxiliaryStyleApplied&&(g.apply(this.auxiliaryStyle,this.shadowRoot),this._auxiliaryStyleApplied=!0),g.applyDefaultStyleToComponent(this.style,this.chatStyle),Te.checkForContainerStyles(this,this._elementRef),this._activeService.key&&this._activeService.validateKeyProperty?u.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):this._activeService instanceof ia&&!this._activeService.key?this._activeService instanceof ia&&ma.render(this._elementRef,this.changeToChatView.bind(this),this._activeService):((i=this._childElement)!==null&&i!==void 0?i:this._childElement=this.children[0],Fc.render(this,this._elementRef,this._activeService,this._childElement)),this._hasBeenRendered=!0,Ir.onRender(this)}},{key:"disconnectedCallback",value:function disconnectedCallback(){ba.chat=void 0}}])}(ca);Uc([_("object")],Hc.prototype,"connect",2);Uc([_("object")],Hc.prototype,"directConnection",2);Uc([_("object")],Hc.prototype,"webModel",2);Uc([_("object")],Hc.prototype,"requestBodyLimits",2);Uc([_("function")],Hc.prototype,"requestInterceptor",2);Uc([_("function")],Hc.prototype,"responseInterceptor",2);Uc([_("function")],Hc.prototype,"validateInput",2);Uc([_("object")],Hc.prototype,"chatStyle",2);Uc([_("object")],Hc.prototype,"attachmentContainerStyle",2);Uc([_("object")],Hc.prototype,"dropupStyles",2);Uc([_("object")],Hc.prototype,"inputAreaStyle",2);Uc([_("object")],Hc.prototype,"textInput",2);Uc([_("object")],Hc.prototype,"submitButtonStyles",2);Uc([_("string")],Hc.prototype,"auxiliaryStyle",2);Uc([_("array")],Hc.prototype,"history",2);Uc([_("object")],Hc.prototype,"introMessage",2);Uc([_("object")],Hc.prototype,"avatars",2);Uc([_("object")],Hc.prototype,"names",2);Uc([_("boolean")],Hc.prototype,"displayLoadingBubble",2);Uc([_("object")],Hc.prototype,"errorMessages",2);Uc([_("object")],Hc.prototype,"messageStyles",2);Uc([_("object")],Hc.prototype,"textToSpeech",2);Uc([_("object")],Hc.prototype,"speechToText",2);Uc([_("object")],Hc.prototype,"images",2);Uc([_("object")],Hc.prototype,"gifs",2);Uc([_("object")],Hc.prototype,"camera",2);Uc([_("object")],Hc.prototype,"audio",2);Uc([_("object")],Hc.prototype,"microphone",2);Uc([_("object")],Hc.prototype,"mixedFiles",2);Uc([_("object")],Hc.prototype,"dragAndDrop",2);Uc([_("object")],Hc.prototype,"introPanelStyle",2);Uc([_("object")],Hc.prototype,"htmlClassUtilities",2);Uc([_("function")],Hc.prototype,"onMessage",2);Uc([_("function")],Hc.prototype,"onClearMessages",2);Uc([_("function")],Hc.prototype,"onComponentRender",2);Uc([_("function")],Hc.prototype,"onError",2);Uc([_("object")],Hc.prototype,"demo",2);Uc([_("object")],Hc.prototype,"_insertKeyViewStyles",2);customElements.define("deep-chat",Hc);export{Hc as DeepChat};

